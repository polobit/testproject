<script id="subscribe-template" type="text/html">
<div class="row">
	<div class="span12">
		<div class="page-header">
			<h1>Plan and Upgrade
				<a href="#" id="cancel-account-request" class="pull-right btn btn-danger" align="center" style="margin-top:10px;">Cancel My Account</a>
				{{#if billingData}}
					<a href="#update-card" id="change-card" class="pull-right btn" align="center" style="margin-top:10px;margin-right:10px">Change card</a>
				{{else}}
					<a href="#update-card" id="change-card" class="pull-right btn btn-primary" align="center" style="margin-top:10px;margin-right:10px;display:none">Change card</a>
				{{/if}}
			</h1>
		</div>
	</div>
</div>
<div class="row-fluid">
	<div class="span11">
		<div class="span4" id="plan-details-pane"></div>
		<div class="span4" id="email-details-pane"></div>
		
	</div>
</div>
<div class="row-fluid" style="margin-top:50px">
	<div class="span5">
		<div style="border-bottom:1px solid #f5f5f5;margin-bottom:20px">
			<h3>Your Credit Card Details</h3>
		</div>
		<div id="customer-details-holder">		
	</div>
	</div>
</div>
	{{#if billingData}}
	<div class="row-fluid">
	<div class="span5" style="margin-top:20px">
		<div style="border-bottom:1px solid #f5f5f5;margin-bottom:20px">
			<h3>Recent Payments<small style="font-size:11px;margin-left:5px">Thank you</small></h3>
		</div>
			<div id="invoice-details-holder"></div>
	</div>
	</div>
	{{/if}}
<div id="credit-card-form-modal-holder"></div>

</script>

<script id="customer-details-block-template" type="text/html">
{{#stringToJSON this "billingData"}}{{/stringToJSON}}
{{#if billingData}}
	<div class="card-details">
		Name: {{billingData.cards.data.0.name}} </br>
		Credit card: **** **** **** {{billingData.cards.data.0.last4}} <br/>
		Expiration: {{getMonthFromIndex billingData.cards.data.0.expMonth}}, {{billingData.cards.data.0.expYear}}  ({{#if_less_than billingData.cards.data.0.expMonth 9}}0{{billingData.cards.data.0.expMonth}}{{else}}{{billingData.cards.data.0.expMonth}}{{/if_less_than}} / {{billingData.cards.data.0.expYear}})
	</div>
	{{else}}
		No Credit Cards attached. <a href="#attach-card" id="change-card">Attach card</a>
{{/if}}
</script>

<script id="account-plan-details-template" type="text/html">
<div class="well" style="width: 220px; height: 200px;">
	<div style="width: 220px; height: 180px;">
		<div style="border-bottom: 1px solid #e5e5e5">
		<h3><i class="icon-group" style="margin-right:5px"></i>Users</h3>
		</div>
		<div class="clearfix"></div>
<div class="form-horizontal"
			style="margin-left: -33%; margin-top: 10px">
		{{#getSubscriptionBasedOnPlan billingData plan}}
			<div class="control-group">
				<label class="control-label">Plan</label>
				<div class="controls" style="margin-top: 5px;">
					{{getAccountPlanName ../plan.plan_type}} ({{getAccountPlanInteval
					../plan.plan_type}})</div>
			</div>
			<div class="control-group" style="margin-top: -5%">
				<label class="control-label" style="margin-top: -2%">Users</label>
				<div class="controls">{{quantity}}</div>
			</div>
			<div class="control-group" style="margin-top: -5%">
				<label class="control-label" style="margin-top: -2%">Cost</label>
				<div class="controls">${{total}} </br>
					<small>({{quantity}} * {{numeric_operation plan.amount "100" "/"}})</small>
				</div> 
			</div>
			<div class="control-group" style="margin-top: -5%">
				<label class="control-label" style="margin-top: -2%">Next Invoice</label>
				<div class="controls">
					{{epochToHumanDate "mmm dd, yyyy" currentPeriodEnd}}
				</div>
			</div>
		</div>
		{{else}}
		<div class="control-group">
				<label class="control-label">Plan</label>
				<div class="controls" style="margin-top: 5px;">
					Free</div>
			</div>
			<div class="control-group" style="margin-top: -5%">
				<label class="control-label" style="margin-top: -2%">Users</label>
				<div class="controls">2</div>
			</div>
</div>
</div>
		{{/getSubscriptionBasedOnPlan}} 
		{{#if billingData}} 
			{{#check_plan "FREE"}}
				<a class="btn btn-primary" href="#subscribe-plan" id="account_plan_upgrade">
				Update </a> 
				{{else}}
				<a class="btn btn-primary" href="#subscribe-plan" id="account_plan_upgrade">
				Change </a> 
			{{/check_plan}}
			{{else}} 
				<a class="btn btn-primary" href="#" id="attach_card_notification"> Upgrade </a>
	 	{{/if}}

	<!--<a style="margin-top:6px;float:right;cursor:pointer;text-decoration:none" id="user-plan-details-popover"><i class="icon-info-sign"></i> Plan Details</a> -->
</div>
</script>
<script id="account-plan-details-popover-template" type="text/html">
{{#if_greater contactLimit 2100000000}}
 	Contacts   : Unlimited Contacts <br/>
{{else}}
	Contacts   : {{contactLimit}} <br/>
{{/if_greater}}
 Webrules   : {{webRuleLimit}} <br/>
{{#if_greater contactLimit 2100000000}}
 	Contacts   : Unlimited Workflows <br/>
{{else}}
	Workflows   : {{workflowLimit}} <br/>
{{/if_greater}}
White Label : {{#if whiteLabelEnabled}} Yes {{else}} No{{/if}} 
</script>

<script id="email-plan-subscription-details-popover-template" type="text/html">
{{#if emailPlan}}
		 Plan Limit   : {{numeric_operation emailPlan.quantity "1000" "*"}} <br/>
	{{else}}
		Plan Limit   : 5000 <small>Powered by Agile CRM</small> <br/>
{{/if}}
{{#if cachedData.one_time_emails_count}}
 	Emails in account    : {{cachedData.one_time_emails_count}} <br/>
{{/if}}

</script>

<script id="email-plan-details-template" type="text/html">
<div class="span4">
	<div class="well" style="width: 220px; height: 200px;">
		<div style="width: 220px; height: 180px;">
			<div style="border-bottom: 1px solid #e5e5e5;">
				<h3><i class="icon-envelope" style="margin-right:5px"></i>Emails</h3>
			</div>
			<div class="clearfix"></div>

			<form id="gateway" class="form-horizontal hide">
				<input type="text" name="gateway" class="hidden" value="Stripe" />
			</form>

			{{#getSubscriptionBasedOnPlan billingData emailPlan}} 
			<div class="form-horizontal" name="emailPlan"
				style="margin-left: -33%; margin-top: 10px" id="email-plan-form">
				<div class="control-group">
					<label class="control-label">Emails</label>
					<div class="controls" style="margin-top: 5px;">
						{{numeric_operation ../emailPlan.quantity 1000 "*"}} <small>per month</small></div>
				</div>
				<div class="control-group" style="margin-top: -5%">
					<label class="control-label" style="margin-top: -2%">Cost</label>
					<div class="controls">${{total}} <br/><small>(Charged @ ${{numeric_operation plan.amount "100" "/"}} per thousand)</small></div>
				</div>	
				</br>
				<div class="control-group" style="margin-top: -5%">
					<label class="control-label" style="margin-top: -2%">Next Invoice</label>
					<div class="controls">
						{{epochToHumanDate "mmm dd, yyyy" currentPeriodEnd}}
					</div>
				</div>
				</div>
</div>
				{{else}}
				<div style="margin-top: 10%; text-align: center; font-size: 15px">
					5000 Emails <br />
				<div style="margin-top:10px"><small> Powered by Agile CRM </small></div>
				</div>
</div>
			{{/getSubscriptionBasedOnPlan}}

			<div class="clearfix"></div>
			{{#if billingData}}
			{{#if emailPlan}}
					<a class="btn btn-primary" href="#subscribe" id="account_email_plan_upgrade">Change </a>
				{{else}}
					<a class="btn btn-primary" href="#subscribe" id="account_email_plan_upgrade">Upgrade </a>
			{{/if}}
			{{else}} 
				<a class="btn btn-primary" href="#" id="account_email_attach_card"> Upgrade </a> 
			{{/if}}
<!--	<a style="margin-top:6px;float:right;cursor:pointer;text-decoration:none" id="email-plan-details-popover"><i class="icon-info-sign"></i> Usage Details</span> -->
		
</div>
</div>
</script>

<script id="email-plan-form-template" type="text/html">
<div class="span4">
	<div class="well" style="width: 220px; height: 200px;">
		<div style="width: 220px; height: 180px;">
			<div style="border-bottom: 1px solid #e5e5e5;">
				<h3>Email plan</h3>
			</div>
			<div class="clearfix"></div>

			<form id="gateway" class="form-horizontal hide">
				<input type="text" name="gateway" class="hidden" value="Stripe" />
			</form>
				<form class="form-horizontal" name="emailPlan" style="margin-left:-40%;margin-top:10px" id="email-plan-form">
						<div class="control-group">
                       		 <label class="control-label" style="margin-top:5px">Send Rate</label>
                        		<div class="controls" style="margin-top: 5px;">
									<span style="margin-top:5px;float:right"> X 1000 </span><input type="text" class="input input-small required number" id="email-quantity" name="quantity" min="1"></input>
                        		</div>
                    		</div>
							<div class="control-group">
								<div class="controls">
									<span style="color: #FA782D; font-size: 30px;margin-left:0px">$<span id="emails_total_cost">0</span></span><span style="margin-left:3px">Per month</span>
									<br/>
									<small style="margin-top: 0px;margin-left:-30px">
										 charged @ <span style="color: #FA782D;" id="email_rate">$4</span> / 1000 emails
									</small>
								</div>
							</div>
				</form>
		</div>
<div class="clearfix"></div>
					<a class="btn btn-primary save" href="#"> Purchase </a>

					<a class="btn" href="#" id="close"> close </a>
	</div>
</div>
</script>

   <script id="charge-collection-template" type="html/text">
	{{#if this.length}}
        <table class="table table-striped" id="sort-table">
            <thead>
                <tr>
				 	<th>Date</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody id="charge-model-list" class="model-list-cursor">
            </tbody>
        </table>
	{{else}}
		No recent payments.
	{{/if}}
</script>
<script id="charge-model-template" type="text/html">
	<td><time class="time-ago" datetime="{{epochToHumanDate "" created}}">{{epochToHumanDate "ddd mmm dd yyyy HH:MM:ss" created}}</time></td>	
	<td >
    	${{numeric_operation amount 100 "/"}} {{#if refunded}} - Refunded {{/if}}
	</td>
	
	
</script>