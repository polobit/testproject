<script id="task-detail-template" type="text/html">
<div class="row-fluid">
       <div class="span12">
            <div style="margin-bottom: 20px; margin-top:25px;">
			<div class="row-fluid" style="margin-bottom: -10px;">
                 <span class="pull-left taskDetail-text" style="margin-bottom: -10px;"> 
                    <h2 style="text-transform: capitalize;">{{#is_link subject}}<span class="activate-link">{{else}}<span>{{/is_link}}{{safe_string subject}}</span></h2>
                  </span>
					<span class="label" style="margin-top: 11px;display: inline-block;margin-left: 10px">{{task_property type}}</span>                  
                    {{#if_not_equals priority_type "NORMAL" }}
                   <span class="label label-{{task_label_color priority_type}}" style="display: inline-block;margin-left: 4px">{{ucfirst priority_type}}</span>
                         {{/if_not_equals}}
                 	<!--  starting rating,edit,owner -->

					<div class="btn-group right">
					   <a class="btn" href="javascript:void(0)" data="{{id}}" id="task_edit" ><i class="icon-edit"></i> Edit</a>
                        <a class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></a>
                    	
								<ul class="dropdown-menu pull-right" role="menu">
									<li><a href="#new-task-modal"  data-toggle="modal"><i class="icon-file"></i>Add Note</a></li>
                                    
									<li><a href='javascript:void(0)'  data="{{id}}" class ="delete_task"><i	class="icon-trash"></i> Delete</a></li>
								</ul>
					 </div>
                 </div>
             </div>
            <!---------- end of row ------------>


  <!--------- task status ---------------->

<div class="row-fluid">
<div class="span10" >
{{#if_equals "IN_PROGRESS" status}}
<div style="width:230px">
<div class="pull-left" style="text-transform: capitalize;width:50%;">{{displayTaskStatus status}} ({{progress}}%)</div>
 <div class="pull-right" style="width:50%;text-align: right;"><time datetime="{{epochToHumanDate "dd mmm yyyy" due}}">(Due {{epochToHumanDate "dd mmm yyyy" due}})</time></div>
<div class="clearfix"></div>
<div   style="width: 100%;height:5px;" class="progress progress-info">
          <div class="bar" style="width: {{progress}}%;"></div>
     </div>
</div>
{{/if_equals}}

{{#if_equals "COMPLETED" status}}
<span class="span4" style="text-transform: capitalize;">{{displayTaskStatus status}}
{{#if task_completed_time}}<time datetime="{{epochToHumanDate "dd mmm yyyy" task_completed_time}}">({{epochToHumanDate "dd mmm yyyy" task_completed_time}})</time>{{/if}}
</span>

{{/if_equals}}

{{#if_equals "YET_TO_START" status}}
<span class="span4" style="text-transform: capitalize;">{{displayTaskStatus status}}
<time datetime="{{epochToHumanDate "dd mmm yyyy" due}}">(Due {{epochToHumanDate "dd mmm yyyy" due}})</time>
</span>
{{/if_equals}}
</div>
<div class="span2">
<div class="pull-right" style="position: relative;width: 100%;">
<div class="contact-owner-position" style="top: 0px;">
<div class="change-owner-succes"></div>
  <span title="Owner" class="contact-owner-view">
      	<span class="contact-owner" id="change-owner-element">
        	<span class="contact-owner-text">Owner:&nbsp;&nbsp;</span>
			{{#if taskOwner}}
        	<span class="contact-owner-pic"><img class="user-img"  alt="" src="{{defaultGravatarurl 40}}" /></span>
			{{else}}
			<span class="contact-owner-pic"><img class="user-img"  alt="" src="{{defaultGravatarurl 40}}" /></span>
            <span class="task-owner-add" style="font-size:13px;"><a style="cursor:pointer;">Assign Owner</a></span>
 			{{/if}}
        	<span id="task-owner" data={{taskOwner.id}} class="task-owner-name contact-owner-name">{{taskOwner.name}}</span>
        
        	{{#canEditContact taskOwner.id}}
        	<div class="btn-group" id="change-task-owner-ul" style="vertical-align: middle; display: none">
        		 <a class="btn dropdown-toggle" data-toggle="dropdown">Change Owner <span class="caret"></span></a>
        		 <ul id='task-detail-owner' class="dropdown-menu pull-right"></ul>
        	</div> 
			{{/canEditContact}}
       </span>
    </span>
</div>
</div>
</div>
</div>

<div class="row-fluid"  style="border-bottom: 1px solid #ddd;margin-bottom: 15px; padding-bottom: 15px;">
<div class="row-fluid" id="task-contact-img" style="margin-top: -8px;">
        	{{#each contacts}}
        		{{#if_contact_type "PERSON"}}
        			<a href="#contact/{{id}}" class="activate-link"><img class="thumbnail img-inital" data-name="{{dataNameAvatar properties}}" src="{{gravatarurl properties 40}}" width="40px" height="40px" style="display:inline; width:40px; height:40px; "  title="{{getPropertyValue properties "first_name"}} {{getPropertyValue properties "last_name"}}" /></a>
        		{{/if_contact_type}}
				{{#if_contact_type "COMPANY"}}
        			<a href="#contact/{{id}}" class="activate-link"><img class="thumbnail" {{getCompanyImage "40" "display:inline;"}} title="{{getPropertyValue properties "name"}}"/></a>
        		{{/if_contact_type}}
        	{{/each}}
</div>
</div> 

  </div>
</div>

		<div class="row-fluid">
		<!--  starting time line view -->
       <!-- ending of tabs --->
		<div class="span9">
			<ul class="nav nav-tabs" id="taskDetailsTab">
                <li  class="active"><a data-toggle="tab" href="#activity">Activity</a></li>
				<li><a data-toggle="tab" href="#notes">Notes</a></li>
				<li><a data-toggle="tab" href="#contacts">Related</a></li>
			</ul>
           
			<div class="tab-content" id="task_tab_detail">
                <div class="tab-pane active" id="activity"><img src="img/21-0.gif"></img></div>
				<div class="tab-pane " id="contacts"><img src="img/21-0.gif"></img></div>
				<div class="tab-pane" id="notes"><img src="img/21-0.gif"></img></div>
			</div>
       </div>
    <!-- ending of tabs --->
		</div>
	<!--  ending timeline view -->

	</script>

<script id="task-related-collection-template" type="text/html">
{{#if this.length}}
	<div style='height:30px'>
		<a href="#" class="task-add-contact btn right" style="position:relative;margin-bottom:10px;">
			<span><i class="icon-plus-sign"></i></span> Add Contact
		</a>
	</div>
	<br/>
			<table  class="table table-striped agile-ellipsis-dynamic onlySorting" style="overflow: scroll; border-radius: 5px; -webkit-border-radius: 5px; margin-bottom:0px; border: 1px solid #dddddd; border-collapse: separate;">
				<colgroup><col width="10px"><col width="40%"><col width="20%"><col width="25%"><col width="12%"></colgroup>
				<thead>
					<tr><th></th>
						<th>Name</th>
						<th>Work</th>
						<th>Tags</th>
						<th>Lead Score</th>
					</tr>
				</thead>
				<tbody id="task-related-model-list" class="task-related-model-list agile-edit-row"
					route="contact/" style="overflow: scroll;">
				</tbody>
			</table>

		{{else}}
			<div class="slate">
            	<div class="slate-content">
                	<div class="box-left">
                    	<img alt="Clipboard" src="/img/clipboard.png">
                	</div>
                	<div class="box-right">
                    	<h3>Task is not associated with any person/contact. </h3>
                    	<div class="text">
							All Contacts which are related to this task are shown here.
							<br/>
							<a href="#" class="task-add-contact btn left" style="margin-top:10px; margin-bottom:10px;">
								<i class="icon-plus-sign"></i> Add Contact
							</a>
                    	</div>
                	</div>
            	</div>
        	</div>
		{{/if}}
</script>

<script id="task-related-model-template" type="text/html">
	<td></td>
	<td class="data" data="{{id}}" style="white-space:nowrap;">
    	<div style="display:inline;padding-right:10px;height:auto;">
          {{#if_contact_type "PERSON"}}
        	<img class="thumbnail img-inital" data-name="{{dataNameAvatar properties}}" src="{{gravatarurl properties 40}}" width="40px" height="40px" style="display:inline; width:40px; height:40px; "  title="{{getPropertyValue properties "first_name"}} {{getPropertyValue properties "last_name"}}" />
        		
             <div style="height:auto;display:inline-block;vertical-align:top;text-overflow:ellipsis;white-space:nowrap;width:12em;overflow:hidden;">
        		<b>	{{getPropertyValue properties "first_name"}}
        		{{getPropertyValue properties "last_name"}} </b>
        		<br />
        		{{getPropertyValue properties "email"}}
    	</div>
          {{/if_contact_type}}
				{{#if_contact_type "COMPANY"}}
        	 <img class="thumbnail" {{getCompanyImage "40" "display:inline;"}} title="{{getPropertyValue properties "name"}}"/>
           <div style="height:auto;display:inline-block;vertical-align:top;text-overflow:ellipsis;white-space:nowrap;width:12em;overflow:hidden;">
        		<b>{{getPropertyValue properties "name"}}
        	
    	</div>
           
        		{{/if_contact_type}}
    	</div>
    	
	</td>
	<td><div style="height:auto;display:inline-block;vertical-align:top;text-overflow:ellipsis;width:8em;overflow:hidden;">{{getPropertyValue properties "title"}}<br />
    	{{getPropertyValue properties "company"}}</div>
	</td>
	<td> 
<div class="ellipsis-multiline" style="line-height:20px !important; word-break:keep-all;">
	{{#each tags}}
    	<span class="label">{{this}}</span>
    {{/each}}
</div>
	</td>
	<td style="width:6em;"><div>{{lead_score}}</div></td>
</script>



<script id="task-related-activity-collection-template" type="text/html">
{{#unless this.length}}
        <div class="slate">
            <div class="slate-content">
                <div class="box-left">
                    <img alt="Clipboard" src="/img/clipboard.png" />
                </div>
                <div class="box-right">
                    <h3>No Activity Found.</h3>
                </div>
            </div>
        </div>
 {{/unless}}

{{#if this.length}}
<div class="page-header" style="margin-top: 0px !important;padding-bottom: 0px;border-bottom: 0px;"></div>
	<ul id="task-related-activity-model-list" class="ativity-block-ul" style="margin:0px;"></ul>
{{/if}}
</script>

<script id="task-related-activity-model-template" type="text/html">
<div style="display:block;" class="activity">
<div class="activity-text-block" style="background: #f5f5f5;">
	<span class="activity-block-owner">
         {{#if user}}
			{{#if userPic}}
				<img class="user-img thumbnail" width="40" height="40" alt="" src="{{userPic}}" >
			{{else}}
				<img class="user-img thumbnail" width="40" height="40" alt="" src="{{defaultGravatarurl 40}}" >
			{{/if}}
		{{else}}
			<img class="user-img thumbnail" width="40" height="40" alt="" src="{{#getCurrentUserPrefs}}{{#if pic}}{{pic}}{{else}}{{defaultGravatarurl 40}}{{/if}}{{/getCurrentUserPrefs}}" >
		{{/if}}

     <span class="owner-name">{{user.name}}</span>

	</span>
	<h4><b>{{get_normal_activity_type activity_type}}</b></h4>


   {{#if_equals "TASK_EDIT" activity_type}}
	<div style="background:none;border:none;margin-top: 8px;">
         {{displayActivityFieldText custom3}} updated.
	</div>	
     {{/if_equals}}

 {{#if_equals "TASK_ADD" activity_type}}
	<div style="background:none;border:none;margin-top: 8px;">
         Task created for user {{ucfirst custom1}}.
	</div>	
     {{/if_equals}}

 {{#if_equals "TASK_PROGRESS_CHANGE" activity_type}}
	<div style="background:none;border:none;margin-top: 8px;">
         Task progress changed from {{custom2}}% to {{custom1}}%.
	</div>	
     {{/if_equals}}

 {{#if_equals "TASK_OWNER_CHANGE" activity_type}}
	<div style="background:none;border:none;margin-top: 8px;">
      Task  owner changed to {{custom1}}.
	</div>	
     {{/if_equals}}

 {{#if_equals "TASK_STATUS_CHANGE" activity_type}}
	<div style="background:none;border:none;margin-top: 8px;">
        Status changed from {{displayTaskStatus custom2}} to {{displayTaskStatus custom1}}.
	</div>	
     {{/if_equals}}


 {{#if_equals "TASK_COMPLETED" activity_type}}
	<div style="background:none;border:none;margin-top: 8px;">
        Task status changed to completed.
	</div>	
     {{/if_equals}}

 {{#if_equals "TASK_DELETE" activity_type}}
	<div style="background:none;border:none;margin-top: 8px;">
        Task is deleted
	</div>	
     {{/if_equals}}


 {{#if_equals "TASK_RELATED_CONTACTS" activity_type}}
	<div style="background:none;border:none;margin-top: 8px;">
    {{#if related_contact_ids}}{{#stringToJSON this "related_contact_ids"}}{{#toLinkTrigger this}}<a href="#contact/{{this.contactid}}">{{this.contactname}}</a>{{/toLinkTrigger}}{{/stringToJSON}}{{/if}} 
    {{#if_equals "added_relatedcontacts" custom3}}
       attached to
      {{else}}
        removed from
     {{/if_equals}}
       the task
    </div>	
  {{/if_equals}}

	<div class="clear">
		<small class="edit-hover" style="margin-right:10px"> 
			<time  datetime="{{epochToHumanDate "" time}}" style="border-bottom:dotted 1px #999">{{epochToHumanDate "dd mmm yyyy" time}}</time>
		</small>
	</div>

</div>
</script>

<!-- New (Note) Modal views -->
<div class="modal hide fade tasknoteupdatemodal"
	id="tasknoteupdatemodal">
	<div class="modal-header">
		<button class="close" data-dismiss="modal">x</button>
		<h3>
			<i class="icon-plus-sign"></i>&nbsp;Edit Note
		</h3>
	</div>
	<div class="modal-body">
		<form id="tasknoteUpdateForm" name="tasknoteUpdateForm" method="post">
			<fieldset>

				<input name="id" id="id" type="hidden" value="{{id}}" /> <input
					name="created_time" id="created_time" type="hidden"
					value="{{created_time}}" />

				<div class="control-group">
					<label class="control-label"><b>Subject</b> <span
						class="field_req">*</span></label>
					<div class="controls">
						<input type="text" placeholder="About" name="subject" id="subject"
							class="required" />
					</div>
				</div>
				<div class="row-fluid">
					<div class="control-group">
						<label class="control-label"><b>Description</b></label>
						<div class="controls">
							<textarea rows="3" class="span8" placeholder="Detailed Note"
								name="description" id="description" style="max-width: 400px;"></textarea>
						</div>
					</div>
				</div>

			</fieldset>
		</form>
	</div>
	<div class="modal-footer">
		<a href="#" class="btn btn-primary" id="task_note_update">Save </a> <span
			class="save-status"></span>
	</div>
</div>
<!-- End of Modal views -->


<!-- New (Note) Modal views -->
<div class="modal hide fade task-note-modal" id="new-task-modal">
	<div class="modal-header">
		<button class="close" data-dismiss="modal">x</button>
		<h3>
			<i class="icon-plus-sign"></i>&nbsp;Add Note
		</h3>
	</div>
	<div class="modal-body">
		<form id="tasknoteForm" name="tasknoteForm" method="post">
			<fieldset>
				<div class="control-group">
					<label class="control-label"><b>Subject</b> <span
						class="field_req">*</span></label>
					<div class="controls">
						<input type="text" placeholder="About" name="subject" id="subject"
							class="required" />
					</div>
				</div>
				<div class="row-fluid">
					<div class="control-group">
						<label class="control-label"><b>Description</b></label>
						<div class="controls">
							<textarea rows="3" class="span8" placeholder="Detailed Note"
								name="description" id="description" style="max-width: 400px;"></textarea>
						</div>
					</div>
				</div>

			</fieldset>
		</form>
	</div>
	<div class="modal-footer">
		<a href="#" class="btn btn-primary" id="tasknote_validate">Save </a> <span
			class="save-status"></span>
	</div>
</div>
<!-- End of Modal views -->

