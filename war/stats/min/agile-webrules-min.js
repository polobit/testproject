function _agile_execute_action(action){switch(action.action){case"MODAL_POPUP":_agile_when(action,function(){_agile_show_modal(action)});break;case"FORM":_agile_when(action,function(){_agile_show_modal(action)});break;case"CORNER_NOTY":_agile_when(action,function(){_agile_show_noty(action)});break;case"ASSIGN_CAMPAIGN":_agile.add_campaign({id:action.RHS});break;case"UNSUBSCRIBE_CAMPAIGN":_agile.unsubscribe_campaign({id:action.RHS});break;case"ADD_TAG":_agile.add_tag(action.RHS);break;case"REMOVE_TAG":_agile.remove_tag(action.RHS);break;case"JAVA_SCRIPT":eval("["+action.popup_text.value+"]");break;case"ADD_SCORE":_agile.add_score(action.RHS);break;case"SUBTRACT_SCORE":action.RHS=action.RHS<0?action.RHS:-action.RHS;_agile.add_score(action.RHS);break}}function _agile_close_modal(){if(window.parent._agile_SM){window.parent._agile_SM.hide()}if(_agile_SM){_agile_SM.hide()}}function _agile_check_condition(a){switch(a.LHS){case"tags":switch(a.CONDITION){case"EQUALS":return _agile_rules.tags_in(a);case"NOTEQUALS":return _agile_rules.tags_out(a)}break;case"page":switch(a.CONDITION){case"EQUALS":return _agile_rules.page_view_is(a);case"MATCHES":return _agile_rules.page_view_matches(a);case"NOTEQUALS":return _agile_rules.page_view_is_not(a);case"NOT_CONTAINS":return _agile_rules.page_view_not_matches(a)}break;case"visit":switch(a.CONDITION){case"ONLY_ONCE":return _agile_rules.once(a);case"ONCE_PER_SESSION":return _agile_rules.once_per_session(a);case"EVERYTIME":return _agile_rules.everytime(a)}break;case"referrer":switch(a.CONDITION){case"EQUALS":return _agile_rules.referrer_is(a);case"NOTEQUALS":return _agile_rules.referrer_is_not(a);case"MATCHES":return _agile_rules.referrer_matches(a);case"NOT_CONTAINS":return _agile_rules.referrer_not_matches(a)}break;case"tags_time":return _agile_rules.tags_time(a);case"created_time":return _agile_rules.contact_time(a);case"title":switch(a.CONDITION){case"EQUALS":return _agile_rules.contact_properties_in(a);case"NOTEQUALS":return _agile_rules.contact_properties_out(a)}break;case"company":switch(a.CONDITION){case"EQUALS":return _agile_rules.contact_properties_in(a);case"NOTEQUALS":return _agile_rules.contact_properties_out(a)}break;case"lead_score":switch(a.CONDITION){case"IS_LESS_THAN":return _agile_rules.max_score(a);case"IS_GREATER_THAN":return _agile_rules.min_score(a);case"EQUALS":return _agile_rules.score(a)}break;case"owner_id":switch(a.CONDITION){case"EQUALS":return _agile_rules.owner_is(a);case"NOTEQUALS":return _agile_rules.owner_is_not(a)}break;default:switch(a.CONDITION){case"EQUALS":return _agile_rules.contact_properties_in(a);case"NOTEQUALS":return _agile_rules.contact_properties_out(a);case"MATCHES":return _agile_rules.contact_properties_match(a);case"NOT_CONTAINS":return _agile_rules.contact_properties_doesnot_match(a);default:return _agile_rules.custom_time(a)}}}var _agile_rules={tags_in:function(c){if(c.RHS&&_agile_contact){var b=_agile_contact.tags.length;for(var a=0;a<b;a++){if(c.RHS===_agile_contact.tags[a]){return true}}}},tags_out:function(d){if(_agile_contact&&d.RHS){var b=0;var c=_agile_contact.tags.length;for(var a=0;a<c;a++){if(_agile_contact.tags[a]!==d.RHS){b++}}if(b==c&&b!==0&&c!==0){return true}}},tags_time:function(a){if(a.RHS&&_agile_contact){var k=a.RHS;var c=a.nested_lhs;var i=a.nested_rhs;var e=_agile_contact.tagsWithTime.length;var b=new Date().getTime();for(var d=0;d<e;d++){if(k==_agile_contact.tagsWithTime[d].tag){var b=new Date().getTime();var g=(_agile_contact.tagsWithTime[d].createdTime);var f=(b-g);if((a.nested_condition=="LAST"&&(0<=f&&f<=(c*86400000)))||(a.nested_condition=="AFTER"&&(c<=g)&&((g-c)>=86400000))||(a.nested_condition=="BEFORE"&&(c>=g))||(a.nested_condition=="EQUALS"&&(0<=(g-c)&&(g-c)<=86400000))||(a.nested_condition=="BETWEEN"&&(c<=g&&g<=i))){return true}}}}},min_score:function(a){if(_agile_contact&&a.RHS&&_agile_contact.lead_score>a.RHS){return true}},max_score:function(a){if(_agile_contact&&a.RHS&&_agile_contact.lead_score<a.RHS){return true}},score:function(a){if(_agile_contact&&a.RHS&&_agile_contact.lead_score==a.RHS){return true}},referrer_is:function(a){if(a.RHS==document.referrer){return true}},referrer_matches:function(b){var a=document.referrer;if(a.indexOf(b.RHS)!==-1){return true}},referrer_not_matches:function(b){var a=document.referrer;if(a.indexOf(b.RHS)==-1){return true}},referrer_is_not:function(a){if(a.RHS!==document.referrer){return true}},page_view_is:function(a){if(a.RHS===document.location.href){return true}},page_view_is_not:function(a){if(a.RHS!==document.location.href){return true}},page_view_not_matches:function(b){var a=document.location.href;if(a.indexOf(b.RHS)==-1){return true}},page_view_matches:function(b){var a=document.location.href;if(a.indexOf(b.RHS)!==-1){return true}},contact_properties_in:function(c){if(_agile_contact&&c.RHS){var a=_agile_contact.properties.length;for(var b=0;b<a;b++){if(c.LHS==_agile_contact.properties[b].name&&c.RHS==_agile_contact.properties[b].value){return true}}}},contact_properties_out:function(d){if(_agile_contact&&d.RHS){var a=0;var b=_agile_contact.properties.length;for(var c=0;c<b;c++){if(d.LHS==_agile_contact.properties[c].name&&d.RHS!=_agile_contact.properties[c].value){return true}if(d.LHS!==_agile_contact.properties[c].name){a++}}if(a==b&&a!=0&&b!=0){return true}}},contact_time:function(f){if(_agile_contact&&f.RHS){var e=new Date().getTime();var c=(_agile_contact.created_time*1000);var a=(e-c);var d=f.RHS;var b=f.RHS_NEW;if((f.CONDITION=="LAST"&&(0<=a&&a<=(d*86400000)))||(f.CONDITION=="AFTER"&&(d<=c)&&((c-d)>=86400000))||(f.CONDITION=="BEFORE"&&(d>=c))||(f.CONDITION=="ON"&&(0<=(c-d)&&(c-d)<=86400000))||(f.CONDITION=="BETWEEN"&&(d<=c&&c<=b))){return true}}},custom_time:function(j){if(_agile_contact&&j.RHS){var f=j.RHS;var e=j.RHS_NEW;var a=_agile_contact.properties.length;for(var d=0;d<a;d++){if(j.LHS==(_agile_contact.properties[d].name+"_time")){var i=new Date().getTime();var c=_agile_contact.properties[d].value*1000;var b=(i-c);if((j.CONDITION=="LAST"&&(0<=b&&b<=(f*86400000)))||(j.CONDITION=="AFTER"&&(f<=c)&&((c-f)>=86400000))||(j.CONDITION=="BEFORE"&&(f>=c))||(j.CONDITION=="ON"&&(0<=(c-f)&&(c-f)<=86400000))||(j.CONDITION=="BETWEEN"&&(f<=c&&c<=e))){return true}}}}},owner_is:function(a){if(_agile_contact&&a.RHS&&_agile_contact.owner.id.toString()==a.RHS){return true}},owner_is_not:function(a){if(_agile_contact&&a.RHS&&_agile_contact.owner.id.toString()!==a.RHS){return true}},contact_properties_match:function(d){if(_agile_contact&&d.RHS){var b=0;var a=_agile_contact.properties.length;for(var c=0;c<a;c++){if((d.LHS==_agile_contact.properties[c].name)&&_agile_contact.properties[c].value&&(_agile_contact.properties[c].value.indexOf(d.RHS)!==-1)){return true}}}},contact_properties_doesnot_match:function(e){if(_agile_contact&&h){var c=_agile_contact.properties.length;var b=0;for(var d=0;d<c;d++){if((e.LHS==_agile_contact.properties[d].name)&&_agile_contact.properties[d].value&&(_agile_contact.properties[d].value.indexOf(e.RHS)==-1)){return true}if(e.LHS!==_agile_contact.properties[d].name){b++}}if(b==c&&c!=0&&b!=0){return true}}},once:function(e){var a=agile_read_cookie("agile-webrules");if(a){var d=0;a=JSON.parse(a);for(var b=0;b<a.length;b++){if(a[b]!=e.webrule_id){d++}}if(d==a.length&&d!=0&&a.length!=0){return true}}else{return true}},once_per_session:function(d){var a=agile_read_cookie("agile-session-webrules");if(a){a=JSON.parse(a);var c=0;for(var b=0;b<a.length;b++){if(a[b]!=d.webrule_id){c++}}if(c==a.length&&c!=0&&a.length!=0){return true}}else{return true}},everytime:function(a){return true}};function _agile_webrules(){if(_agile_web_rules){_agile_execute_webrules(_agile_web_rules,_agile_contact,_agile_email);return}_agile.web_rules({success:function(a){_agile_web_rules=a;agile_getEmail({success:function(b){_agile_email=b.email;if(_agile_email=="null"||undefined){_agile_execute_webrules(_agile_web_rules)}else{if(_agile_email){_agile.get_contact(_agile_email,{success:function(c){_agile_contact=c;_agile_execute_webrules(_agile_web_rules,_agile_contact,_agile_email);return},error:function(){_agile_execute_webrules(_agile_web_rules);return}})}}},error:function(){_agile_execute_webrules(_agile_web_rules)}})},error:function(){console.log("error")}})}function _agile_execute_webrules(a,c,b){a.forEach(function(d){_agile_execute_webrule(d)})}function _agile_execute_webrule(c){var a=c.rules.length;for(var b=0;b<a;b++){var d=c.rules[b];d.webrule_id=c.id;d.webrule_name=c.name;if(!_agile_check_condition(d)){return false}}c.actions.forEach(function(e){_agile_execute_action(e)});_agile_add_web_rule_cookie(c);return true}var _agile_mouseY;var _agile_exit_intent_shown=false;function _agile_exit_intent(a){document.addEventListener("mousemove",function(b){_agile_mouseY=b.pageY});document.addEventListener("mouseleave",function(){console.log(_agile_mouseY<window.scrollY+20);if(_agile_mouseY<window.scrollY+20){if(_agile_exit_intent_shown==false){_agile_exit_intent_shown=true;setTimeout(a,250)}}})}function _agile_load_fields(){load_jquery_lib(function(){if(!_agile_contact){return}var a=_agile_convert_json(_agile_contact);$(".simple-modal-body").find("iframe").contents().find("input[agile-field]").each(function(){var b=$(this).attr("agile-field");if(b in a&&a[b]){$(this).val(a[b])}})})}function _agile_save_form(a,b){if(arguments.length==1){_agile_save_form(false,a);return}load_jquery_lib(function(){console.log("Saving form");var c={};$(".simple-modal-body").find("iframe").contents().find("input[agile-field]").each(function(){var e=$(this).attr("agile-field");var d=$(this).val();if(d){c[e]=d}});console.log("Saving ");console.log(c);if(!_agile_contact){_agile.create_contact(c,{success:function(d){console.log("success");b()},error:function(d){console.log("error");if(b){b()}}})}else{_agile.update_contact(c,{success:function(d){console.log("success");if(b){b()}}})}if(a){_agile_close_modal()}})}var _agile_contact;var _agile_web_rules;var _agile_email;var _agile_SM;function _agile_show_modal(a){load_moo_tools_lib(function(){load_simple_modal_lib(function(){load_handlebars_lib(function(){var b=a.popup_text.value.replace(/\n/g,"").replace(/\>[\t ]+\</g,"><");var c=Handlebars.compile(b);var d=_agile_convert_json(_agile_contact);var b=c(d);var e={};e.overlayOpacity=0.5;e.custom_html=true;e.closeButton=false;e.onAppend=function(){document.id("simple-modal").fade("hide");setTimeout((function(){document.id("simple-modal").fade("show")}),200);var f=new Fx.Tween(document.id("simple-modal"),{duration:450,transition:"linear",link:"cancel",property:"top"}).start(-400,150)};e.hideHeader="true";e.hideFooter="true";_agile_SM=new SimpleModal(e);_agile_SM.show({model:"modal",contents:function(){return b}})})})})}function _agile_show_noty(b){var a;if(b.position=="RIGHT_BOTTOM"){a="bottomRight"}if(b.position=="RIGHT_TOP"){a="topRight"}if(b.position=="LEFT_BOTTOM"){a="bottomLeft"}if(b.position=="LEFT_TOP"){a="topLeft"}if(b.position=="TOP"){a="top"}if(b.position=="BOTTOM"){a="bottom"}load_jquery_lib(function(){load_handlebars_lib(function(){load_noty_lib(a,function(){var c=b.popup_text.value.replace(/\n/g,"").replace(/\>[\t ]+\</g,"><");var d=Handlebars.compile(c);var e=_agile_convert_json(_agile_contact);var c=d(e);var f=noty({text:c,type:"alert",dismissQueue:"true",layout:a,theme:"defaultTheme"})})})})}function _agile_convert_json(c){if(c!==undefined&&c.hasOwnProperty("properties")){var a={};for(var b=0;b<c.properties.length;b++){var d=c.properties[b];if(d.name=="first_name"||d.name=="last_name"||d.name=="email"||d.name=="company"||d.name=="website"){a[d.name]=d.value}}return a}}function _agile_add_web_rule_cookie(a){a.rules.forEach(function(b){if(b.CONDITION=="ONLY_ONCE"){_agile_webrule_cookie(a.id,"agile-webrules",5*365)}if(b.CONDITION=="ONCE_PER_SESSION"){_agile_webrule_cookie(a.id,"agile-session-webrules",0)}})}function _agile_webrule_cookie(d,e,a){var c=agile_read_cookie(e);c=JSON.parse(c);if(!c){c=[]}function b(f,j){for(var g=0;g<f.length;g++){if(f[g]===j){return true}}return false}if(b(c,d)){return}c.push(d);agile_create_cookie(e,JSON.stringify(c),a)}var _agile_is_head_loaded=false;function load_head_js(a){if(_agile_is_head_loaded){a()}else{_agile_require_js("https://d2l6lw2yloivu1.cloudfront.net/web-grabbers/lib/head.load.min.js",function(){_agile_is_head_loaded=true;a()})}}function load_jquery_lib(a){load_head_js(function(){head.test((typeof jQuery=="undefined"||jQuery.fn.jquery<"1.7.2"),["https://d2l6lw2yloivu1.cloudfront.net/web-grabbers/lib/jquery-1.7.2.min.js"],"",a)})}function load_handlebars_lib(a){load_head_js(function(){head.test((typeof Handlebars=="undefined"),["https://d2l6lw2yloivu1.cloudfront.net/web-grabbers/lib/handlebars-v1.3.0.js"],"",a)})}function load_noty_lib(a,b){load_head_js(function(){head.load(["https://d2l6lw2yloivu1.cloudfront.net/web-grabbers/lib/noty/jquery.noty.js","https://d2l6lw2yloivu1.cloudfront.net/web-grabbers/lib/noty/default.js","https://d2l6lw2yloivu1.cloudfront.net/web-grabbers/lib/noty/"+a+".js"],b)})}function load_moo_tools_lib(a){load_head_js(function(){head.test((typeof MooTools=="undefined"||window.MooTools.version<"1.3.1"),["https://d2l6lw2yloivu1.cloudfront.net/web-grabbers/lib/mootools-core-1.4.5.js","https://d2l6lw2yloivu1.cloudfront.net/web-grabbers/lib/mootools-more-1.4.0.1.js"],"",a)})}function load_simple_modal_lib(a){load_head_js(function(){head.load("/stats/min/simple-modal.js",function(){head.load(["https://d2l6lw2yloivu1.cloudfront.net/web-grabbers/lib/modal/custommodal.css"],a)})})}function _agile_when(b,c){var a=b.delay;switch(a){case"IMMEDIATE":c();break;case"AFTER_SECS":setTimeout(c,b.timer*1000);break;case"FIRST_SCROLL":window.onscroll=function(){c();window.onscroll=null};break;case"END_OF_PAGE":window.onscroll=function(){if((window.innerHeight+window.scrollY)>=document.body.offsetHeight){c();window.onscroll=null}};break;case"EXIT":_agile_exit_intent(c);break}};