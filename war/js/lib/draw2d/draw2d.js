Event=function(){this.type=null;this.target=null;this.relatedTarget=null;this.cancelable=false;this.timeStamp=null;this.returnValue=true};Event.prototype.initEvent=function(b,a){this.type=b;this.cancelable=a;this.timeStamp=(new Date()).getTime()};Event.prototype.preventDefault=function(){if(this.cancelable){this.returnValue=false}};Event.fireDOMEvent=function(c,b){if(document.createEvent){var a=document.createEvent("Events");a.initEvent(c,true,true);b.dispatchEvent(a)}else{if(document.createEventObject){var a=document.createEventObject();b.fireEvent("on"+c,a)}}};EventTarget=function(){this.eventhandlers=new Object()};EventTarget.prototype.addEventListener=function(b,a){if(typeof this.eventhandlers[b]=="undefined"){this.eventhandlers[b]=new Array}this.eventhandlers[b][this.eventhandlers[b].length]=a};EventTarget.prototype.dispatchEvent=function(a){a.target=this;if(typeof this.eventhandlers[a.type]!="undefined"){for(var b=0;b<this.eventhandlers[a.type].length;b++){this.eventhandlers[a.type][b](a)}}return a.returnValue};EventTarget.prototype.removeEventListener=function(d,b){if(typeof this.eventhandlers[d]!="undefined"){var c=new Array;for(var a=0;a<this.eventhandlers[d].length;a++){if(this.eventhandlers[d][a]!=b){c[c.length]=this.eventhandlers[d][a]}}this.eventhandlers[d]=c}};
Drag=function(){};Drag.current=null;Drag.currentTarget=null;Drag.dragging=false;Drag.isDragging=function(){return this.dragging};Drag.setCurrent=function(a){this.current=a;this.dragging=true};Drag.getCurrent=function(){return this.current};Drag.clearCurrent=function(){this.current=null;this.dragging=false};Draggable=function(a,b){EventTarget.call(this);this.construct(a,b);this.diffX=0;this.diffY=0;this.targets=new ArrayList()};Draggable.prototype=new EventTarget;Draggable.prototype.construct=function(c,d){this.element=c;this.constraints=d;var b=this;var e=function(){var h=new DragDropEvent();h.initDragDropEvent("dblclick",true);b.dispatchEvent(h);var g=arguments[0]||window.event;g.cancelBubble=true;g.returnValue=false};var f=function(){var g=arguments[0]||window.event;var j=new DragDropEvent();var h=b.node.workflow.getAbsoluteX();var l=b.node.workflow.getAbsoluteY();var k=b.node.workflow.getScrollLeft();var i=b.node.workflow.getScrollTop();j.x=g.clientX-b.element.offsetLeft+k-h;j.y=g.clientY-b.element.offsetTop+i-l;if(g.button==2){j.initDragDropEvent("contextmenu",true);b.dispatchEvent(j)}else{j.initDragDropEvent("dragstart",true);if(b.dispatchEvent(j)){b.diffX=g.clientX-b.element.offsetLeft;b.diffY=g.clientY-b.element.offsetTop;Drag.setCurrent(b);if(b.isAttached==true){b.detachEventHandlers()}b.attachEventHandlers()}}g.cancelBubble=true;g.returnValue=false};var a=function(){if(Drag.getCurrent()==null){var g=arguments[0]||window.event;if(Drag.currentHover!=null&&b!=Drag.currentHover){var h=new DragDropEvent();h.initDragDropEvent("mouseleave",false,b);Drag.currentHover.dispatchEvent(h)}if(b!=null&&b!=Drag.currentHover){var h=new DragDropEvent();h.initDragDropEvent("mouseenter",false,b);b.dispatchEvent(h)}Drag.currentHover=b}else{}};if(this.element.addEventListener){this.element.addEventListener("mousemove",a,false);this.element.addEventListener("mousedown",f,false);this.element.addEventListener("dblclick",e,false)}else{if(this.element.attachEvent){this.element.attachEvent("onmousemove",a);this.element.attachEvent("onmousedown",f);this.element.attachEvent("ondblclick",e)}else{throw new Error("Drag not supported in this browser.")}}};Draggable.prototype.attachEventHandlers=function(){var a=this;a.isAttached=true;this.tempMouseMove=function(){var j=arguments[0]||window.event;var h=new Point(j.clientX-a.diffX,j.clientY-a.diffY);if(a.node.getCanSnapToHelper()){h=a.node.getWorkflow().snapToHelper(a.node,h)}a.element.style.left=h.x+"px";a.element.style.top=h.y+"px";var d=a.node.workflow.getScrollLeft();var b=a.node.workflow.getScrollTop();var g=a.node.workflow.getAbsoluteX();var e=a.node.workflow.getAbsoluteY();var i=a.getDropTarget(j.clientX+d-g,j.clientY+b-e);var c=a.getCompartment(j.clientX+d-g,j.clientY+b-e);if(Drag.currentTarget!=null&&i!=Drag.currentTarget){var k=new DragDropEvent();k.initDragDropEvent("dragleave",false,a);Drag.currentTarget.dispatchEvent(k)}if(i!=null&&i!=Drag.currentTarget){var k=new DragDropEvent();k.initDragDropEvent("dragenter",false,a);i.dispatchEvent(k)}Drag.currentTarget=i;if(Drag.currentCompartment!=null&&c!=Drag.currentCompartment){var k=new DragDropEvent();k.initDragDropEvent("figureleave",false,a);Drag.currentCompartment.dispatchEvent(k)}if(c!=null&&c.node!=a.node&&c!=Drag.currentCompartment){var k=new DragDropEvent();k.initDragDropEvent("figureenter",false,a);c.dispatchEvent(k)}Drag.currentCompartment=c;var f=new DragDropEvent();f.initDragDropEvent("drag",false);a.dispatchEvent(f)};a.tempMouseUp=function(){a.detachEventHandlers();var i=arguments[0]||window.event;var g=new DragDropEvent();g.initDragDropEvent("dragend",false);a.dispatchEvent(g);var d=a.node.workflow.getScrollLeft();var b=a.node.workflow.getScrollTop();var f=a.node.workflow.getAbsoluteX();var e=a.node.workflow.getAbsoluteY();var h=a.getDropTarget(i.clientX+d-f,i.clientY+b-e);var c=a.getCompartment(i.clientX+d-f,i.clientY+b-e);if(h!=null){var j=new DragDropEvent();j.initDragDropEvent("drop",false,a);h.dispatchEvent(j)}if(c!=null&&c.node!=a.node){var j=new DragDropEvent();j.initDragDropEvent("figuredrop",false,a);c.dispatchEvent(j)}if(Drag.currentTarget!=null){var j=new DragDropEvent();j.initDragDropEvent("dragleave",false,a);Drag.currentTarget.dispatchEvent(j);Drag.currentTarget=null}Drag.currentCompartment=null;Drag.clearCurrent()};if(document.body.addEventListener){document.body.addEventListener("mousemove",this.tempMouseMove,false);document.body.addEventListener("mouseup",this.tempMouseUp,false)}else{if(document.body.attachEvent){document.body.attachEvent("onmousemove",this.tempMouseMove);document.body.attachEvent("onmouseup",this.tempMouseUp)}else{throw new Error("Drag doesn't support this browser.")}}};Draggable.prototype.detachEventHandlers=function(){this.isAttached=false;if(document.body.removeEventListener){document.body.removeEventListener("mousemove",this.tempMouseMove,false);document.body.removeEventListener("mouseup",this.tempMouseUp,false)}else{if(document.body.detachEvent){document.body.detachEvent("onmousemove",this.tempMouseMove);document.body.detachEvent("onmouseup",this.tempMouseUp)}else{throw new Error("Drag doesn't support this browser.")}}};Draggable.prototype.getDropTarget=function(a,d){for(var b=0;b<this.targets.getSize();b++){var c=this.targets.get(b);if(c.node.isOver(a,d)&&c.node!=this.node){return c}}return null};Draggable.prototype.getCompartment=function(b,e){var a=null;for(var c=0;c<this.node.workflow.compartments.getSize();c++){var d=this.node.workflow.compartments.get(c);if(d.isOver(b,e)&&d!=this.node){if(a==null){a=d}else{if(a.getZOrder()<d.getZOrder()){a=d}}}}return a==null?null:a.dropable};Draggable.prototype.getLeft=function(){return this.element.offsetLeft};Draggable.prototype.getTop=function(){return this.element.offsetTop};DragDropEvent=function(){Event.call(this)};DragDropEvent.prototype=new Event();DragDropEvent.prototype.initDragDropEvent=function(c,a,b){this.initEvent(c,a);this.relatedTarget=b};DropTarget=function(a){EventTarget.call(this);this.construct(a)};DropTarget.prototype=new EventTarget;DropTarget.prototype.construct=function(a){this.element=a};DropTarget.prototype.getLeft=function(){var b=this.element;var a=b.offsetLeft;while((b=b.offsetParent)!=null){a+=b.offsetLeft}return a};DropTarget.prototype.getTop=function(){var a=this.element;var b=a.offsetTop;while((a=a.offsetParent)!=null){b+=a.offsetTop}return b};DropTarget.prototype.getHeight=function(){return this.element.offsetHeight};DropTarget.prototype.getWidth=function(){return this.element.offsetWidth};
Graphics=function(c,a,b){this.jsGraphics=c;this.xt=b.x;this.yt=b.y;this.radian=a*Math.PI/180;this.sinRadian=Math.sin(this.radian);this.cosRadian=Math.cos(this.radian)};Graphics.prototype.setStroke=function(a){this.jsGraphics.setStroke(a)};Graphics.prototype.drawLine=function(b,d,a,c){var f=this.xt+b*this.cosRadian-d*this.sinRadian;var h=this.yt+b*this.sinRadian+d*this.cosRadian;var e=this.xt+a*this.cosRadian-c*this.sinRadian;var g=this.yt+a*this.sinRadian+c*this.cosRadian;this.jsGraphics.drawLine(f,h,e,g)};Graphics.prototype.fillRect=function(k,g,l,d){var c=this.xt+k*this.cosRadian-g*this.sinRadian;var j=this.yt+k*this.sinRadian+g*this.cosRadian;var b=this.xt+(k+l)*this.cosRadian-g*this.sinRadian;var i=this.yt+(k+l)*this.sinRadian+g*this.cosRadian;var a=this.xt+(k+l)*this.cosRadian-(g+d)*this.sinRadian;var f=this.yt+(k+l)*this.sinRadian+(g+d)*this.cosRadian;var m=this.xt+k*this.cosRadian-(g+d)*this.sinRadian;var e=this.yt+k*this.sinRadian+(g+d)*this.cosRadian;this.jsGraphics.fillPolygon([c,b,a,m],[j,i,f,e])};Graphics.prototype.fillPolygon=function(e,d){var c=new Array();var b=new Array();for(var a=0;a<e.length;a++){c[a]=this.xt+e[a]*this.cosRadian-d[a]*this.sinRadian;b[a]=this.yt+e[a]*this.sinRadian+d[a]*this.cosRadian}this.jsGraphics.fillPolygon(c,b)};Graphics.prototype.setColor=function(a){this.jsGraphics.setColor(a.getHTMLStyle())};Graphics.prototype.drawPolygon=function(e,d){var c=new Array();var b=new Array();for(var a=0;a<e.length;a++){c[a]=this.xt+e[a]*this.cosRadian-d[a]*this.sinRadian;b[a]=this.yt+e[a]*this.sinRadian+d[a]*this.cosRadian}this.jsGraphics.drawPolygon(c,b)};
Color=function(d,c,a){if(typeof c=="undefined"){var b=this.hex2rgb(d);this.red=b[0];this.green=b[1];this.blue=b[2]}else{this.red=d;this.green=c;this.blue=a}};Color.prototype.type="Color";Color.prototype.getHTMLStyle=function(){return"rgb("+this.red+","+this.green+","+this.blue+")"};Color.prototype.getRed=function(){return this.red};Color.prototype.getGreen=function(){return this.green};Color.prototype.getBlue=function(){return this.blue};Color.prototype.getIdealTextColor=function(){var a=105;var b=(this.red*0.299)+(this.green*0.587)+(this.blue*0.114);return(255-b<a)?new Color(0,0,0):new Color(255,255,255)};Color.prototype.hex2rgb=function(a){a=a.replace("#","");return({0:parseInt(a.substr(0,2),16),1:parseInt(a.substr(2,2),16),2:parseInt(a.substr(4,2),16)})};Color.prototype.hex=function(){return(this.int2hex(this.red)+this.int2hex(this.green)+this.int2hex(this.blue))};Color.prototype.int2hex=function(a){a=Math.round(Math.min(Math.max(0,a),255));return("0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16))};Color.prototype.darker=function(b){var d=parseInt(Math.round(this.getRed()*(1-b)));var c=parseInt(Math.round(this.getGreen()*(1-b)));var a=parseInt(Math.round(this.getBlue()*(1-b)));if(d<0){d=0}else{if(d>255){d=255}}if(c<0){c=0}else{if(c>255){c=255}}if(a<0){a=0}else{if(a>255){a=255}}return new Color(d,c,a)};Color.prototype.lighter=function(b){var d=parseInt(Math.round(this.getRed()*(1+b)));var c=parseInt(Math.round(this.getGreen()*(1+b)));var a=parseInt(Math.round(this.getBlue()*(1+b)));if(d<0){d=0}else{if(d>255){d=255}}if(c<0){c=0}else{if(c>255){c=255}}if(a<0){a=0}else{if(a>255){a=255}}return new Color(d,c,a)};
ArrayList=function(){this.increment=10;this.size=0;this.data=new Array(this.increment)};ArrayList.EMPTY_LIST=new ArrayList();ArrayList.prototype.reverse=function(){var b=new Array(this.size);for(var a=0;a<this.size;a++){b[a]=this.data[this.size-a-1]}this.data=b};ArrayList.prototype.getCapacity=function(){return this.data.length};ArrayList.prototype.getSize=function(){return this.size};ArrayList.prototype.isEmpty=function(){return this.getSize()==0};ArrayList.prototype.getLastElement=function(){if(this.data[this.getSize()-1]!=null){return this.data[this.getSize()-1]}};ArrayList.prototype.getFirstElement=function(){if(this.data[0]!=null){return this.data[0]}};ArrayList.prototype.get=function(a){return this.data[a]};ArrayList.prototype.add=function(a){if(this.getSize()==this.data.length){this.resize()}this.data[this.size++]=a};ArrayList.prototype.addAll=function(b){for(var a=0;a<b.getSize();a++){this.add(b.get(a))}};ArrayList.prototype.remove=function(b){var a=this.indexOf(b);if(a>=0){return this.removeElementAt(a)}return null};ArrayList.prototype.insertElementAt=function(c,a){if(this.size==this.capacity){this.resize()}for(var b=this.getSize();b>a;b--){this.data[b]=this.data[b-1]}this.data[a]=c;this.size++};ArrayList.prototype.removeElementAt=function(a){var c=this.data[a];for(var b=a;b<(this.getSize()-1);b++){this.data[b]=this.data[b+1]}this.data[this.getSize()-1]=null;this.size--;return c};ArrayList.prototype.removeAllElements=function(){this.size=0;for(var a=0;a<this.data.length;a++){this.data[a]=null}};ArrayList.prototype.indexOf=function(b){for(var a=0;a<this.getSize();a++){if(this.data[a]==b){return a}}return -1};ArrayList.prototype.contains=function(b){for(var a=0;a<this.getSize();a++){if(this.data[a]==b){return true}}return false};ArrayList.prototype.resize=function(){newData=new Array(this.data.length+this.increment);for(var a=0;a<this.data.length;a++){newData[a]=this.data[a]}this.data=newData};ArrayList.prototype.trimToSize=function(){var a=new Array(this.getSize());for(var b=0;b<this.getSize();b++){a[b]=this.data[b]}this.size=a.length-1;this.data=a};ArrayList.prototype.sort=function(g){var d,c;var e;var b;var h;var a;for(d=1;d<this.getSize();d++){b=this.data[d];e=b[g];c=d-1;h=this.data[c];a=h[g];while(c>=0&&a>e){this.data[c+1]=this.data[c];c--;if(c>=0){h=this.data[c];a=h[g]}}this.data[c+1]=b}};ArrayList.prototype.clone=function(){var a=new ArrayList(this.size);for(var b=0;b<this.size;b++){a.add(this.data[b])}return a};ArrayList.prototype.overwriteElementAt=function(b,a){this.data[a]=b};
Point=function(a,b){this.x=a;this.y=b};Point.prototype.type="Point";Point.prototype.getX=function(){return this.x};Point.prototype.getY=function(){return this.y};Point.prototype.getPosition=function(c){var b=c.x-this.x;var a=c.y-this.y;if(Math.abs(b)>Math.abs(a)){if(b<0){return PositionConstants.WEST}return PositionConstants.EAST}if(a<0){return PositionConstants.NORTH}return PositionConstants.SOUTH};Point.prototype.equals=function(a){return this.x==a.x&&this.y==a.y};Point.prototype.getDistance=function(a){return Math.sqrt((this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y))};Point.prototype.getTranslated=function(a){return new Point(this.x+a.x,this.y+a.y)};
Dimension=function(a,d,b,c){Point.call(this,a,d);this.w=b;this.h=c};Dimension.prototype=new Point;Dimension.prototype.type="Dimension";Dimension.prototype.translate=function(b,a){this.x+=b;this.y+=a;return this};Dimension.prototype.resize=function(a,b){this.w+=a;this.h+=b;return this};Dimension.prototype.setBounds=function(a){this.x=a.x;this.y=a.y;this.w=a.w;this.h=a.h;return this};Dimension.prototype.isEmpty=function(){return this.w<=0||this.h<=0};Dimension.prototype.getWidth=function(){return this.w};Dimension.prototype.getHeight=function(){return this.h};Dimension.prototype.getRight=function(){return this.x+this.w};Dimension.prototype.getBottom=function(){return this.y+this.h};Dimension.prototype.getTopLeft=function(){return new Point(this.x,this.y)};Dimension.prototype.getCenter=function(){return new Point(this.x+this.w/2,this.y+this.h/2)};Dimension.prototype.getBottomRight=function(){return new Point(this.x+this.w,this.y+this.h)};Dimension.prototype.equals=function(a){return this.x==a.x&&this.y==a.y&&this.w==a.w&&this.h==a.h};
Figure=function(){this.construct()};Figure.prototype.type="Figure";Figure.ZOrderBaseIndex=100;Figure.setZOrderBaseIndex=function(a){Figure.ZOrderBaseIndex=a};Figure.prototype.construct=function(){this.lastDragStartTime=0;this.x=0;this.y=0;this.border=null;this.setDimension(10,10);this.id=this.generateUId();this.html=this.createHTMLElement();this.canvas=null;this.workflow=null;this.draggable=null;this.parent=null;this.isMoving=false;this.canSnapToHelper=true;this.snapToGridAnchor=new Point(0,0);this.timer=-1;this.setDeleteable(true);this.setCanDrag(true);this.setResizeable(true);this.setSelectable(true);this.properties=new Object();this.moveListener=new ArrayList()};Figure.prototype.dispose=function(){this.canvas=null;this.workflow=null;this.moveListener=null;if(this.draggable!=null){this.draggable.removeEventListener("mouseenter",this.tmpMouseEnter);this.draggable.removeEventListener("mouseleave",this.tmpMouseLeave);this.draggable.removeEventListener("dragend",this.tmpDragend);this.draggable.removeEventListener("dragstart",this.tmpDragstart);this.draggable.removeEventListener("drag",this.tmpDrag);this.draggable.removeEventListener("dblclick",this.tmpDoubleClick);this.draggable.node=null}this.draggable=null;if(this.border!=null){this.border.dispose()}this.border=null;if(this.parent!=null){this.parent.removeChild(this)}};Figure.prototype.getProperties=function(){return this.properties};Figure.prototype.getProperty=function(a){return this.properties[a]};Figure.prototype.setProperty=function(a,b){this.properties[a]=b;this.setDocumentDirty()};Figure.prototype.getId=function(){return this.id};Figure.prototype.setCanvas=function(a){this.canvas=a};Figure.prototype.getWorkflow=function(){return this.workflow};Figure.prototype.setWorkflow=function(b){if(this.draggable==null){this.html.tabIndex="0";var a=this;this.keyDown=function(c){c.cancelBubble=true;c.returnValue=true;a.onKeyDown(c.keyCode,c.ctrlKey)};if(this.html.addEventListener){this.html.addEventListener("keydown",this.keyDown,false)}else{if(this.html.attachEvent){this.html.attachEvent("onkeydown",this.keyDown)}}this.draggable=new Draggable(this.html,Draggable.DRAG_X|Draggable.DRAG_Y);this.draggable.node=this;this.tmpContextMenu=function(c){a.onContextMenu(a.x+c.x,c.y+a.y)};this.tmpMouseEnter=function(c){a.onMouseEnter()};this.tmpMouseLeave=function(c){a.onMouseLeave()};this.tmpDragend=function(c){a.onDragend()};this.tmpDragstart=function(d){var c=a.workflow;c.showMenu(null);if(a.workflow.toolPalette&&a.workflow.toolPalette.activeTool){d.returnValue=false;a.workflow.onMouseDown(a.x+d.x,d.y+a.y);a.workflow.onMouseUp(a.x+d.x,d.y+a.y);return}d.returnValue=a.onDragstart(d.x,d.y)};this.tmpDrag=function(c){a.onDrag()};this.tmpDoubleClick=function(c){a.onDoubleClick()};this.draggable.addEventListener("contextmenu",this.tmpContextMenu);this.draggable.addEventListener("mouseenter",this.tmpMouseEnter);this.draggable.addEventListener("mouseleave",this.tmpMouseLeave);this.draggable.addEventListener("dragend",this.tmpDragend);this.draggable.addEventListener("dragstart",this.tmpDragstart);this.draggable.addEventListener("drag",this.tmpDrag);this.draggable.addEventListener("dblclick",this.tmpDoubleClick)}this.workflow=b};Figure.prototype.createHTMLElement=function(){this.item=document.createElement("div");this.item.id=this.id;this.item.style.position="absolute";this.item.style.left=this.x+"px";this.item.style.top=this.y+"px";this.item.style.height=this.width+"px";this.item.style.width=this.height+"px";this.item.style.margin="0px";this.item.style.padding="0px";this.item.style.outline="none";this.item.style.zIndex=""+Figure.ZOrderBaseIndex;return this.item};Figure.prototype.setParent=function(a){this.parent=a};Figure.prototype.getParent=function(){return this.parent};Figure.prototype.getZOrder=function(){return this.html.style.zIndex};Figure.prototype.setZOrder=function(a){this.html.style.zIndex=a};Figure.prototype.hasFixedPosition=function(){return false};Figure.prototype.getMinWidth=function(){return 5};Figure.prototype.getMinHeight=function(){return 5};Figure.prototype.getHTMLElement=function(){if(this.html==null){this.html=this.createHTMLElement()}return this.html};Figure.prototype.paint=function(){};Figure.prototype.setBorder=function(a){if(this.border!=null){this.border.figure=null}this.border=a;this.border.figure=this;this.border.refresh();this.setDocumentDirty()};Figure.prototype.onContextMenu=function(a,c){var b=this.getContextMenu();if(b!=null){this.workflow.showMenu(b,a,c)}};Figure.prototype.getContextMenu=function(){return null};Figure.prototype.onDoubleClick=function(){};Figure.prototype.onMouseEnter=function(){};Figure.prototype.onMouseLeave=function(){};Figure.prototype.onDrag=function(){this.x=this.draggable.getLeft();this.y=this.draggable.getTop();if(this.isMoving==false){this.isMoving=true;this.setAlpha(0.5)}this.fireMoveEvent()};Figure.prototype.onDragend=function(){if(this.getWorkflow().getEnableSmoothFigureHandling()==true){var c=this;var f=function(){if(c.alpha<1){c.setAlpha(Math.min(1,c.alpha+0.05))}else{window.clearInterval(c.timer);c.timer=-1}};if(c.timer>0){window.clearInterval(c.timer)}c.timer=window.setInterval(f,20)}else{this.setAlpha(1)}for(var d=0;d<this.getWorkflow().getFigures().getSize();d++){if(this.id!=this.getWorkflow().getFigures().get(d).id){var e=this.getWorkflow().getFigures().get(d).x+this.getWorkflow().getFigures().get(d).width;var b=this.getWorkflow().getFigures().get(d).y+this.getWorkflow().getFigures().get(d).height;var a=this.overlap(this.getWorkflow().getFigures().get(d).x,this.getWorkflow().getFigures().get(d).y,e,b,this.x,this.y,this.x+this.width,this.y+this.height);if(a!=null){this.x=this.x+this.getWorkflow().getFigures().get(d).width+10;this.y=this.y+this.getWorkflow().getFigures().get(d).height+10}}}this.command.setPosition(this.x,this.y);this.workflow.commandStack.execute(this.command);this.command=null;this.isMoving=false;this.workflow.hideSnapToHelperLines();this.fireMoveEvent()};Figure.prototype.onDragstart=function(a,b){if(!this.canDrag){return false}workflow.setCurrentSelection(null);this.command=new CommandMove(this,this.x,this.y);return true};Figure.prototype.setCanDrag=function(a){this.canDrag=a;if(a){this.html.style.cursor="move"}else{this.html.style.cursor=null}};Figure.prototype.setAlpha=function(c){if(this.alpha==c){return}try{this.html.style.MozOpacity=c}catch(a){}try{this.html.style.opacity=c}catch(a){}try{var b=Math.round(c*100);if(b>=99){this.html.style.filter=""}else{this.html.style.filter="alpha(opacity="+b+")"}}catch(a){}this.alpha=c};Figure.prototype.setDimension=function(a,b){this.width=Math.max(this.getMinWidth(),a);this.height=Math.max(this.getMinHeight(),b);if(this.html==null){return}this.html.style.width=this.width+"px";this.html.style.height=this.height+"px";this.fireMoveEvent();if(this.workflow!=null&&this.workflow.getCurrentSelection()==this){this.workflow.showResizeHandles(this)}};Figure.prototype.setPosition=function(b,a){this.x=b;this.y=a;if(this.html==null){return}this.html.style.left=this.x+"px";this.html.style.top=this.y+"px";this.fireMoveEvent();if(this.workflow!=null&&this.workflow.getCurrentSelection()==this){this.workflow.showResizeHandles(this)}};Figure.prototype.isResizeable=function(){return this.resizeable};Figure.prototype.setResizeable=function(a){this.resizeable=a};Figure.prototype.isSelectable=function(){return this.selectable};Figure.prototype.setSelectable=function(a){this.selectable=a};Figure.prototype.isStrechable=function(){return true};Figure.prototype.isDeleteable=function(){return this.deleteable};Figure.prototype.setDeleteable=function(a){this.deleteable=a};Figure.prototype.setCanSnapToHelper=function(a){this.canSnapToHelper=a};Figure.prototype.getCanSnapToHelper=function(){return this.canSnapToHelper};Figure.prototype.getSnapToGridAnchor=function(){return this.snapToGridAnchor};Figure.prototype.setSnapToGridAnchor=function(a){this.snapToGridAnchor=a};Figure.prototype.getBounds=function(){return new Dimension(this.getX(),this.getY(),this.getWidth(),this.getHeight())};Figure.prototype.getWidth=function(){return this.width};Figure.prototype.getHeight=function(){return this.height};Figure.prototype.getY=function(){return this.y};Figure.prototype.getX=function(){return this.x};Figure.prototype.getAbsoluteY=function(){return this.y};Figure.prototype.getAbsoluteX=function(){return this.x};Figure.prototype.onKeyDown=function(b,a){if(b==46&&this.isDeleteable()==true){this.workflow.commandStack.execute(new CommandDelete(this))}if(a){this.workflow.onKeyDown(b,a)}};Figure.prototype.getPosition=function(){return new Point(this.x,this.y)};Figure.prototype.isOver=function(b,f){var a=this.getAbsoluteX();var e=this.getAbsoluteY();var c=a+this.width;var d=e+this.height;return(b>=a&&b<=c&&f>=e&&f<=d)};Figure.prototype.attachMoveListener=function(a){if(a==null||this.moveListener==null){return}this.moveListener.add(a)};Figure.prototype.detachMoveListener=function(a){if(a==null||this.moveListener==null){return}this.moveListener.remove(a)};Figure.prototype.fireMoveEvent=function(){this.setDocumentDirty();var b=this.moveListener.getSize();for(var a=0;a<b;a++){this.moveListener.get(a).onOtherFigureMoved(this)}};Figure.prototype.onOtherFigureMoved=function(a){};Figure.prototype.setDocumentDirty=function(){if(this.workflow!=null){this.workflow.setDocumentDirty()}};Figure.prototype.generateUId=function(){var d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";var e=10;var c=10;nbTry=0;while(nbTry<1000){var f="PBX";for(var b=0;b<e;b++){var a=Math.floor(Math.random()*d.length);f+=d.substring(a,a+1)}elem=document.getElementById(f);if(!elem){return f}nbTry+=1}return null};Figure.prototype.disableTextSelection=function(a){if(typeof a.onselectstart!="undefined"){a.onselectstart=function(){return false}}else{if(typeof a.style.MozUserSelect!="undefined"){a.style.MozUserSelect="none"}}};Figure.prototype.setId=function(a){this.id=a;this.item.id=a};Figure.prototype.remove=function(){this.workflow.removeFigure(this.id)};Figure.prototype.overlap=function(b,d,f,h,a,c,e,g){return null};
Node=function(){this.bgColor=null;this.lineColor=new Color(128,128,255);this.lineStroke=1;this.ports=new ArrayList();Figure.call(this)};Node.prototype=new Figure;Node.prototype.type="Node";Node.prototype.dispose=function(){for(var a=0;a<this.ports.getSize();a++){this.ports.get(a).dispose()}this.ports=null;Figure.prototype.dispose.call(this)};Node.prototype.createHTMLElement=function(){var a=Figure.prototype.createHTMLElement.call(this);a.style.width="auto";a.style.height="auto";a.style.margin="0px";a.style.padding="0px";if(this.lineColor!=null){a.style.border=this.lineStroke+"px solid "+this.lineColor.getHTMLStyle()}a.style.fontSize="1px";if(this.bgColor!=null){a.style.backgroundColor=this.bgColor.getHTMLStyle()}return a};Node.prototype.paint=function(){Figure.prototype.paint.call(this);for(var a=0;a<this.ports.getSize();a++){this.ports.get(a).paint()}};Node.prototype.getPorts=function(){return this.ports};Node.prototype.getPort=function(c){if(this.ports==null){return null}for(var b=0;b<this.ports.getSize();b++){var a=this.ports.get(b);if(a.getName()==c){return a}}};Node.prototype.addPort=function(b,a,c){this.ports.add(b);b.setOrigin(a,c);b.setPosition(a,c);b.setParent(this);b.setDeleteable(false);this.html.appendChild(b.getHTMLElement());if(this.workflow!=null){this.workflow.registerPort(b)}};Node.prototype.removePort=function(b){if(this.ports!=null){this.ports.removeElementAt(this.ports.indexOf(b))}try{this.html.removeChild(b.getHTMLElement())}catch(a){}if(this.workflow!=null){this.workflow.unregisterPort(b)}};Node.prototype.setWorkflow=function(c){var b=this.workflow;Figure.prototype.setWorkflow.call(this,c);if(b!=null){for(var a=0;a<this.ports.getSize();a++){b.unregisterPort(this.ports.get(a))}}if(this.workflow!=null){for(var a=0;a<this.ports.getSize();a++){this.workflow.registerPort(this.ports.get(a))}}};Node.prototype.setBackgroundColor=function(a){this.bgColor=a;if(this.bgColor!=null){this.html.style.backgroundColor=this.bgColor.getHTMLStyle()}else{this.html.style.backgroundColor="transparent"}};Node.prototype.getBackgroundColor=function(){return this.bgColor};Node.prototype.setColor=function(a){this.lineColor=a;if(this.lineColor!=null){this.html.style.border=this.lineStroke+"px solid "+this.lineColor.getHTMLStyle()}else{this.html.style.border="0px"}};Node.prototype.setLineWidth=function(a){this.lineStroke=a;if(this.lineColor!=null){this.html.style.border=this.lineStroke+"px solid "+this.lineColor.getHTMLStyle()}else{this.html.style.border="0px"}};Node.prototype.refreshConnections=function(){if(this.workflow!=null){this.workflow.refreshConnections(this)}};
VectorFigure=function(){this.bgColor=null;this.lineColor=new Color(0,0,0);this.stroke=1;this.graphics=null;Node.call(this)};VectorFigure.prototype=new Node;VectorFigure.prototype.type="VectorFigure";VectorFigure.prototype.dispose=function(){Node.prototype.dispose.call(this);this.bgColor=null;this.lineColor=null;if(this.graphics!=null){this.graphics.clear()}this.graphics=null};VectorFigure.prototype.createHTMLElement=function(){var a=Node.prototype.createHTMLElement.call(this);a.style.border="0px";a.style.backgroundColor="transparent";return a};VectorFigure.prototype.setWorkflow=function(a){Node.prototype.setWorkflow.call(this,a);if(this.workflow==null){this.graphics.clear();this.graphics=null}};VectorFigure.prototype.paint=function(){if(this.graphics==null){this.graphics=new jsGraphics(this.id)}else{this.graphics.clear()}Node.prototype.paint.call(this);for(var a=0;a<this.ports.getSize();a++){this.getHTMLElement().appendChild(this.ports.get(a).getHTMLElement())}};VectorFigure.prototype.setDimension=function(a,b){Node.prototype.setDimension.call(this,a,b);if(this.graphics!=null){this.paint()}};VectorFigure.prototype.setBackgroundColor=function(a){this.bgColor=a;if(this.graphics!=null){this.paint()}};VectorFigure.prototype.getBackgroundColor=function(){return this.bgColor};VectorFigure.prototype.setLineWidth=function(a){this.stroke=a;if(this.graphics!=null){this.paint()}};VectorFigure.prototype.setColor=function(a){this.lineColor=a;if(this.graphics!=null){this.paint()}};VectorFigure.prototype.getColor=function(){return this.lineColor};
Oval=function(){VectorFigure.call(this)};Oval.prototype=new VectorFigure;Oval.prototype.type="Oval";Oval.prototype.paint=function(){VectorFigure.prototype.paint.call(this);this.graphics.setStroke(2);if(this.lineColor!=null){this.graphics.setColor(this.lineColor.getHTMLStyle());this.graphics.drawOval(0,0,this.getWidth()-1,this.getHeight()-1)}if(this.bgColor!=null){this.graphics.setColor(this.bgColor.getHTMLStyle());this.graphics.fillOval(1.5,2,this.getWidth()-2,this.getHeight()-2);this.graphics.setColor(this.bgColor.getHTMLStyle());this.graphics.fillOval(2,2,this.getWidth()-2,this.getHeight()-2)}this.graphics.paint()};
Circle=function(a){Oval.call(this);if(a){this.setDimension(a,a)}};Circle.prototype=new Oval;Circle.prototype.type="Circle";Circle.prototype.setDimension=function(a,b){if(a>b){Oval.prototype.setDimension.call(this,a,a)}else{Oval.prototype.setDimension.call(this,b,b)}};Circle.prototype.isStrechable=function(){return false};
PortCircle=function(){this.divCreated=false;VectorFigure.call(this)};PortCircle.prototype=new VectorFigure;PortCircle.prototype.type="PortCircle";PortCircle.prototype.paint=function(){VectorFigure.prototype.paint.call(this);this.portCircleDiv=document.createElement("div");this.portCircleDiv.style.width="7px";this.portCircleDiv.style.height="7px";if(navigator.userAgent.indexOf("msie") != -1){this.portCircleDiv.className="circleIE";}else if(/chrome/.test( navigator.userAgent.toLowerCase()) || navigator.userAgent.indexOf('Safari')!=-1)this.portCircleDiv.className="circleChrome"; else this.portCircleDiv.className="circle"; this.portCircleDiv.innerHTML="&nbsp;";if(this.bgColor!=null){this.portCircleDiv.style.backgroundColor=this.bgColor.getHTMLStyle()}if(this.lineColor!=null){this.portCircleDiv.style.border="1px solid "+this.lineColor.getHTMLStyle()}this.getHTMLElement().style.cursor="crosshair";this.getHTMLElement().parentNode.style.cursor="crosshair";this.getHTMLElement().appendChild(this.portCircleDiv);this.divCreated=true};PortCircle.prototype.setBackgroundColor=function(a){this.bgColor=a;if(this.divCreated){this.portCircleDiv.style.backgroundColor=this.bgColor.getHTMLStyle()}};PortCircle.prototype.setColor=function(a){this.lineColor=a;if(this.divCreated){this.portCircleDiv.style.border="1px solid "+this.lineColor.getHTMLStyle()}};
Rectangle=function(b,a){this.bgColor=null;this.lineColor=new Color(228,228,228);this.lineStroke=1;Figure.call(this);if(b&&a){this.setDimension(b,a)}};Rectangle.prototype=new Figure;Rectangle.prototype.type="Rectangle";Rectangle.prototype.dispose=function(){Figure.prototype.dispose.call(this);this.bgColor=null;this.lineColor=null};Rectangle.prototype.createHTMLElement=function(){var a=Figure.prototype.createHTMLElement.call(this);a.style.width="auto";a.style.height="auto";a.style.margin="0px";a.style.padding="0px";a.style.border=this.lineStroke+"px solid "+this.lineColor.getHTMLStyle();a.style.fontSize="1px";a.style.lineHeight="1px";a.innerHTML="&nbsp";if(this.bgColor!=null){a.style.backgroundColor=this.bgColor.getHTMLStyle()}return a};Rectangle.prototype.setBackgroundColor=function(a){this.bgColor=a;if(this.bgColor!=null){this.html.style.backgroundColor=this.bgColor.getHTMLStyle()}else{this.html.style.backgroundColor="transparent"}};Rectangle.prototype.getBackgroundColor=function(){return this.bgColor};Rectangle.prototype.setColor=function(a){this.lineColor=a;if(this.lineColor!=null){this.html.style.border=this.lineStroke+"px solid "+this.lineColor.getHTMLStyle()}else{this.html.style.border=this.lineStroke+"0px"}};Rectangle.prototype.getColor=function(){return this.lineColor};Rectangle.prototype.getWidth=function(){return Figure.prototype.getWidth.call(this)+2*this.lineStroke};Rectangle.prototype.getHeight=function(){return Figure.prototype.getHeight.call(this)+2*this.lineStroke};Rectangle.prototype.setDimension=function(a,b){return Figure.prototype.setDimension.call(this,a-2*this.lineStroke,b-2*this.lineStroke)};Rectangle.prototype.setLineWidth=function(a){var b=a-this.lineStroke;this.setDimension(this.getWidth()-2*b,this.getHeight()-2*b);this.lineStroke=a;var d="transparent";if(this.lineColor!=null){d=this.lineColor.getHTMLStyle()}this.html.style.border=this.lineStroke+"px solid "+d};Rectangle.prototype.getLineWidth=function(){return this.lineStroke};
ImageFigure=function(a){this.url=a;Node.call(this);this.setDimension(40,40)};ImageFigure.prototype=new Node;ImageFigure.prototype.type="Image";ImageFigure.prototype.createHTMLElement=function(){var a=Node.prototype.createHTMLElement.call(this);a.style.width=this.width+"px";a.style.height=this.height+"px";a.style.margin="0px";a.style.padding="0px";a.style.border="0px";if(this.url!=null){a.style.backgroundImage="url("+this.url+")"}else{a.style.backgroundImage=""}return a};ImageFigure.prototype.setColor=function(a){};ImageFigure.prototype.isResizeable=function(){return false};ImageFigure.prototype.setImage=function(a){this.url=a;if(this.url!=null){this.html.style.backgroundImage="url("+this.url+")"}else{this.html.style.backgroundImage=""}};
Port=function(b,a){Corona=function(){};Corona.prototype=new Circle;Corona.prototype.setAlpha=function(c){Circle.prototype.setAlpha.call(this,Math.min(0.3,c))};if(b==null){this.currentUIRepresentation=new PortCircle()}else{this.currentUIRepresentation=b}if(a==null){this.connectedUIRepresentation=new PortCircle();this.connectedUIRepresentation.setColor(null)}else{this.connectedUIRepresentation=a}this.disconnectedUIRepresentation=this.currentUIRepresentation;this.hideIfConnected=false;this.uiRepresentationAdded=true;this.parentNode=null;this.originX=0;this.originY=0;this.coronaWidth=10;this.corona=null;Rectangle.call(this);this.setDimension(12,12);Rectangle.prototype.setColor.call(this,null);this.dropable=new DropTarget(this.html);this.dropable.node=this;this.dropable.addEventListener("dragenter",function(c){c.target.node.onDragEnter(c.relatedTarget.node)});this.dropable.addEventListener("dragleave",function(c){c.target.node.onDragLeave(c.relatedTarget.node)});this.dropable.addEventListener("drop",function(c){c.relatedTarget.node.onDrop(c.target.node)})};Port.prototype=new Rectangle;Port.prototype.type="Port";Port.ZOrderBaseIndex=5000;Port.setZOrderBaseIndex=function(a){Port.ZOrderBaseIndex=a};Port.prototype.setHideIfConnected=function(a){this.hideIfConnected=a};Port.prototype.dispose=function(){var b=this.moveListener.getSize();for(var a=0;a<b;a++){var c=this.moveListener.get(a);this.parentNode.workflow.removeFigure(c);c.dispose()}Rectangle.prototype.dispose.call(this);this.parentNode=null;this.dropable.node=null;this.dropable=null;this.disconnectedUIRepresentation.dispose();this.connectedUIRepresentation.dispose()};Port.prototype.createHTMLElement=function(){var a=Rectangle.prototype.createHTMLElement.call(this);a.style.zIndex=Port.ZOrderBaseIndex;this.currentUIRepresentation.html.zIndex=Port.ZOrderBaseIndex;a.appendChild(this.currentUIRepresentation.html);this.uiRepresentationAdded=true;return a};Port.prototype.setUiRepresentation=function(a){if(a==null){a=new Figure()}if(this.uiRepresentationAdded){this.html.removeChild(this.currentUIRepresentation.getHTMLElement())}var b=a.getHTMLElement();this.html.appendChild(b);a.paint();this.currentUIRepresentation=a};Port.prototype.onMouseEnter=function(){this.setLineWidth(2)};Port.prototype.onMouseLeave=function(){this.setLineWidth(1)};Port.prototype.setDimension=function(b,a){Rectangle.prototype.setDimension.call(this,b,a);this.connectedUIRepresentation.setDimension(b,a);this.disconnectedUIRepresentation.setDimension(b,a);this.setPosition(this.x,this.y)};Port.prototype.setBackgroundColor=function(a){this.currentUIRepresentation.setBackgroundColor(a);this.connectedUIRepresentation.setBackgroundColor(a)};Port.prototype.getBackgroundColor=function(){return this.currentUIRepresentation.getBackgroundColor()};Port.prototype.getConnections=function(){var a=new ArrayList();var c=this.moveListener.getSize();for(var b=0;b<c;b++){var d=this.moveListener.get(b);if(d instanceof Connection){a.add(d)}}return a};Port.prototype.setColor=function(a){this.currentUIRepresentation.setColor(a);this.connectedUIRepresentation.setColor(a)};Port.prototype.getColor=function(){return this.currentUIRepresentation.getColor()};Port.prototype.setLineWidth=function(a){this.currentUIRepresentation.setLineWidth(a)};Port.prototype.getLineWidth=function(){return this.currentUIRepresentation.getLineWidth()};Port.prototype.paint=function(){this.currentUIRepresentation.paint()};Port.prototype.setPosition=function(b,a){this.originX=b;this.originY=a;Rectangle.prototype.setPosition.call(this,b,a);if(this.html==null){return}this.html.style.left=(this.x-this.getWidth()/2)+"px";this.html.style.top=(this.y-this.getHeight()/2)+"px"};Port.prototype.setParent=function(a){if(this.parentNode!=null){this.parentNode.detachMoveListener(this)}this.parentNode=a;if(this.parentNode!=null){this.parentNode.attachMoveListener(this)}};Port.prototype.attachMoveListener=function(a){Rectangle.prototype.attachMoveListener.call(this,a);if(this.hideIfConnected==true){this.setUiRepresentation(this.connectedUIRepresentation)}};Port.prototype.detachMoveListener=function(a){Rectangle.prototype.detachMoveListener.call(this,a);if(this.getConnections().getSize()==0){this.setUiRepresentation(this.disconnectedUIRepresentation)}};Port.prototype.getParent=function(){return this.parentNode};Port.prototype.onDrag=function(){Rectangle.prototype.onDrag.call(this);this.parentNode.workflow.showConnectionLine(this.parentNode.x+this.x,this.parentNode.y+this.y,this.parentNode.x+this.originX,this.parentNode.y+this.originY)};Port.prototype.getCoronaWidth=function(){return this.coronaWidth};Port.prototype.setCoronaWidth=function(a){this.coronaWidth=a};Port.prototype.onDragend=function(){this.setAlpha(1);this.setPosition(this.originX,this.originY);this.parentNode.workflow.hideConnectionLine()};Port.prototype.setOrigin=function(a,b){this.originX=a;this.originY=b};Port.prototype.onDragEnter=function(a){if(this.parentNode.id==a.parentNode.id){}else{this.parentNode.workflow.connectionLine.setColor(new Color(35,141,201));this.parentNode.workflow.connectionLine.setLineWidth(3);this.showCorona(true)}};Port.prototype.onDragLeave=function(a){this.parentNode.workflow.connectionLine.setColor(new Color(35,141,201));this.parentNode.workflow.connectionLine.setLineWidth(1);this.showCorona(false)};Port.prototype.onDrop=function(a){if(this.parentNode.id==a.parentNode.id){}else{var b=new CommandConnect(this.parentNode.workflow,a,this);this.parentNode.workflow.getCommandStack().execute(b)}};Port.prototype.getAbsolutePosition=function(){return new Point(this.getAbsoluteX(),this.getAbsoluteY())};Port.prototype.getAbsoluteBounds=function(){return new Dimension(this.getAbsoluteX(),this.getAbsoluteY(),this.getWidth(),this.getHeight())};Port.prototype.getAbsoluteY=function(){return this.originY+this.parentNode.getY()};Port.prototype.getAbsoluteX=function(){return this.originX+this.parentNode.getX()};Port.prototype.onOtherFigureMoved=function(a){this.fireMoveEvent()};Port.prototype.getName=function(){return this.getProperty("name")};Port.prototype.setName=function(a){this.setProperty("name",a)};Port.prototype.isOver=function(b,f){var a=this.getAbsoluteX()-this.coronaWidth-this.getWidth()/2;var e=this.getAbsoluteY()-this.coronaWidth-this.getHeight()/2;var c=a+this.width+(this.coronaWidth*2)+this.getWidth()/2;var d=e+this.height+(this.coronaWidth*2)+this.getHeight()/2;return(b>=a&&b<=c&&f>=e&&f<=d)};Port.prototype.showCorona=function(a,b){if(a==true){if(!this.parentNode.getWorkflow()){}else{this.corona=new Corona();this.corona.setAlpha(0.3);this.corona.setBackgroundColor(new Color(0,125,125));this.corona.setColor(null);this.corona.setDimension(this.getWidth()+(this.getCoronaWidth()*2),this.getWidth()+(this.getCoronaWidth()*2));this.parentNode.getWorkflow().addFigure(this.corona,this.getAbsoluteX()-this.getCoronaWidth()-this.getWidth()/2,this.getAbsoluteY()-this.getCoronaWidth()-this.getHeight()/2);if(!this.parentNode.getWorkflow().getConnectionLine()||this.parentNode.getWorkflow().getConnectionLine()==null){}else{this.point1=this.parentNode.getWorkflow().getConnectionLine().getStartPoint();this.point2=this.parentNode.getWorkflow().getConnectionLine().getEndPoint();this.midPoint=new Point(((this.point1.getX()+this.point2.getX())/2),((this.point1.getY()+this.point2.getY())/2));this.startImage=new ImageFigure("images/draw2d/check.png");this.startImage.setDimension(62,62);this.parentNode.workflow.addFigure(this.startImage,this.midPoint.getX(),this.midPoint.getY())}}}else{if(a==false&&this.corona!=null){this.parentNode.getWorkflow().removeFigure(this.corona);if(this.startImage!=null){this.parentNode.getWorkflow().removeFigure(this.startImage)}this.startImage=null;this.corona=null}}};Port.prototype.setId=function(a){this.html.id=a;this.id=a};
InputPort=function(b){Port.call(this,b)};InputPort.prototype=new Port;InputPort.prototype.type="InputPort";InputPort.prototype.onDrop=function(d){if(d.getMaxFanOut&&d.getMaxFanOut()<=d.getFanOut()){return}if(this.parentNode.id==d.parentNode.id){}else{if(d instanceof OutputPort){var c=new CommandConnect(this.parentNode.workflow,d,this);this.parentNode.workflow.getCommandStack().execute(c)}}};InputPort.prototype.onDragEnter=function(a){if(a instanceof OutputPort){Port.prototype.onDragEnter.call(this,a)}};InputPort.prototype.onDragLeave=function(a){if(a instanceof OutputPort){Port.prototype.onDragLeave.call(this,a)}};
OutputPort=function(b){Port.call(this,b);this.maxFanOut=100};OutputPort.prototype=new Port;OutputPort.prototype.type="OutputPort";OutputPort.prototype.onDrop=function(d){if(this.getMaxFanOut()<=this.getFanOut()){return}if(this.parentNode.id==d.parentNode.id){}else{if(d instanceof InputPort){alert("Drop");var c=new CommandConnect(this.parentNode.workflow,this,d);this.parentNode.workflow.getCommandStack().execute(c)}}};OutputPort.prototype.onDragEnter=function(a){this.point1=this.parentNode.getWorkflow().getConnectionLine().getStartPoint();this.point2=this.parentNode.getWorkflow().getConnectionLine().getEndPoint();this.midPoint=new Point(((this.point1.getX()+this.point2.getX())/2),((this.point1.getY()+this.point2.getY())/2));this.wrongImage=new ImageFigure("images/draw2d/wrong.png");this.wrongImage.setDimension(62,62);this.parentNode.workflow.addFigure(this.wrongImage,this.point1.getX(),this.point1.getY());if(this.getMaxFanOut()<=this.getFanOut()){return}if(a instanceof InputPort){Port.prototype.onDragEnter.call(this,a)}};OutputPort.prototype.onDragLeave=function(a){this.parentNode.workflow.removeFigure(this.wrongImage);if(a instanceof InputPort){Port.prototype.onDragLeave.call(this,a)}};OutputPort.prototype.onDragstart=function(d,c){if(this.maxFanOut==-1){return true}if(this.getMaxFanOut()<=this.getFanOut()){return false}return true};OutputPort.prototype.setMaxFanOut=function(b){this.maxFanOut=b};OutputPort.prototype.getMaxFanOut=function(){return this.maxFanOut};OutputPort.prototype.getFanOut=function(){if(this.getParent().workflow==null){return 0}var h=0;var f=this.getParent().workflow.getLines();var i=f.getSize();for(var j=0;j<i;j++){var g=f.get(j);if(g instanceof Connection){if(g.getSource()==this){h++}else{if(g.getTarget()==this){h++}}}}return h};
Line=function(){this.lineColor=new Color(35,141,201);this.stroke=1;this.canvas=null;this.workflow=null;this.html=null;this.graphics=null;this.id=this.generateUId();this.startX=30;this.startY=30;this.endX=100;this.endY=100;this.alpha=1;this.isMoving=false;this.zOrder=Line.ZOrderBaseIndex;this.moveListener=new ArrayList();this.setSelectable(true);this.setDeleteable(true)};Line.ZOrderBaseIndex=200;Line.setZOrderBaseIndex=function(a){Line.ZOrderBaseIndex=a};Line.prototype.dispose=function(){this.canvas=null;this.workflow=null;if(this.graphics!=null){this.graphics.clear()}this.graphics=null};Line.prototype.getZOrder=function(){return this.zOrder};Line.prototype.setZOrder=function(a){if(this.html!=null){this.html.style.zIndex=a}this.zOrder=a};Line.prototype.createHTMLElement=function(){this.item=document.createElement("div");this.item.id=this.id;this.item.style.position="absolute";this.item.style.left="0px";this.item.style.top="0px";this.item.style.height="0px";this.item.style.width="0px";this.item.style.zIndex=this.zOrder;return this.item};Line.prototype.getHTMLElement=function(){if(this.html==null){this.html=this.createHTMLElement()}return this.html};Line.prototype.getWorkflow=function(){return this.workflow};Line.prototype.isResizeable=function(){return true};Line.prototype.setCanvas=function(a){this.canvas=a;if(this.graphics!=null){this.graphics.clear()}this.graphics=null};Line.prototype.setWorkflow=function(a){this.workflow=a;if(this.graphics!=null){this.graphics.clear()}this.graphics=null};Line.prototype.paint=function(){if(this.graphics==null){this.graphics=new jsGraphics(this.id)}else{this.graphics.clear()}this.graphics.setStroke(this.stroke);this.graphics.setColor(this.lineColor.getHTMLStyle());this.graphics.drawLine(this.startX,this.startY,this.endX,this.endY);this.graphics.paint()};Line.prototype.attachMoveListener=function(a){this.moveListener.add(a)};Line.prototype.detachMoveListener=function(a){this.moveListener.remove(a)};Line.prototype.fireMoveEvent=function(){var b=this.moveListener.getSize();for(var a=0;a<b;a++){this.moveListener.get(a).onOtherFigureMoved(this)}};Line.prototype.onOtherFigureMoved=function(a){};Line.prototype.setLineWidth=function(a){this.stroke=a;if(this.graphics!=null){this.paint()}this.setDocumentDirty()};Line.prototype.setColor=function(a){this.lineColor=a;if(this.graphics!=null){this.paint()}this.setDocumentDirty()};Line.prototype.getColor=function(){return this.lineColor};Line.prototype.setAlpha=function(c){if(c==this.alpha){return}try{this.html.style.MozOpacity=c}catch(a){}try{this.html.style.opacity=c}catch(a){}try{var b=Math.round(c*100);if(b>=99){this.html.style.filter=""}else{this.html.style.filter="alpha(opacity="+b+")"}}catch(a){}this.alpha=c};Line.prototype.setStartPoint=function(a,b){this.startX=a;this.startY=b;if(this.graphics!=null){this.paint()}this.setDocumentDirty()};Line.prototype.setEndPoint=function(a,b){this.endX=a;this.endY=b;if(this.graphics!=null){this.paint()}this.setDocumentDirty()};Line.prototype.getStartX=function(){return this.startX};Line.prototype.getStartY=function(){return this.startY};Line.prototype.getStartPoint=function(){return new Point(this.startX,this.startY)};Line.prototype.getEndX=function(){return this.endX};Line.prototype.getEndY=function(){return this.endY};Line.prototype.getEndPoint=function(){return new Point(this.endX,this.endY)};Line.prototype.isSelectable=function(){return this.selectable};Line.prototype.setSelectable=function(a){this.selectable=a};Line.prototype.isDeleteable=function(){return this.deleteable};Line.prototype.setDeleteable=function(a){this.deleteable=a};Line.prototype.getLength=function(){return Math.sqrt((this.startX-this.endX)*(this.startX-this.endX)+(this.startY-this.endY)*(this.startY-this.endY))};Line.prototype.getAngle=function(){var a=this.getLength();var b=-(180/Math.PI)*Math.asin((this.startY-this.endY)/a);if(b<0){if(this.endX<this.startX){b=Math.abs(b)+180}else{b=360-Math.abs(b)}}else{if(this.endX<this.startX){b=180-b}}return b};Line.prototype.onContextMenu=function(a,c){var b=this.getContextMenu();if(b!=null){this.workflow.showMenu(b,a,c)}};Line.prototype.getContextMenu=function(){return null};Line.prototype.onDoubleClick=function(){};Line.prototype.setDocumentDirty=function(){if(this.workflow!=null){this.workflow.setDocumentDirty()}};Line.prototype.generateUId=function(){var d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";var e=10;var c=10;nbTry=0;while(nbTry<1000){var f="";for(var b=0;b<e;b++){var a=Math.floor(Math.random()*d.length);f+=d.substring(a,a+1)}elem=document.getElementById(f);if(!elem){return f}nbTry+=1}return null};Line.prototype.containsPoint=function(b,a){return Line.hit(this.startX,this.startY,this.endX,this.endY,b,a)};Line.hit=function(c,j,b,i,h,g){var e=5;b-=c;i-=j;h-=c;g-=j;var f=h*b+g*i;var a;if(f<=0){a=0}else{h=b-h;g=i-g;f=h*b+g*i;if(f<=0){a=0}else{a=f*f/(b*b+i*i)}}var d=h*h+g*g-a;if(d<0){d=0}return Math.sqrt(d)<e};Line.prototype.setId=function(a){this.item.id=a};
ConnectionDecorator=function(){this.color=new Color(0,0,0);this.backgroundColor=new Color(250,250,250)};ConnectionDecorator.prototype.type="ConnectionDecorator";ConnectionDecorator.prototype.paint=function(a){};ConnectionDecorator.prototype.setColor=function(a){this.color=a};ConnectionDecorator.prototype.setBackgroundColor=function(a){this.backgroundColor=a};
ConnectionRouter=function(){};ConnectionRouter.prototype.type="ConnectionRouter";ConnectionRouter.prototype.getDirection=function(b,d){var e=Math.abs(b.x-d.x);var c=1;var a=Math.abs(b.y-d.y);if(a<=e){e=a;c=0}a=Math.abs(b.getBottom()-d.y);if(a<=e){e=a;c=2}a=Math.abs(b.getRight()-d.x);if(a<e){e=a;c=1}return c};ConnectionRouter.prototype.getEndDirection=function(b){var c=b.getEndPoint();var a=b.getTarget().getParent().getBounds();return 0};ConnectionRouter.prototype.getStartDirection=function(b){var c=b.getStartPoint();var a=b.getSource().getParent().getBounds();return 2};ConnectionRouter.prototype.route=function(a){};
ManhattanConnectionRouter=function(){this.MINDIST=20};ManhattanConnectionRouter.prototype=new ConnectionRouter;ManhattanConnectionRouter.prototype.type="ManhattanConnectionRouter";ManhattanConnectionRouter.prototype.route=function(b){var a=new Point(b.getStartPoint().getX()-1,b.getStartPoint().getY()+2.5);var c=this.getStartDirection(b);var e=new Point(b.getEndPoint().getX()-1,b.getEndPoint().getY()-7);var d=this.getEndDirection(b);this._route(b,e,d,a,c)};ManhattanConnectionRouter.prototype._route=function(d,e,h,p,c){var g=0.1;var f=0.01;var o=0;var i=1;var m=2;var a=3;var l=e.x-p.x;var j=e.y-p.y;var n;var b;if(((l*l)<(f))&&((j*j)<(f))){d.addPoint(new Point(p.x,p.y));return}if(h==a){if((l>0)&&((j*j)<g)&&(c==i)){n=p;b=c}else{if(l<0){n=new Point(e.x-this.MINDIST,e.y)}else{if(((j>0)&&(c==m))||((j<0)&&(c==o))){n=new Point(p.x,e.y)}else{if(h==c){var k=Math.min(e.x,p.x)-this.MINDIST;n=new Point(k,e.y)}else{n=new Point(e.x-(l/2),e.y)}}}if(j>0){b=o}else{b=m}}}else{if(h==i){if((l<0)&&((j*j)<g)&&(c==a)){n=p;b=c}else{if(l>0){n=new Point(e.x+this.MINDIST,e.y)}else{if(((j>0)&&(c==m))||((j<0)&&(c==o))){n=new Point(p.x,e.y)}else{if(h==c){var k=Math.max(e.x,p.x)+this.MINDIST;n=new Point(k,e.y)}else{n=new Point(e.x-(l/2),e.y)}}}if(j>0){b=o}else{b=m}}}else{if(h==m){if(((l*l)<g)&&(j<0)&&(c==o)){n=p;b=c}else{if(j>0){n=new Point(e.x,e.y+this.MINDIST)}else{if(((l>0)&&(c==i))||((l<0)&&(c==a))){n=new Point(e.x,p.y)}else{if(h==c){var k=Math.max(e.y,p.y)+this.MINDIST;n=new Point(e.x,k)}else{n=new Point(e.x,e.y-(j/2))}}}if(l>0){b=a}else{b=i}}}else{if(h==o){if(((l*l)<g)&&(j>0)&&(c==m)){n=p;b=c}else{if(j<0){n=new Point(e.x,e.y-this.MINDIST)}else{if(((l>0)&&(c==i))||((l<0)&&(c==a))){n=new Point(e.x,p.y)}else{if(h==c){var k=Math.min(e.y,p.y)-this.MINDIST;n=new Point(e.x,k)}else{n=new Point(e.x,e.y-(j/2))}}}if(l>0){b=a}else{b=i}}}}}}this._route(d,n,b,p,c);d.addPoint(e)};
Connection=function(){Line.call(this);this.sourcePort=null;this.targetPort=null;this.sourceDecorator=null;this.targetDecorator=new shape.uml.InheritanceConnectionDecorator();this.sourceAnchor=new ConnectionAnchor();this.targetAnchor=new ConnectionAnchor();this.router=Connection.defaultRouter;this.lineSegments=new ArrayList();this.children=new ArrayList();this.setColor(new Color(35,141,201));this.setLineWidth(1)};Connection.prototype=new Line;Connection.defaultRouter=new ManhattanConnectionRouter();Connection.setDefaultRouter=function(a){Connection.defaultRouter=a};Connection.prototype.disconnect=function(){if(this.sourcePort!=null){this.sourcePort.detachMoveListener(this);this.fireSourcePortRouteEvent()}if(this.targetPort!=null){this.targetPort.detachMoveListener(this);this.fireTargetPortRouteEvent()}};Connection.prototype.reconnect=function(){if(this.sourcePort!=null){this.sourcePort.attachMoveListener(this);this.fireSourcePortRouteEvent()}if(this.targetPort!=null){this.targetPort.attachMoveListener(this);this.fireTargetPortRouteEvent()}};Connection.prototype.isResizeable=function(){return false};Connection.prototype.addFigure=function(b,a){var c=new Object();c.figure=b;c.locator=a;this.children.add(c);if(this.graphics!=null){this.paint()}};Connection.prototype.setSourceDecorator=function(a){this.sourceDecorator=a;if(this.graphics!=null){this.paint()}};Connection.prototype.setTargetDecorator=function(a){this.targetDecorator=a;if(this.graphics!=null){this.paint()}};Connection.prototype.setSourceAnchor=function(a){this.sourceAnchor=a;this.sourceAnchor.setOwner(this.sourcePort);if(this.graphics!=null){this.paint()}};Connection.prototype.setTargetAnchor=function(a){this.targetAnchor=a;this.targetAnchor.setOwner(this.targetPort);if(this.graphics!=null){this.paint()}};Connection.prototype.setRouter=function(a){if(a!=null){this.router=a}else{this.router=new NullConnectionRouter()}if(this.graphics!=null){this.paint()}};Connection.prototype.getRouter=function(){return this.router};Connection.prototype.paint=function(){for(var a=0;a<this.children.getSize();a++){var b=this.children.get(a);if(b.isAppended==true){this.html.removeChild(b.figure.getHTMLElement())}b.isAppended=false}if(this.graphics==null){this.graphics=new jsGraphics(this.id)}else{this.graphics.clear()}this.graphics.setStroke(this.stroke);this.graphics.setColor(this.lineColor.getHTMLStyle());this.startStroke();this.router.route(this);if(this.getSource().getParent().isMoving==false&&this.getTarget().getParent().isMoving==false){targetPoint=new Point(this.getEndPoint().x,(this.getEndPoint().y));startPoint=new Point(this.getStartPoint().x,(this.getStartPoint().y));this.targetDecorator=new shape.uml.InheritanceConnectionDecorator();if(this.targetDecorator!=null){this.targetDecorator.paint(new Graphics(this.graphics,this.getEndAngle(),targetPoint))}if(this.sourceDecorator!=null){this.sourceDecorator.paint(new Graphics(this.graphics,this.getStartAngle(),startPoint))}}this.finishStroke();for(var a=0;a<this.children.getSize();a++){var b=this.children.get(a);this.html.appendChild(b.figure.getHTMLElement());b.isAppended=true;b.locator.relocate(b.figure)}};Connection.prototype.getStartPoint=function(){if(this.isMoving==false){return this.sourceAnchor.getLocation(this.targetAnchor.getReferencePoint())}else{return Line.prototype.getStartPoint.call(this)}};Connection.prototype.getEndPoint=function(){if(this.isMoving==false){return this.targetAnchor.getLocation(this.sourceAnchor.getReferencePoint())}else{return Line.prototype.getEndPoint.call(this)}};Connection.prototype.startStroke=function(){this.oldPoint=null;this.lineSegments=new ArrayList()};Connection.prototype.finishStroke=function(){this.graphics.paint();this.oldPoint=null};Connection.prototype.getPoints=function(){var a=new ArrayList();var b;for(var c=0;c<this.lineSegments.getSize();c++){b=this.lineSegments.get(c);a.add(b.start)}a.add(b.end);return a};Connection.prototype.addPoint=function(b){b=new Point(b.x,b.y);if(this.oldPoint!=null){this.graphics.drawLine(this.oldPoint.x,this.oldPoint.y,b.x,b.y);var a=new Object();a.start=this.oldPoint;a.end=b;this.lineSegments.add(a)}this.oldPoint=new Object();this.oldPoint.x=b.x;this.oldPoint.y=b.y};Connection.prototype.setSource=function(a){if(this.sourcePort!=null){this.sourcePort.detachMoveListener(this)}this.sourcePort=a;if(this.sourcePort==null){return}this.sourceAnchor.setOwner(this.sourcePort);this.fireSourcePortRouteEvent();this.sourcePort.attachMoveListener(this);this.setStartPoint(a.getAbsoluteX(),a.getAbsoluteY())};Connection.prototype.getSource=function(){return this.sourcePort};Connection.prototype.setTarget=function(a){if(this.targetPort!=null){this.targetPort.detachMoveListener(this)}this.targetPort=a;if(this.targetPort==null){return}this.targetAnchor.setOwner(this.targetPort);this.fireTargetPortRouteEvent();this.targetPort.attachMoveListener(this);this.setEndPoint(a.getAbsoluteX(),a.getAbsoluteY())};Connection.prototype.getTarget=function(){return this.targetPort};Connection.prototype.onOtherFigureMoved=function(a){if(a==this.sourcePort){this.setStartPoint(this.sourcePort.getAbsoluteX(),this.sourcePort.getAbsoluteY())}else{this.setEndPoint(this.targetPort.getAbsoluteX(),this.targetPort.getAbsoluteY())}};Connection.prototype.containsPoint=function(d,b){for(var c=0;c<this.lineSegments.getSize();c++){var a=this.lineSegments.get(c);if(Line.hit(a.start.x,a.start.y,a.end.x,a.end.y,d,b)){return true}}return false};Connection.prototype.getStartAngle=function(){var d=this.lineSegments.get(0).start;var b=this.lineSegments.get(0).end;var a=Math.sqrt((d.x-b.x)*(d.x-b.x)+(d.y-b.y)*(d.y-b.y));var c=-(180/Math.PI)*Math.asin((d.y-b.y)/a);if(c<0){if(b.x<d.x){c=Math.abs(c)+180}else{c=360-Math.abs(c)}}else{if(b.x<d.x){c=180-c}}return c};Connection.prototype.getEndAngle=function(){var d=this.lineSegments.get(this.lineSegments.getSize()-1).end;var b=this.lineSegments.get(this.lineSegments.getSize()-1).start;var a=Math.sqrt((d.x-b.x)*(d.x-b.x)+(d.y-b.y)*(d.y-b.y));var c=-(180/Math.PI)*Math.asin((d.y-b.y)/a);if(c<0){if(b.x<d.x){c=Math.abs(c)+180}else{c=360-Math.abs(c)}}else{if(b.x<d.x){c=180-c}}return c};Connection.prototype.fireSourcePortRouteEvent=function(){var b=this.sourcePort.getConnections();for(var a=0;a<b.getSize();a++){b.get(a).paint()}};Connection.prototype.fireTargetPortRouteEvent=function(){var b=this.targetPort.getConnections();for(var a=0;a<b.getSize();a++){b.get(a).paint()}};
ConnectionAnchor=function(a){this.owner=a};ConnectionAnchor.prototype.type="ConnectionAnchor";ConnectionAnchor.prototype.getLocation=function(a){return this.getReferencePoint()};ConnectionAnchor.prototype.getOwner=function(){return this.owner};ConnectionAnchor.prototype.setOwner=function(a){this.owner=a};ConnectionAnchor.prototype.getBox=function(){return this.getOwner().getAbsoluteBounds()};ConnectionAnchor.prototype.getReferencePoint=function(){if(this.getOwner()==null){return null}else{return this.getOwner().getAbsolutePosition()}};
CompartmentFigure=function(){Node.call(this);this.children=new ArrayList();this.setBorder(new LineBorder(1));this.dropable=new DropTarget(this.html);this.dropable.node=this;this.dropable.addEventListener("figureenter",function(a){a.target.node.onFigureEnter(a.relatedTarget.node)});this.dropable.addEventListener("figureleave",function(a){a.target.node.onFigureLeave(a.relatedTarget.node)});this.dropable.addEventListener("figuredrop",function(a){a.target.node.onFigureDrop(a.relatedTarget.node)})};CompartmentFigure.prototype=new Node;CompartmentFigure.prototype.type="CompartmentFigure";CompartmentFigure.prototype.onFigureEnter=function(a){};CompartmentFigure.prototype.onFigureLeave=function(a){};CompartmentFigure.prototype.onFigureDrop=function(a){};CompartmentFigure.prototype.getChildren=function(){return this.children};CompartmentFigure.prototype.addChild=function(a){a.setZOrder(this.getZOrder()+1);a.setParent(this);this.children.add(a)};CompartmentFigure.prototype.removeChild=function(a){a.setParent(null);this.children.remove(a)};CompartmentFigure.prototype.setZOrder=function(a){Node.prototype.setZOrder.call(this,a);for(var b=0;b<this.children.getSize();b++){this.children.get(b).setZOrder(a+1)}};CompartmentFigure.prototype.setPosition=function(e,d){var c=this.getX();var b=this.getY();Node.prototype.setPosition.call(this,e,d);for(var a=0;a<this.children.getSize();a++){var f=this.children.get(a);f.setPosition(f.getX()+this.getX()-c,f.getY()+this.getY()-b)}};CompartmentFigure.prototype.onDrag=function(){var c=this.getX();var b=this.getY();Node.prototype.onDrag.call(this);for(var a=0;a<this.children.getSize();a++){var d=this.children.get(a);d.setPosition(d.getX()+this.getX()-c,d.getY()+this.getY()-b)}};
Document=function(a){this.canvas=a};Document.prototype.getFigures=function(){var b=new ArrayList();var d=this.canvas.figures;var e=this.canvas.dialogs;for(var c=0;c<d.getSize();c++){var a=d.get(c);if(e.indexOf(a)==-1&&a.getParent()==null&&!(a instanceof Window)){b.add(a)}}return b};Document.prototype.getFigure=function(a){return this.canvas.getFigure(a)};Document.prototype.getLines=function(){return this.canvas.getLines()};
ResizeHandle=function(d,b){Rectangle.call(this,5,5);this.type=b;var c=this.getWidth();var a=c/2;switch(this.type){case 1:this.setSnapToGridAnchor(new Point(c,c));break;case 2:this.setSnapToGridAnchor(new Point(a,c));break;case 3:this.setSnapToGridAnchor(new Point(0,c));break;case 4:this.setSnapToGridAnchor(new Point(0,a));break;case 5:this.setSnapToGridAnchor(new Point(0,0));break;case 6:this.setSnapToGridAnchor(new Point(a,0));break;case 7:this.setSnapToGridAnchor(new Point(c,0));break;case 8:this.setSnapToGridAnchor(new Point(c,a));break}this.setBackgroundColor(new Color(0,255,0));this.setWorkflow(d);this.setZOrder(10000)};ResizeHandle.prototype=new Rectangle;ResizeHandle.prototype.type="ResizeHandle";ResizeHandle.prototype.getSnapToDirection=function(){switch(this.type){case 1:return SnapToHelper.NORTH_WEST;case 2:return SnapToHelper.NORTH;case 3:return SnapToHelper.NORTH_EAST;case 4:return SnapToHelper.EAST;case 5:return SnapToHelper.SOUTH_EAST;case 6:return SnapToHelper.SOUTH;case 7:return SnapToHelper.SOUTH_WEST;case 8:return SnapToHelper.WEST}};ResizeHandle.prototype.onDragend=function(){if(this.commandMove==null){return}var a=this.workflow.currentSelection;this.commandMove.setPosition(a.getX(),a.getY());this.commandResize.setDimension(a.getWidth(),a.getHeight());this.workflow.getCommandStack().execute(this.commandResize);this.workflow.getCommandStack().execute(this.commandMove);this.commandMove=null;this.commandResize=null;this.workflow.hideSnapToHelperLines()};ResizeHandle.prototype.setPosition=function(b,a){this.x=b;this.y=a;this.html.style.left=this.x+"px";this.html.style.top=this.y+"px"};ResizeHandle.prototype.onDragstart=function(b,c){if(!this.canDrag){return false}var a=this.workflow.currentSelection;this.commandMove=new CommandMove(a,a.getX(),a.getY());this.commandResize=new CommandResize(a,a.getWidth(),a.getHeight());return true};ResizeHandle.prototype.onDrag=function(){var g=this.getX();var f=this.getY();Rectangle.prototype.onDrag.call(this);var e=g-this.getX();var c=f-this.getY();var d=this.workflow.currentSelection.getX();var b=this.workflow.currentSelection.getY();var a=this.workflow.currentSelection.getWidth();var h=this.workflow.currentSelection.getHeight();switch(this.type){case 1:this.workflow.currentSelection.setPosition(d-e,b-c);this.workflow.currentSelection.setDimension(a+e,h+c);break;case 2:this.workflow.currentSelection.setPosition(d,b-c);this.workflow.currentSelection.setDimension(a,h+c);break;case 3:this.workflow.currentSelection.setPosition(d,b-c);this.workflow.currentSelection.setDimension(a-e,h+c);break;case 4:this.workflow.currentSelection.setPosition(d,b);this.workflow.currentSelection.setDimension(a-e,h);break;case 5:this.workflow.currentSelection.setPosition(d,b);this.workflow.currentSelection.setDimension(a-e,h-c);break;case 6:this.workflow.currentSelection.setPosition(d,b);this.workflow.currentSelection.setDimension(a,h-c);break;case 7:this.workflow.currentSelection.setPosition(d-e,b);this.workflow.currentSelection.setDimension(a+e,h-c);break;case 8:this.workflow.currentSelection.setPosition(d-e,b);this.workflow.currentSelection.setDimension(a+e,h);break}this.workflow.moveResizeHandles(this.workflow.getCurrentSelection())};ResizeHandle.prototype.setCanDrag=function(a){Rectangle.prototype.setCanDrag.call(this,a);if(!a){this.html.style.cursor="";return}switch(this.type){case 1:this.html.style.cursor="nw-resize";break;case 2:this.html.style.cursor="s-resize";break;case 3:this.html.style.cursor="ne-resize";break;case 4:this.html.style.cursor="w-resize";break;case 5:this.html.style.cursor="se-resize";break;case 6:this.html.style.cursor="n-resize";break;case 7:this.html.style.cursor="sw-resize";break;case 8:this.html.style.cursor="e-resize";break}};ResizeHandle.prototype.onKeyDown=function(b,a){this.workflow.onKeyDown(b,a)};ResizeHandle.prototype.fireMoveEvent=function(){};
Canvas=function(a){if(a){this.construct(a)}this.enableSmoothFigureHandling=false;this.canvasLines=new ArrayList()};Canvas.prototype.type="Canvas";Canvas.prototype.construct=function(a){this.canvasId=a;this.html=document.getElementById(this.canvasId);this.scrollArea=document.body.parentNode};Canvas.prototype.setViewPort=function(a){this.scrollArea=document.getElementById(a)};Canvas.prototype.addFigure=function(a,g,d,c){if(this.enableSmoothFigureHandling==true){if(a.timer<=0){a.setAlpha(0.001)}var b=a;var e=function(){if(b.alpha<1){b.setAlpha(Math.min(1,b.alpha+0.05))}else{window.clearInterval(b.timer);b.timer=-1}};if(b.timer>0){window.clearInterval(b.timer)}b.timer=window.setInterval(e,30)}a.setCanvas(this);if(g&&d){a.setPosition(g,d)}if(a instanceof Line){this.canvasLines.add(a);this.html.appendChild(a.getHTMLElement())}else{var f=this.canvasLines.getFirstElement();if(f==null){this.html.appendChild(a.getHTMLElement())}else{this.html.insertBefore(a.getHTMLElement(),f.getHTMLElement())}}if(!c){a.paint()}};Canvas.prototype.removeFigure=function(a){if(this.enableSmoothFigureHandling==true){var c=this;var b=a;var d=function(){if(b.alpha>0){b.setAlpha(Math.max(0,b.alpha-0.05))}else{window.clearInterval(b.timer);b.timer=-1;c.html.removeChild(b.html);b.setCanvas(null)}};if(b.timer>0){window.clearInterval(b.timer)}b.timer=window.setInterval(d,20)}else{this.html.removeChild(a.html);a.setCanvas(null)}if(a instanceof Line){this.canvasLines.remove(a)}};Canvas.prototype.getEnableSmoothFigureHandling=function(){return this.enableSmoothFigureHandling};Canvas.prototype.setEnableSmoothFigureHandling=function(a){this.enableSmoothFigureHandling=a};Canvas.prototype.getWidth=function(){return parseInt(this.html.style.width)};Canvas.prototype.getHeight=function(){return parseInt(this.html.style.height)};Canvas.prototype.setBackgroundImage=function(a,b){if(a!=null){if(b){this.html.style.background="transparent url("+a+") "}else{this.html.style.background="transparent url("+a+") no-repeat"}}else{this.html.style.background="transparent"}};Canvas.prototype.getY=function(){return this.y};Canvas.prototype.getX=function(){return this.x};Canvas.prototype.getAbsoluteY=function(){var a=this.html;var b=a.offsetTop;while((a=a.offsetParent)!=null){b+=a.offsetTop}return b};Canvas.prototype.getAbsoluteX=function(){var b=this.html;var a=b.offsetLeft;while((b=b.offsetParent)!=null){a+=b.offsetLeft}return a};Canvas.prototype.getScrollLeft=function(){return this.scrollArea.scrollLeft};Canvas.prototype.getScrollTop=function(){return this.scrollArea.scrollTop};
Workflow=function(k){if(!k){return}this.gridWidthX=10;this.gridWidthY=10;this.snapToGridHelper=null;this.verticalSnapToHelperLine=null;this.horizontalSnapToHelperLine=null;this.figures=new ArrayList();this.lines=new ArrayList();this.commonPorts=new ArrayList();this.dropTargets=new ArrayList();this.compartments=new ArrayList();this.selectionListeners=new ArrayList();this.dialogs=new ArrayList();this.toolPalette=null;this.dragging=false;this.tooltip=null;this.draggingLine=null;this.dragFigure=null;this.commandStack=new CommandStack();this.oldScrollPosLeft=0;this.oldScrollPosTop=0;this.currentSelection=null;this.currentMenu=null;this.connectionLine=new Line();this.resizeHandle1=new ResizeHandle(this,1);this.resizeHandle2=new ResizeHandle(this,2);this.resizeHandle3=new ResizeHandle(this,3);this.resizeHandle4=new ResizeHandle(this,4);this.resizeHandle5=new ResizeHandle(this,5);this.resizeHandle6=new ResizeHandle(this,6);this.resizeHandle7=new ResizeHandle(this,7);this.resizeHandle8=new ResizeHandle(this,8);this.resizeHandleHalfWidth=parseInt(this.resizeHandle2.getWidth()/2);this.lastSelectedFigure=null;Canvas.call(this,k);this.setPanning(false);if(this.html!=null){n=this;this.html.tabIndex="0";var m=function(){var c=arguments[0]||window.event;var b=c.clientX;var d=c.clientY;var f=n.getScrollLeft();var h=n.getScrollTop();var a=n.getAbsoluteX();var g=n.getAbsoluteY();if(n.getBestFigure(b+f-a,d+h-g)!=null){return}var e=n.getBestLine(b+f-a,d+h-g,null);if(e!=null){e.onContextMenu(b+f-a,d+h-g)}else{n.onContextMenu(b+f-a,d+h-g)}};this.html.oncontextmenu=function(){return false};var n=this;var p=function(b){var a=b.ctrlKey;n.onKeyDown(b.keyCode,a)};var i=function(){var d=arguments[0]||window.event;var c=d.clientX;var e=d.clientY;var f=n.getScrollLeft();var a=n.getScrollTop();var b=n.getAbsoluteX();var g=n.getAbsoluteY();n.onMouseDown(c+f-b,e+a-g)};var j=function(){var d=arguments[0]||window.event;if(n.currentMenu!=null){n.removeFigure(n.currentMenu);n.currentMenu=null}if(d.button==2){return}var c=d.clientX;var e=d.clientY;var f=n.getScrollLeft();var a=n.getScrollTop();var b=n.getAbsoluteX();var g=n.getAbsoluteY();n.onMouseUp(c+f-b,e+a-g)};var o=function(){var b=arguments[0]||window.event;var c=b.clientX;var d=b.clientY;var h=n.getScrollLeft();var r=n.getScrollTop();var e=n.getAbsoluteX();var g=n.getAbsoluteY();n.currentMouseX=c+h-e;n.currentMouseY=d+r-g;var f=n.getBestFigure(n.currentMouseX,n.currentMouseY);if(Drag.currentHover!=null&&f==null){var a=new DragDropEvent();a.initDragDropEvent("mouseleave",false,n);Drag.currentHover.dispatchEvent(a)}else{var c=b.clientX;var d=b.clientY;var h=n.getScrollLeft();var r=n.getScrollTop();var e=n.getAbsoluteX();var g=n.getAbsoluteY();n.onMouseMove(c+h-e,d+r-g)}if(f==null){Drag.currentHover=null}if(n.tooltip!=null){if(Math.abs(n.currentTooltipX-n.currentMouseX)>10||Math.abs(n.currentTooltipY-n.currentMouseY)>10){n.showTooltip(null)}}};var l=function(c){var c=arguments[0]||window.event;var b=c.clientX;var d=c.clientY;var f=n.getScrollLeft();var h=n.getScrollTop();var a=n.getAbsoluteX();var g=n.getAbsoluteY();var e=n.getBestLine(b+f-a,d+h-g,null);if(e!=null){e.onDoubleClick()}};if(this.html.addEventListener){this.html.addEventListener("contextmenu",m,false);this.html.addEventListener("mousemove",o,false);this.html.addEventListener("mouseup",j,false);this.html.addEventListener("mousedown",i,false);this.html.addEventListener("keydown",p,false);this.html.addEventListener("dblclick",l,false)}else{if(this.html.attachEvent){this.html.attachEvent("oncontextmenu",m);this.html.attachEvent("onmousemove",o);this.html.attachEvent("onmousedown",i);this.html.attachEvent("onmouseup",j);this.html.attachEvent("onkeydown",p);this.html.attachEvent("ondblclick",l)}else{throw new Error("Open-jACOB Draw2D not supported in this browser.")}}}};Workflow.prototype=new Canvas;Workflow.prototype.type="Workflow";Workflow.COLOR_GREEN=new Color(0,255,0);Workflow.COLOR_WHITESMOKE=new Color(228,228,228);Workflow.COLOR_SELECTIONCOLOR=new Color(215,215,215);Workflow.prototype.onScroll=function(){var i=this.getScrollLeft();var j=this.getScrollTop();var k=i-this.oldScrollPosLeft;var l=j-this.oldScrollPosTop;for(var g=0;g<this.figures.getSize();g++){var h=this.figures.get(g);if(h.hasFixedPosition&&h.hasFixedPosition()==true){h.setPosition(h.getX()+k,h.getY()+l)}}this.oldScrollPosLeft=i;this.oldScrollPosTop=j};Workflow.prototype.setPanning=function(b){this.panning=b;if(b){this.html.style.cursor="move"}else{this.html.style.cursor="default"}};Workflow.prototype.scrollTo=function(l,n,o){if(o){this.scrollArea.scrollLeft=l;this.scrollArea.scrollTop=n}else{var m=40;var q=(l-this.getScrollLeft())/m;var r=(n-this.getScrollTop())/m;var i=this.getScrollLeft();var k=this.getScrollTop();for(var p=0;p<m;p++){this.scrollArea.scrollLeft=i+(q*p);this.scrollArea.scrollTop=k+(r*p)}}};Workflow.prototype.showTooltip=function(g,f){if(this.tooltip!=null){this.removeFigure(this.tooltip);this.tooltip=null;if(this.tooltipTimer>=0){window.clearTimeout(this.tooltipTimer);this.tooltipTimer=-1}}this.tooltip=g;if(this.tooltip!=null){this.currentTooltipX=this.currentMouseX;this.currentTooltipY=this.currentMouseY;this.addFigure(this.tooltip,this.currentTooltipX+10,this.currentTooltipY+10);var h=this;var e=function(){h.tooltipTimer=-1;h.showTooltip(null)};if(f==true){this.tooltipTimer=window.setTimeout(e,5000)}}};Workflow.prototype.showDialog=function(e,f,d){if(f){this.addFigure(e,f,d)}else{this.addFigure(e,200,100)}this.dialogs.add(e)};Workflow.prototype.showMenu=function(f,d,e){if(this.menu!=null){this.html.removeChild(this.menu.getHTMLElement());this.menu.setWorkflow()}this.menu=f;if(this.menu!=null){this.menu.setWorkflow(this);this.menu.setPosition(d,e);this.html.appendChild(this.menu.getHTMLElement());this.menu.paint()}};Workflow.prototype.onContextMenu=function(e,f){var d=this.getContextMenu();if(d!=null){this.showMenu(d,e,f)}};Workflow.prototype.getContextMenu=function(){return null};Workflow.prototype.setToolWindow=function(d,e,f){this.toolPalette=d;if(f){this.addFigure(d,e,f)}else{this.addFigure(d,20,20)}this.dialogs.add(d)};Workflow.prototype.setSnapToGrid=function(b){if(b){this.snapToGridHelper=new SnapToGrid(this)}else{this.snapToGridHelper=null}};Workflow.prototype.setSnapToGeometry=function(b){if(b){this.snapToGeometryHelper=new SnapToGeometry(this)}else{this.snapToGeometryHelper=null}};Workflow.prototype.setGridWidth=function(c,d){this.gridWidthX=c;this.gridWidthY=d};Workflow.prototype.addFigure=function(f,g,h){Canvas.prototype.addFigure.call(this,f,g,h,true);f.setWorkflow(this);var e=this;if(f instanceof CompartmentFigure){this.compartments.add(f)}if(f instanceof Line){this.lines.add(f)}else{this.figures.add(f);f.draggable.addEventListener("dragend",function(a){});f.draggable.addEventListener("dragstart",function(a){var b=e.getFigure(a.target.element.id);if(b==null){return}if(b.isSelectable()==false){return}e.showResizeHandles(b);e.setCurrentSelection(b)});f.draggable.addEventListener("drag",function(a){var b=e.getFigure(a.target.element.id);if(b==null){return}if(b.isSelectable()==false){return}e.moveResizeHandles(b)})}f.paint();this.setDocumentDirty()};Workflow.prototype.removeFigure=function(b){Canvas.prototype.removeFigure.call(this,b);this.figures.remove(b);this.lines.remove(b);this.dialogs.remove(b);b.setWorkflow(null);if(b instanceof CompartmentFigure){this.compartments.remove(b)}if(b instanceof Connection){b.disconnect()}if(this.currentSelection==b){this.setCurrentSelection(null)}this.setDocumentDirty()};Workflow.prototype.moveFront=function(b){this.html.removeChild(b.getHTMLElement());this.html.appendChild(b.getHTMLElement())};Workflow.prototype.moveBack=function(b){this.html.removeChild(b.getHTMLElement());this.html.insertBefore(b.getHTMLElement(),this.html.firstChild)};Workflow.prototype.getBestCompartmentFigure=function(l,i,j){var g=null;for(var k=0;k<this.figures.getSize();k++){var h=this.figures.get(k);if((h instanceof CompartmentFigure)&&h.isOver(l,i)==true&&h!=j){if(g==null){g=h}else{if(g.getZOrder()<h.getZOrder()){g=h}}}}return g};Workflow.prototype.getBestFigure=function(l,i,j){var g=null;for(var k=0;k<this.figures.getSize();k++){var h=this.figures.get(k);if(h.isOver(l,i)==true&&h!=j){if(g==null){g=h}else{if(g.getZOrder()<h.getZOrder()){g=h}}}}return g};Workflow.prototype.getBestLine=function(g,i,j){var h=null;for(var k=0;k<this.lines.getSize();k++){var l=this.lines.get(k);if(l.containsPoint(g,i)==true&&l!=j){if(h==null){h=l}else{if(h.getZOrder()<l.getZOrder()){h=l}}}}return h};Workflow.prototype.getFigure=function(f){for(var d=0;d<this.figures.getSize();d++){var e=this.figures.get(d);if(e.id==f){return e}}return null};Workflow.prototype.getFigures=function(){return this.figures};Workflow.prototype.getDocument=function(){return new Document(this)};Workflow.prototype.addSelectionListener=function(b){this.selectionListeners.add(b)};Workflow.prototype.removeSelectionListener=function(b){this.selectionListeners.remove(b)};Workflow.prototype.setCurrentSelection=function(e){if(e==null){if(!this.deleteImage){}else{if(this.deleteImage.getWorkflow()!=null){this.removeFigure(this.deleteImage)}}this.hideResizeHandles()}this.currentSelection=e;if(e!=null&&e instanceof Connection){this.deleteImage=new ImageFigure("images/draw2d/delete.png");this.deleteImage.setDimension(31,43);this.deleteImage.setCanDrag(false);this.deleteImage.setResizeable(false);this.deleteImage.setProperty("ConnectionLine",e);this.deleteImage.html.style.cursor="pointer";workflow.addFigure(this.deleteImage,this.mouseDownPosX,this.mouseDownPosY)}for(var f=0;f<this.selectionListeners.getSize();f++){var d=this.selectionListeners.get(f);if(d!=null&&d.onSelectionChanged){d.onSelectionChanged(this.currentSelection)}}if(e!=null&&e instanceof ImageFigure){workflow.removeFigure(this.deleteImage);this.lastSelectedFigure=this.deleteImage.getProperty("ConnectionLine");if(this.lastSelectedFigure!=null&&this.lastSelectedFigure instanceof Connection){workflow.removeFigure(this.lastSelectedFigure)}this.setCurrentSelection(null);this.showMenu(null)}};Workflow.prototype.getCurrentSelection=function(){return this.currentSelection};Workflow.prototype.getLines=function(){return this.lines};Workflow.prototype.registerPort=function(b){b.draggable.targets=this.dropTargets;this.commonPorts.add(b);this.dropTargets.add(b.dropable)};Workflow.prototype.unregisterPort=function(b){b.draggable.targets=null;this.commonPorts.remove(b);this.dropTargets.remove(b.dropable)};Workflow.prototype.getCommandStack=function(){return this.commandStack};Workflow.prototype.showConnectionLine=function(e,g,f,h){this.connectionLine.setStartPoint(e,g);this.connectionLine.setEndPoint(f,h);if(this.connectionLine.canvas==null){Canvas.prototype.addFigure.call(this,this.connectionLine)}};Workflow.prototype.hideConnectionLine=function(){if(this.connectionLine.canvas!=null){Canvas.prototype.removeFigure.call(this,this.connectionLine)}};Workflow.prototype.getConnectionLine=function(){if(this.connectionLine.canvas!=null){return this.connectionLine}};Workflow.prototype.showResizeHandles=function(l){this.hideResizeHandles();if(this.getEnableSmoothFigureHandling()==true&&this.getCurrentSelection()!=l){this.resizeHandle1.setAlpha(0.01);this.resizeHandle2.setAlpha(0.01);this.resizeHandle3.setAlpha(0.01);this.resizeHandle4.setAlpha(0.01);this.resizeHandle5.setAlpha(0.01);this.resizeHandle6.setAlpha(0.01);this.resizeHandle7.setAlpha(0.01);this.resizeHandle8.setAlpha(0.01)}var m=this.resizeHandle1.getWidth();var o=6;var r=this.resizeHandle1.getHeight();var j=l.getHeight();var k=l.getWidth();var n=l.getX();var q=l.getY();Canvas.prototype.addFigure.call(this,this.resizeHandle1,n-m-o,q-r-o/2);Canvas.prototype.addFigure.call(this,this.resizeHandle3,n+k+o,q-r-o/2);Canvas.prototype.addFigure.call(this,this.resizeHandle5,n+k+o,q+j+o/2);Canvas.prototype.addFigure.call(this,this.resizeHandle7,n-m-o,q+j+o/2);this.moveFront(this.resizeHandle1);this.moveFront(this.resizeHandle3);this.moveFront(this.resizeHandle5);this.moveFront(this.resizeHandle7);this.resizeHandle1.setCanDrag(l.isResizeable());this.resizeHandle3.setCanDrag(l.isResizeable());this.resizeHandle5.setCanDrag(l.isResizeable());this.resizeHandle7.setCanDrag(l.isResizeable());if(l.isResizeable()){var p=new Color(0,255,0);this.resizeHandle1.setBackgroundColor(p);this.resizeHandle3.setBackgroundColor(p);this.resizeHandle5.setBackgroundColor(p);this.resizeHandle7.setBackgroundColor(p)}else{this.resizeHandle1.setBackgroundColor(Workflow.COLOR_SELECTIONCOLOR);this.resizeHandle3.setBackgroundColor(Workflow.COLOR_SELECTIONCOLOR);this.resizeHandle5.setBackgroundColor(Workflow.COLOR_SELECTIONCOLOR);this.resizeHandle7.setBackgroundColor(Workflow.COLOR_SELECTIONCOLOR)}if(l.isStrechable()&&l.isResizeable()){this.resizeHandle2.setCanDrag(l.isResizeable());this.resizeHandle4.setCanDrag(l.isResizeable());this.resizeHandle6.setCanDrag(l.isResizeable());this.resizeHandle8.setCanDrag(l.isResizeable());Canvas.prototype.addFigure.call(this,this.resizeHandle2,n+(k/2)-this.resizeHandleHalfWidth,q-r);Canvas.prototype.addFigure.call(this,this.resizeHandle4,n+k,q+(j/2)-(r/2));Canvas.prototype.addFigure.call(this,this.resizeHandle6,n+(k/2)-this.resizeHandleHalfWidth,q+j);Canvas.prototype.addFigure.call(this,this.resizeHandle8,n-m,q+(j/2)-(r/2));this.moveFront(this.resizeHandle2);this.moveFront(this.resizeHandle4);this.moveFront(this.resizeHandle6);this.moveFront(this.resizeHandle8)}};Workflow.prototype.hideResizeHandles=function(){if(this.resizeHandle1.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle1)}if(this.resizeHandle2.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle2)}if(this.resizeHandle3.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle3)}if(this.resizeHandle4.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle4)}if(this.resizeHandle5.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle5)}if(this.resizeHandle6.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle6)}if(this.resizeHandle7.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle7)}if(this.resizeHandle8.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle8)}};Workflow.prototype.moveResizeHandles=function(h){var m=this.resizeHandle1.getWidth();var j=this.resizeHandle1.getHeight();var l=h.getHeight();var i=h.getWidth();var k=h.getX();var n=h.getY();this.resizeHandle1.setPosition(k-m,n-j-3);this.resizeHandle3.setPosition(k+i,n-j-3);this.resizeHandle5.setPosition(k+i,n+l+3);this.resizeHandle7.setPosition(k-m,n+l+3);if(h.isStrechable()){this.resizeHandle2.setPosition(k+(i/2)-this.resizeHandleHalfWidth,n-j);this.resizeHandle4.setPosition(k+i,n+(l/2)-(j/2));this.resizeHandle6.setPosition(k+(i/2)-this.resizeHandleHalfWidth,n+l);this.resizeHandle8.setPosition(k-m,n+(l/2)-(j/2))}};Workflow.prototype.onMouseDown=function(g,h){this.dragging=true;this.mouseDownPosX=g;this.mouseDownPosY=h;if(this.toolPalette!=null&&this.toolPalette.getActiveTool()!=null){this.toolPalette.getActiveTool().execute(g,h)}if(this.currentSelection instanceof Connection){workflow.removeFigure(this.deleteImage)}this.setCurrentSelection(null);this.showMenu(null);var i=this.getLines().getSize();for(var j=0;j<i;j++){var f=this.lines.get(j);if(f.containsPoint(g,h)&&f.isSelectable()){this.hideResizeHandles();this.setCurrentSelection(f);if(f instanceof Line&&!(f instanceof Connection)){this.draggingLine=f}break}}};Workflow.prototype.onMouseUp=function(d,c){this.dragging=false;this.draggingLine=null};Workflow.prototype.onMouseMove=function(f,g){if(this.html.style.cursor!="move"){if(this.dragFigure!=null){this.dragFigure.onDragend()}}if(this.dragging==true&&this.draggingLine!=null){var h=f-this.mouseDownPosX;var e=g-this.mouseDownPosY;this.draggingLine.startX=this.draggingLine.getStartX()+h;this.draggingLine.startY=this.draggingLine.getStartY()+e;this.draggingLine.setEndPoint(this.draggingLine.getEndX()+h,this.draggingLine.getEndY()+e);this.mouseDownPosX=f;this.mouseDownPosY=g}else{if(this.dragging==true&&this.panning==true){var h=f-this.mouseDownPosX;var e=g-this.mouseDownPosY;this.scrollTo(this.getScrollLeft()-h,this.getScrollTop()-e,true);this.onScroll()}}};Workflow.prototype.onKeyDown=function(c,d){if(c==46&&this.currentSelection!=null&&this.currentSelection.isDeleteable()){this.commandStack.execute(new CommandDelete(this.currentSelection))}};Workflow.prototype.setDocumentDirty=function(){for(var d=0;d<this.dialogs.getSize();d++){var c=this.dialogs.get(d);if(c!=null&&c.onSetDocumentDirty){c.onSetDocumentDirty()}}if(this.snapToGeometryHelper!=null){this.snapToGeometryHelper.onSetDocumentDirty()}if(this.snapToGridHelper!=null){this.snapToGridHelper.onSetDocumentDirty()}};Workflow.prototype.snapToHelper=function(h,j){if(this.snapToGeometryHelper!=null){if(h instanceof ResizeHandle){var l=h.getSnapToGridAnchor();j.x+=l.x;j.y+=l.y;var i=new Point(j.x,j.y);var m=h.getSnapToDirection();var k=this.snapToGeometryHelper.snapPoint(m,j,i);if((m&SnapToHelper.EAST_WEST)&&!(k&SnapToHelper.EAST_WEST)){this.showSnapToHelperLineVertical(i.x)}else{this.hideSnapToHelperLineVertical()}if((m&SnapToHelper.NORTH_SOUTH)&&!(k&SnapToHelper.NORTH_SOUTH)){this.showSnapToHelperLineHorizontal(i.y)}else{this.hideSnapToHelperLineHorizontal()}i.x-=l.x;i.y-=l.y;return i}else{var n=new Dimension(j.x,j.y,h.getWidth(),h.getHeight());var i=new Dimension(j.x,j.y,h.getWidth(),h.getHeight());var m=SnapToHelper.NSEW;var k=this.snapToGeometryHelper.snapRectangle(n,i);if((m&SnapToHelper.WEST)&&!(k&SnapToHelper.WEST)){this.showSnapToHelperLineVertical(i.x)}else{if((m&SnapToHelper.EAST)&&!(k&SnapToHelper.EAST)){this.showSnapToHelperLineVertical(i.getX()+i.getWidth())}else{this.hideSnapToHelperLineVertical()}}if((m&SnapToHelper.NORTH)&&!(k&SnapToHelper.NORTH)){this.showSnapToHelperLineHorizontal(i.y)}else{if((m&SnapToHelper.SOUTH)&&!(k&SnapToHelper.SOUTH)){this.showSnapToHelperLineHorizontal(i.getY()+i.getHeight())}else{this.hideSnapToHelperLineHorizontal()}}return i.getTopLeft()}}else{if(this.snapToGridHelper!=null){var l=h.getSnapToGridAnchor();j.x=j.x+l.x;j.y=j.y+l.y;var i=new Point(j.x,j.y);this.snapToGridHelper.snapPoint(0,j,i);i.x=i.x-l.x;i.y=i.y-l.y;return i}}return j};Workflow.prototype.showSnapToHelperLineHorizontal=function(b){if(this.horizontalSnapToHelperLine==null){this.horizontalSnapToHelperLine=new Line();this.horizontalSnapToHelperLine.setColor(new Color(175,175,255));this.addFigure(this.horizontalSnapToHelperLine)}this.horizontalSnapToHelperLine.setStartPoint(0,b);this.horizontalSnapToHelperLine.setEndPoint(this.getWidth(),b)};Workflow.prototype.showSnapToHelperLineVertical=function(b){if(this.verticalSnapToHelperLine==null){this.verticalSnapToHelperLine=new Line();this.verticalSnapToHelperLine.setColor(new Color(175,175,255));this.addFigure(this.verticalSnapToHelperLine)}this.verticalSnapToHelperLine.setStartPoint(b,0);this.verticalSnapToHelperLine.setEndPoint(b,this.getHeight())};Workflow.prototype.hideSnapToHelperLines=function(){this.hideSnapToHelperLineHorizontal();this.hideSnapToHelperLineVertical()};Workflow.prototype.hideSnapToHelperLineHorizontal=function(){if(this.horizontalSnapToHelperLine!=null){this.removeFigure(this.horizontalSnapToHelperLine);this.horizontalSnapToHelperLine=null}};Workflow.prototype.hideSnapToHelperLineVertical=function(){if(this.verticalSnapToHelperLine!=null){this.removeFigure(this.verticalSnapToHelperLine);this.verticalSnapToHelperLine=null}};Workflow.prototype.removeFigures=function(){for(var b=0;b<workflow.figures.getSize();b++){workflow.removeFigure(workflow.figures.get(b))}};Workflow.prototype.getWorkflow=function(){return this};Workflow.prototype.dragFigure=function(b){this.dragFigure=null;this.dragFigure=b};
Window=function(a){this.title=a;this.titlebar=null;Figure.call(this);this.setDeleteable(false);this.setCanSnapToHelper(false);this.setZOrder(Window.ZOrderIndex)};Window.prototype=new Figure;Window.prototype.type="Window";Window.ZOrderIndex=50000;Window.setZOrderBaseIndex=function(a){Window.ZOrderBaseIndex=a};Window.prototype.hasFixedPosition=function(){return true};Window.prototype.hasTitleBar=function(){return true};Window.prototype.createHTMLElement=function(){var a=Figure.prototype.createHTMLElement.call(this);a.style.margin="0px";a.style.padding="0px";a.style.border="1px solid black";a.style.backgroundImage="url(window_bg.png)";a.style.cursor=null;if(this.hasTitleBar()){this.titlebar=document.createElement("div");this.titlebar.style.position="absolute";this.titlebar.style.left="0px";this.titlebar.style.top="0px";this.titlebar.style.width=this.getWidth()+"px";this.titlebar.style.height="15px";this.titlebar.style.margin="0px";this.titlebar.style.padding="0px";this.titlebar.style.font="normal 10px verdana";this.titlebar.style.backgroundColor="blue";this.titlebar.style.borderBottom="2px solid gray";this.titlebar.style.whiteSpace="nowrap";this.titlebar.style.textAlign="center";this.titlebar.style.backgroundImage="url(window_toolbar.png)";this.textNode=document.createTextNode(this.title);this.titlebar.appendChild(this.textNode);a.appendChild(this.titlebar)}return a};Window.prototype.setDocumentDirty=function(a){};Window.prototype.onDragend=function(){};Window.prototype.onDragstart=function(a,b){if(this.titlebar==null){return false}if(this.canDrag==true&&a<parseInt(this.titlebar.style.width)&&b<parseInt(this.titlebar.style.height)){return true}return false};Window.prototype.isSelectable=function(){return false};Window.prototype.setCanDrag=function(a){Figure.prototype.setCanDrag.call(this,a);this.html.style.cursor="";if(this.titlebar==null){return}if(a){this.titlebar.style.cursor="move"}else{this.titlebar.style.cursor=""}};Window.prototype.setWorkflow=function(b){var a=this.workflow;Figure.prototype.setWorkflow.call(this,b);if(a!=null){a.removeSelectionListener(this)}if(this.workflow!=null){this.workflow.addSelectionListener(this)}};Window.prototype.setDimension=function(a,b){Figure.prototype.setDimension.call(this,a,b);if(this.titlebar!=null){this.titlebar.style.width=this.getWidth()+"px"}};Window.prototype.setTitle=function(a){this.title=a};Window.prototype.getMinWidth=function(){return 50};Window.prototype.getMinHeight=function(){return 50};Window.prototype.isResizeable=function(){return false};Window.prototype.setAlpha=function(a){};Window.prototype.setBackgroundColor=function(a){this.bgColor=a;if(this.bgColor!=null){this.html.style.backgroundColor=this.bgColor.getHTMLStyle()}else{this.html.style.backgroundColor="transparent";this.html.style.backgroundImage=""}};Window.prototype.setColor=function(a){this.lineColor=a;if(this.lineColor!=null){this.html.style.border=this.lineStroke+"px solid "+this.lineColor.getHTMLStyle()}else{this.html.style.border="0px"}};Window.prototype.setLineWidth=function(a){this.lineStroke=a;this.html.style.border=this.lineStroke+"px solid black"};Window.prototype.onSelectionChanged=function(a){};
Command=function(a){};Command.prototype.type="Command";Command.prototype.getLabel=function(){};Command.prototype.canExecute=function(){return true};Command.prototype.execute=function(){};Command.prototype.undo=function(){};Command.prototype.redo=function(){};
CommandStack=function(){this.undostack=new Array();this.redostack=new Array();this.maxundo=50;this.eventListeners=new ArrayList()};CommandStack.PRE_EXECUTE=1;CommandStack.PRE_REDO=2;CommandStack.PRE_UNDO=4;CommandStack.POST_EXECUTE=8;CommandStack.POST_REDO=16;CommandStack.POST_UNDO=32;CommandStack.POST_MASK=CommandStack.POST_EXECUTE|CommandStack.POST_UNDO|CommandStack.POST_REDO;CommandStack.PRE_MASK=CommandStack.PRE_EXECUTE|CommandStack.PRE_UNDO|CommandStack.PRE_REDO;CommandStack.prototype.type="CommandStack";CommandStack.prototype.setUndoLimit=function(a){this.maxundo=a};CommandStack.prototype.markSaveLocation=function(){this.undostack=new Array();this.redostack=new Array()};CommandStack.prototype.execute=function(a){if(a.canExecute()==false){return}this.notifyListeners(a,CommandStack.PRE_EXECUTE);this.undostack.push(a);a.execute();this.redostack=new Array();if(this.undostack.length>this.maxundo){this.undostack=this.undostack.slice(this.undostack.length-this.maxundo)}this.notifyListeners(a,CommandStack.POST_EXECUTE)};CommandStack.prototype.undo=function(){var a=this.undostack.pop();if(a){this.notifyListeners(a,CommandStack.PRE_UNDO);this.redostack.push(a);a.undo();this.notifyListeners(a,CommandStack.POST_UNDO)}};CommandStack.prototype.redo=function(){var a=this.redostack.pop();if(a){this.notifyListeners(a,CommandStack.PRE_REDO);this.undostack.push(a);a.redo();this.notifyListeners(a,CommandStack.POST_REDO)}};CommandStack.prototype.canRedo=function(){return this.redostack.length>0};CommandStack.prototype.canUndo=function(){return this.undostack.length>0};CommandStack.prototype.addCommandStackEventListener=function(a){this.eventListeners.add(a)};CommandStack.prototype.removeCommandStackEventListener=function(a){this.eventListeners.remove(a)};CommandStack.prototype.notifyListeners=function(e,d){var c=new CommandStackEvent(e,d);var b=this.eventListeners.getSize();for(var a=0;a<b;a++){this.eventListeners.get(a).stackChanged(c)}};
CommandStackEvent=function(b,a){this.command=b;this.details=a};CommandStackEvent.prototype.type="CommandStackEvent";CommandStackEvent.prototype.getCommand=function(){return this.command};CommandStackEvent.prototype.getDetails=function(){return this.details};CommandStackEvent.prototype.isPostChangeEvent=function(){return 0!=(this.getDetails()&CommandStack.POST_MASK)};CommandStackEvent.prototype.isPreChangeEvent=function(){return 0!=(this.getDetails()&CommandStack.PRE_MASK)};
CommandAdd=function(c,b,a,e,d){Command.call(this,"add figure");this.parent=d;this.figure=b;this.x=a;this.y=e;this.workflow=c};CommandAdd.prototype=new Command;CommandAdd.prototype.type="CommandAdd";CommandAdd.prototype.execute=function(){this.redo()};CommandAdd.prototype.redo=function(){if(this.x&&this.y){this.workflow.addFigure(this.figure,this.x,this.y)}else{this.workflow.addFigure(this.figure)}this.workflow.setCurrentSelection(this.figure);if(this.parent!=null){this.parent.addChild(this.figure)}};CommandAdd.prototype.undo=function(){this.workflow.removeFigure(this.figure);this.workflow.setCurrentSelection(null);if(this.parent!=null){this.parent.removeChild(this.figure)}};
CommandAddDynamicPort=function(c,b,a,g,d,f,e){Command.call(this,"add figure");this.parent=d;this.figure=b;this.x=a;this.y=g;this.workflow=c;this.portName=f;this.invisible=e};CommandAddDynamicPort.prototype=new Command;CommandAddDynamicPort.prototype.type="CommandAddDynamicPort";CommandAddDynamicPort.prototype.execute=function(){this.redo()};CommandAddDynamicPort.prototype.redo=function(){this.div=document.getElementById(this.parent.id+"portTable");this.tableRow=this.div.childNodes[0].childNodes[0];var e=document.createElement("td");e.align="center";e.style.whiteSpace="nowrap";var d=this.portName;setPortTD(e,this.parent.name,d);e.style.MozUserSelect="none";e.onselectstart=function(){return false};e.unselectable="on";this.tableRow.appendChild(e);this.portWidth=attributePort.getWidth();this.portAllign=this.outputPortAllign;this.parent.recalculateSize();if(this.parent.getPorts().getSize()>1){var b=document.createElement("td");b.align="center";b.style.whiteSpace="nowrap";b.style.width="80px";b.innerHTML='<div style="width:80px;height:1px;border-top:1px solid #000000"/>';this.tableRow.insertBefore(b,e)}this.parent.recalculateSize(this.parent.name);var c=e.clientWidth/2;if(this.parent.getPorts().getSize()>0){c=this.parent.getWidth()-e.clientWidth/2}var a=this.parent.getHeight();this.workflow.addFigure(this.figure,c,a);this.parent.addPort(this.figure,c,a);this.parent.allignDynamicNode();this.parent.recalculateSize(this.parent.name);if(this.invisible){document.getElementById(this.figure.getId()).style.visibility="hidden"}};CommandAddDynamicPort.prototype.undo=function(){this.workflow.removeFigure(this.figure);this.workflow.setCurrentSelection(null);if(this.parent!=null){this.parent.removeChild(this.figure)}};
CommandDelete=function(a){Command.call(this,"delete figure");this.parent=a.parent;this.figure=a;this.workflow=a.workflow;this.connections=null};CommandDelete.prototype=new Command;CommandDelete.prototype.type="CommandDelete";CommandDelete.prototype.execute=function(){this.redo()};CommandDelete.prototype.undo=function(){this.workflow.addFigure(this.figure);if(this.figure instanceof Connection){this.figure.reconnect()}this.workflow.setCurrentSelection(this.figure);if(this.parent!=null){this.parent.addChild(this.figure)}for(var a=0;a<this.connections.getSize();++a){this.workflow.addFigure(this.connections.get(a));this.connections.get(a).reconnect()}};CommandDelete.prototype.redo=function(){this.workflow.removeFigure(this.figure);this.workflow.setCurrentSelection(null);if(this.figure.getPorts&&this.connections==null){this.connections=new ArrayList();var b=this.figure.getPorts();for(var a=0;a<b.getSize();a++){if(b.get(a).getConnections){this.connections.addAll(b.get(a).getConnections())}}}if(this.connections==null){this.connections=new ArrayList()}for(var a=0;a<this.connections.getSize();++a){if(navigator.userAgent.indexOf("msie") != -1){this.connections.get(a).dispose()}else{this.workflow.removeFigure(this.connections.get(a))}}if(this.parent!=null){this.parent.removeChild(this.figure)}};
CommandMove=function(b,a,c){Command.call(this,"move figure");this.figure=b;this.oldX=a;this.oldY=c;this.oldCompartment=b.getParent()};CommandMove.prototype=new Command;CommandMove.prototype.type="CommandMove";CommandMove.prototype.setPosition=function(a,b){this.newX=a;this.newY=b;this.newCompartment=this.figure.workflow.getBestCompartmentFigure(a,b,this.figure)};CommandMove.prototype.canExecute=function(){return this.newX!=this.oldX||this.newY!=this.oldY};CommandMove.prototype.execute=function(){this.redo()};CommandMove.prototype.undo=function(){this.figure.setPosition(this.oldX,this.oldY);if(this.newCompartment!=null){this.newCompartment.removeChild(this.figure)}if(this.oldCompartment!=null){this.oldCompartment.addChild(this.figure)}this.figure.workflow.moveResizeHandles(this.figure)};CommandMove.prototype.redo=function(){this.figure.setPosition(this.newX,this.newY);if(this.oldCompartment!=null){this.oldCompartment.removeChild(this.figure)}if(this.newCompartment!=null){this.newCompartment.addChild(this.figure)}this.figure.workflow.moveResizeHandles(this.figure)};
CommandConnect=function(b,c,d,e,a){Command.call(this,"create connection");this.workflow=b;this.source=c;this.target=d;this.connection=null;this.isXml=e;this.connectid=a};CommandConnect.prototype=new Command;CommandConnect.prototype.type="CommandConnect";CommandConnect.prototype.setConnection=function(a){this.connection=a};CommandConnect.prototype.execute=function(){if(this.connection==null){this.connection=new Connection()}this.connection.setSource(this.source);this.connection.setTarget(this.target);this.connection.setTargetDecorator(new shape.uml.InheritanceConnectionDecorator());this.workflow.addFigure(this.connection);if(this.isXml){this.connection.setId(this.connectid)}};CommandConnect.prototype.redo=function(){this.workflow.addFigure(this.connection);this.connection.reconnect()};CommandConnect.prototype.undo=function(){this.workflow.removeFigure(this.connection)};
var jg_ihtm,jg_ie,jg_fast,jg_dom,jg_moz,jg_n4=(document.layers&&typeof document.classes!="undefined");function chkDHTM(a,b){a=document.body||null;jg_ie=a&&typeof a.insertAdjacentHTML!="undefined";jg_dom=(a&&!jg_ie&&typeof a.appendChild!="undefined"&&typeof document.createRange!="undefined"&&typeof(b=document.createRange()).setStartBefore!="undefined"&&typeof b.createContextualFragment!="undefined");jg_ihtm=!jg_ie&&!jg_dom&&a&&typeof a.innerHTML!="undefined";jg_fast=jg_ie&&document.all&&!window.opera;jg_moz=jg_dom&&typeof a.style.MozOpacity!="undefined"}function pntDoc(){this.wnd.document.write(jg_fast?this.htmRpc():this.htm);this.htm=""}function pntCnvDom(){var a=this.wnd.document.createRange();a.setStartBefore(this.cnv);a=a.createContextualFragment(jg_fast?this.htmRpc():this.htm);if(this.cnv){this.cnv.appendChild(a)}this.htm=""}function pntCnvIe(){if(this.cnv){this.cnv.insertAdjacentHTML("BeforeEnd",jg_fast?this.htmRpc():this.htm)}this.htm=""}function pntCnvIhtm(){if(this.cnv){this.cnv.innerHTML+=this.htm}this.htm=""}function pntCnv(){this.htm=""}function mkDiv(a,d,b,c){this.htm+='<div style="position:absolute;left:'+a+"px;top:"+d+"px;width:"+b+"px;height:"+c+"px;clip:rect(0,"+b+"px,"+c+"px,0);background-color:"+this.color+(!jg_moz?";overflow:hidden":"")+';"></div>'}function mkDivIe(a,d,b,c){this.htm+="%%"+this.color+";"+a+";"+d+";"+b+";"+c+";"}function mkDivPrt(a,d,b,c){this.htm+='<div style="position:absolute;border-left:'+b+"px solid "+this.color+";left:"+a+"px;top:"+d+"px;width:0px;height:"+c+"px;clip:rect(0,"+b+"px,"+c+"px,0);background-color:"+this.color+(!jg_moz?";overflow:hidden":"")+';"></div>'}function mkLyr(a,d,b,c){this.htm+='<layer left="'+a+'" top="'+d+'" width="'+b+'" height="'+c+'" bgcolor="'+this.color+'"></layer>\n'}var regex=/%%([^;]+);([^;]+);([^;]+);([^;]+);([^;]+);/g;function htmRpc(){return this.htm.replace(regex,'<div style="overflow:hidden;position:absolute;background-color:$1;left:$2;top:$3;width:$4;height:$5"></div>\n')}function htmPrtRpc(){return this.htm.replace(regex,'<div style="overflow:hidden;position:absolute;background-color:$1;left:$2;top:$3;width:$4;height:$5;border-left:$4px solid $1"></div>\n')}function mkLin(e,m,b,k){if(e>b){var j=b;var g=k;b=e;k=m;e=j;m=g}var q=b-e,o=Math.abs(k-m),l=e,i=m,n=(m>k)?-1:1;if(q>=o){var a=o<<1,h=a-(q<<1),d=a-q,f=l;while((q--)>0){++l;if(d>0){this.mkDiv(f,i,l-f,1);i+=n;d+=h;f=l}else{d+=a}}this.mkDiv(f,i,b-f+1,1)}else{var a=q<<1,h=a-(o<<1),d=a-o,c=i;if(k<=m){while((o--)>0){if(d>0){this.mkDiv(l++,i,1,c-i+1);i+=n;d+=h;c=i}else{i+=n;d+=a}}this.mkDiv(b,k,1,c-k+1)}else{while((o--)>0){i+=n;if(d>0){this.mkDiv(l++,c,1,i-c);d+=h;c=i}else{d+=a}}this.mkDiv(b,c,1,k-c+1)}}}function mkLin2D(r,b,q,a){if(r>q){var f=q;var n=a;q=r;a=b;r=f;b=n}var j=q-r,i=Math.abs(a-b),h=r,g=b,m=(b>a)?-1:1;var k=this.stroke;if(j>=i){if(j>0&&k-3>0){var t=(k*j*Math.sqrt(1+i*i/(j*j))-j-(k>>1)*i)/j;t=(!(k-4)?Math.ceil(t):Math.round(t))+1}else{var t=k}var u=Math.ceil(k/2);var o=i<<1,e=o-(j<<1),l=o-j,d=h;while((j--)>0){++h;if(l>0){this.mkDiv(d,g,h-d+u,t);g+=m;l+=e;d=h}else{l+=o}}this.mkDiv(d,g,q-d+u+1,t)}else{if(k-3>0){var t=(k*i*Math.sqrt(1+j*j/(i*i))-(k>>1)*j-i)/i;t=(!(k-4)?Math.ceil(t):Math.round(t))+1}else{var t=k}var u=Math.round(k/2);var o=j<<1,e=o-(i<<1),l=o-i,c=g;if(a<=b){++u;while((i--)>0){if(l>0){this.mkDiv(h++,g,t,c-g+u);g+=m;l+=e;c=g}else{g+=m;l+=o}}this.mkDiv(q,a,t,c-a+u)}else{while((i--)>0){g+=m;if(l>0){this.mkDiv(h++,c,t,g-c+u);l+=e;c=g}else{l+=o}}this.mkDiv(q,c,t,a-c+u+1)}}}function mkLinDott(d,k,b,i){if(d>b){var h=b;var e=i;b=d;i=k;d=h;k=e}var o=b-d,n=Math.abs(i-k),j=d,g=k,m=(k>i)?-1:1,l=true;if(o>=n){var a=n<<1,f=a-(o<<1),c=a-o;while((o--)>0){if(l){this.mkDiv(j,g,1,1)}l=!l;if(c>0){g+=m;c+=f}else{c+=a}++j}if(l){this.mkDiv(j,g,1,1)}}else{var a=o<<1,f=a-(n<<1),c=a-n;while((n--)>0){if(l){this.mkDiv(j,g,1,1)}l=!l;g+=m;if(c>0){++j;c+=f}else{c+=a}}if(l){this.mkDiv(j,g,1,1)}}}function mkOv(g,p,r,q){var v=r>>1,u=q>>1,o=r&1,f=(q&1)+1,e=g+v,d=p+u,m=0,l=u,j=0,i=u,z=(v*v)<<1,k=(u*u)<<1,s=(z>>1)*(1-(u<<1))+k,c=(k>>1)-z*((u<<1)-1),n,t;while(l>0){if(s<0){s+=k*((m<<1)+3);c+=(k<<1)*(++m)}else{if(c<0){s+=k*((m<<1)+3)-(z<<1)*(l-1);c+=(k<<1)*(++m)-z*(((l--)<<1)-3);n=m-j;t=i-l;if(n&2&&t&2){this.mkOvQds(e,d,-m+2,j+o,-i,i-1+f,1,1);this.mkOvQds(e,d,-m+1,m-1+o,-l-1,l+f,1,1)}else{this.mkOvQds(e,d,-m+1,j+o,-i,i-t+f,n,t)}j=m;i=l}else{c-=z*((l<<1)-3);s-=(z<<1)*(--l)}}}this.mkDiv(e-v,d-i,v-j+1,(i<<1)+f);this.mkDiv(e+j+o,d-i,v-j+1,(i<<1)+f)}function mkOv2D(e,f,c,d){var G=this.stroke;c+=G-1;d+=G-1;var R=c>>1,P=d>>1,O=c&1,z=(d&1)+1,o=e+R,n=f+P,E=0,B=P,k=(R*R)<<1,U=(P*P)<<1,g=(k>>1)*(1-(P<<1))+U,N=(U>>1)-k*((P<<1)-1);if(G-4<0&&(!(G-2)||c-51>0&&d-51>0)){var r=0,q=P,F,L,D,v,u,I,t;while(B>0){if(g<0){g+=U*((E<<1)+3);N+=(U<<1)*(++E)}else{if(N<0){g+=U*((E<<1)+3)-(k<<1)*(B-1);N+=(U<<1)*(++E)-k*(((B--)<<1)-3);F=E-r;L=q-B;if(F-1){t=F+1+(G&1);L=G}else{if(L-1){t=G;L+=1+(G&1)}else{t=L=G}}this.mkOvQds(o,n,-E+1,r-t+F+O,-q,-L+q+z,t,L);r=E;q=B}else{N-=k*((B<<1)-3);g-=(k<<1)*(--B)}}}this.mkDiv(o-R,n-q,G,(q<<1)+z);this.mkDiv(o+R+O-G+1,n-q,G,(q<<1)+z)}else{var S=(c-((G-1)<<1))>>1,Q=(d-((G-1)<<1))>>1,C=0,A=Q,m=(S*S)<<1,T=(Q*Q)<<1,j=(m>>1)*(1-(Q<<1))+T,M=(T>>1)-m*((Q<<1)-1),D=new Array(),u=new Array(),H=new Array();D[0]=0;u[0]=P;H[0]=Q-1;while(B>0){if(g<0){g+=U*((E<<1)+3);N+=(U<<1)*(++E);D[D.length]=E;u[u.length]=B}else{if(N<0){g+=U*((E<<1)+3)-(k<<1)*(B-1);N+=(U<<1)*(++E)-k*(((B--)<<1)-3);D[D.length]=E;u[u.length]=B}else{N-=k*((B<<1)-3);g-=(k<<1)*(--B)}}if(A>0){if(j<0){j+=T*((C<<1)+3);M+=(T<<1)*(++C);H[H.length]=A-1}else{if(M<0){j+=T*((C<<1)+3)-(m<<1)*(A-1);M+=(T<<1)*(++C)-m*(((A--)<<1)-3);H[H.length]=A-1}else{M-=m*((A<<1)-3);j-=(m<<1)*(--A);H[H.length-1]--}}}}var r=0,q=P,p=H[0],J=D.length,F,L;for(var K=0;K<J;K++){if(typeof H[K]!="undefined"){if(H[K]<p||u[K]<q){E=D[K];this.mkOvQds(o,n,-E+1,r+O,-q,p+z,E-r,q-p);r=E;q=u[K];p=H[K]}}else{E=D[K];this.mkDiv(o-E+1,n-q,1,(q<<1)+z);this.mkDiv(o+r+O,n-q,1,(q<<1)+z);r=E;q=u[K]}}this.mkDiv(o-R,n-q,1,(q<<1)+z);this.mkDiv(o+r+O,n-q,1,(q<<1)+z)}}function mkOvDott(g,l,q,o){var t=q>>1,s=o>>1,k=q&1,f=o&1,e=g+t,d=l+s,j=0,i=s,p=(t*t)<<1,m=p<<1,h=(s*s)<<1,r=(p>>1)*(1-(s<<1))+h,c=(h>>1)-p*((s<<1)-1),n=true;while(i>0){if(r<0){r+=h*((j<<1)+3);c+=(h<<1)*(++j)}else{if(c<0){r+=h*((j<<1)+3)-m*(i-1);c+=(h<<1)*(++j)-p*(((i--)<<1)-3)}else{c-=p*((i<<1)-3);r-=m*(--i)}}if(n){this.mkOvQds(e,d,-j,j+k,-i,i+f,1,1)}n=!n}}function mkRect(a,e,b,d){var c=this.stroke;this.mkDiv(a,e,b,c);this.mkDiv(a+b,e,c,d);this.mkDiv(a,e+d,b+c,c);this.mkDiv(a,e+c,c,d-c)}function mkRectDott(a,d,b,c){this.drawLine(a,d,a+b,d);this.drawLine(a+b,d,a+b,d+c);this.drawLine(a,d+c,a+b,d+c);this.drawLine(a,d,a,d+c)}function jsgFont(){this.PLAIN="font-weight:normal;";this.BOLD="font-weight:bold;";this.ITALIC="font-style:italic;";this.ITALIC_BOLD=this.ITALIC+this.BOLD;this.BOLD_ITALIC=this.ITALIC_BOLD}var Font=new jsgFont();function jsgStroke(){this.DOTTED=-1}var Stroke=new jsgStroke();function jsGraphics(b,a){this.setColor=new Function("arg","this.color = arg.toLowerCase();");this.setStroke=function(c){this.stroke=c;if(!(c+1)){this.drawLine=mkLinDott;this.mkOv=mkOvDott;this.drawRect=mkRectDott}else{if(c-1>0){this.drawLine=mkLin2D;this.mkOv=mkOv2D;this.drawRect=mkRect}else{this.drawLine=mkLin;this.mkOv=mkOv;this.drawRect=mkRect}}};this.setPrintable=function(c){this.printable=c;if(jg_fast){this.mkDiv=mkDivIe;this.htmRpc=c?htmPrtRpc:htmRpc}else{this.mkDiv=jg_n4?mkLyr:c?mkDivPrt:mkDiv}};this.setFont=function(d,e,c){this.ftFam=d;this.ftSz=e;this.ftSty=c||Font.PLAIN};this.drawPolyline=this.drawPolyLine=function(c,f,e){for(var d=0;d<c.length-1;d++){this.drawLine(c[d],f[d],c[d+1],f[d+1])}};this.fillRect=function(c,f,d,e){this.mkDiv(c,f,d,e)};this.drawPolygon=function(c,d){this.drawPolyline(c,d);this.drawLine(c[c.length-1],d[c.length-1],c[0],d[0])};this.drawEllipse=this.drawOval=function(c,f,d,e){this.mkOv(c,f,d,e)};this.fillEllipse=this.fillOval=function(g,r,n,v){var B=(n-=1)>>1,A=(v-=1)>>1,o=(n&1)+1,f=(v&1)+1,e=g+B,d=r+A,m=0,l=A,j=0,i=A,t=(B*B)<<1,s=t<<1,k=(A*A)<<1,u=(t>>1)*(1-(A<<1))+k,c=(k>>1)-t*((A<<1)-1),q,p,z;if(n+1){while(l>0){if(u<0){u+=k*((m<<1)+3);c+=(k<<1)*(++m)}else{if(c<0){u+=k*((m<<1)+3)-s*(l-1);q=e-m;p=(m<<1)+o;c+=(k<<1)*(++m)-t*(((l--)<<1)-3);z=i-l;this.mkDiv(q,d-i,p,z);this.mkDiv(q,d+l+f,p,z);j=m;i=l}else{c-=t*((l<<1)-3);u-=s*(--l)}}}}this.mkDiv(e-B,d-i,n+1,(i<<1)+f)};this.fillPolygon=function(j,h){var k;var q;var s,o;var d,r;var c,p;var m,l;var e;var f=j.length;if(!f){return}s=h[0];o=h[0];for(k=1;k<f;k++){if(h[k]<s){s=h[k]}if(h[k]>o){o=h[k]}}for(q=s;q<=o;q++){var g=new Array();e=0;for(k=0;k<f;k++){if(!k){m=f-1;l=0}else{m=k-1;l=k}r=h[m];p=h[l];if(r<p){d=j[m];c=j[l]}else{if(r>p){p=h[m];r=h[l];c=j[m];d=j[l]}else{continue}}if((q>=r)&&(q<p)){g[e++]=Math.round((q-r)*(c-d)/(p-r)+d)}else{if((q==o)&&(q>r)&&(q<=p)){g[e++]=Math.round((q-r)*(c-d)/(p-r)+d)}}}g.sort(integer_compare);for(k=0;k<e;k+=2){this.mkDiv(g[k],q,g[k+1]-g[k]+1,1)}}};this.drawString=function(d,c,e){this.htm+='<div style="position:absolute;white-space:nowrap;left:'+c+"px;top:"+e+"px;font-family:"+this.ftFam+";font-size:"+this.ftSz+";color:"+this.color+";"+this.ftSty+'">'+d+"</div>"};this.drawStringRect=function(d,c,g,e,f){this.htm+='<div style="position:absolute;overflow:hidden;left:'+c+"px;top:"+g+"px;width:"+e+"px;text-align:"+f+";font-family:"+this.ftFam+";font-size:"+this.ftSz+";color:"+this.color+";"+this.ftSty+'">'+d+"</div>"};this.drawImage=function(g,c,i,e,f,d){this.htm+='<div style="position:absolute;left:'+c+"px;top:"+i+"px;width:"+e+"px;height:"+f+'px;"><img src="'+g+'" width="'+e+'" height="'+f+'"'+(d?(" "+d):"")+"></div>"};this.clear=function(){this.htm="";if(this.cnv){this.cnv.innerHTML=this.defhtm}};this.mkOvQds=function(d,k,j,g,f,c,e,i){this.mkDiv(g+d,f+k,e,i);this.mkDiv(g+d,c+k,e,i);this.mkDiv(j+d,c+k,e,i);this.mkDiv(j+d,f+k,e,i)};this.setStroke(1);this.setFont("verdana,geneva,helvetica,sans-serif",String.fromCharCode(49,50,112,120),Font.PLAIN);this.color="#000000";this.htm="";this.wnd=a||window;if(!(jg_ie||jg_dom||jg_ihtm)){chkDHTM()}if(typeof b!="string"||!b){this.paint=pntDoc}else{this.cnv=document.all?(this.wnd.document.all[b]||null):document.getElementById?(this.wnd.document.getElementById(b)||null):null;this.defhtm=(this.cnv&&this.cnv.innerHTML)?this.cnv.innerHTML:"";this.paint=jg_dom?pntCnvDom:jg_ie?pntCnvIe:jg_ihtm?pntCnvIhtm:pntCnv}this.setPrintable(false)}function integer_compare(a,b){return(a<b)?-1:((a>b)*1)};