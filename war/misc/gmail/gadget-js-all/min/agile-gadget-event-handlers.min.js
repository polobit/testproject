$(".action-add-note").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");$(".gadget-notes-tab-list",a).hide();agile_build_form_template($(this),"gadget-note",".gadget-notes-tab-list",function(){$(".gadget-notes-tab a",a).tab("show");$(".gadget-notes-tab-list",a).show();agile_gadget_adjust_height()})});$(".action-add-task").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");$(".gadget-tasks-tab-list",a).hide();agile_build_form_template($(this),"gadget-task",".gadget-tasks-tab-list",function(){agile_load_datepicker($(".task-calender",a),function(){$(".gadget-tasks-tab a",a).tab("show");$(".gadget-tasks-tab-list",a).show();agile_gadget_adjust_height()})})});$(".action-add-deal").die().live("click",function(c){c.preventDefault();var b=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");var a=$(this);$(".gadget-deals-tab-list",b).hide();agile_get_gadget_template("gadget-deal-template",function(d){_agile.get_milestones({success:function(f){Milestone_Array=f.milestones.split(",");for(var h in Milestone_Array){Milestone_Array.splice(h,1,Milestone_Array[h].trim())}var e=Contacts_Json[b.closest(".show-form").data("content")];e.milestones=Milestone_Array;var g=getTemplate("gadget-deal",e,"no");a.closest(".gadget-contact-details-tab").find(".gadget-deals-tab-list").html($(g));$(".gadget-deals-tab a",b).tab("show");$(".gadget-deals-tab-list",b).show();agile_load_datepicker($(".deal-calender",b),function(){$(".gadget-deals-tab a",b).tab("show");$(".gadget-deals-tab-list",b).show();agile_gadget_adjust_height()});agile_gadget_adjust_height()},error:function(e){}})})});$(".action-add-campaign").die().live("click",function(c){c.preventDefault();var b=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");var a=$(this);$(".gadget-campaigns-tab-list",b).hide();agile_get_gadget_template("gadget-campaign-template",function(d){_agile.get_workflows({success:function(e){var f=getTemplate("gadget-campaign",e,"no");a.closest(".gadget-contact-details-tab").find(".gadget-campaigns-tab-list").html($(f));$(".gadget-campaigns-tab a",b).tab("show");$(".gadget-campaigns-tab-list",b).show();agile_gadget_adjust_height()},error:function(e){}})})});$(".gadget-contact-validate").die().live("click",function(f){f.preventDefault();var d=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");var b=$(this);var a=[];var c={};a=agile_serialize_form(d.find(".gadget-contact-form"));$.each(a,function(e,g){c[g.name]=g.value});$(".contact-add-waiting",d).show();_agile.create_contact(c,{success:function(e){$(".contact-add-waiting",d).hide(1);agile_create_contact_ui(d,b,c.email,e)},error:function(e){$(".contact-add-waiting",d).hide(1);$(".contact-add-status",d).text(e.error).show().delay(5000).hide(1)}})});$(".gadget-note-validate").die().live("click",function(d){d.preventDefault();var c=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");var a=[];var b={};var f={};a=agile_serialize_form($(c).find(".gadget-note-form"));$.each(a,function(g,e){if(e.name=="email"){f[e.name]=e.value}else{b[e.name]=e.value}});$(".note-add-waiting",c).show();_agile.add_note(b,{success:function(e){$(".note-add-waiting",c).hide(1);$(".gadget-notes-tab",c).trigger("click")},error:function(e){}},f.email)});$(".gadget-task-validate").die().live("click",function(d){d.preventDefault();var c=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");var a=[];var b={};var f={};a=agile_serialize_form($(c).find(".gadget-task-form"));$.each(a,function(g,e){if(e.name=="email"){f[e.name]=e.value}else{b[e.name]=e.value}});b.due=new Date(b.due).getTime()/1000;$(".task-add-waiting",c).show();_agile.add_task(b,{success:function(e){$(".task-add-waiting",c).hide(1);$(".gadget-tasks-tab",c).trigger("click")},error:function(e){}},f.email)});$(".gadget-deal-validate").die().live("click",function(d){d.preventDefault();var c=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");var a=[];var b={};var f={};a=agile_serialize_form($(c).find(".gadget-deal-form"));$.each(a,function(g,e){if(e.name=="email"){f[e.name]=e.value}else{b[e.name]=e.value}});b.close_date=new Date(b.close_date).getTime()/1000;$(".deal-add-waiting",c).show();_agile.add_deal(b,{success:function(e){$(".deal-add-waiting",c).hide(1);$(".gadget-deals-tab",c).trigger("click")},error:function(e){}},f.email)});$(".gadget-campaign-validate").die().live("click",function(d){d.preventDefault();var c=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");var a=[];var b={};var f=$(c).data("content");a=agile_serialize_form($(c).find(".gadget-campaign-form"));$.each(a,function(g,e){if(e.name=="email"){f[e.name]=e.value}else{b[e.name]=e.value}});$(".campaign-add-waiting",c).show();_agile.add_campaign(b,{success:function(e){$(".campaign-add-waiting",c).hide(1);$(".gadget-campaigns-tab",c).trigger("click")},error:function(e){}},f)});$(".cancel").die().live("click",function(c){c.preventDefault();var a=$(this).data("tab-identity");$(".gadget-"+a+"-tab").trigger("click");var b=$(this).closest("div.gadget-contact-details-tab");$(".show-add-contact-form",b).toggle();agile_gadget_adjust_height()});$(".gadget-search-contact").die().live("click",function(c){c.preventDefault();var b=$(this).closest("div.gadget-contact-details-tab").find(".show-form");var a=$(this);var d="";if(!a.hasClass("search-mail-button")){d=$(b).data("content");agile_gadget_adjust_width(b,$(".contact-search-waiting",b),true);$(".contact-search-waiting",b).css("visibility","visible")}else{d=$(".agile-mail-dropdown").data("email");if(Contacts_Json[d].mail_exist==true){$("#agile_content .show-form").each(function(){if($(this).data("content")==d){$(this).find(".gadget-show-contact").trigger("click");return false}});console.log("Email is already in list");return}$(".contact-search-waiting",b).show()}_agile.get_contact(d,{success:function(e){$(".contact-search-waiting",b).hide();if(a.hasClass("search-mail-button")){agile_add_mail_to_list(e,d,b)}else{agile_create_contact_ui(b,a,d,e)}},error:function(e){e.id=null;$(".contact-search-waiting",b).hide();if(a.hasClass("search-mail-button")){$(".contact-search-status",b).fadeIn().delay(4000).fadeOut();agile_add_mail_to_list(e,d,b)}else{agile_create_contact_ui(b,a,d,e)}}})});$(".gadget-add-contact").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");agile_build_form_template($(this),"gadget-add-contact",".show-add-contact-form",function(){$(".show-add-contact-form",a).toggle();agile_gadget_adjust_height()})});$(".gadget-show-contact").die().live("click",function(c){c.preventDefault();var b=$(this).closest("div.gadget-contact-details-tab").find(".show-form");var a=$(this);agile_build_form_template(a,"gadget-contact-summary",".show-contact-summary",function(){var d=Contacts_Json[$(b).data("content")];agile_build_tag_ui($("#added_tags_ul",b),d);$(".display-toggle",b).addClass("hide-contact-summery").removeClass("gadget-show-contact");$(".display-toggle i",b).addClass("icon-collapse-alt").removeClass("icon-expand-alt");$(".display-toggle span",b).text("Hide Details");$(".display-toggle",b).next().hide();agile_gadget_adjust_height();$(".show-contact-summary",b).toggle();agile_gadget_adjust_height();agile_build_form_template(a,"gadget-tabs",".option-tabs",function(){$(".gadget_tabs",b).tab();$(".option-tabs",b).toggle();agile_gadget_adjust_height();$(".gadget-notes-tab",b).trigger("click");$(".dropdown-toggle").dropdown()})})});$(".hide-contact-summery").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");$(".display-toggle",a).removeClass("hide-contact-summery").addClass("gadget-show-contact");$(".display-toggle i",a).removeClass("icon-collapse-alt").addClass("icon-expand-alt");$(".display-toggle span",a).text("Show");$(".display-toggle",a).next().show();agile_gadget_adjust_height();$(".show-contact-summary",a).toggle();agile_gadget_adjust_height();$(".option-tabs",a).toggle();agile_gadget_adjust_height()});function agile_gadget_adjust_width(d,a,f){if(f){var c=$(".agile-no-contact",d).width();var e=parseInt(a.width(),10)+parseInt(a.css("margin-left"),10)+10;var b=(((c-e)/c)*100)+"%";$(".contact-list-width",d).css("max-width",b)}else{$(".contact-list-width",d).css("max-width","95%")}}function agile_create_contact_ui(c,a,d,b){if(Is_Localhost){b.ac_path=Lib_Path}else{b.ac_path="https://"+agile_id.namespace+".agilecrm.com/"}$.extend(Contacts_Json[d],b);agile_build_form_template(a,"gadget-contact-list",".contact-list",function(){if(b.id==null){agile_gadget_adjust_width(c,$(".contact-search-status",c),true);$(".contact-search-status",c).show().delay(4000).hide(1,function(){agile_gadget_adjust_width(c,$(".contact-search-status",c),false)})}else{$(".gadget-show-contact",c).trigger("click")}})}function agile_add_mail_to_list(c,e,b){if(Is_Localhost){c.ac_path=Lib_Path}else{c.ac_path="https://"+agile_id.namespace+".agilecrm.com/"}var d={};d[e]=Contacts_Json[e];$.extend(Contacts_Json[e],c);Contacts_Json[e].mail_exist=true;var a=getTemplate("gadget",d,"no");$("#agile_content").prepend($(a));$("#agile_content").children().eq(0).find(".contact-list").hide();agile_get_gadget_template("gadget-contact-list-template",function(h){var f=Contacts_Json[e];var g=getTemplate("gadget-contact-list",f,"no");$("#agile_content").children().eq(0).find(".contact-list").html($(g));$("#agile_content").children().eq(0).find(".contact-list").show();if(!Is_Localhost){gadgets.window.adjustHeight()}if(f.id!=null){$("#agile_content").children().eq(0).find(".gadget-show-contact").trigger("click")}else{$("#agile_content").children().eq(0).find(".contact-search-status").hide();$("#agile_content").children().eq(0).find(".contact-list-width").css("max-width","95%")}})}$(".add-score").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.score-scope");var c=$('input[name="email"]',a).val();var d=parseInt($.trim($(".score-value",a).text()),10);$(".score-value",a).text(d+1);_agile.add_score(1,{success:function(e){$.extend(Contacts_Json[c],e)},error:function(e){}},c)});$(".subtract-score").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.score-scope");var c=$('input[name="email"]',a).val();var d=parseInt($.trim($(".score-value",a).text()),10);if(d>0){$(".score-value",a).text(d-1);_agile.add_score(-1,{success:function(e){$.extend(Contacts_Json[c],e)},error:function(e){}},c)}});$(".gadget-notes-tab").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.gadget-contact-details-tab").find(".show-form");$(".gadget-notes-tab-list",a).html("");var c=$(a).data("content");$(".tab-waiting",a).show();_agile.get_notes({success:function(d){head.js(Lib_Path+"lib/date-formatter.js",Lib_Path+"lib/jquery.timeago.js",function(){agile_get_gadget_template("gadget-notes-list-template",function(e){$(".tab-waiting",a).hide();$(".gadget-notes-tab-list",a).html(getTemplate("gadget-notes-list",d,"no"));agile_gadget_adjust_height()});$("time",a).timeago()})},error:function(d){}},c)});$(".gadget-tasks-tab").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.gadget-contact-details-tab").find(".show-form");$(".gadget-tasks-tab-list",a).html("");var c=$(a).data("content");$(".tab-waiting",a).show();_agile.get_tasks({success:function(d){agile_get_gadget_template("gadget-tasks-list-template",function(e){$(".tab-waiting",a).hide();$(".gadget-tasks-tab-list",a).html(getTemplate("gadget-tasks-list",d,"no"));$(".gadget-tasks-tab-list",a).show();agile_gadget_adjust_height()});$("time",a).timeago()},error:function(d){}},c)});$(".gadget-deals-tab").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.gadget-contact-details-tab").find(".show-form");$(".gadget-deals-tab-list",a).html("");var c=$(a).data("content");$(".tab-waiting",a).show();_agile.get_deals({success:function(d){agile_get_gadget_template("gadget-deals-list-template",function(e){$(".tab-waiting",a).hide();$(".gadget-deals-tab-list",a).html(getTemplate("gadget-deals-list",d,"no"));$(".gadget-deals-tab-list",a).show();agile_gadget_adjust_height()});$("time",a).timeago()},error:function(d){}},c)});$(".gadget-campaigns-tab").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.gadget-contact-details-tab").find(".show-form");$(".gadget-campaigns-tab-list",a).html("");var c=$(a).data("content");$(".tab-waiting",a).show();_agile.get_campaign_logs({success:function(d){agile_get_gadget_template("gadget-campaigns-list-template",function(e){$(".tab-waiting",a).hide();var f={};if(Is_Localhost){f.ac_path=Lib_Path}else{f.ac_path="https://"+agile_id.namespace+".agilecrm.com/"}f.lib_path=Lib_Path;f.response=d;$(".gadget-campaigns-tab-list",a).html(getTemplate("gadget-campaigns-list",f,"no"));$(".gadget-campaigns-tab-list",a).show();agile_gadget_adjust_height()});$("time",a).timeago()},error:function(d){}},c)});$("#contact_add_tags").die().live("click",function(d){d.preventDefault();var c=$(this).closest("div.add-tag");var b=[];var a={};var f={};b=agile_serialize_form($("#add_tags_form",c));$.each(b,function(e,g){if(g.name=="email"){f[g.name]=g.value}else{a[g.name]=g.value}});if(a.tags.length!=0){$("#add_tags_form",c).hide();$(".tag-waiting",c).show("fast");_agile.add_tag(a.tags,{success:function(e){$(".tag-waiting",c).hide();$.extend(Contacts_Json[f.email],e);agile_build_tag_ui($("#added_tags_ul",c),e);$(".toggle-tag",c).show("medium");agile_gadget_adjust_height()},error:function(e){}},f.email)}else{$("#add_tags_form",c).hide();$(".toggle-tag",c).show("medium")}});$(".remove-tag").die().live("click",function(c){c.preventDefault();var a=$(this).closest("div.add-tag");var d=$(a).find('#add_tags_form input[name="email"]').val();var b=$(this).prev().text();$(".toggle-tag",a).hide("fast",function(){$(".tag-waiting",a).show()});_agile.remove_tag(b,{success:function(e){$(".tag-waiting",a).hide();$.extend(Contacts_Json[d],e);agile_build_tag_ui($("#added_tags_ul",a),e);$(".toggle-tag",a).show("medium");agile_gadget_adjust_height()},error:function(e){}},d)});$(".toggle-tag").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.add-tag");$(".toggle-tag",a).hide("fast",function(){$("#add_tags_form",a).show();$('form input[name="tags"]',a).val("").focus();agile_gadget_adjust_height()})});$("#tags").die().live("keypress",function(b){var b=(b)?b:((Event)?Event:null);var a=(b.target)?b.target:((b.srcElement)?b.srcElement:null);if(b.keyCode===13){b.preventDefault();$(this).next().trigger("click")}});