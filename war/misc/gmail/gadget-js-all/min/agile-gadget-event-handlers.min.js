function agile_init_handlers(){$(".gadget-contact-validate").die().live("click",function(f){f.preventDefault();var b=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");var c=$(this);var a=[];var d={};a=agile_serialize_form(b.find(".gadget-contact-form"));$.each(a,function(e,g){d[g.name]=g.value});$(".contact-add-waiting",b).show();_agile.create_contact(d,function(e){$(".contact-add-waiting",b).hide(1);agile_create_contact_ui(b,c,d.email,e)})});$(".gadget-note-validate").die().live("click",function(f){f.preventDefault();var c=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");var b=[];var d={};var a={};b=agile_serialize_form($(c).find(".gadget-note-form"));$.each(b,function(e,g){if(g.name=="email"){a[g.name]=g.value}else{d[g.name]=g.value}});$(".note-add-waiting",c).show();_agile.add_note(d,function(e){$(".note-add-waiting",c).hide(1);$(".gadget-notes-tab",c).trigger("click")},a.email)});$(".gadget-task-validate").die().live("click",function(f){f.preventDefault();var c=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");var b=[];var d={};var a={};b=agile_serialize_form($(c).find(".gadget-task-form"));$.each(b,function(e,g){if(g.name=="email"){a[g.name]=g.value}else{d[g.name]=g.value}});d.due=new Date(d.due).getTime()/1000;$(".task-add-waiting",c).show();_agile.add_task(d,function(e){$(".task-add-waiting",c).hide(1);$(".gadget-tasks-tab",c).trigger("click")},a.email)});$(".gadget-deal-validate").die().live("click",function(f){f.preventDefault();var c=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");var b=[];var d={};var a={};b=agile_serialize_form($(c).find(".gadget-deal-form"));$.each(b,function(e,g){if(g.name=="email"){a[g.name]=g.value}else{d[g.name]=g.value}});d.close_date=new Date(d.close_date).getTime()/1000;$(".deal-add-waiting",c).show();_agile.add_deal(d,function(e){$(".deal",c).hide(1);$(".gadget-deals-tab",c).trigger("click")},a.email)});$(".gadget-campaign-validate").die().live("click",function(f){f.preventDefault();var c=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");var b=[];var d={};var a=$(c).data("content");b=agile_serialize_form($(c).find(".gadget-campaign-form"));$.each(b,function(e,g){if(g.name=="email"){a[g.name]=g.value}else{d[g.name]=g.value}});$(".campaign-add-waiting",c).show();_agile.add_campaign(d,function(e){$(".campaign-add-waiting",c).hide(1);$(".gadget-campaigns-tab",c).trigger("click")},a)});$(".add-score").die().live("click",function(c){c.preventDefault();var b=$(this).closest("div.score-scope");var a=$('input[name="email"]',b).val();var d=parseInt($.trim($(".score-value",b).text()),10);$(".score-value",b).text(d+1);_agile.add_score(1,function(e){$.extend(Contacts_Json[a],e)},a)});$(".subtract-score").die().live("click",function(c){c.preventDefault();var b=$(this).closest("div.score-scope");var a=$('input[name="email"]',b).val();var d=parseInt($.trim($(".score-value",b).text()),10);if(d>0){$(".score-value",b).text(d-1);_agile.add_score(-1,function(e){$.extend(Contacts_Json[a],e)},a)}});$("#contact_add_tags").die().live("click",function(f){f.preventDefault();var d=$(this).closest("div.add-tag");var c=[];var b={};var a={};c=agile_serialize_form($("#add_tags_form",d));$.each(c,function(e,g){if(g.name=="email"){a[g.name]=g.value}else{b[g.name]=g.value}});if(b.tags.length!=0){$("#add_tags_form",d).hide();$(".tag-waiting",d).show("fast");_agile.add_tag(b.tags,function(e){$(".tag-waiting",d).hide();$.extend(Contacts_Json[a.email],e);agile_build_tag_ui($("#added_tags_ul",d),e);$(".toggle-tag",d).show("medium");agile_gadget_adjust_height()},a.email)}else{$("#add_tags_form",d).hide();$(".toggle-tag",d).show("medium")}});$(".remove-tag").die().live("click",function(d){d.preventDefault();var c=$(this).closest("div.add-tag");var b=$(c).find('#add_tags_form input[name="email"]').val();var a=$(this).prev().text();$(".toggle-tag",c).hide("fast",function(){$(".tag-waiting",c).show()});_agile.remove_tag(a,function(e){$(".tag-waiting",c).hide();$.extend(Contacts_Json[b],e);agile_build_tag_ui($("#added_tags_ul",c),e);$(".toggle-tag",c).show("medium");agile_gadget_adjust_height()},b)});$(".toggle-tag").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.add-tag");$(".toggle-tag",a).hide("fast",function(){$("#add_tags_form",a).show();$('form input[name="tags"]',a).val("").focus();agile_gadget_adjust_height()})});$("#tags").die().live("keypress",function(a){var a=(a)?a:((event)?event:null);var b=(a.target)?a.target:((a.srcElement)?a.srcElement:null);if(a.keyCode===13){a.preventDefault();$(this).next().trigger("click")}});$(".action-add-note").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");$(".gadget-notes-tab-list",a).hide();agile_build_form_template($(this),"gadget-note",".gadget-notes-tab-list",function(){$(".gadget-notes-tab a",a).tab("show");$(".gadget-notes-tab-list",a).show();agile_gadget_adjust_height()})});$(".action-add-task").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");$(".gadget-tasks-tab-list",a).hide();agile_build_form_template($(this),"gadget-task",".gadget-tasks-tab-list",function(){agile_load_datepicker($(".task-calender",a),function(){$(".gadget-tasks-tab a",a).tab("show");$(".gadget-tasks-tab-list",a).show();agile_gadget_adjust_height()})})});$(".action-add-deal").die().live("click",function(c){c.preventDefault();var a=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");var b=$(this);$(".gadget-deals-tab-list",a).hide();agile_get_gadget_template("gadget-deal-template",function(d){_agile.get_milestones(function(f){console.log(f);Milestone_Array=f.milestones.split(",");for(var e in Milestone_Array){Milestone_Array.splice(e,1,Milestone_Array[e].trim())}var h=Contacts_Json[a.closest(".show-form").data("content")];h.milestones=Milestone_Array;var g=getTemplate("gadget-deal",h,"no");b.closest(".gadget-contact-details-tab").find(".gadget-deals-tab-list").html($(g));$(".gadget-deals-tab a",a).tab("show");$(".gadget-deals-tab-list",a).show();agile_load_datepicker($(".deal-calender",a),function(){$(".gadget-deals-tab a",a).tab("show");$(".gadget-deals-tab-list",a).show();agile_gadget_adjust_height()});agile_gadget_adjust_height()})})});$(".action-add-campaign").die().live("click",function(c){c.preventDefault();var a=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");var b=$(this);$(".gadget-campaigns-tab-list",a).hide();agile_get_gadget_template("gadget-campaign-template",function(d){_agile.get_workflows(function(e){console.log(e);var f=getTemplate("gadget-campaign",e,"no");b.closest(".gadget-contact-details-tab").find(".gadget-campaigns-tab-list").html($(f));$(".gadget-campaigns-tab a",a).tab("show");$(".gadget-campaigns-tab-list",a).show();agile_gadget_adjust_height()})})});$(".gadget-search-contact").die().live("click",function(d){d.preventDefault();var b=$(this).closest("div.gadget-contact-details-tab").find(".show-form");var c=$(this);var a=$(b).data("content");agile_gadget_adjust_width(b,$(".contact-search-waiting",b),true);$(".contact-search-waiting",b).show();agile_getContact(a,function(e){agile_create_contact_ui(b,c,a,e)})});$(".gadget-show-contact").die().live("click",function(c){c.preventDefault();var a=$(this).closest("div.gadget-contact-details-tab").find(".show-form");var b=$(this);agile_build_form_template(b,"gadget-contact-summary",".show-contact-summary",function(){var d=Contacts_Json[$(a).data("content")];agile_build_tag_ui($("#added_tags_ul",a),d);$(".contact-minified",a).toggle();agile_gadget_adjust_height();$(".show-contact-summary",a).toggle();agile_gadget_adjust_height();agile_build_form_template(b,"gadget-tabs",".option-tabs",function(){head.js(Lib_Path+"lib/bootstrap.min.js",function(){$(".dropdown-toggle").dropdown();$(".gadget_tabs",a).tab();$(".option-tabs",a).toggle();agile_gadget_adjust_height();$(".gadget-notes-tab",a).trigger("click")})})})});$(".hide-contact-summery").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");$(".contact-minified",a).toggle();agile_gadget_adjust_height();$(".show-contact-summary",a).toggle();agile_gadget_adjust_height();$(".option-tabs",a).toggle();agile_gadget_adjust_height()});$(".gadget-notes-tab").die().live("click",function(c){c.preventDefault();var b=$(this).closest("div.gadget-contact-details-tab").find(".show-form");$(".gadget-notes-tab-list",b).html("");var a=$(b).data("content");$(".tab-waiting",b).show();_agile.get_notes(function(d){head.js(Lib_Path+"lib/date-formatter.js",Lib_Path+"lib/jquery.timeago.js",function(){agile_get_gadget_template("gadget-notes-list-template",function(e){$(".tab-waiting",b).hide();$(".gadget-notes-tab-list",b).html(getTemplate("gadget-notes-list",d,"no"));agile_gadget_adjust_height()});$("time",b).timeago()})},a)});$(".gadget-tasks-tab").die().live("click",function(c){c.preventDefault();var b=$(this).closest("div.gadget-contact-details-tab").find(".show-form");$(".gadget-tasks-tab-list",b).html("");var a=$(b).data("content");$(".tab-waiting",b).show();_agile.get_tasks(function(d){agile_get_gadget_template("gadget-tasks-list-template",function(e){$(".tab-waiting",b).hide();$(".gadget-tasks-tab-list",b).html(getTemplate("gadget-tasks-list",d,"no"));$(".gadget-tasks-tab-list",b).show();agile_gadget_adjust_height()});$("time",b).timeago()},a)});$(".gadget-deals-tab").die().live("click",function(c){c.preventDefault();var b=$(this).closest("div.gadget-contact-details-tab").find(".show-form");$(".gadget-deals-tab-list",b).html("");var a=$(b).data("content");$(".tab-waiting",b).show();_agile.get_deals(function(d){agile_get_gadget_template("gadget-deals-list-template",function(e){$(".tab-waiting",b).hide();$(".gadget-deals-tab-list",b).html(getTemplate("gadget-deals-list",d,"no"));$(".gadget-deals-tab-list",b).show();agile_gadget_adjust_height()});$("time",b).timeago()},a)});$(".gadget-campaigns-tab").die().live("click",function(c){c.preventDefault();var b=$(this).closest("div.gadget-contact-details-tab").find(".show-form");$(".gadget-campaigns-tab-list",b).html("");var a=$(b).data("content");$(".tab-waiting",b).show();_agile.get_campaign_logs(function(d){agile_get_gadget_template("gadget-campaigns-list-template",function(e){$(".tab-waiting",b).hide();var f={};if(Is_Localhost){f.ac_path=Lib_Path}else{f.ac_path="https://"+agile_id.namespace+".agilecrm.com/"}f.lib_path=Lib_Path;f.response=d;$(".gadget-campaigns-tab-list",b).html(getTemplate("gadget-campaigns-list",f,"no"));$(".gadget-campaigns-tab-list",b).show();agile_gadget_adjust_height()});$("time",b).timeago()},a)});$(".gadget-add-contact").die().live("click",function(b){b.preventDefault();var a=$(this).closest("div.gadget-contact-details-tab").find("div.show-form");agile_build_form_template($(this),"gadget-add-contact",".show-add-contact-form",function(){$(".show-add-contact-form",a).toggle();agile_gadget_adjust_height()})});$(".cancel").die().live("click",function(c){c.preventDefault();var b=$(this).data("tab-identity");$(".gadget-"+b+"-tab").trigger("click");var a=$(this).closest("div.gadget-contact-details-tab");$(".show-add-contact-form",a).toggle();agile_gadget_adjust_height()})}function agile_gadget_adjust_width(e,a,b){if(b){var d=$(".agile-no-contact",e).width();var f=parseInt(a.width(),10)+parseInt(a.css("margin-left"),10)+10;var c=(((d-f)/d)*100)+"%";$(".contact-list-width",e).css("max-width",c)}else{$(".contact-list-width",e).css("max-width","95%")}}function agile_gadget_adjust_height(){if(!Is_Localhost){gadgets.window.adjustHeight()}}function agile_create_contact_ui(b,c,a,d){if(Is_Localhost){d.ac_path=Lib_Path}else{d.ac_path="https://"+agile_id.namespace+".agilecrm.com/"}$.extend(Contacts_Json[a],d);agile_build_form_template(c,"gadget-contact-list",".contact-list",function(){if(d.id==null){agile_gadget_adjust_width(b,$(".contact-search-status",b),true);$(".contact-search-status",b).show().delay(4000).hide(1,function(){agile_gadget_adjust_width(b,$(".contact-search-status",b),false)})}else{$(".gadget-show-contact",b).trigger("click")}})};