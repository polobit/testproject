var _agile=_agile||[];var Is_Localhost=false;var Lib_Path;var Contacts_Json={};var Cache_Counter=0;function agile_init_gadget(){if(window.location.host.indexOf("localhost")!=-1){Is_Localhost=true;Lib_Path="http://localhost:8888/";agile_download_scripts();head.js(Lib_Path+"misc/gmail/gadget-js-all/min/agile-gadget-ui.min.js");head.ready(function(){agile_generate_ui("51ekokl790t85b11ivhim9ep7i","localhost")})}else{Lib_Path="https://googleapps.agilecrm.com/";agile_login();gadgets.window.adjustHeight()}}function agile_login(){var d=new gadgets.Prefs();var a=d.getString("agile_user_exists");if(a=="true"){var e=d.getString("agile_user_key");var b=d.getString("agile_user_domain");agile_download_scripts();head.js(Lib_Path+"misc/gmail/gadget-js-all/min/agile-gadget-ui.min.js");head.ready(function(){agile_generate_ui(e,b)})}else{if(a=="false"){var f=d.getString("agile_user_popup");agile_user_setup_load(f)}else{Cache_Counter+=1;var c=Lib_Path+"gmail?chachecounter="+Cache_Counter;console.log("Osapi from "+c);osapi.http.get({href:c,format:"json",authz:"signed"}).execute(agile_handle_load_response)}}}function agile_handle_load_response(b){var a=new gadgets.Prefs();if(b.content.user_exists!=undefined&&b.content.user_exists==true){b.content.user_exists="true";a.set("agile_user_key",b.content.api_key);a.set("agile_user_domain",b.content.domain);a.set("agile_user_exists",b.content.user_exists);agile_login()}else{b.content.user_exists="false";a.set("agile_user_popup",b.content.popup);a.set("agile_user_exists",b.content.user_exists);agile_user_setup_load(b.content.popup)}}function agile_user_setup_load(a){head.js(Lib_Path+"misc/gmail/gadget-js-all/min/agile-gadget-setup.min.js",function(){agile_user_setup(a)})}function agile_download_scripts(){console.log("Downloading scripts");head.js(Lib_Path+"misc/gmail/gadget-js-all/min/agile-gadget-lib.min.js")}window.onload=agile_init_gadget;