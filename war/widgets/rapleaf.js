$(function(){RAPLEAF_PLUGIN_NAME="Rapleaf";RAPLEAF_LOADING_IMAGE='<div id="rap_info_load"><center><img  src="img/ajax-loader-cursor.gif" style="margin-top: 10px;margin-bottom: 14px;"></img></center></div>';var a=agile_crm_get_widget(RAPLEAF_PLUGIN_NAME);console.log("In Rapleaf");console.log(a);Rapleaf_Plugin_Id=a.id;Email=agile_crm_get_contact_property("email");console.log("Email: "+Email);if(a.prefs==undefined){setupRapleafAuth();return}showRapleafDetails()});function setupRapleafAuth(){$("#Rapleaf").html(getTemplate("rapleaf-login",""));console.log("In Rapleaf Auth");$("#save_api_key").die().live("click",function(a){a.preventDefault();if(!isValidForm($("#rapleaf_login_form"))){return}saveRaplefPrefs()})}function saveRaplefPrefs(){var a={};a.rapleaf_api_key=$("#rapleaf_api_key").val();agile_crm_save_widget_prefs(RAPLEAF_PLUGIN_NAME,JSON.stringify(a),function(b){showRapleafDetails()})}function showRapleafDetails(){$("#Rapleaf").html(RAPLEAF_LOADING_IMAGE);if(!Email){rapleafError(RAPLEAF_PLUGIN_NAME,"Please provide email for this contact");return}var b="core/api/widgets/rapleaf/"+Rapleaf_Plugin_Id+"/"+Email;queueGetRequest("widget_queue",b,"json",function c(d){$("#Rapleaf").html(getTemplate("rapleaf-profile",d))},function a(d){rapleafError(RAPLEAF_PLUGIN_NAME,d.responseText)})}function rapleafError(c,b){var a={};a.message=b;$("#"+c).html(getTemplate("rapleaf-error",a))};