$(function(){console.log("In sip.js");SIP_PLUGIN_NAME="Sip";SIP_UPDATE_LOAD_IMAGE='<center><img id="sip_load" src="img/ajax-loader-cursor.gif" style="margin-top: 10px;margin-bottom: 14px;"></img></center>';SIP_WIDGET=agile_crm_get_widget(SIP_PLUGIN_NAME);console.log("SIP_WIDGET");console.log(SIP_WIDGET);Sip_Plugin_Id=SIP_WIDGET.id;console.log(Sip_Plugin_Id);if(SIP_WIDGET.prefs==undefined){setupSipAuth();return}showSipProfile()});function setupSipAuth(){$("#Sip").html(SIP_UPDATE_LOAD_IMAGE);console.log("In setupSipAuth");$("#Sip").html(getTemplate("sip-login",{}));$("#save_prefs").die().live("click",function(a){a.preventDefault();if(!isValidForm($("#sip_login_form"))){return}saveSipPrefs()})}function saveSipPrefs(){console.log("In saveSipPrefs.");var a={};a.sip_username=$("#sip_username").val();a.sip_privateid=$("#sip_privateid").val();a.sip_realm=$("#sip_realm").val();a.sip_password=$("#sip_password").val();a.sip_publicid="sip:"+$("#sip_privateid").val()+"@"+$("#sip_realm").val();if($("#sip_wsenable").is(":checked")){a.sip_wsenable="true"}else{a.sip_wsenable="false"}console.log(a);agile_crm_save_widget_prefs(SIP_PLUGIN_NAME,JSON.stringify(a),function(b){showSipProfile()})}function showSipProfile(){$("#Sip").html(SIP_UPDATE_LOAD_IMAGE);console.log("In showSipProfile.");if(document.readyState==="complete"){console.log(SIP_WIDGET);console.log(Sip_Start);console.log(Sip_Stack);console.log(Sip_Register_Session);var data=eval("("+SIP_WIDGET.prefs+")");if(Sip_Stack!=undefined&&Sip_Register_Session!=undefined&&Sip_Start==true){data.msg="You can make and receive calls with SIP.";$(".contact-make-sip-call").show();$(".make-call").show();$(".contact-make-call").hide()}else{sipStart();data.msg="Need to register on SIP.";$(".contact-make-sip-call").hide();$(".make-call").hide();$(".contact-make-call").show()}console.log(data);$("#Sip").html(getTemplate("sip-profile",data))}};