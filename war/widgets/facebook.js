$(function(){console.log("in facebook.js");FACEBOOK_PLUGIN_NAME="Facebook";FACEBOOK_PROFILE_LOAD_IMAGE='<center><img id="facebook_profile_load" src="img/ajax-loader-cursor.gif" style="margin-top: 10px;margin-bottom: 14px;"></img></center>';var b=agile_crm_get_widget(FACEBOOK_PLUGIN_NAME);FACEBOOK_PLUGIN_ID=b.id;console.log("plugin Id"+FACEBOOK_PLUGIN_ID);var c=agile_crm_get_contact_property("first_name");var a=agile_crm_get_contact_property("last_name");console.log("firstName:"+c+"lastname:"+a);SEARCH_STRING=c+" "+a;console.log("    SEARCH_STRING"+SEARCH_STRING);web_url=agile_crm_get_contact_property_by_subtype("website","FACEBOOK");console.log(web_url);if(web_url){console.log("profile attched"+web_url);tempurl=web_url.replace("@","");console.log(tempurl);showFacebookProfile(tempurl)}else{console.log("no profile attached");showFacebookMatchingProfile(SEARCH_STRING)}$("#facebook_search_btn").die().live("click",function(d){d.preventDefault();getModifiedFacebookMatchingProfiles()});$(".facebook_modify_search").die().live("click",function(d){d.preventDefault();$("#"+FACEBOOK_PLUGIN_NAME).html(getTemplate("facebook-modified-search",{searchString:SEARCH_STRING}))});$("#facebook_search_close").die().live("click",function(d){d.preventDefault()})});function showFacebookMatchingProfile(b){var c=agile_crm_get_contact_property("image");console.log("am in facebook show");queueGetRequest("widget_queue","/core/api/widgets/facebook/contacts/"+FACEBOOK_PLUGIN_ID+"/"+b,"json",function d(f){console.log("Facebook");if(f){f.searchString=SEARCH_STRING;console.log("data is:");console.log(f);var e=$("#"+FACEBOOK_PLUGIN_NAME).html(getTemplate("facebook-matching-profiles",f));$(".facebookImage").die().live("mouseover",function(){Facebook_id=$(this).attr("id");$(this).popover({placement:"left"});$(this).popover("show");$("#"+Facebook_id).die().live("click",function(i){i.preventDefault();console.log(Facebook_id);$(this).popover("hide");console.log("on click in search");var g="@"+Facebook_id;web_url=g;console.log(g);var h=[{name:"website",value:g,subtype:"FACEBOOK"}];if(!c){var j=$(this).attr("src");h.push({name:"image",value:j})}if(!agile_crm_get_contact_property("title")){}console.log(h);agile_crm_update_contact_properties(h);showFacebookProfile(Facebook_id)})})}else{facebookError(f.responseText)}},function a(e){facebookError(e.responseText)})}function facebookError(b){var a={};a.message=b;console.log("error ");$("#"+FACEBOOK_PLUGIN_NAME).html(getTemplate("facebook-error",a))}function getModifiedFacebookMatchingProfiles(){console.log("am in getModifiedFacebookMatchingProfiles");if(!isValidForm($("#facebook-search_form"))){return}$("#spinner-facebook-search").show();SEARCH_STRING=$("#facebook_keywords").val();showFacebookMatchingProfile(SEARCH_STRING)}function showFacebookProfile(b){console.log("am in facbook profile");queueGetRequest("widget_queue","/core/api/widgets/facebook/userProfile/"+FACEBOOK_PLUGIN_ID+"/"+b,"json",function c(f){console.log("Facebook");console.log(f);if(f){var e=agile_crm_get_contact_property("image");console.log(e);f.image=e;$("#Twitter_plugin_delete").show();var d=$("#"+FACEBOOK_PLUGIN_NAME).html(getTemplate("facebook-profile",f));$("#facebook_post_btn").die().live("click",function(){console.log("post on a wall");queueGetRequest("widget_queue","/core/api/widgets/facebook/postonwall/"+FACEBOOK_PLUGIN_ID+"/"+b+"/hai","json",function h(i){console.log("am at success")},function g(i){facebookError(i.responseText)})})}else{facebookError(f.responseText)}},function a(d){facebookError(d.responseText)})};