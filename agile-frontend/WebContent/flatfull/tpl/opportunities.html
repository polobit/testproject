<script id="opportunities-collection-template" type="text/html">
<div class="custom-animated custom-fadeInUp">
<div class="wrapper-md lter bg-light b-b">
<div class="row">
    <div class="col-md-12">
            <h3 class="pull-left h3 font-thin">Deals <small>Opportunities</small>
			<div id="milestone-set-msg" class="alert alert-warning p-sm" role="alert" style="margin-left:100px;display:none;">
  				For better deal reports and sales forecasting, please set your 'Won' and 'Lost' milestones in the <a href="#milestones" style="font-style:italic;text-decoration: initial;color: #337ab7;">Deal settings</a> page.
			</div>
			</h3>
			<!--a href="#deals-add" class="deals-add btn-sm btn-default btn right"><i class="icon-plus-sign" /> Add Deal</a-->
			<div class="pull-right">
			<div class="btn-group  hidden m-r-xs inline-block" id="deals-tracks">
			</div>
      {{#is_mobile}}
      {{else}}
			<div id="deal-list-filters" class="btn-group m-r-xs inline-block">
				 <img class="loading_img p-r-xs"  height="32px" width="32px" src= "img/21-0.gif"></img>
			</div>
      {{/is_mobile}}
      {{#is_mobile}}
              {{else}}
			<div class="btn-group m-r-xs inline-block" id="deals-view">
					<div class="btn btn-sm btn-default"><i class="icon-list m-r-xs"></i></div>
					<a class="btn dropdown-toggle btn-sm btn-default" data-toggle="dropdown" href="#">
						<span class="caret"></span>
					</a>
					<ul class="dropdown-menu pull-right">
							<li><a href="#" class="deals-list-view" onclick="return false;">List View</a></li>
              
						<li><a href="#" class="deals-pipelined-view">Milestone View</a></li>
            
					</ul>
			</div>
      {{/is_mobile}}
			<div class="btn-group m-r-xs inline-block" id="deals-action">
					<a href="#deals-add" class="deals-add btn btn-default btn-sm"><i class="icon-plus-sign" /> Add Deal
					</a>
					<a class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown" href="#">
						<span class="caret"></span>
					</a>
					<ul class="dropdown-menu pull-right">
						<li><a href="#import-deals" >Import from CSV</a></li>
						<li><a href="#" class="deals-export-csv">Export as CSV</a></li>
					
					</ul>
			</div>
			</div>
			<div class="clearfix"></div>
</div>
</div>
</div>
<div class="wrapper-md">
<div class="row">
    <div class="col-md-9">
        <div id="slate">
        </div>
        {{#if this.length}}
        {{#is_mobile}}
        {{else}}
        <div id="total-pipeline-chart" class="w-full bg-white" style="height:300px"></div>
        {{/is_mobile}}
        <br />
			<div>
				<div class="btn-group pull-left" id="bulk-actions">
					<div class="btn btn-sm btn-default">Bulk Actions</div>
					<a class="btn btn-sm dropdown-toggle btn-default" data-toggle="dropdown" href="#">
						<span class="caret"></span>
					</a>
					<ul class="dropdown-menu" id="view-actions">
						<li><a href="#deal_owner_change_modal" data-toggle="modal">Change Owner</a></li>
						<li><a href="#deal_mile_change_modal" data-toggle="modal">Change Milestone/Track</a></li>
						<li class="divider"></li>
						<li><a href="#deal_contact_add_tag_modal" data-toggle="modal">Add Tag to related Contacts</a></li>
						{{#hasMenuScope 'CAMPAIGN'}}
							<li><a href="#deal_contact_add_camp_modal" data-toggle="modal">Add related Contacts to Campaign</a></li>
						{{/hasMenuScope}}
						<li class="divider"></li>
						<li><a href="#deal_bulk_archive_modal" data-toggle="modal">Archive</a></li>
						<li><a href="#deal_bulk_restore_modal" data-toggle="modal">Restore</a></li>
						<li class="divider"></li>
						<li><a href="#deal_bulk_delete_modal" data-toggle="modal">Delete</a></li>
						
					</ul>
				</div>
				<div class="btn-group pull-left m-t-xs" style="display: none;left: 10px;" id="bulk-select"></div>
        <div class="clearfix"></div>
				<br>
			</div>
			<div class="panel panel-default">
			<div class="panel-heading">Deals</div>
			<div class="table-responsive">
                <table class="table table-striped showCheckboxes m-b-none no-sorting agile-table panel table-layout-mob-view" url="core/api/opportunity/delete" id="deal-list" style="table-layout:auto;">
					<thead>
                        <tr>
                            <th>Opportunity</th>
                            <th>Related To</th>
                            <th>Value</th>
                            <th>Milestone</th>
                            <th>Close Date</th>
                            <th>Owner</th>
                        </tr>
                    </thead>
                    <tbody id="opportunities-model-list" class="c-p"><!--route="deals/"-->
                    </tbody>
                </table>
            </div>
            </div>
        
        {{/if}}
        </div>
        
    <div class="col-md-3">
        <div class="data-block">
        {{#is_mobile}}
        {{else}}
        
            <div class="panel wrapper m-b-none">
                <header>
                    <h4 class="m-t-none font-thin"><span><i class="icon-flag"></i></span> Milestones</h4>
                </header>
                <div id="pie-deals-chart" class="w-full" style="height:400px"></div>
			</div>
      {{/is_mobile}}

			<div class="m-t-md">
                <h4 class="m-t-none m-b-sm h4 text-center-xs">
                    What are Milestones?
                </h4>
                
                <p>
                    Milestones are used to define the status of the deal.
                </p>
                <p>
                    e.g. Use 'Won' in case of a successfully completed deal or 'New' for a newly added deal. You can define custom milestones.
                </p>
                
                <h4 class="m-t-none m-b-sm h4 text-center-xs">
                    What are Deals?
                </h4>
                
                <p>
                    Deals are opportunities you can continuously track throughout their life-cycle.
                </p>
            </div>
        </div> 
    </div>
</div>
</div>

</div>

<!-- Deal bulk milestone and pipeline change modal. -->
<div id="deal_owner_change_modal" class="deal_bulk_modal modal  fade">
<div class="modal-dialog">
    <div class="modal-content">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3 class="modal-title">Change Owner</h3>
  </div>
  <div class="modal-body">
<div class="row">
    <div class="control-group form-group col-md-5">
		<p class="m-t-xs">Changing owner for <span class="count"> </span> Deal(s).</p>
		<label class="control-label"><b>Select Owner </b><span
			class="field_req">*</span></label>
			<div class="controls" id="owners">
				<select id="owners-list-bulk" class="required form-control" name="owner_id"></select>
			</div>
</div>
	</div>
  </div>
  <div class="modal-footer">
    <a href="#" id="deal-bulk-owner" class="btn btn-sm btn-primary">Done</a>
  </div>
</div>
</div>
</div>

<!-- Deal bulk owner change modal. -->
<div id="deal_mile_change_modal" class="deal_bulk_modal modal  fade">
<div class="modal-dialog">
    <div class="modal-content">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3 class="modal-title">Change Milestone/Track</h3>
  </div>
  <div class="modal-body">
	<form id="bulk_mile_Form" name="opportunityForm" method="post">
	<p>Changing track/milestone for <span class="count"> </span> Deal(s).</p>
<div class="row">
    <div class="control-group form-group col-md-5">
		<label class="control-label"><b>Select Track </b><span
			class="field_req">*</span></label>
			<div class="controls" id="bulk-pipeline">
				<select id="pipeline-list-bulk" class="required form-control" name="pipeline"></select>
			</div>
</div>
	</div>
<div class="row">
	<div class="control-group form-group col-md-5">
		<label class="control-label"><b>Select Milestone </b><span
			class="field_req">*</span></label>
			<div class="controls" id="bulk-pipeline">
				<select id="milestone-list-bulk" class="required form-control" name="milestone"></select>
			</div>
	</div>
	</div>
<input type="hidden" id="pipeline-name"  name="pipeline-name"></input>
	</form>
  </div>
  <div class="modal-footer">
    <a href="#" id="deal-bulk-mile" class="btn btn-sm btn-primary">Done</a>
  </div>
</div>
</div>
</div>

<!-- Bulk archive confirmation-->
<div id="deal_bulk_archive_modal" class="deal_bulk_modal modal  fade">
<div class="modal-dialog">
    <div class="modal-content">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3 class="modal-title">Archive</h3>
  </div>
  <div class="modal-body">
    <div id="deal-bulk-confirm">
		Archive <span class="count"> </span> Deal(s)?
	</div>
  </div>
  <div class="modal-footer">
	<button type="button" class="btn btn-sm btn-danger" data-dismiss="modal" aria-hidden="true">No</button>
    <a href="#" id="deal-bulk-archive" class="btn btn-sm btn-primary">Yes</a>
  </div>
</div>
</div>
</div>

<!-- Bulk restore confirmation-->
<div id="deal_bulk_restore_modal" class="deal_bulk_modal modal fade">
<div class="modal-dialog">
    <div class="modal-content">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3 class="modal-title">Restore</h3>
  </div>
  <div class="modal-body">
    <div id="deal-bulk-confirm">
		Restore <span class="count"> </span> Deal(s)?
	</div>
  </div>
  <div class="modal-footer">
	<button type="button" class="btn btn-sm btn-danger" data-dismiss="modal" aria-hidden="true">No</button>
    <a href="#" id="deal-bulk-restore" class="btn btn-sm btn-primary">Yes</a>
  </div>
</div>
</div>
</div>

<!-- Bulk delete confirmation-->
<div id="deal_bulk_delete_modal" class="deal_bulk_modal modal fade">
<div class="modal-dialog">
    <div class="modal-content">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3 class="modal-title">Delete</h3>
  </div>
  <div class="modal-body">
    <div id="deal-bulk-confirm">
		Delete <span class="count"> </span> Deal(s)?
	</div>
  </div>
  <div class="modal-footer">
	<button type="button" class="btn btn-sm btn-danger" data-dismiss="modal" aria-hidden="true">No</button>
    <a href="#" id="deal-bulk-delete" class="btn btn-sm btn-primary">Yes</a>
  </div>
</div>
</div>
</div>

<!-- Add tag to the related contacts confirmation -->
<div id="deal_contact_add_tag_modal" class="deal_bulk_modal modal  fade">
<div class="modal-dialog">
    <div class="modal-content">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3 class="modal-title">Add tag</h3>
  </div>
  <div class="modal-body">
<div class="row">
		<form id="dealContactTagsBulkForm">
                <div class="control-group form-group col-md-7">         
					<p class="m-t-xs">Add Tag to related Contacts of selected <span class="count"> </span> Deal(s)</p>
                    <label class="control-label"><b>Add tags</b> <span class="field_req">*</span></label>
                    <div class="controls">
                        <div class="pull-left">
                        <ul name="tags" class="tagsinput tags p-n"></ul>
                        </div>              
                        <input name="tags" type="text" id="addBulkTags" class="tags-typeahead form-control" placeholder="Enter tags separated by comma" autocomplete="off"><ul class="typeahead dropdown-menu" style="top: 34px; left: 15px; display: none;"><li class="active"><a href="#"><strong>Te</strong>st</a></li><li><a href="#"><strong>Te</strong>st Company</a></li><li><a href="#"><strong>Te</strong>st2</a></li><li><a href="#"><strong>Te</strong>st3</a></li><li><a href="#"><strong>Te</strong>xt</a></li><li><a href="#"><strong>te</strong>st</a></li></ul>
						<span class="error-tags" style="display:none;color:red;">This field is required.</span>
						<span class="invalid-tags" style="display:none;color:red;">Tag name should start with an alphabet and can not contain special characters other than underscore and space.</span>
						<input class="hide">      
              		</div>
                </div>
        </form>
	</div>
  </div>
  <div class="modal-footer">
    	<!-- <button type="button" class="btn btn-sm btn-danger" data-dismiss="modal" aria-hidden="true">Cancel</button> -->
    	<a href="#" id="deal-contact-add-tag" class="btn btn-primary btn-sm">Done</a> 
  		<span class="save-status"></span>
  </div>
</div>
</div>
</div>

<!-- Add related contacts to campaign confirmation -->
<div id="deal_contact_add_camp_modal" class="deal_bulk_modal modal  fade">
<div class="modal-dialog">
    <div class="modal-content">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3 class="modal-title">Add to Campaign</h3>
  </div>
  <div class="modal-body">
<div class="row">
    <div class="control-group form-group col-md-8">
		<p class="m-t-xs">Add related Contacts of selected <span class="count"> </span> Deal(s) to Campaign</p>
		<label class="control-label"><b>Select Campaign </b><span
			class="field_req">*</span></label>
			<div class="controls" id="workflows">
				<select id="workflows-list-bulk" class="required form-control" name="workflow_id"></select>
			</div>
</div>
	</div>
  </div>
  <div class="modal-footer">
    <a href="#" id="deal-contact-add-camp" class="btn btn-sm btn-primary">Done</a>
  </div>
</div>
</div>
</div>

</script>
<script id="opportunities-model-template" type="text/html">
<td data="{{id}}" class="data">
	<div class="text-ellipsis" style="width:10em"> 
		<a class="text-cap">{{name}}</a>
	</div>
</td>
<td>
<div class="text-ellipsis" style="width:10em">
	<div class="inline-block text-ellipsis" style="width:9em">
	{{#each contacts}}
       {{#if_contact_type "PERSON"}}
        	<a href="#contact/{{id}}" class="activate-link hide-popover thumb-sm"><img class="r r-2x img-inital" data-name="{{dataNameAvatar properties 40}}" src="{{gravatarurl properties 40}}"   title="{{getPropertyValue properties "first_name"}} {{getPropertyValue properties "last_name"}}" /></a>
       {{/if_contact_type}}
	   {{#if_contact_type "COMPANY"}}
        	<a href="#company/{{id}}" class="activate-link hide-popover thumb-sm"><img class="r r-2x" {{getCompanyImage "40" "display:inline;"}} title="{{getPropertyValue properties "name"}}"/></a>
       {{/if_contact_type}}
   {{/each}}
   </div>
  {{#if_greater this.contacts.length "4"}}<span>...</span>{{/if_greater}}
</div>
</td>
<td value="{{expected_value}}"><div class="text-ellipsis" style="width:10em">{{#if expected_value}}{{currencySymbol}}{{numberWithCommas expected_value}}{{else}}-{{/if}}</div></td>
<td><div class="text-ellipsis" style="width:5em">{{milestone}} ({{probability}}%) </div></td>
<td class="text-muted"><div class="text-ellipsis" style="width:10em">{{#if close_date}}<i class="fa fa-clock-o m-r-xs"></i><time class="deal-close-time" value="{{close_date}}" datetime="{{epochToHumanDate "" close_date}}">{{epochToHumanDate "ddd mmm dd yyyy HH:MM:ss" close_date}}</time>{{/if}}</div></td>
<td>
<div class="text-ellipsis" style="width:5em">
    <div class="thumb-sm avatar">
       {{#if pic}}
        <img class="r r-2x" src="{{pic}}"  title="{{owner.name}}" />
	   {{else}}
		<img class="r r-2x" src="{{defaultGravatarurl 50}}"  title="{{owner.name}}" />
       {{/if}}
    </div>
</div>
</td>
</script>

<script id="opportunity-track-list-collection-template" type="text/html">
<div class="btn-group right pos-rlt"  id="filters-tour-step">
	<button class="btn filter-dropdown btn-default btn-sm"><i class="icon-road m-r-xs"/></button>
	<button class="btn dropdown-toggle btn-default btn-sm" data-toggle="dropdown">
    	<span class="caret"></span>
  	</button>
	<ul id ="opportunity-track-list-model-list" class="pull-right dropdown-menu">
	</ul>
</div>
</script>

<script id="opportunity-track-list-model-template" type="text/html">
{{#if name}}
<a id='{{id}}' class="pipeline c-p" data="{{name}}">{{name}}</a>
 {{else}}
<a id='{{id}}' class="pipeline c-p" data="Default">Default</a>
{{/if}}
</script>
