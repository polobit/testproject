<script id="ticket-details-container-template" type="text/html">

</script>
<script id="ticket-details-template" type="text/html">

{{#get_current_user_prefs this}}{{/get_current_user_prefs}}

<div id="contact-dtl" class="app-content-full  h-full dock-view-fixing">
  <div class="hbox hbox-auto-xs hbox-auto-sm bg-light">
    <!-- first column in details view -->
    <div class="col bg-light lter b-r w-lg" style="width:299px;">
      <div class="vbox">
        <div class="row-row">

          <div class="wrapper p-t-sm">

            <div class="panel panel-default m-t-sm">
                  <div class="panel-body text-center">

                  <div class="pos-rlt w-full">

                   {{#is_ticket_collection_available}}

                    <div class="contact-navigation-view">

                    <span class="navigation">

                      {{#next_prev_ticket_exists 'previous'}}
                      <a href="{{#is_filtered_ticket}}
                      #tickets/filter/{{#get_ticket_filter_id}}{{/get_ticket_filter_id}}/ticket/{{#next_prev_ticket_exists 'previous'}}{{get_ticket_id 'previous'}}{{/next_prev_ticket_exists}}
                      {{/is_filtered_ticket}}" class="pull-left text-info text-xs" title="Previous Ticket">
                        <i class="icon icon-chevron-left" style="vertical-align: middle;"></i>
                       </a>
                      {{else}}
                       <span class="pull-left text-muted text-xs" title="Previous Ticket">
                        <i class="icon icon-chevron-left" style="vertical-align: middle;"></i>
                       </span>
                      {{/next_prev_ticket_exists}}

                      {{#next_prev_ticket_exists 'next'}}
                      <a href="{{#is_filtered_ticket}}
                      #tickets/filter/{{#get_ticket_filter_id}}{{/get_ticket_filter_id}}/ticket/{{#next_prev_ticket_exists 'next'}}{{get_ticket_id 'next'}}{{/next_prev_ticket_exists}}
                      {{/is_filtered_ticket}}" class="pull-right text-info text-xs" title="Next Ticket"><i class="icon icon-chevron-right" style="vertical-align: middle;"></i></a>
                       {{else}}
                       <span class="pull-right text-muted text-xs" title="Previous Ticket">
                        <i class="icon icon-chevron-right" style="vertical-align: middle;"></i>
                       </span>
                      {{/next_prev_ticket_exists}}

                    </span>
                    </div>
                    {{/is_ticket_collection_available}}

                  </div>
                  
                   <div>
                        <a class="text-info back-to-tickets" href="javascript:void(0);">Tickets</a> / 
                        <span> #{{id}}</span>
                    </div>

                    <div class="b-b b-light m-t-sm m-b-sm"></div>

                  <div class="clearfix cursor-pointer" onclick="window.open('#contact/{{contact.id}}', '_blank')">

                      <div class="inline">
                        <div class="thumb-sm">
                            <img src="{{gravatarurl contact.properties 24}}" class="r-5x" alt="...">
                          </div>
                        <div class="h4 m-t m-b-xs"> <span class="first-letter-cap inline-block">
                              {{getPropertyValue contact.properties "first_name"}}
                              {{getPropertyValue contact.properties "last_name"}} 
                            </span>
                        </div>
                        <div><span class="first-letter-cap">
                              {{getPropertyValue contact.properties "company"}}
                            </span>
                        </div>

                         <div>
                              {{getPropertyValue contact.properties "email"}}
                          </div>

                           <div>
                               <a href="tel:{{getPropertyValue contact.properties "phone"}}" class="contact-make-call contact-call-button" phone="{{getPropertyValue contact.properties "phone"}}">
                                  {{getPropertyValue contact.properties "phone"}}
                                </a>
                            </div>  

                            {{#if contact.tags}}
                            <div>
                              {{#each contact.tags}}
                              <span class="label bg-light dk text-tiny first-letter-cap inline-block m-r-xxs">
                                {{this}}
                              </span>
                              {{/each}}
                            </div>
                            {{/if}}

                            <div class="col-md-12 p-n m-t-xs">

                              {{#each contact.properties}}

                                {{#if_equals name "website"}}

                                  {{#if subtype}}
                                   <a target="_blank" href="https://twitter.com/{{value}}" class="m-l-xs">
                                    <i class="{{get_social_icon subtype}} text-base text-muted"></i>
                                   </a>
                                   {{else}}
                                        <a target="_blank" href="/{{getPropertyValueBytype contact.properties 'website' '' 'URL'}}" 
                                        class="text-l-none">
                                        <i class="{{get_social_icon URL}} text-base text-muted"></i>
                                      </a>
                                   {{/if}}

                                 {{/if_equals}}

                              {{/each}}

                              </div>

                      </div>                      
                    </div>
              </div>
                  
            </div>

            <div class="panel panel-default m-t-md">
              <div class="panel-body">
                <div class="row m-n">

                   <div class="row m-l-n m-r-n">
                    <div class="col-md-12 p-l-n">
                      <div class="p-n m-b-xxs">Assignee
                      <a class="assign-to-me text-info pull-right" href="javascript:void(0);" style="{{#if_equals current_logged_in_user.id assigneeID}} display:none {{/if_equals}}">Take It</a>
                      </div>
                      <select id="ticket-assignee" class="form-control text-xs" name="assigneeID" style="height: 28px;padding: 3px 6px;">
                          
                      </select>
                    </div>

                  </div>
                </div>

                <div class="row m-n p-t-sm">
                  <div class="col-md-12 p-n m-b-xxs">CCs
                    <a class="add-me-to-cc text-info pull-right" href="javascript:void(0);" style="{{#containsScope requester_email cc_emails}} display:none {{/containsScope}}">CC Me</a>
                  </div>
                  <div class="col-md-12  ticket-email b-a p-xs p-b-none r text-xs">
                    <div class="v-top" >
                      <ul class="cc-emails m-n p-n" name="cc_emails">
                          {{#each cc_emails}}
                            <li class="tag btn btn-xs btn-default m-r-xs m-b-xs inline-block" data="{{this}}" >
                              <span>
                                <a class="m-r-xs" href="javascript:void(0);" >{{this}}</a>
                                <a class="close remove-ticket-cc-emails text-lg">&times</a>
                              </span>
                            </li>
                          {{/each}}
                          <li class="tag m-r-xs m-b-xs inline-block">
                            <input type="text" placeholder="Add CC Email" id="cc_email_field" class="cc_emails_st" autocomplete="off">
                          </li>
                      </ul>
                    </div>  
                  </div>
                </div>

                <div class="row m-n p-t-sm">
                  <div class="col-md-12 p-n m-b-xs sla-due-date">

                    <div class="col-md-12 p-n m-b-xxs"> 
                      <span class="sla-text">Due In</span>
                      <!-- <a id="change-sla" href="javascript:void(0);" class="text-info">Change</a> -->
                    </div>
                      
                    <input type="text" class="form-control text-xs" id="datetimepicker" placeholder="Select date" value="{{#if due_time}}{{epochToHumanDate "mm/dd/yyyy" due_time}}{{/if}}"/>
                     
                  </div>
                </div>

              </div>
            </div>

                
            <div class="panel panel-default m-t-md">
              <div class="panel-body">

                <div class="row m-n">
                   <div class="col-md-12 p-n">
                      <div class="p-n m-b-xxs">Status</div>
                      <select name="status" class="form-control text-xs ticket_status" style="height: 28px;padding: 3px 6px;">
                        <option value="OPEN" {{#if_equals status "OPEN"}}selected{{/if_equals}}>Open</option>
                        <option value="PENDING" {{#if_equals status "PENDING"}}selected{{/if_equals}}>Pending</option>
                        <option value="CLOSED" {{#if_equals status "CLOSED"}}selected{{/if_equals}}>Closed</option>
                      </select>
                    </div>
                 </div>

              <div class="row p-t-sm">

                  <div class="col-md-6 p-l-n">
                    <div class="p-n m-b-xxs">Type</div>
                    <select id="type" name="type" class="form-control text-xs ticket_type" style="height: 28px;padding: 3px 6px;">
                      <option value="QUESTION" {{#if_equals type "QUESTION"}}selected{{/if_equals}}>
                        Question
                      </option>
                      <option value="TASK" {{#if_equals type "TASK"}}selected{{/if_equals}}>Task</option>
                      <option value="INCIDENT" {{#if_equals type "INCIDENT"}}selected{{/if_equals}}>
                        Incident
                      </option>
                      <option value="PROBLEM" {{#if_equals type "PROBLEM"}}selected{{/if_equals}}>Problem</option>
                    </select>
                  </div>

                  <div class="col-md-6 p-r-n">
                      <div class="p-n m-b-xxs">Priority</div>
                      <select name="priority" class="form-control text-xs ticket_priority" style="height: 28px;padding: 3px 6px;">
                        <option value="LOW" {{#if_equals priority "LOW"}}selected{{/if_equals}}>Low</option>
                        <option value="MEDIUM" {{#if_equals priority "MEDIUM"}}selected{{/if_equals}}>Medium</option>
                        <option value="HIGH" {{#if_equals priority "HIGH"}}selected{{/if_equals}}>High</option>
                      </select>
                  </div>
              
              </div>

              <div class="row m-n p-t-sm">
                  <div class="col-md-12 p-n m-b-xxs">Labels</div>
                  <div class="col-md-12 p-n text-xs">
                    <select data-placeholder="Labels" class="chosen-select form-control" multiple class="w-md">
                    </select>
                  </div>
                </div>


            </div>
          </div> 
          
          </div><!-- End of wrapper-->
           
        </div><!-- End of row-row-->
      </div><!-- End of vbox-->
    </div>
    <!-- End of first column in details view -->

    <!-- second column in details view -->
    <div class="col bg-white">
      <div class="vbox">
        <div class="row-row">

          <!-- Start of ticket notes -->
          <div class="wrapper bg-light p-t-sm p-b-sm pos-rlt b-b">
            <h3 class="font-thin m-t-none m-b-none inline-block" style="width: 88%;">

               <i class="fa {{#if_equals is_favorite "true"}}fa-star text-warning {{else}}fa-star-o text-light{{/if_equals}} toggle-favorite" style="font-size: 20px;"></i>  {{subject}} 
            </h3>
             
            <div class="pos-abs" style="right: 15px; top: 10px;">

            <div class="btn-group dropdown m-l-xs" data-toggle="tooltip" data-placement="bottom" data-original-title="Workflows">
              <button class="fa fa-sitemap btn btn-sm w-xxs btn-default show-workflows" data-toggle="dropdown"></button>

              <ul id="workflows_list" class="dropdown-menu">
                <li><a href="javascript:void(0);">Loading...</a></li>
              </ul>
            </div>

            <div class="btn-group m-l-xs">

              <button class="fa fa-ban btn btn-sm {{#if_equals is_spam "true"}}btn-danger{{else}}btn-default{{/if_equals}} w-xxs w-auto-xs toggle-spam" data-toggle="tooltip" data-placement="bottom" data-original-title="{{#if_equals is_spam "true"}}not spam{{else}}Mark as Spam{{/if_equals}}"></button>
              
              <button class="fa fa-trash-o btn btn-sm btn-default w-xxs w-auto-xs delete-ticket" data-toggle="tooltip" data-placement="bottom" data-original-title="Delete Ticket"></button>

              <button class="fa fa-check btn btn-sm btn-default w-xxs w-auto-xs close-ticket" data-toggle="tooltip" data-placement="bottom" data-original-title="Close Ticket"></button>
            </div> 

            <button class="fa fa-dedent btn btn-sm btn-default m-l-xs toggle-widgets" data-toggle="tooltip" data-placement="bottom" data-original-title="Toggle Widgets"></button>
             
            </div>
          </div>
          
        <div class="clearfix m-b-lg m-md">
            <a class="pull-left thumb-sm"><img src="{{current_logged_in_user.ownerPic}}" class="r-5x" alt="User Image"></a>
            <div class="m-l-xxl bg-white">
               <div id="send-reply-container">
               </div>
            </div>

            <div class="b-b b-light m-b-sm position-relative">
              <span class="label label-default toggle-timeline cursor-pointer pull-right position-relative" style="bottom: 8px;">Show timeline</span>
            </div>

          <!-- End of ticket notes -->
          <div id="notes-collection-container">
              
          </div>
          <!-- End of notes -->

    </div>
    
        </div><!-- End of row-row-->
      </div><!-- End of vbox-->
    
    </div>
    <!-- End of second column in details view -->

    <!-- third column in details view -->
    <div class="contact-right-widgetsview box-border b-l col w-lg bg-light lter b-l bg-auto" style="{{#agile_compare_prefs "hide_ticket_details_widgets" "true"}}display: none;{{/agile_compare_prefs}}">
      <div class="vbox block">
        <div class="row-row" style="display: block !important;">
          <div class="wrapper">
 
            <div id="widgets" class="contact_{{contactID}}">
            </div>  
          </div>  
        </div><!-- End of row-row-->
      </div><!-- End of vbox-->
    </div>
  </div>  
</div>
</div>
</script>
<script  id="create-ticket-notes-template" type="text/html">
<form name="send-reply" id="send-reply" onsubmit="return false;">
    <input type="hidden" name="ticket_id" value="{{id}}">
    <input type="hidden" name="attachment_urls" value=",">
    
      <div>
      
        {{#if_equals reply_type "reply"}}
          <button class="btn btn-primary reply-btn btn-sm" rel="reply" style="position: relative;">Reply
                      <i class="fa fa-caret-down text-primary" style="position: absolute;top: 80%;left: 44%;font-size: 18px;"></i>
                    </button>
        {{else}}
          <button class="btn btn-default reply-btn btn-sm" rel="reply" style="position: relative;">Reply
                    </button>
        {{/if_equals}}
        
        {{#if_equals reply_type "comment"}}
          <button class="btn btn-dark reply-btn btn-sm" rel="comment" style="position: relative;">Comment
            <i class="fa fa-caret-down text-dark" style="position: absolute;top: 80%;left: 44%;font-size: 18px;"></i>
          </button>
        {{else}}
          <button class="btn btn-default reply-btn btn-sm" rel="comment">Comment</button>
        {{/if_equals}}
        
        {{#if_equals reply_type "forward"}}
          <button class="btn btn-info reply-btn btn-sm" rel="forward" style="position: relative;">Forward
            <i class="fa fa-caret-down text-info" style="position: absolute;top: 80%;left: 44%;font-size: 18px;"></i>
          </button>
        {{else}}
          <button class="btn btn-default reply-btn btn-sm" rel="forward">Forward</button>
        {{/if_equals}}
        
        
        
        {{#if canned_responses}}
        <div class="btn-group dropdown m-l-xs pull-right">
          <button class="btn btn-sm btn-default" data-toggle="dropdown" data-toggle="tooltip" data-placement="bottom" data-original-title="Canned Responses"><i class="fa fa-reorder"></i></button>
          <ul id="workflows_list" class="dropdown-menu">
            {{#each canned_responses}}
            <li id="ticket_canned_response" rel="{{id}}"><a href="javascript:void(0);" id={{id}}>{{title}}</a></li>
            {{/each}}
          </ul>
        </div>
        {{/if}}

        </div>

                  <div id="reply-editor" class="m-t-sm">

                    {{#if_equals reply_type "forward"}}
                     <ul class="forward-emails m-n p-a-sm b-a p-xs p-b-none r" name="forward_emails">
                          <li class="tag m-r-xs m-b-xs inline-block">
                             <input type="text" id="forward_email_input" name="email" class="b-n" placeholder="To Email" autocomplete="off"/>
                          </li>
                      </ul> 
                    {{/if_equals}}

                     <textarea id="reply_textarea" name="html_text" class="form-control {{#if_equals reply_type "comment"}} bg-lightyellow{{/if_equals}}" style="min-height:76px;max-height:400px;width:100%;text-indent: 0px; overflow-y: hidden; resize: none;padding: 8px;">{{#if_equals reply_type "forward"}} {{get_palin_text_from_html notes}} {{/if_equals}}</textarea>
            
                  </div>
                  
                  <div class="m-t-xs clearfix m-b-sm">

                   <span class="error-msg text-sm pull-right" style="color: #d9534f;"></span>
                    {{#if label_matched_canned_responses}}<span onclick="$('.matched-canned-responses-list').toggle();" class="text-info text-sm cursor-pointer border-highlight-light pull-right">Show matched canned Responses</span>{{/if}}

                    {{#if_equals reply_type "reply"}}
                    <div class="btn-group dropdown dropup p-none">
                        <button class="btn btn-default btn-sm send-reply">Send Reply</button>
                        <button class="btn btn-default btn-sm" data-toggle="dropdown" aria-expanded="false"><span class="caret"></span></button>
                        <ul class="dropdown-menu">
                          <li><a href="javascript:void(0);" class="send-reply close-ticket">Send Reply &amp; Close Ticket</a></li>
                        </ul>
                      </div>
                      {{/if_equals}}
                      
                      {{#if_equals reply_type "comment"}} 

                      <div class="btn-group dropdown dropup p-none">
                        <button class="btn btn-default btn-sm send-reply private">Add Comment</button>
                        <button class="btn btn-default btn-sm" data-toggle="dropdown" aria-expanded="false"><span class="caret"></span></button>
                        <ul class="dropdown-menu">
                          <li><a href="javascript:void(0);" class="send-reply private close-ticket">Add Comment & Close Ticket</a></li>
                        </ul>
                      </div> 
                      {{/if_equals}} 


                      {{#if_equals reply_type "forward"}} 
                        <button class="btn btn-sm btn-default send-reply forward">Forward</button>
                      {{/if_equals}}

                    
                  </div>

                  {{#if label_matched_canned_responses}}
                  <div class="panel panel-default m-t-md matched-canned-responses-list" style="display: none;">
                    <div class="panel-heading">Matched Canned Responses</div>
                    <table class="table table-striped table-responsive m-b-none">
                      <tbody>
                        {{#each label_matched_canned_responses}}
                        <tr id="ticket_canned_response" rel="{{id}}" class="ticket-canned-response text-sm">                    
                          <td>{{title}}</td>
                          <td>
                            <div id="message" class="edit-hover text-muted div-max-width" style="max-width: 50%;" title="{{compile_template message ../this}}">{{compile_template message ../this}}</div>
                          </td>
                        </tr>
                        {{/each}}
                      </tbody>
                    </table>
                   </div>
                  {{/if}}

              </div>
              
      </form>        
</script>
<script  id="ticket-status-template" type="text/html">
  {{#if_equals status 'OPEN'}}
    <li>
      <a class="change-ticket-status-li" data-value="CLOSED">Close</a>
    </li>
  {{/if_equals}}
  {{#if_equals status 'CLOSED'}}
    <li>
      <a class="change-ticket-status-li" data-value="OPEN">Open</a>
    </li>
  {{/if_equals}}
</script>
<script  id="ticket-notes-loader-template" type="text/html">
<div class="b-b b-t p-md">
  <img class="loading" src="/flatfull/img/ajax-loader-cursor.gif">
</div>
</script>
<script  id="ticket-change-assignee-template" type="text/html">
  {{#each this}}
    <optgroup data-group-id="{{id}}" data-group-email="{{group_email}}" label="{{group_name}}">
      {{#group_users}}
        <option value="{{id}}">{{name}}</option>
      {{/group_users}}
    </optgroup>
  {{/each}}  
</script>
<script  id="ticket-deals-list-template" type="text/html">
  {{#unless this.length}}
    No Deals
  {{/unless}}  
  {{#each this}}
    <div class="col-md-12 p-n m-t-xs">
      <div>
        {{name}}
      </div>
      <div>
        $ {{expected_value}} <span class="text-muted">{{milestone}}({{probability}}%)</span>
      </div>
      <div class="text-ellipsis">
        {{description}}
      </div>
    </div>
  {{/each}}
</script>