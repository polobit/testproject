<script id="stripe-profile-template" type="text/html">
<div class="wrapper-xs">
	{{#if customer.activeCard.name}}
		<a href="https://manage.stripe.com/customers/{{customer.id}}" target="_blank"><h4 class="text-u-c"><b>{{customer.activeCard.name}}</b></h4></a>
		{{#if customer.activeCard.addressState}}
			<p class="text-sm m-b-none">
				{{#if customer.activeCard.addressLine1}}{{customer.activeCard.addressLine1}},<br/>{{/if}}
				{{#if customer.activeCard.addressLine2}}{{customer.activeCard.addressLine2}},<br/>{{/if}}	
				{{#if customer.activeCard.addressCity}}{{customer.activeCard.addressCity}},<br/>{{/if}}
				{{customer.activeCard.addressState}}, 
				{{#if customer.activeCard.addressCountry}}
					{{customer.activeCard.addressCountry}}
				{{else}}
					{{customer.activeCard.country}}
				{{/if}}
			</p>
		{{/if}}
	{{else}}
		<a href="https://manage.stripe.com/customers/{{customer.id}}" target="_blank">{{getCurrentContactProperty "first_name"}} {{getCurrentContactProperty "last_name"}}</a>
	{{/if}}
</div>
<div class="b-t b-b wrapper-xs">
	<div class="row">
		<div class="col-md-1 p-r-none">
			<p class="m-b-none c-p" id="add_credits"><i class="icon-plus-sign"></i></p>
		</div>
		<div class="col-md-5">
			{{translate 'widgets' 'credits'}}<div class="pull-right"> :</div>
		</div>
		<div class="col-md-6">
  			<span>$ </span>
  			<span id="balance_credit">{{stripeCreditConvertion customer.accountBalance}}</span>
		</div>
	</div>
</div>
<div id="stripe_credits_panel" class="col-md-12 p-t-xs p-b-xs hide">
{{#if_hasWriteAccess}}
		<div class="col-md-6 p-l-none p-r-sm">
			<input class="form-control input-sm" id="credit_amount" type="number" value="0" name="credit_amount">
		</div>
		<div class="col-md-3 p-none">
			<button href="#" class="btn btn-sm btn-primary" id="stripe_credits_add" style="" name="stripe_credits_add">{{translate 'other' 'add'}}</button>
		</div>
		<div class="col-md-3 p-none">
			<button href="#" class="btn btn-sm btn-default" id="stripe_credits_cancel" style="" name="stripe_credits_cancel">{{translate 'other' 'cancel'}}</button>
		</div>
	{{else}}
		<div class="col-md-12 p-l-none p-r-sm">
			<p>{{translate 'widgets' 'revoke-stripe-desc'}}</p>
		</div>
{{/if_hasWriteAccess}}
</div>
<div class="clearfix"></div>
<div class="b-t">
	<div class=" wrapper-xs">
		<span>{{translate 'widgets' 'subscription-details'}}</span>
	</div>
</div>
<div class="b-t b-b wrapper-sm">
	{{#if customer.subscription}}
		<div class="row">	
			<div class="col-md-5 p-r-none">{{translate 'tasks' 'start-date'}}
				<div class="pull-right"> :</div>
			</div>
			<div class="col-md-7 text-muted p-r-none p-l-xxs">
				<i class="fa fa-clock-o m-r-xs"></i>
				<time class="time-ago" datetime="{{epochToHumanDate "" customer.subscription.start}}">{{epochToHumanDate "ddd mmm dd yyyy HH:MM:ss" customer.subscription.start}}</time>
			</div>
		</div>
		{{#if customer.subscription.currentPeriodEnd}}
		<div class="row">	
			<div class="col-md-5 p-r-none">{{translate 'tasks' 'end-date'}}
				<div class="pull-right">:</div>
			</div>
			<div class="col-md-7 text-muted p-r-none p-l-xxs">
				<i class="fa fa-clock-o m-r-xs"></i>
				<time class="time-ago" datetime="{{epochToHumanDate "" customer.subscription.currentPeriodEnd}}">{{epochToHumanDate "ddd mmm dd yyyy HH:MM:ss" customer.subscription.currentPeriodEnd}}</time>
			</div>
		</div>
		{{/if}}
		<div class="row">	
			<div class="col-md-5 p-r-none">{{translate 'plan-and-upgrade' 'current-plan'}}
				<div class="pull-right">:</div>
			</div>							
			<div class="col-md-7 p-r-none word-break p-l-xxs">
				{{customer.subscription.plan.id}}
			</div>
		</div>
		<div class="row">	
			<div class="col-md-5 p-r-none">{{translate 'widgets' 'interval'}}
				<div class="pull-right">:</div>
			</div>							
			<div class="col-md-7 p-r-none p-l-xxs">
				{{customer.subscription.plan.interval}}
			</div>
		</div>
		<div class="row">	
			<div class="col-md-5 p-r-none">{{translate 'plan-and-upgrade' 'amount'}}
				<div class="pull-right">:</div>
			</div>							
			<div class="col-md-7 p-r-none p-l-xxs">
				{{numeric_operation customer.subscription.plan.amount 100 "/"}} {{toUpperCase customer.subscription.plan.currency}}
			</div>
		</div>
	{{else}}
		<div>
	    	{{translate 'widgets' 'no-active-subscription'}}
		</div>
	{{/if}}
</div>

<div class="nav-tabs-alt">
<ul class="nav nav-tabs text-base" id="myTab">
	<li class="active text-center" style="width:48%; margin-left: 2%;" align="center"><a data-toggle="tab" href="#invoices"><h4 class="h4 text-base">{{translate 'plan-and-upgrade' 'invoices'}}</h4><small></small></a></li>
	<li class="text-center" style="width:48%;" align="center"><a data-toggle="tab" href="#payments"><h4 class="h4 text-base">{{translate 'campaigns' 'payments'}}</h4><small>
	</small></a></li>
</ul>
</div>
<div class="tab-content" id="myTabContent">
	<div id="invoices" class="tab-pane fade active in">
		<ul id="invoice_block" class="list-group m-b-none text-base"></ul>
	</div>
	<div id="payments" class="tab-pane fade">
		<ul id="payments_block" class="list-group m-b-none text-base"></ul>
	</div>
</div>
<div class="clearfix"></div>
</script>

<script id="stripe-invoices-template" type="text/html">
{{#if invoice.length}}
	{{#each invoice}}
		<li class="list-group-item r-none b-l-none b-r-none">
			<div class="clear">					
				<a class="pull-left" data-toggle="collapse" href="#collapse-{{id}}" >
					{{#if_equals paid true}}Paid{{else}}Pending{{/if_equals}}
				</a>
				<div class="pull-right font-bold">$ {{numeric_operation total 100 "/"}}</div>	
				<div class="clearfix"></div>	
			</div>		
			<div class="clearfix"></div>					
			<div id="collapse-{{id}}" class="collapse" style="color: rgba(0, 0, 0, 0.5);">
				{{#each lines.data}}	
					{{#if_equals type "invoiceitem"}}
						<div class="pull-left">{{description}}</div>					
						<div class="pull-right">$ {{numeric_operation amount 100 "/"}}</div>
						<br>
					{{/if_equals}}
					{{#if_equals type "subscription"}}
						<div class="pull-left">{{plan.name}}</div>					
						<div class="pull-right">$ {{numeric_operation plan.amount 100 "/"}}
						</div><br>
						<div class="pull-left">{{translate 'plan-and-upgrade' 'quantity'}}
						</div>					
						<div class="pull-right">{{quantity}}</div><br>
						<div class="text-ellipsis w-full">
							<small>
								{{epochToHumanDate "dd-mmm-yy" period.start}}&nbspto 
								{{epochToHumanDate "dd-mmm-yy" period.end}} 
							</small>
						</div>
					{{/if_equals}}	         
				{{/each}}
			</div>
			<small class="text-muted"><i class="fa fa-clock-o m-r-xs"></i><time class="time-ago" datetime="{{epochToHumanDate "" date}}">{{epochToHumanDate "ddd mmm dd yyyy HH:MM:ss" date}}</time></small>
		</li>
	{{/each}}
{{else}}
	<li class="list-group-item r-none b-l-none b-r-none"> {{translate 'widgets' 'no-invoices'}} </li>
{{/if}}
</script>

<script id="stripe-payments-template" type="text/html">
{{#if payments.length}}
	{{#each payments}}
		<li class="list-group-item r-none b-l-none b-r-none">
			<div class="clear">					
				<a class="pull-left" data-toggle="collapse" href="#collapse-{{id}}" >
					{{#if_equals paid true}}Paid{{else}}Pending{{/if_equals}}
				</a>
				<div class="pull-right font-bold">$ {{numeric_operation amount 100 "/"}}</div>				
				<div class="clearfix"></div>
			</div>					
			<div id="collapse-{{id}}" class="collapse" style="color: rgba(0, 0, 0, 0.5);">
				{{#each lines.data}}	
					{{translate 'plan-and-upgrade' 'amount'}} : {{amount}}{{currency}}<br>
					{{translate 'widgets' 'receipt'}}: {{receipt_number}}<br>
					{{translate 'widgets' 'balance'}}: {{balance_transaction}}<br>
					{{translate 'widgets' 'reason'}} : {{reason}}
					{{translate 'report-add' 'time'}}   : {{epochToHumanDate "ddd mmm dd yyyy HH:MM:ss" created}}
					{{else}}
					{{translate 'widgets' 'no-refund-transactions'}}
				{{/each}}
			</div>
			<small class="text-muted"><i class="fa fa-clock-o m-r-xs"></i><time class="time-ago" datetime="{{epochToHumanDate "" created}}">{{epochToHumanDate "ddd mmm dd yyyy HH:MM:ss" created}}</time></small>
		</li>
	{{/each}}
{{else}}
	<li class="list-group-item r-none b-l-none b-r-none"> {{translate 'widgets' 'no-payments'}} </li>
{{/if}}
</script>

<script id="stripe-custom-field-template" type="text/html">
<div class="wrapper-sm">
{{#if_equals this.custom_fields.length "0"}}
	<p>{{translate 'widgets' 'stripe-each-contact-desc'}} <a class="text-info" href="#custom-fields">{{translate 'widgets' 'create-one'}}</a>.</p>
{{else}}
	<p>{{translate 'widgets' 'select-the-custom-field'}}</p>
	<select name="stripe_field" id="stripe_custom_field_name" class="required form-control col-md-10 w-full">
     		<option class="default-select" value="">{{translate 'widgets' 'select'}}</option>
		{{#each this.custom_fields}}
			<option value="{{field_label}}">{{field_label}} 
			</option>
		{{/each}}
	</select>
	<p>{{translate 'widgets' 'or-you-can'}} <a href="#custom-fields">{{translate 'tickets' 'create'}} </a> {{translate 'widgets' 'new-text-custom-field'}}</p>
	<a href="#" class="btn btn-sm btn-default text-l-none" id="save_stripe_name">{{translate 'portlets' 'save'}}</a>
{{/if_equals}}
</div>
</script>

<script id="stripe-error-template" type="text/html">
<div class="wrapper-sm">
{{#check_length message "140"}}
	<div class="ellipsis-multi-line collapse-25 h-auto word-break text-base" title="{{message}}">
		{{{message}}}
	</div>
{{else}}
	<div class="word-break p-n text-base" style="line-height:160%;">
		{{{message}}}
	</div>
{{/check_length}}
</div>
</script>

<script id="stripe-login-template" type="text/html">
<div class="m-t">
	{{translate 'widgets' 'stripe-profile-desc'}}
<br>
	<div class="col-sm-12 text-center m-t-sm">
		<p><b>{{translate 'widgets' 'access'}} <i class="icon-question c-p" data-toggle="tooltip" data-placement="top" title="{{translate 'widgets' 'select-the-access-mode-desc'}}" ></i></b></p>
	    <div class="btn-group" data-toggle="buttons">
	        <label class="btn btn-default active">
	            <input type="radio" class="stripe_scopes" checked="checked" id="read_only" name="scope" value="read_only"/> {{translate 'widgets' 'read'}}
	        </label> 
	        <label class="btn btn-default">
	            <input type="radio" class="stripe_scopes" id="read_write" name="scope" value="read_write"/> {{translate 'widgets' 'write'}}
	        </label> 	      
	    </div>	   
	</div>
<div class="text-center"><button class="btn btn-sm btn-primary m-t-sm" url="{{url}}" id="stripe_url">{{translate 'widgets' 'link-your Stripe'}}</button></div>
</div>
</script>


<script id="stripe-revoke-access-template" type="text/html">

<div>

{{#if_equals custom_data.length "0"}}
				<p>{{translate 'widgets' 'stripe-each-contact-desc'}} <a class="text-info" href="#custom-fields">{{translate 'widgets' 'create-one'}}</a>.</p>
{{else}}

<p>{{translate 'widgets' 'select-the-custom-field'}}</p>
<form id="reportsForm">

<input name="scope"  id="scope" value="{{prefs.scope}}" hidden/>
<input name="stripe_publishable_key"  id="stripe_publishable_key" value="{{prefs.stripe_publishable_key}}" hidden/>
<input name="token_type"  id="token_type" value="{{prefs.token_type}}" hidden/>
<input name="livemode"  id="livemode" value="{{prefs.livemode}}" hidden/>
<input name="refresh_token"  id="refresh_token" value="{{prefs.refresh_token}}" hidden/>
<input name="stripe_user_id"  id="stripe_user_id" value="{{prefs.stripe_user_id}}" hidden/>
<input name="access_token"  id="access_token" value="{{prefs.access_token}}" hidden/>

<fieldset class="m-l-md">
		<div class="control-group m-l-n-md">
				<label class="control-label">{{translate 'widgets' 'current-custom-field'}}
				</label>
				<div class="controls" id="contactTypeAhead">
			
			<select name="stripe_field_name" id="stripe_custom_field" class="required col-md-10 form-control w-full">
     				<option class="default-select" value="">{{translate 'widgets' 'select'}}
     				</option>
				{{#each custom_data}}
					{{#if_equals ../prefs.stripe_field_name field_label}}
						<option selected="selected" value="{{field_label}}">{{field_label}}
						</option>
						{{else}}	
							<option value="{{field_label}}">{{field_label}}</option>
					{{/if_equals}}
				{{/each}}
			</select>
			</div>
			</div>
		</fieldset>
				<div class="m-t-sm m-r-none m-b-xs m-l-none text-center">
					<a class='btn btn-default btn-sm  p-t-xs p-b-xs p-l-xs p-r-xs m-l-xs save-agile-widget' widget-name="Stripe" id="widget-prefs-save">{{translate 'portlets' 'save'}}</a>
					<a class='btn btn-danger btn-sm revoke-widget m-l-xs' widget-name="Stripe">{{translate 'widgets' 'revoke-access'}}</a>

					
					<a href="#add-widget" class='btn btn-default btn-sm' widget-name="Stripe">{{translate 'other' 'cancel'}}</a>
				</div> 
	</div>
</form>
{{/if_equals}}
</div>
</script>
