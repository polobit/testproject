<%@page import="java.util.Iterator"%>
<%@page import="com.agilecrm.account.NavbarConstants"%>
<%@page import="com.agilecrm.account.MenuSetting"%>
<%@page import="com.agilecrm.account.util.MenuSettingUtil"%>
<%@page import="com.agilecrm.user.util.DomainUserUtil"%>
<%@page import="com.agilecrm.session.UserInfo"%>
<%@page import="com.agilecrm.session.SessionManager"%>
<%@page import="com.agilecrm.user.DomainUser"%>
<%@page import="com.agilecrm.user.UserPrefs"%>
<%@page import="com.agilecrm.user.util.UserPrefsUtil"%>
<%@page import="org.codehaus.jackson.map.ObjectMapper"%>
<%@page import="com.agilecrm.subscription.restrictions.db.util.BillingRestrictionUtil"%>
<%@page import="com.agilecrm.subscription.restrictions.db.BillingRestriction"%>
<%@page import="org.apache.commons.lang.StringUtils"%>
<%@page import="com.agilecrm.util.MobileUADetector"%>
<%

			System.out.println("Domain user " + domainUser);
			
			String logoutURL = "/login?sur=true";
			UserInfo user = SessionManager.get();
		
%>

<header id="header" class="app-header navbar" role="menu">

		
			
				<div class="navbar-header 
				<%
				 	switch (Integer.parseInt(currentUserPrefs.theme)) {
				 		case 1:  out.print("bg-black ");
				   				 break;
				 		case 2:  out.print("bg-white-only ");
								 break;
				 		case 3:  out.print("bg-primary ");
								 break;
				 		case 4:  out.print("bg-info ");
								 break;
				 		case 5:  out.print("bg-success ");
								 break;
				 		case 6:  out.print("bg-danger ");
								 break;
				 		case 7:  out.print("bg-black ");
								 break;
				 		case 8:  out.print("bg-info dker ");
								 break;
				 		case 9:  out.print("bg-primary ");
								 break;
				 		case 10:  out.print("bg-info dker ");
								 break;
				 		case 11:  out.print("bg-success ");
								 break;
				 		case 12:  out.print("bg-danger dker ");
								 break;
				 		case 13:  out.print("bg-dark ");
								 break;
				 		case 14:  out.print("bg-dark ");
								 break;
				 		default:
				        		break;
				 
				 	}
				  		
				 %>">
				 
				 	 <button class="pull-right hide dk" id="mobile-menu-settings"  ui-toggle-class="show" data-target=".navbar-collapse">
          <i class="glyphicon glyphicon-cog"></i>
        </button>

          <button class="pull-right visible-xs" id="mobile-menu" ui-toggle-class="off-screen" data-target=".app-aside" ui-scroll-to="app">
          <i class="glyphicon glyphicon-align-justify"></i>
        </button>

        <li class="dropdown hide add-modal-mobile visible-xs pull-right wrapper-sm p-t" id="menu1"><a class="dropdown-toggle"
                data-toggle="dropdown" href=""><i class="fa fa-plus"></i></a>
                <ul class="dropdown-menu  animated fadeInRight mobile-add-modals">
                  <li><a href="#personModal"  class="person" id="person">
                      <div class="pull-left">Contact</div><div class='pull-right shortcuts'>Shift + N</div><div class="clearfix"></div></a></li>
                  <li><a href="#companyModal"  data-toggle="modal"
                    id="company"> <div class="pull-left">Company</div><div class='pull-right shortcuts'>Shift + C</div><div class="clearfix"></div></a></li>
                  <li><a href="#"  id="show-activity"> <div class="pull-left">Event</div><div class='pull-right shortcuts'>Shift + V</div><div class="clearfix"></div></a></li>
                  <li><a href="#" class=" add-task"> <div class="pull-left">Task</div><div class='pull-right shortcuts'>Shift + T</div><div class="clearfix"></div></a></li>

                  <%
                    if(domainUser.menu_scopes.contains(NavbarConstants.DEALS)){
                  %>
                  <li><a href="#" class="font-bold deals-add"> <div class="pull-left">Deal</div><div class='pull-right shortcuts'>Shift + D</div><div class="clearfix"></div></a></li>
                  <%
                    }
                  %>
                  <li><a href="#" id="show-note"> <div class="pull-left">Note</div><div class='pull-right shortcuts'>Shift + O</div><div class="clearfix"></div></a></li>
                  <li><a href="#send-email"> <div class="pull-left">Email</div><div class='pull-right shortcuts'>Shift + M</div><div class="clearfix"></div></a></li>
                </ul> <!-- 
              <img style='display:hidden' id='ajax'
                src='img/ajax-loader.gif' />
                --></li>

        <button class="pull-right hide visible-xs search-menu-mobile" id="search-menu-mobile" ui-toggle-class="off-screen" data-target=".app-aside" ui-scroll-to="app">
          <i class="icon-magnifier search-menu-mobile"></i>
        </button>

         

                <%
						   if(MobileUADetector.isMobileOrTablet(request.getHeader("user-agent"))){
						  %>
							<li class="nav-bar-search pull-right  search-mobile hide">
								<form id="searchForm" class=" navbar-search  navbar-search navbar-form navbar-form-sm navbar-left shift">
					<div class="input-group">
							<input id="searchText" type="text"
										data-provide="typeahead"
										class="typeahead typeahead_contacts search-query form-control-custom input-sm bg-light no-border rounded padder"
										placeholder="Search">
										
										 <!-- <input id="search-results" 
										type="image" src="img/SearchIcon.png" class="searchbox hidden" /> -->
						<span class="input-group-btn">
                <button type="submit" class="btn btn-sm bg-light rounded" id="search-results" style="height:30px;"><i class="fa fa-search"></i></button>
              </span>
              </div>				
								</form>
							</li>
							<%}%>


                 
             


				
			
        
       
				 
				    <a class="navbar-brand font-bold text-lt" href="#"><i class="fa fa-cloud"></i> <span class="hidden-folded m-l-xs hidden-xs"> Agile CRM </span></a>
</div>
					<div id="navbar" class="collapse pos-rlt hide-xs  navbar-collapse box-shadow   
					
					<%
				 	switch (Integer.parseInt(currentUserPrefs.theme)) {
				 		case 1:  out.print("bg-white-only ");
				   				 break;
				 		case 2:  out.print("bg-white-only ");
								 break;
				 		case 3:  out.print("bg-white-only ");
								 break;
				 		case 4:  out.print("bg-white-only ");
								 break;
				 		case 5:  out.print("bg-white-only ");
								 break;
				 		case 6:  out.print("bg-white-only ");
								 break;
				 		case 7:  out.print("bg-black ");
								 break;
				 		case 8:  out.print("bg-info dker ");
								 break;
				 		case 9:  out.print("bg-primary ");
								 break;
				 		case 10:  out.print("bg-info dk ");
								 break;
				 		case 11:  out.print("bg-success ");
								 break;
				 		case 12:  out.print("bg-danger dker ");
								 break;
				 		case 13:  out.print("bg-white-only ");
								 break;
				 		case 14:  out.print("bg-dark ");
								 break;
				 		default:
				        		break;
				 
				 	}
				  		
				 %>">
					<div class="nav navbar-nav hidden-xs">
<a href="#" id="app-aside-folded" style="top:8px;" class="p-b-sm p-l-sm p-r-sm inline-block pos-rlt pos-t-xs  no-shadow navbar-btn" ui-toggle="app-aside-folded" target=".app">
            <i class="fa fa-dedent fa-fw text"></i>
          <!--   <i class="fa fa-indent fa-fw text-active"></i> -->
          </a>
</div>

						<ul class="nav navbar-nav agile-menu">
						 	<li id="homemenu" class="active"></li>
							<%
							    if ("admin".equals(domainUser.domain)) {
											out.println("<li><a href='#all-domain-users'><i class='icon-group'></i> All Domain Users</a></li></ul>");
											out.println("<ul class='nav navbar-nav pull-right' style='float:right!important;'><li class='nav-bar-search'>	<form id='domainSearchForm' class=' navbar-search'	style='margin: 5px;'>	<input id='domainSearchText' class='form-control pull-left' type='text' style='line-height: 17px;width:85%;'	data-provide='typeahead'		placeholder='Search'></input> <input id='domain-search-results' type='image' src='img/SearchIcon.png' class='searchbox pull-left m-xs p-t-xs' /><div class='clearfix'></div></form></li><li><a href="
													+ logoutURL
													+ "><i class='icon-off'></i>Logout</a></li>");
										} else {
							%>

							<%--
							<%
							
								for(NavbarConstants constant : domainUser.menu_scopes)
								{
							%>
								    <li id="<%=constant.id%>"><a href="<%=constant.href%>"><i
										class="<%=constant.icon%> icon-white"></i> <%=constant.heading%></a></li>
							<%
								}
							%>
							
							
							<%
							String css_classes = "";
							int size = domainUser.menu_scopes.size();
							if(size <=7)
							{
							    
							    css_classes = css_classes + " more-menu-hide-medium";
							}
							else
							{
							    css_classes = css_classes + " more-menu-show-medium";
							}
							if(size <= 4)
							{
							    css_classes = css_classes + " more-menu-hide-low";
							}
							else
							{
							    css_classes = css_classes + " more-menu-show-low";
							}
							
							
							    if (domainUser.menu_scopes.size() > 3) {
							%>
								<li id="more-menu" class="dropdown <%=css_classes%>"><a
									class="dropdown-toggle" data-toggle="dropdown" href=""> More
										<i class='caret'></i>
								</a>
								<%
							    } else
							    {
								%>
								<li id="more-menu" class="dropdown <%=css_classes%>"><a
									class="dropdown-toggle" data-toggle="dropdown" href=""> More
										<i class='caret'></i>
								</a>
							<%
							    }
							%>
								<ul class="dropdown-menu drop-drop">
									<%
								Iterator<NavbarConstants> iterator = domainUser.menu_scopes.iterator();
								int index = 0;
								for(NavbarConstants constant : domainUser.menu_scopes)
								{
								    
								    if(index < 2)
								    {
										++index;
										continue;
								    }
								    
							%>
								    <li  id="<%=constant.id%>"><a href="<%=constant.href%>"><i
										class="<%=constant.icon%> icon-white"></i> <%=constant.heading%></a></li>
							<%
								}
							%>
								</ul>
							</li> 
							--%>
							
						
								<li data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Calendar"><a href="#calendar"><i class="icon icon-calendar"></i> <span class="visible-xs">Calendar</span> </a></li>
								<li id="due_tasks"  data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Tasks"><a class="pos-rlt" href="#tasks"><i class="icon-list"></i>
									<span class="visible-xs">Tasks</span>

											<span title="Tasks due" class="navbar_due_tasks pull-right-xs"><span  id="due_tasks_count" class="badge badge-sm up bg-danger"></span></span></a></li>
								<li id="recent-menu" class="dropdown" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Activity"><a
								class="dropdown-toggle" data-toggle="dropdown" href=""> <i class='fa fa-history' style="opacity:0.8"></i>
								<span class="visible-xs">Recent Activity</span>
							</a><ul class="dropdown-menu animated fadeInRight recent-view" style="width:23em; right:-11px;"></ul>
							</li>  
                          <%
						   if(!MobileUADetector.isMobileOrTablet(request.getHeader("user-agent"))){
						  %>
							<li class="nav-bar-search">
								<form id="searchForm" class=" navbar-search  navbar-search navbar-form navbar-form-sm navbar-left shift">
					<div class="input-group">
							<input id="searchText" type="text"
										data-provide="typeahead"
										class="typeahead typeahead_contacts search-query form-control-custom input-sm bg-light no-border rounded padder"
										placeholder="Search">
										
										 <!-- <input id="search-results" 
										type="image" src="img/SearchIcon.png" class="searchbox hidden" /> -->
						<span class="input-group-btn">
                <button type="submit" class="btn btn-sm bg-light rounded" id="search-results" style="height:30px;"><i class="fa fa-search"></i></button>
              </span>
              </div>				
								</form>
							</li>
							<%}%>
						</ul>
  
 			<ul class="nav  navbar-nav  navbar-right show_shortcuts">	
						 	<li rel="popover" data-trigger="click" class="need_help hidden-xs" screen_name="Need Help? We are one click away." data-content="<div class='row' id='need_help_header'  style='color:#7D7474'>
									<div class='col-md-12 text-sm p-b-xs'>Need Help? We are one click away.</div>
								</div>
								<div class='row m-none' style='color:#7D7474'>
								<div class='pull-left inline-block' style='width:50%;border-right: 1px solid #E2E4E4;'>
								 <div class='p-r-none p-l-none'>
								  <div class='text-center'>
								   <div class='text-xs' style='margin-top:-2px;padding-bottom:2px;'><b><a href='https://our.agilecrm.com/calendar/Vikas,Mrudula,Shravi_Sharma,Bharat,Manish,Nick,Stephen' target='_blank' rep class='text-info'>Sales</a></b>
								   </div>
								  </div> 
							     </div>
							    </div>
							    <div class='pull-right' style='width:50%;border-left: 1px solid #FFFFFF;'>
								 <div class='p-r-none p-l-none'>
								  <div class=' text-center text-xs'  style='margin-top:-2px;padding-bottom:2px;'><b><a href='https://our.agilecrm.com/calendar/Haaris_farooqi,Khader' target='_blank' rep class='text-info'>Support</a></b>
								  </div>
								 </div>
								</div><div class='clearfix'></div>
							    </div>" data-original-title="" title="">
							     <a href="#" onclick="return false;"><i class="fa fa-question-circle"></i></a>			
                                                        </li>
							     
							    
							
						 <%
                               if(request.getHeader("User-Agent").indexOf("Mobile") == -1) {

                        %>
                             <li class="hidden-xs" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Full Screen"><a  class="enable-element-full-screen"><span class="fa fa-arrows-alt"></span></a></li>
                        <%
                               }
						%>
						
									
							<li class="dropdown" id="menu1"><a class="dropdown-toggle"
								data-toggle="dropdown" href="">New <b class="caret"></b></a>
								<ul class="dropdown-menu animated fadeInRight">
									<li><a href="#personModal"  class="person" id="person">
											<div class="pull-left">Contact</div><div class='pull-right shortcuts'>Shift + N</div><div class="clearfix"></div></a></li>
									<li><a href="#companyModal"  data-toggle="modal"
										id="company"> <div class="pull-left">Company</div><div class='pull-right shortcuts'>Shift + C</div><div class="clearfix"></div></a></li>
									<li><a href="#"  id="show-activity"> <div class="pull-left">Event</div><div class='pull-right shortcuts'>Shift + V</div><div class="clearfix"></div></a></li>
									<li><a href="#" class=" add-task"> <div class="pull-left">Task</div><div class='pull-right shortcuts'>Shift + T</div><div class="clearfix"></div></a></li>

									<%
										if(domainUser.menu_scopes.contains(NavbarConstants.DEALS)){
									%>
									<li><a href="#" class="font-bold deals-add"> <div class="pull-left">Deal</div><div class='pull-right shortcuts'>Shift + D</div><div class="clearfix"></div></a></li>
									<%
										}
									%>
									<li><a href="#" id="show-note"> <div class="pull-left">Note</div><div class='pull-right shortcuts'>Shift + O</div><div class="clearfix"></div></a></li>
									<li><a href="#send-email"> <div class="pull-left">Email</div><div class='pull-right shortcuts'>Shift + M</div><div class="clearfix"></div></a></li>
								</ul> <!-- 
							<img style='display:hidden' id='ajax'
								src='img/ajax-loader.gif' />
								--></li>

							<li id="fat-menu" class="dropdown">
							<a href="" class="dropdown-toggle" data-toggle="dropdown"><!-- <i
									class="agilecrm-profile-dropdown"></i> -->
<span class="thumb-sm avatar pull-right m-t-n-sm m-b-n-sm m-l-sm">
				<%	if (!StringUtils.isEmpty(currentUserPrefs.pic))
							out.println("<img src='"
							+ currentUserPrefs.pic
							+ "' alt='...'  style='width:40px;height:40px;'></img>");
					else
							out.println("<img src='img/gravatar.png'  alt='...'></img>");
				%>
               
               
              </span>
              <div class="pull-left text-ellipsis w-auto hidden-sm hidden-md" style="max-width:150px;"><span class="hidden-sm hidden-md"><%=domainUser.name%></span></div>
              <b class="caret"></b>									
									 </a>
								<ul class="dropdown-menu animated fadeInRight w">
									<li><a href='#user-prefs' class="b-b">
											<%-- <%
											    if (!StringUtils.isEmpty(currentUserPrefs.pic))
																out.println("<img src='"
																		+ currentUserPrefs.pic
																		+ "'style='padding:2px !important' class='thumbnail m-b-none thumb-xxs m-r-xs inline'></img>");
															else
																out.println("<img src='img/gravatar.png' style='padding:2px !important' class='thumbnail m-b-none thumb-xxs m-r-xs inline'></img>");
											%> --%> <span class="text-sm m-r-md"> <b><%=user.getEmail()%></b></span>

									</a></li>

									<li><a href="#user-prefs"><!-- <i class="icon-cog"></i> -->

											<div class="pull-left">Preferences</div><div class='pull-right shortcuts'>Shift + P</div><div class="clearfix"></div></a></li>

									<%
									    if (domainUser != null && domainUser.is_admin)
									    {
														out.print("<li><a href='#account-prefs'><div class='pull-left'>Admin Settings</div><div class='pull-right shortcuts'>Shift + A</div><div class='clearfix'></div></a></li>");
													//	out.println("<li><a href='#subscribe'><i class='icon-shopping-cart'></i> Plan & Upgrade</a></li>");
									    }
									%>
									<li><a href="#themeandlayout"><!-- <i class="icon-off"></i> -->
											<div class="pull-left">Theme & Layout</div><div class='pull-right shortcuts'>Shift + L</div><div class="clearfix"></div></a></li>
									<li class="divider"></li>
									<li><a href="#subscribe"><!-- <i class="icon-cog"></i> -->
											<div class="pull-left">Upgrade</div><div class='pull-right shortcuts'>Shift + U</div><div class="clearfix"></div></a></li>
									<li><a href="https://www.agilecrm.com/product-updates" target="_blank"><!-- <i class="icon-off"></i> -->
											<div class="pull-left">Product Updates</div><div class='pull-right shortcuts'>Shift + R</div><div class="clearfix"></div></a></li>
									<li><a href="#help"><!-- <i class="icon-off"></i> -->
											<div class="pull-left">Help</div><div class='pull-right shortcuts'>Shift + H</div><div class="clearfix"></div></a></li>
									<!-- <li><a href="https://www.agilecrm.com/support.html" target="_blank"><i class="icon-facetime-video"></i> Help
											Videos</a></li>
								 	<li><a href="#" onclick="$('li#fat-menu').removeClass('open');clickdesk_show_livechat_popup();"><i class="icon-comment"></i> Live Chat</a></li>  -->
									<!-- <li><a href="#help"><i class="icon-question"></i>
											Help</a></li> -->
									<li class="divider"></li>
									<li><a href="<%=logoutURL%>"><!-- <i class="icon-off"></i> -->
											<div class="pull-left">Logout</div><div class='pull-right shortcuts'>Shift + G</div><div class="clearfix"></div></a></li>

								</ul></li>
							<%
							    }
							%>
						</ul>
					</div>
					</header>
					<!--/.nav-collapse -->
			
		
		
		
