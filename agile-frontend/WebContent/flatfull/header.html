<%@page import="java.util.Iterator"%>
<%@page import="com.agilecrm.account.NavbarConstants"%>
<%@page import="com.agilecrm.account.MenuSetting"%>
<%@page import="com.agilecrm.account.util.MenuSettingUtil"%>
<%@page import="com.agilecrm.user.util.DomainUserUtil"%>
<%@page import="com.agilecrm.session.UserInfo"%>
<%@page import="com.agilecrm.session.SessionManager"%>
<%@page import="com.agilecrm.user.DomainUser"%>
<%@page import="com.agilecrm.user.UserPrefs"%>
<%@page import="com.agilecrm.user.util.UserPrefsUtil"%>
<%@page import="org.codehaus.jackson.map.ObjectMapper"%>
<%@page import="com.agilecrm.subscription.restrictions.db.util.BillingRestrictionUtil"%>
<%@page import="com.agilecrm.subscription.restrictions.db.BillingRestriction"%>
<%@page import="org.apache.commons.lang.StringUtils"%>
<%@page import="com.agilecrm.util.MobileUADetector"%>
<%@page import="com.agilecrm.user.access.UserAccessScopes"%>
<%

			System.out.println("Domain user " + domainUser);
			
			String logoutURL = "/login?sur=true";
			UserInfo user = SessionManager.get();
		
%>

<style type="text/css">
.background-img-sales{
  background: url("https://doxhze3l6s7v9.cloudfront.net/img/menu-service-icons-sprite.png") no-repeat;
  background-position: 0 0px;
  border: 0 none;'
}
.background-img-marketing{
  background: url("https://doxhze3l6s7v9.cloudfront.net/img/menu-service-icons-sprite.png") no-repeat;
  display: inline-block;
  background-position: 49% 0px;
}
.background-img-service{
   background: url("https://doxhze3l6s7v9.cloudfront.net/img/menu-service-icons-sprite.png") no-repeat;
   background-position: 98% 0px;
}
.agile-theme-15 li.help-icon > a:hover,.agile-theme-15 li.help-icon > a:focus{
color: #78909c !important;
}

</style>

<header id="header" class="app-header navbar" role="menu">

		
			
				<div class="navbar-header 
				<%
				 	switch (Integer.parseInt(currentUserPrefs.theme)) {
				 		case 1:  out.print("bg-black ");
				   				 break;
				 		case 2:  out.print("bg-white-only ");
								 break;
				 		case 3:  out.print("bg-primary ");
								 break;
				 		case 4:  out.print("bg-info ");
								 break;
				 		case 5:  out.print("bg-success ");
								 break;
				 		case 6:  out.print("bg-danger ");
								 break;
				 		case 7:  out.print("bg-black ");
								 break;
				 		case 8:  out.print("bg-info dker ");
								 break;
				 		case 9:  out.print("bg-primary ");
								 break;
				 		case 10:  out.print("bg-info dker ");
								 break;
				 		case 11:  out.print("bg-success ");
								 break;
				 		case 12:  out.print("bg-danger dker ");
								 break;
				 		case 13:  out.print("bg-dark ");
								 break;
				 		case 14:  out.print("bg-dark ");
								 break;
						case 15:  out.print("bg-white ");
								 break;
				 		default:
				        		break;
				 
				 	}
				  		
				 %>">
				 
				 	 <button class="pull-right hide dk" id="mobile-menu-settings"  ui-toggle-class="show" data-target=".navbar-collapse">
          <i class="glyphicon glyphicon-cog"></i>
        </button>

          <button class="pull-left visible-xs" id="mobile-menu" ui-toggle-class="off-screen" data-target=".app-aside" ui-scroll-to="app">
          <i class="glyphicon glyphicon-align-justify"></i>
        </button>
        <li class="dropdown hide add-modal-mobile visible-xs pull-right wrapper-sm p-t p-r-md" id="menu1"><a class="dropdown-toggle"data-toggle="dropdown" href=""><i class="icon-plus"></i></a>
                <ul class="dropdown-menu  animated fadeInRight mobile-add-modals" role="menu">
                  <li><a href="#personModal"  class="person" id="person">
                      <div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "contacts")%></div><div class='pull-right shortcuts'>Shift + N</div><div class="clearfix"></div></a></li>
                  <li><a href="#companyModal"  data-toggle="modal"
                    id="company"> <div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "company")%></div><div class='pull-right shortcuts'>Shift + C</div><div class="clearfix"></div></a></li>
                     <%
                    if(domainUser.menu_scopes.contains(NavbarConstants.DEALS)){
                  %>
                  <li><a href="#" class="font-bold deals-add"> <div class="pull-left">Deal</div><div class='pull-right shortcuts'>Shift + D</div><div class="clearfix"></div></a></li>
                  <%
                    }
                  %>
                  <li><a href="#"  id="show-activity"> <div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "event") %></div><div class='pull-right shortcuts'>Shift + V</div><div class="clearfix"></div></a></li>
                  <li><a href="#" class=" add-task"> <div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "task") %></div><div class='pull-right shortcuts'>Shift + T</div><div class="clearfix"></div></a></li>

                 
                  <li><a href="#" id="show-note"> <div class="pull-left">Note</div><div class='pull-right shortcuts'>Shift + O</div><div class="clearfix"></div></a></li>
                  <li><a href="#send-email"> <div class="pull-left">Email</div><div class='pull-right shortcuts'>Shift + M</div><div class="clearfix"></div></a></li>
                  <li><a href="javascript:void(0);" onclick="App_Ticket_Module.renderNewTicketModalView();"> <div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "ticket") %></div><div class="clearfix"></div></a></li>
                </ul> <!-- 
              <img style='display:hidden' id='ajax'
                src='img/ajax-loader.gif' />
                --></li>

        <%
				      if(MobileUADetector.isMobile(request.getHeader("user-agent"))){
				   %>
		        <li class="pull-right list-none">
					<div class="dropdown m-l-sm navbar-searchicon searchicon-dropdown">
					<button class="fa fa-search text-base p-n btn1 btn-sm dropdown-toggle no-shadow bg-transparent b-n show-search-dropdown" type="button"></button>
					<ul class="dropdown-menu search-view animated fadeInRight agile-search mobile-search-view pos-r-0" style="left:auto">
							<div class="pos-abs search-close" data-toggle="tooltip" data-placement="bottom" title="Close" style="right: 6px;top:-1px;z-index:1;color: #363f44!important;">
							<span class="c-p" style="font-size:15px;">&times;</span>
						</div>
					<div class="col-sm-12">

					<form class=" m-t-sm m-b-sm searchForm" id="searchForm" role="search">
					<div class="input-group add-on">
					<input type="text" id="searchText" data-provide="typeahead"
										class="typeahead form-control r-5x typeahead_contacts form-control-custom"
										placeholder='<%=LanguageUtil.getLocaleJSONValue(localeJSON, "search")%>' onclick="Agile_GA_Event_Tracker.track_event('Search option in Nav Bar')">
					<div class="input-group-btn">

					<a class="btn btn-default no-shadow" href="#" id="speechDectation"src="https://i.imgur.com/cHidSVu.gif"  ><i class="icon-microphone" style="position: relative;"></i></a>

					<button class="btn btn-default no-shadow r-5x" id="search-results" type="submit"><i class="fa fa-search"></i></button>
					</div>
					</div>
					</form>

					</div>

					



					<li>
					<ul class="col-sm-12 list-none search-filters" id="advanced-search-fields-group" name="fields_set">
					<li>
		       		  		<a href="javascript:void(0);" class="p-b-none">
								<label class="i-checks i-checks-sm searchtypeall "><input name="all" value = "" type="checkbox" class="choose-column-chbx"><i></i></label><%=LanguageUtil.getLocaleJSONValue(localeJSON, "all")%></a>
					</li>

					<!-- <li>
   		  			<a href="javascript:void(0);" class="p-b-none">
						<label class="i-checks i-checks-sm  searchtype"><input name="lead" value = "lead" type="checkbox" class="choose-column-chbx"><i></i></label><%=LanguageUtil.getLocaleJSONValue(localeJSON, "menu-leads")%></a>
					</li> -->

					<li>
   		  			<a href="javascript:void(0);" class="p-b-none">
						<label class="i-checks i-checks-sm  searchtype"><input name="person" value = "person" type="checkbox" class="choose-column-chbx"><i></i></label><%=LanguageUtil.getLocaleJSONValue(localeJSON, "contacts")%></a>
					</li>

					<li>
					<a href="javascript:void(0);" class="p-b-none">
								<label class="i-checks i-checks-sm  searchtype"><input name="company" value = "company" type="checkbox" class="choose-column-chbx"><i></i></label><%=LanguageUtil.getLocaleJSONValue(localeJSON, "companies")%></a>
					</li>

					<li>
					<a href="javascript:void(0);" class="p-b-none">
								<label class="i-checks i-checks-sm  searchtype"><input name="opportunity" value = "opportunity" type="checkbox" class="choose-column-chbx"><i></i></label><%=LanguageUtil.getLocaleJSONValue(localeJSON, "deals")%></a>
					</li>

					<li>
					<a href="javascript:void(0);" class="p-b-none">
								<label class="i-checks i-checks-sm  searchtype"><input name="document" value = "document" type="checkbox" class="choose-column-chbx"><i></i></label><%=LanguageUtil.getLocaleJSONValue(localeJSON, "documents")%></a>
					</li>

					<li>
					<a href="javascript:void(0);" class="p-b-none">
								<label class="i-checks i-checks-sm  searchtype"><input name="tickets" value = "tickets" type="checkbox" class="choose-column-chbx"><i></i></label><%=LanguageUtil.getLocaleJSONValue(localeJSON, "tickets")%></a>

					</li>
                			
                	</ul>
          
					</li>

					</ul>
					</div>
					</li>
		<%
			}
		%>
		<img class='hide' src='https://doxhze3l6s7v9.cloudfront.net/img/menu-service-icons-sprite.png'></img>
        <div rel="popover" data-custom-popover-class='grid_custom_popover' data-trigger="click"  data-original-title="" title="" data-placement="bottom" class="need_help grid_icon_center visible-xs" screen_name="Need Help? We are one click away." data-content="<div class='row' id='need_help_header'>
									<ul class='col-xs-12 col-sm-12 grid-sub-nav text-center m-t-md p-l-md p-r-md'>
										
								<li class='pull-left m-b-sm'><a href='#' class='menu-service-select' data-service-name='SALES' data-dashboard='dashboard'><i class='thumb  background-img-sales'></i><span class='block'><%=LanguageUtil.getLocaleJSONValue(localeJSON, "sales") %></span></a></li>

								<li class='pull-left m-b-sm'><a href='#' class='menu-service-select' data-service-name='MARKETING' data-dashboard='MarketingDashboard  '><i class='thumb background-img-marketing'></i> <span class='block'><%=LanguageUtil.getLocaleJSONValue(localeJSON, "menu-marketing") %></span></a></li>

								<li class='pull-left m-b-sm'><a href='#' class='menu-service-select' data-service-name='SERVICE' data-dashboard='dashboard'><i class='thumb  background-img-service'></i> <span class='block'><%=LanguageUtil.getLocaleJSONValue(localeJSON, "service") %></span></a></li>

								</ul>
								</div>
								
							    </div>">
							     <a href="#" class='grid-icon-header block wrapper' onclick="return false;"><i class="glyphicon glyphicon-th"></i></a>		
							 </div>

         

                

                 
             


				
			
        
       
				   <%
				      if(MobileUADetector.isMobile(request.getHeader("user-agent"))){
				   %>
				    <a class="navbar-brand font-bold text-lt p-l-none" href="#">   
				   <%
				      }else {
				   %>

					<a href="#navigate-dashboard" id="app-aside-folded" style="top:8px;" class="p-l-sm inline-block pos-rlt pos-t-xs no-shadow" ui-toggle="app-aside-folded">
					<i class="fa fa-dedent fa-fw text"></i>
					<i class="material-icons" style="display:none;color: #409de4;">cloud</i>
					<!--   <i class="fa fa-indent fa-fw text-active"></i> -->
					</a>

				    <a class="navbar-brand font-bold text-lt" href="#navigate-dashboard">
				   <%
				      }
				   %>
				    
				    
				    <i class="fa fa-cloud hidden-xs"></i>
				    <i class="material-icons newtheme-cloud hidden-xs" style="display:none;">cloud</i>
				     <span class="hidden-folded m-l-xs"> <%=LanguageUtil.getLocaleJSONValue(localeJSON, "agile-crm") %> </span></a>     

</div>
					<div id="navbar" class="collapse pos-rlt hide-xs  navbar-collapse box-shadow   
					
					<%
				 	switch (Integer.parseInt(currentUserPrefs.theme)) {
				 		case 1:  out.print("bg-white-only ");
				   				 break;
				 		case 2:  out.print("bg-white-only ");
								 break;
				 		case 3:  out.print("bg-white-only ");
								 break;
				 		case 4:  out.print("bg-white-only ");
								 break;
				 		case 5:  out.print("bg-white-only ");
								 break;
				 		case 6:  out.print("bg-white-only ");
								 break;
				 		case 7:  out.print("bg-black ");
								 break;
				 		case 8:  out.print("bg-info dker ");
								 break;
				 		case 9:  out.print("bg-primary ");
								 break;
				 		case 10:  out.print("bg-info dk ");
								 break;
				 		case 11:  out.print("bg-success ");
								 break;
				 		case 12:  out.print("bg-danger dker ");
								 break;
				 		case 13:  out.print("bg-white-only ");
								 break;
				 		case 14:  out.print("bg-dark ");
								 break;
						case 15:  out.print("bg-white ");
								 break;
				 		default:
				        		break;
				 
				 	}
				  		
				 %>">

				 <%
				      if(!MobileUADetector.isMobile(request.getHeader("user-agent"))){
				   %>

					<!--  <div class="nav navbar-nav hidden-xs">
<a href="#" id="app-aside-folded" style="top:8px;" class="p-b-sm p-l-sm p-r-sm inline-block pos-rlt pos-t-xs  no-shadow navbar-btn" ui-toggle="app-aside-folded" target=".app">
            <i class="fa fa-dedent fa-fw text"></i>
          </a>
</div>  -->

					<ul class="nav navbar-nav agile-menu">
					<li>
					<div class="dropdown m-l-sm navbar-searchicon searchicon-dropdown">
					<button class="fa fa-search text-base p-n btn1 btn-sm dropdown-toggle no-shadow bg-transparent b-n show-search-dropdown" type="button"></button>
					<ul class="dropdown-menu search-view animated fadeInRight agile-search">
						<div class="pos-abs search-close" data-toggle="tooltip" data-placement="bottom" title="Close" style="right:6px;top:-1px;z-index:1;color: #363f44!important;">
							<span class="c-p" style="font-size:15px;">&times;</span>
						</div>
					<div class="col-sm-12">

					<form class=" m-t-sm m-b-sm" id="searchForm" role="search">
					<div class="input-group add-on">
					<input type="text" id="searchText" data-provide="typeahead"
										class="typeahead form-control r-5x typeahead_contacts form-control-custom"
										placeholder='<%=LanguageUtil.getLocaleJSONValue(localeJSON, "search")%>' onclick="Agile_GA_Event_Tracker.track_event('Search option in Nav Bar')">
					<div class="input-group-btn">

					<a class="btn btn-default no-shadow" href="#" id="speechDectation"src="https://i.imgur.com/cHidSVu.gif"  ><i class="icon-microphone" style="position: relative;"></i></a>

					<button class="btn btn-default no-shadow r-5x" id="search-results" type="submit"><i class="fa fa-search"></i></button>
					</div>
					</div>
					</form>

					</div>

					



					<li>
					<ul class="col-sm-12 list-none search-filters" id="advanced-search-fields-group" name="fields_set">
					<li>
		       		  		<a href="javascript:void(0);" class="p-b-none">
								<label class="i-checks i-checks-sm searchtypeall "><input name="all" value = "" type="checkbox" class="choose-column-chbx"><i></i></label><%=LanguageUtil.getLocaleJSONValue(localeJSON, "all")%></a>
					</li>
	                
					<!-- <li>
   		  			<a href="javascript:void(0);" class="p-b-none">
						<label class="i-checks i-checks-sm  searchtype"><input name="lead" value = "lead" type="checkbox" class="choose-column-chbx"><i></i></label><%=LanguageUtil.getLocaleJSONValue(localeJSON, "menu-leads")%></a>
					</li> -->

					<li>
   		  			<a href="javascript:void(0);" class="p-b-none">
						<label class="i-checks i-checks-sm  searchtype"><input name="person" value = "person" type="checkbox" class="choose-column-chbx"><i></i></label><%=LanguageUtil.getLocaleJSONValue(localeJSON, "contacts")%></a>
					</li>

					<li>
					<a href="javascript:void(0);" class="p-b-none">
								<label class="i-checks i-checks-sm  searchtype"><input name="company" value = "company" type="checkbox" class="choose-column-chbx"><i></i></label><%=LanguageUtil.getLocaleJSONValue(localeJSON, "companies")%></a>
					</li>

					<li>
					<a href="javascript:void(0);" class="p-b-none">
								<label class="i-checks i-checks-sm  searchtype"><input name="opportunity" value = "opportunity" type="checkbox" class="choose-column-chbx"><i></i></label><%=LanguageUtil.getLocaleJSONValue(localeJSON, "deals")%></a>
					</li>

					<li>
					<a href="javascript:void(0);" class="p-b-none">
								<label class="i-checks i-checks-sm  searchtype"><input name="document" value = "document" type="checkbox" class="choose-column-chbx"><i></i></label><%=LanguageUtil.getLocaleJSONValue(localeJSON, "documents")%></a>
					</li>

					<li>
					<a href="javascript:void(0);" class="p-b-none">
								<label class="i-checks i-checks-sm  searchtype"><input name="tickets" value = "tickets" type="checkbox" class="choose-column-chbx"><i></i></label><%=LanguageUtil.getLocaleJSONValue(localeJSON, "tickets")%></a>

					</li>
                			
                	</ul>
          
					</li>

					</ul>
					</div>
					</li>
					
					<li id="homemenu" class="active"></li>

					

				<%
				      }
				   %>

                <!--<img onclick="startDictation()" src="https://i.imgur.com/cHidSVu.gif" class="btn btn-sm bg-light" style="width:30px;height:30px;padding:0px">-->
               
							


						 	<!--<li id="homemenu" class="active"></li>-->
							
							    <%
                  if ("admin".equals(domainUser.domain)) 
                  {
                	
                	out.println("<li><a href='#all-domain-users'><i class='icon-group'></i> All Domain Users</a></li>");
                	
                	if(domainUser.adminPanelAccessScopes !=null && domainUser.adminPanelAccessScopes.contains(AdminPanelAccessScopes.AFFILIATES))
                  	{
                  	out.println("<li><a href='#admin-affiliate'>Affiliates</a></li>");
                  	}
                  	if(domainUser.adminPanelAccessScopes !=null && domainUser.adminPanelAccessScopes.contains(AdminPanelAccessScopes.VIEW_LOGS))
                  	{
                  	out.println("<li><a href='#activities'>Logs</a></li>");
                  	}
                  	out.println("</ul><ul class='nav navbar-nav pull-right' style='float:right!important;'><li class='nav-bar-search'> <form id='domainSearchForm' class=' navbar-search'  style='margin: 5px;'> <input id='domainSearchText' class='form-control pull-left' type='text' style='line-height: 17px;width:85%;'  data-provide='typeahead'    placeholder='Search'></input> <input id='domain-search-results' type='image' src='img/SearchIcon.png' class='searchbox pull-left m-xs p-t-xs' /><div class='clearfix'></div></form></li>");
                  	 out.println("<li class='pull-right'><div class='m-t-xs'><span class=' dropdown-toggle' data-toggle='dropdown' ><a style='background: transparent;border: 0px;'>");
                    if (!StringUtils.isEmpty(currentUserPrefs.pic))
                        out.println("<img height='35' width='35' style='border-radius: 50%;margin-left: 20px;' src='"+ domainUser.pic+ "' alt='...' class='pos-rlt pos-t-xs'></img>");
                    else
                      out.println("<img height='35' width='35' style='border-radius: 50%;margin-left: 20px;' src='img/gravatar.png'  alt='...'></img>");
                      out.println("</a></span><ul class='dropdown-menu m-t-sm' style='right: 0;left: auto;'><li><a href='#user-prefs' class='b-b p-r-none'><div class='pull-left text-ellipsis w-auto hidden-sm hidden-md' style='max-width:210px;clear: both;''><span class='hidden-sm hidden-md text-head-black'>"+SafeHtmlUtil.sanitize(domainUser.name)+"</span></div><span class='text-sm text-ellipsis block' style='clear: both;''> <b>"+user.getEmail()+"</b></span></a></li>");
                      out.println("<li><a href="+logoutURL+"><i class='icon-off'></i>Logout</a></li></ul></div></li>");
                    if(domainUser.adminPanelAccessScopes !=null && domainUser.adminPanelAccessScopes.contains(AdminPanelAccessScopes.ADD_USER))
                  	{
                  		out.println("<li style='margin-top: 15px;'><div class='btn-group'><a href='#users-add' class=''><i class='icon-plus-sign'></i> Add User</a>");
                  		out.println("<button class=' dropdown-toggl adduseradminpanel' data-toggle='dropdown' style='background: transparent;border: 0px;'><span class='caret'></span></button><ul class='dropdown-menu pull-right' role='menu'><li><a href='#users'>All Users</a></li></ul>");
                  		out.println("</div></li>");
                  	}
                  
                  } else {
              %>
              		<%--
							
							<%
							
								for(NavbarConstants constant : domainUser.menu_scopes)
								{
							%>
								    <li id="<%=constant.id%>"><a href="<%=constant.href%>"><i
										class="<%=constant.icon%> icon-white"></i> <%=constant.heading%></a></li>
							<%
								}
							%>
							
							
							<%
							String css_classes = "";
							int size = domainUser.menu_scopes.size();
							if(size <=7)
							{
							    
							    css_classes = css_classes + " more-menu-hide-medium";
							}
							else
							{
							    css_classes = css_classes + " more-menu-show-medium";
							}
							if(size <= 4)
							{
							    css_classes = css_classes + " more-menu-hide-low";
							}
							else
							{
							    css_classes = css_classes + " more-menu-show-low";
							}
							
							
							    if (domainUser.menu_scopes.size() > 3) {
							%>
								<li id="more-menu" class="dropdown <%=css_classes%>"><a
									class="dropdown-toggle" data-toggle="dropdown" href=""> More
										<i class='caret'></i>
								</a>
								<%
							    } else
							    {
								%>
								<li id="more-menu" class="dropdown <%=css_classes%>"><a
									class="dropdown-toggle" data-toggle="dropdown" href=""> More
										<i class='caret'></i>
								</a>
							<%
							    }
							%>
								<ul class="dropdown-menu drop-drop">
									<%
								Iterator<NavbarConstants> iterator = domainUser.menu_scopes.iterator();
								int index = 0;
								for(NavbarConstants constant : domainUser.menu_scopes)
								{
								    
								    if(index < 2)
								    {
										++index;
										continue;
								    }
								    
							%>
								    <li  id="<%=constant.id%>"><a href="<%=constant.href%>"><i
										class="<%=constant.icon%> icon-white"></i> <%=constant.heading%></a></li>
							<%
								}
							%>
								</ul>
							</li> 
							--%>
							
								<%
								      if(!domainUser.restricted_menu_scopes.contains(NavbarConstants.CALENDAR)){
								%>	
								<!-- <li data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Calendar"><a href="#calendar" onclick="Agile_GA_Event_Tracker.track_event('Calendar Option in Nav Bar')"><i class="icon icon-calendar"></i> <span class="visible-xs">Calendar</span> </a></li> -->
								<%
								      }
								%>
								<%
								      if(!domainUser.restricted_menu_scopes.contains(NavbarConstants.CALENDAR)){
								%>	
								<!-- <li id="due_tasks"  data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Tasks"><a class="pos-rlt" href="#tasks" onclick="Agile_GA_Event_Tracker.track_event('Tasks Option in Nav Bar')"><i class="icon-list"></i>
									<span class="visible-xs">Tasks</span>

											<span title="Tasks due" class="navbar_due_tasks pull-right-xs"><span  id="due_tasks_count" class="badge badge-sm up bg-danger"></span></span></a></li> -->
								<%
								      }
								%>
								<!-- <li id="recent-menu" class="dropdown" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Activity"><a
								class="dropdown-toggle" data-toggle="dropdown" href=""> <i class='fa fa-history' style="opacity:0.8"></i>
								<span class="visible-xs">Recent Activity</span>
							</a><ul class="dropdown-menu animated fadeInRight recent-view" style="width:23em; right:-11px;"></ul>
							</li>   -->
                          <%
						   if(!MobileUADetector.isMobile(request.getHeader("user-agent"))){
						  %>
							<!--<li class="nav-bar-search">
								<form id="searchForm" class=" navbar-search  navbar-search navbar-form navbar-form-sm navbar-left shift">
					<div class="input-group">
							<input id="searchText" type="text"
										data-provide="typeahead"
										class="typeahead typeahead_contacts search-query form-control-custom input-sm bg-light no-border rounded padder"
										placeholder="Search">
										
										 <!-- <input id="search-results" 
										type="image" src="img/SearchIcon.png" class="searchbox hidden" /> 
						<span class="input-group-btn">
                <button type="submit" class="btn btn-sm bg-light rounded" id="search-results" style="height:30px;"><i class="fa fa-search"></i></button>
              </span>
              </div>				
								</form>
							</li>-->
							<%}%>
						</ul>


						
 			<ul class="nav  navbar-nav  navbar-right show_shortcuts">


                                        <!-- <li rel="popover" data-trigger="click" class="need_help hidden-xs" data-placement="left" screen_name="Need Help? We are one click away." data-content="<div class='row' id='need_help_header'  style='color:#7D7474'>
									<div class='col-md-12 text-sm p-b-xs'>Need Help? We are one click away.</div>
								</div>
								<div class='row m-none' style='color:#7D7474'>
								<div class='pull-left inline-block' style='width:50%;border-right: 1px solid #E2E4E4;'>
								 <div class='p-r-none p-l-none'>
								  <div class='text-center'>
								   <div class='text-xs' style='margin-top:-2px;padding-bottom:2px;'><b><a href='http://salescal.agilecrm.com' target='_blank' rep class='text-info ga-track-event' data-ga-text='Demo Sales from Dashboard'>Sales</a></b>
								   </div>
								  </div> 
							     </div>
							    </div>
							    <div class='pull-right' style='width:50%;border-left: 1px solid #FFFFFF;'>
								 <div class='p-r-none p-l-none'>
								  <div class=' text-center text-xs'  style='margin-top:-2px;padding-bottom:2px;'><b><a href='http://supportcal.agilecrm.com' target='_blank' rep class='text-info ga-track-event' data-ga-text='Demo Support from Dashboard'>Support</a></b>
								  </div>
								 </div>
								</div><div class='clearfix'></div>
							    </div>" data-original-title="" title="">
							     <a href="#" onclick="return false;"><i class="icon-question"></i></a>			

                                                        </li> -->

                             <!--  <li class="support-help-icon" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Help"><a href="https://www.agilecrm.com/support" target="_blank"><i class='fa fa-question-circle text-md'></i></a></li> -->
                             
						     <li id="recent-menu" class="dropdown" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="<%=LanguageUtil.getLocaleJSONValue(localeJSON, "recent") %>"><a
								class="dropdown-toggle" data-toggle="dropdown" href="" onclick="Agile_GA_Event_Tracker.track_event('Activity Option in Nav Bar')"> <i class='icon-clock'></i>
								<i class='material-icons' style="display: none;">history</i>
								<span class="visible-xs"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "recent-activity") %></span>
							</a><ul class="dropdown-menu animated fadeInRight recent-view" style="width:23em; right:-11px;"></ul>
							</li>  
									
							<li class="dropdown" id="menu1">
						    <li>
										<a class="dropdown-toggle p-l-xs"
								data-toggle="dropdown" href="" onclick="Agile_GA_Event_Tracker.track_event('New Option in Nav Bar')"><span class="m-r-xs pull-left" style="margin-top:1px;"><span><%=LanguageUtil.getLocaleJSONValue(localeJSON, "menu-add") %></span> 
								</span><i class="caret" style="margin-top:-2px;"></i></a>
								<ul class="dropdown-menu animated fadeInRight" role="menu">
									 <%
								      if(domainUser.restricted_scopes == null || !domainUser.restricted_scopes.contains(UserAccessScopes.CREATE_CONTACT)){
								    %>
								    <!-- <li><a href="#" id="lead">
											<div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "menu-lead") %></div> --><!-- <div class='pull-right shortcuts'>Shift + N</div> --><!-- <div class="clearfix"></div></a></li> -->
									<li><a href="#personModal"  class="person" id="person">
											<div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "contact") %></div><div class='pull-right shortcuts'>Shift + N</div><div class="clearfix"></div></a></li>
									<li><a href="#companyModal"  data-toggle="modal"
										id="company"> <div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "company") %></div><div class='pull-right shortcuts'>Shift + C</div><div class="clearfix"></div></a></li>
									<%
								          }
								    %> 
									
									
										<%
										if(domainUser.menu_scopes.contains(NavbarConstants.DEALS) &&          !domainUser.restricted_menu_scopes.contains(NavbarConstants.DEALS)){
									%>
									<li><a href="#" class="font-bold deals-add"> <div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "deal") %></div><div class='pull-right shortcuts'>Shift + D</div><div class="clearfix"></div></a></li>
									<%
										}
									%>
									<li><a href="#"  id="show-activity"> <div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "event") %></div><div class='pull-right shortcuts'>Shift + V</div><div class="clearfix"></div></a></li>
									<li><a href="#" class=" add-task"> <div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "task") %></div><div class='pull-right shortcuts'>Shift + T</div><div class="clearfix"></div></a></li>

									
									<li><a href="#" id="show-note"> <div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "note") %></div><div class='pull-right shortcuts'>Shift + O</div><div class="clearfix"></div></a></li>
									<li><a href="#send-email"> <div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "email") %></div><div class='pull-right shortcuts'>Shift + M</div><div class="clearfix"></div></a></li>
									<%if(domainUser.menu_scopes.contains(NavbarConstants.HELPDESK)){%>
									  <li><a href="javascript:void(0);" onclick="App_Ticket_Module.renderNewTicketModalView();"> <div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "ticket") %></div><div class='pull-right shortcuts'>Shift + K</div><div class="clearfix"></div></a></li>
								    <%}%>
									<li><a href="#" class="show-dialler"> <div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "call") %></div><div class='pull-right shortcuts'>Shift + Q</div><div class="clearfix"></div></a></li>
								</ul> <!-- 
							<img style='display:hidden' id='ajax'
								src='img/ajax-loader.gif' />
								--></li>
							
							</li>

							<li id="fat-menu" class="dropdown">

							<a href="" class="dropdown-toggle clear" data-toggle="dropdown"><!-- <i
									class="agilecrm-profile-dropdown"></i> -->
<span class="thumb-small avatar pull-right m-t-n-sm">
				<%	if (!StringUtils.isEmpty(currentUserPrefs.pic))
							out.println("<img src='"
							+ domainUser.pic
							+ "' alt='...' class='pos-rlt pos-t-xs'></img>");
					else
							out.println("<img src='img/gravatar.png'  alt='...'></img>");
				%>
               
               
              </span>
              <!-- <div class="pull-left text-ellipsis w-auto hidden-sm hidden-md" style="max-width:150px;"><span class="hidden-sm hidden-md"><%=SafeHtmlUtil.sanitize(domainUser.name)%></span></div>
              <b class="caret"></b> -->									
									 </a>
								<ul class="dropdown-menu animated fadeInRight w" role="menu">
									<li>
										<a href='#user-prefs' class="b-b p-r-none username">
											<div class="pull-left text-ellipsis w-auto hidden-sm hidden-md" style="max-width:210px;clear: both;"><span class="hidden-sm hidden-md text-head-black"><%=SafeHtmlUtil.sanitize(domainUser.name)%></span></div>
											<span class="text-sm text-ellipsis block" style="clear: both;"> <b><%=user.getEmail()%></b></span>
										</a>
									</li>
									
									<li><a href="#user-prefs" onclick="Agile_GA_Event_Tracker.track_event('Preferences in Profile Dropdown')"><!-- <i class="icon-cog"></i> -->

											<div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "preferences") %></div><div class='pull-right shortcuts'>Shift + P</div><div class="clearfix"></div></a></li>

									<%
									    if (domainUser != null && domainUser.is_admin)
									    {
														out.print("<li><a href='#account-prefs' onclick=\"Agile_GA_Event_Tracker.track_event('Admin Settings in Profile Dropdown')\"><div class='pull-left'>" + LanguageUtil.getLocaleJSONValue(localeJSON, "admin-settings")+ "</div><div class='pull-right shortcuts'>Shift + A</div><div class='clearfix'></div></a></li>");
													//	out.println("<li><a href='#subscribe'><i class='icon-shopping-cart'></i> Plan & Upgrade</a></li>");

									    }
									%>
										<% if(!MobileUADetector.isMobile(request.getHeader("user-agent"))){
									%>
									<li><a href="#subscribe" onclick="Agile_GA_Event_Tracker.track_event('Plan & Upgrade in Profile Dropdown')"><!-- <i class="icon-cog"></i> -->
											<div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "upgrade") %></div><div class='pull-right shortcuts'>Shift + U</div><div class="clearfix"></div></a></li><li class='divider m-n' ></li>
									<%}%>
						
											<!--<li><a href="https://www.agilecrm.com/product-updates" target="_blank" onclick=\"Agile_GA_Event_Tracker.track_event('Product Updates in Profile Dropdown')\"><i class="icon-off"></i>-->
											<!--<div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "product-updates") %></div><div class='pull-right shortcuts'>Shift + R</div><div class="clearfix"></div></a></li>-->

											
									<!--<li><a href="#affiliate-overview" id="affiliate_link">
											<div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "affiliate") %></div><div class='pull-right shortcuts'></div><div class="clearfix"></div></a></li>-->
									<li class="hide"><a href="#refer" id="referrals_link"><!-- <i class="icon-cog"></i> -->
											<div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "refer") %></div><div class='pull-right shortcuts'></div><div class="clearfix"></div></a></li>
						
									<!--<li><a href="https://www.agilecrm.com/support" target= "_blank" onclick="Agile_GA_Event_Tracker.track_event('Help in Profile Dropdown')"> <i class="icon-off"></i> 
									<div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "help") %></div><div class='pull-right shortcuts'>Shift + H</div><div class="clearfix"></div></a></li>-->
									<li><a id="help-options"><!-- <i class="icon-off"></i> -->
											<div class="pull-left">Contact Us</div><div class="clearfix"></div></a>
									</li>
									<!--<li class="none"><a href="#" id="clickdesk_live_chat">
											<div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "chat-with-us") %> 
												<i class="fa fa-circle" aria-hidden="true" style="color: green;margin-left: 5px;"></i>
											</div><div class='pull-right shortcuts'></div><div class="clearfix"></div></a>
									</li>-->
									<!-- <li><a href="https://www.agilecrm.com/support.html" target="_blank"><i class="icon-facetime-video"></i> Help
											Videos</a></li>
								 	<li><a href="#" onclick="$('li#fat-menu').removeClass('open');clickdesk_show_livechat_popup();"><i class="icon-comment"></i> Live Chat</a></li>  -->
									<!-- <li><a href="#help"><i class="icon-question"></i>
											Help</a></li> -->
									<li><a href="<%=logoutURL%>"><!-- <i class="icon-off"></i> -->
											<div class="pull-left"><%=LanguageUtil.getLocaleJSONValue(localeJSON, "logout") %></div><div class='pull-right shortcuts'>Shift + G</div><div class="clearfix"></div></a></li>

								</ul></li>
							<%
							    }
							%>
						</ul>
					</div>
					</header>
					<!--/.nav-collapse -->
			

<script type="text/javascript">
var item = document.getElementById('speechDectation');
if(window.hasOwnProperty('webkitSpeechRecognition')) 
	item.style.display = "inline-block";
else
	item.style.display = "none"; 
</script>
