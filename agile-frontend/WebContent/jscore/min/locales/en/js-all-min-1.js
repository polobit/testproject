Backbone.View.prototype.close=function(){this.remove();this.unbind();if(this.onClose){this.onClose()}};var BaseModel=Backbone.Model.extend({});var BaseCollection=Backbone.Collection.extend({model:BaseModel,initialize:function(b,a){this.restKey=a.restKey;if(a.sortKey){this.sortKey=a.sortKey}if(a.descending){this.descending=a.descending}this.sort_collection=a.sort_collection;if(this.sort_collection==false){this.comparator=false}},comparator:function(a){if(this.sortKey){if(this.descending==true){return -a.get(this.sortKey)}return a.get(this.sortKey)}return a.get("id")},parse:function(a){if(a&&a[this.restKey]){return a[this.restKey]}return a}});var Base_List_View=Backbone.View.extend({events:{"click .delete":"deleteItem","click .edit":"edit","delete-checked .agile_delete":"deleteItem","click .delete-model":"deleteModel","click .delete-confirm":"deleteConfirm"},initialize:function(){_.bindAll(this,"render","deleteItem","edit","deleteModel");this.model.bind("destroy",this.close,this);this.model.bind("change",this.render,this);this.model.bind("popoverChange",this.test,this)},deleteItem:function(a){a.preventDefault();this.model.destroy();this.remove()},deleteModel:function(a){a.preventDefault();showAlertModal("delete","confirm",function(){$.ajax({type:"DELETE",url:this.model.url(),success:function(){location.reload(true)}})})},deleteConfirm:function(c){var b=this;var a=$("#deleteConfirmationModal");a.html(getTemplate("modal-delete-confirm",{})).modal("show");$("#delete-confirm",a).click(function(d){d.preventDefault();var f=b.model.get("id");console.log(f);$(this).addClass("disabled");$.ajax({url:"core/api/users/"+f,type:"DELETE",success:function(){console.log("success");$("#deleteConfirmationModal").modal("hide");b.remove();if(!_billing_restriction.currentLimits.freePlan){var e;if(count>1){e=_agile_get_translated_val("users","deleted-users")}else{e=_agile_get_translated_val("users","deleted-user")}showNotyPopUp("information",e,"top",10000)}},error:function(e){console.log("error");a.find(".modal-footer").find("#delete-user").html('<small class="text-danger" style="font-size:15px;margin-right:172px;">'+_agile_get_translated_val("users","delete-user-error")+"</small>");console.log(e)}})})},edit:function(a){},test:function(c){var a=false;if(a){var b=this;getTemplate(b.options.template,b.model.toJSON(),undefined,function(d){$(b.el).html(d);$(b.el).data(b.model);console.log($(b.el));c(b.el)});return this}$(this.el).html(getTemplate(this.options.template,this.model.toJSON()));return this},render:function(c){var a=false;if(a){var b=this;getTemplate(b.options.template,b.model.toJSON(),undefined,function(d){$(b.el).html(d);$(b.el).data(b.model);console.log($(b.el));c(b.el)});return this}$(this.el).html(getTemplate(this.options.template,this.model.toJSON()));$(this.el).data(this.model);return this}});var Base_Collection_View=Backbone.View.extend({events:{"click .temp_collection_event":"tempEvent","click .searchFetchNext":"fetchNextCollectionModels",},initialize:function(){if(!this.options.no_transition_bar){showTransitionBar()}_.bindAll(this,"render","appendItem","appendItemOnAddEvent","appendItemsOnAddEvent","buildCollectionUI");if(this.options.data){this.collection=new BaseCollection(this.options.data,{restKey:this.options.restKey,sortKey:this.options.sortKey,descending:this.options.descending,sort_collection:this.options.sort_collection})}else{this.collection=new BaseCollection([],{restKey:this.options.restKey,sortKey:this.options.sortKey,descending:this.options.descending,sort_collection:this.options.sort_collection})}this.collection.url=this.options.url;this.model_list_template=$('<div class="model-list"></div>');this.collection.bind("sync",this.appendItem);this.collection.bind("add",this.appendItemOnAddEvent);this.collection.bind("addAll",this.appendItemsOnAddEvent);var c=this;this.collection.bind("reset",function(){c.render(true)});this.collection.bind("error",function(g,f){if(f.status==401){handleAjaxError();return}c.render(true,f)});this.render();if(this.options.cursor){this.page_size=this.options.page_size;this.global_sort_key=this.options.global_sort_key;this.request_method=this.options.request_method;this.post_data=this.options.post_data;if(!this.page_size){this.page_size=20}var c=this;this.infiniScroll=new Backbone.InfiniScroll(this.collection,{success:function(){$(".scroll-loading",c.el).remove();if(c.options.infini_scroll_cbk){c.options.infini_scroll_cbk()}if(!c.collection.last().get("cursor")||c.collection.first().get("count")==c.collection.models.length){$(".searchFetchNext",c.el).remove()}},untilAttr:"cursor",param:"cursor",strict:true,pageSize:this.page_size,target:this.options.scroll_target?this.options.scroll_target:$(window),onFetch:function(){var f="table";if(c.options.scroll_symbol){f="section"}if(c.options.custom_scrollable_element){f=c.options.custom_scrollable_element}$(f,c.el).after('<div class="scroll-loading" style="margin-left:50%">'+LOADING_ON_CURSOR+"</div>")}});addInfiniScrollToRoute(this.infiniScroll,this.options.infiniscroll_fragment);var b=this.page_size;var e=this.global_sort_key;var a=this.request_method;var d=this.post_data;this.collection.fetch=function(f){f||(f={});f.data||(f.data={});f.data.page_size=b;if(e&&e!=null){f.data.global_sort_key=e}if(a&&a!=null){f.type=a;if(a.toLowerCase()=="post"&&d&&d!=null){$.each(d,function(g,h){f.data[g]=h})}}return Backbone.Collection.prototype.fetch.call(this,f)}}},tempEvent:function(){console.log("tempEvent")},fetchNextCollectionModels:function(a){a.preventDefault();this.infiniScroll.fetchNext()},appendItem:function(b,a){if(a){$(this.model_list_element).append(this.createListView(b).render().el);return}console.log("appendItem");this.model_list_element_fragment.appendChild(this.createListView(b).render().el)},createListView:function(a){if(this.options.modelData){a.set(this.options.modelData)}var b=new Base_List_View({model:a,template:(this.options.templateKey+"-model"),tagName:this.options.individual_tag_name});return b},appendItemOnAddEvent:function(a){this.appendItem(a,true);var b=this.options.appendItemCallback;if(b&&typeof(b)==="function"){b($(this.el))}if($("table",this.el).length!=0){append_checkboxes(this.model_list_element)}},appendItemsOnAddEvent:function(c){this.model_list_element_fragment=document.createDocumentFragment();this.model_list_element=$("#"+this.options.templateKey+"-model-list",$(this.el));var b=this;$.each(c,function(d,e){b.appendItem(e)});$(this.model_list_element).append(this.model_list_element_fragment);if(!b.collection.last().get("cursor")||b.collection.first().get("count")==b.collection.models.length){$(".searchFetchNext",b.el).remove()}var a=this.options.appendItemCallback;if(a&&typeof(a)==="function"){a($(this.el))}if($("table").hasClass("onlySorting")){return}append_checkboxes(this.model_list_element)},render:function(d,c){if(d==undefined){var b=(this.options.customLoader)?getTemplate(this.options.customLoaderTemplate):"";$(this.el).html(b);return this}if($(this.el).html()==getRandomLoadingImg()){$(this.el).empty()}if(c){if(this.options.errorCallback&&typeof(this.options.errorCallback)=="function"){this.options.errorCallback(c)}else{$(this.el).html('<div style="padding:10px;font-size:14px"><b>'+c.responseText+"<b></div>")}return}var e=this;var a=this.buildCollectionUI;getTemplate((this.options.templateKey+"-collection"),this.collection.toJSON(),"yes",a);if(this.page_size&&(this.collection.length<this.page_size)){console.log("Disabling infini scroll");this.infiniScroll.destroy()}this.delegateEvents();return this},buildCollectionUI:function(a){$(this.el).html(a);if(this.collection.models.length==0){fill_slate("slate",this.el,this.options.slateKey)}this.model_list_element_fragment=document.createDocumentFragment();this.model_list_element=$("#"+this.options.templateKey+"-model-list",$(this.el));var b=document.createDocumentFragment();_(this.collection.models).each(function(d){this.appendItem(d)},this);$(this.model_list_element).append(this.model_list_element_fragment);var c=this.options.postRenderCallback;if(c&&typeof(c)==="function"){c($(this.el),this.collection)}hideTransitionBar();$("body").trigger("agile_collection_loaded",[this.el]);if(c&&typeof(c)==="function"){}return this},});Base_Collection_View.extend=function(b){var a=Backbone.View.extend.apply(this,arguments);a.prototype.events=_.extend({},this.prototype.events,b.events);return a};Base_List_View.extend=function(b){var a=Backbone.View.extend.apply(this,arguments);a.prototype.events=_.extend({},this.prototype.events,b.events);return a};var Base_Model_View=Backbone.View.extend({events:{"click .save":"save","click .saveAuthConform":"save","click .delete":"deleteItem"},initialize:function(){showTransitionBar();_.bindAll(this,"render","save","deleteItem","buildModelViewUI");if(this.options.data!=undefined){this.model=new Backbone.Model(this.options.data)}else{if(this.options.model){this.model=this.options.model}else{this.model=new Backbone.Model({})}}this.model.bind("change",this.onChange,this);this.model.bind("error",function(c,b){if(b.status==401){handleAjaxError();return}});if(this.options.url){this.model.url=this.options.url}if((!this.options.isNew)&&$.isEmptyObject(this.model.toJSON())){console.log("to fetch");var a=this;this.model.fetch({success:function(b){a.render(true)}})}},deleteItem:function(b){b.preventDefault();var c=this.options.deleteCallback;var a=this;showAlertModal("delete","confirm",function(){a.model.destroy({success:function(e,d){if(c&&typeof(c)==="function"){console.log(d);c(e,d)}if(this.options.no_reload_on_delete){return}location.reload(true)}})})},save:function(j){j.preventDefault();var c=j.currentTarget;if($(c).hasClass("saveAuth")){var b=this.options.saveAuth;if(b&&typeof(b)==="function"){this.targetEle=c;var h=b(this.el);if(h){return}}}if(this.targetEle){c=this.targetEle}trigger_tinymce_save();var q=$(this.el);var m=$(this.el).find("form").attr("id");var d=this.options.saveCallback;var f=this.options.errorCallback;var p=$("#"+m);console.log(p.find(".save"));
if($(c).attr("disabled")){return}disable_save_button($(c));var o,n;if($(this.el).find("form").length>1){n={};$.each($(this.el).find("form"),function(s,t){if(!isValidForm($(t))){o=false;return}var e=$(t).attr("id");var r=$(t).attr("name");if(r){n[r]=serializeForm(e)}else{$.each(serializeForm(e),function(u,v){n[u]=v})}})}if(o==false||!isValidForm(p)){enable_save_button($(c));return}var l=this.options.form_custom_validate;if(l&&!l()){enable_save_button($(j.currentTarget));return}this.model.clear({silent:true});if(!n){n=serializeForm(m)}this.model.set(n,{silent:true});var i=this.options.window;var a=this.options.reload;var k=this.options.modal;var g=this.options.prePersist;if(g&&typeof(g)==="function"){g(this.model)}this.model.save([],{wait:true,success:function(r,e){track_with_save_success_model($(c));enable_save_button($(c));if(d&&typeof(d)==="function"){console.log(e);d(e)}if(a){location.reload(true)}else{if(i){if(i=="back"){history.back(-1)}else{Backbone.history.navigate(i,{trigger:true})}p.each(function(){this.reset()});if(k){$(k).modal("hide")}}else{}}},error:function(r,e){enable_save_button($(c));console.log(e);if(f&&typeof(f)==="function"){f(e);return}$save_info=$('<div style="display:inline-block"><small><p style="color:#B94A48; font-size:14px"><i>'+e.responseText+"</i></p></small></div>");$(c).closest(".form-actions",this.el).append($save_info);if(e.status!=406){$save_info.show().delay(5000).hide(1)}}},{silent:true})},render:function(c){if(!this.model.isNew()||this.options.isNew||!$.isEmptyObject(this.model.toJSON())||c){$(this.el).html(getRandomLoadingImg());getTemplate(this.options.template,this.model.toJSON(),"yes",this.buildModelViewUI)}else{if(this.options.template=="portlets-leader-board-body-model"){var a=this.options.portletSizeY;var b=50*a;if(a==2||a==3){b+=50}$(this.el).html("<div class='text-center v-middle opa-half' style='margin-top:"+b+"px'><img src='"+updateImageS3Path("../flatfull/img/ajax-loader-cursor.gif")+"' style='width:12px;height:10px;opacity:0.5;' /></div>")}else{$(this.el).html(getRandomLoadingImg())}}return this},onChange:function(){if(this.options.change==false){return}this.render(true)},buildModelViewUI:function(a){hideTransitionBar();$(this.el).on("DOMNodeInserted",function(c){$(this).trigger("view_loaded")});$(this.el).html(a);var b=this.options.postRenderCallback;if(b&&typeof(b)==="function"){b($(this.el),this.model.toJSON())}if(this.options.isNew!=true){if($(this.el).find("form").length>1){deserializeMultipleForms(this.model.toJSON(),$(this.el).find("form"))}else{if($(this.el).find("form").length==1){deserializeForm(this.model.toJSON(),$(this.el).find("form"))}}}$(this.el).trigger("agile_model_loaded")}});function disable_save_button(b){var a=b.attr("data-loading-text");if(!a){a=_agile_get_translated_val("others","saving")}b.css("min-width",b.width()+"px").attr("disabled","disabled").attr("data-save-text",b.html()).text(a)}function enable_save_button(a){a.html(a.attr("data-save-text")).removeAttr("disabled data-save-text")}Base_Model_View.extend=function(b){var a=Backbone.View.extend.apply(this,arguments);a.prototype.events=_.extend({},this.prototype.events,b.events);return a};var INFINI_SCROLL_JSON={};function addInfiniScrollToRoute(a){var b=window.location.hash.split("#")[1];INFINI_SCROLL_JSON[b]=a}function activateInfiniScroll(){var a=window.location.hash.split("#")[1];$.each(INFINI_SCROLL_JSON,function(b,c){c.disableFetch()});if(INFINI_SCROLL_JSON[a]){INFINI_SCROLL_JSON[a].enableFetch()}}var WebpagesRouter=Backbone.Router.extend({routes:{webpages:"webpages","webpage-add":"webpageAdd","webpage/:id":"webpageEdit",},webpages:function(){this.webpages_list_view=new Base_Collection_View({url:"/core/api/webpages",restKey:"webpage",sort_collection:false,templateKey:"webpages",individual_tag_name:"tr",cursor:true,page_size:20,postRenderCallback:function(a){agileTimeAgoWithLngConversion($("time.webpage-created-time",a));start_tour(undefined,a)},appendItemCallback:function(a){$("time.webpage-created-time",a).timeago()}});this.webpages_list_view.collection.fetch();$("#content").html(this.webpages_list_view.el);$(".active").removeClass("active");$("#webpagesmenu").addClass("active")},webpageAdd:function(){if(!this.webpages_list_view||!this.webpages_list_view.collection){this.navigate("webpages",{trigger:true});return}this.webpage_json=undefined;this.webpage_model=undefined;getTemplate("webpage-add",{is_new:true},undefined,function(a){if(!a){return}$("#content").html($(a));initiate_tour("webpages-add",$("#content"))},"#content")},webpageEdit:function(f,d){if(!this.webpages_list_view||this.webpages_list_view.collection.length==0){this.navigate("webpages",{trigger:true});return}if(d){this.webpage_model=d}else{this.webpage_model=this.webpages_list_view.collection.get(f)}if(this.webpage_model===undefined){console.log("Downloading webpage.");var c=this.webpages_list_view.collection.at(0).attributes.count;if(this.webpages_list_view.collection.length!==c){var e=Backbone.Model.extend({url:"/core/api/webpages/"+f});var a=new e();a.id=f;a.fetch({success:function(g){if(!$.isEmptyObject(g.toJSON())){App_Webpages.webpageEdit(f,a);return}}})}}if(this.webpage_model===undefined){return}this.webpage_json=this.webpage_model.get("rules");var b=this;getTemplate("webpage-add",{},undefined,function(h){if(!h){return}var g=$("#content").html($(h));$("#name").val(b.webpage_model.get("name"))},"#content")},});var ReportsRouter=Backbone.Router.extend({routes:{reports:"reports","email-reports":"emailReportTypes","activity-reports":"activityReports","activity-report-add":"activityReportAdd","activity-report-edit/:id":"activityReportEdit","campaign-reports":"campaignReports","contact-reports":"emailReports","report-add":"reportAdd","campaign-report-add":"campaignReportAdd","campaign-report-edit/:id":"campaignReportEdit","report-campaign-results/:id":"campaignReportInstantResults","report-edit/:id":"reportEdit","report-results/:id":"reportInstantResults","report-charts/:type":"reportCharts","report-funnel/:tags":"showFunnelReport","report-growth/:tags":"showGrowthReport","report-ratio/:tag1/:tag2":"showRatioReport","report-sales":"showrevenuegraph","report-deals":"showIncomingDeals","report-calls/:type":"showCallsReport","user-reports":"showUserReports","report-lossReason":"showDealsLossReason","reports-wonDeals":"showDealsWonChart","rep-reports":"showRepPerformance","report-comparison":"showComparisonReport"},reports:function(){report_utility.loadReportsTemplate(function(){var a=$(".nav-tabs li:first-child>a").attr("href").substring(1);var b=$(".nav-tabs li li:first-child>a").attr("href").substring(1);$.each($(".tab-content .tab-pane"),function(){if($(this).attr("id")==b){var c=$("a",this).attr("href").substring(1);_agile_set_prefs("reports_tab",a);$('#reports-tab-container a[href="#'+a+'"]').parent().addClass("report-selected");Backbone.history.loadUrl(c);return}})})},emailReportTypes:function(){getTemplate("email-report-categories",{},undefined,function(a){if(!a){return}$("#content").html($(a));$(".active").removeClass("active");$("#reportsmenu").addClass("active")},"#content")},activityReports:function(){this.activityReports=new Base_Collection_View({url:"/core/api/activity-reports",restKey:"activityReports",templateKey:"activity-report",individual_tag_name:"tr",postRenderCallback:function(){initializeActivityReportsListeners()}});this.activityReports.collection.fetch();var a=this.activityReports;report_utility.loadReportsTemplate(function(){$(".reports-Container").html(getRandomLoadingImg());$(".reports-Container").html(a.render().el);$(".active").removeClass("active");$("#reportsmenu").addClass("active")})},campaignReports:function(){this.reports=new Base_Collection_View({url:"/core/api/campaignReports",restKey:"reports",templateKey:"report-campaign",individual_tag_name:"tr",postRenderCallback:function(){initializeReportsListeners()}});this.reports.collection.fetch();var a=this.reports;report_utility.loadReportsTemplate(function(){$(".reports-Container").html(a.render().el)})},activityReportAdd:function(){if(!tight_acl.checkPermission("REPORT")){return}if(!tight_acl.checkPermission("ACTIVITY")){return}$("#content").html("<div id='reports-listerners-container'></div>");$("#reports-listerners-container").html(getRandomLoadingImg());count=0;var a=new Base_Model_View({url:"core/api/activity-reports",template:"activity-reports-add",window:"activity-reports",isNew:true,postRenderCallback:function(b){initializeActivityReportsListeners();initializeReportsListeners();if(count!=0){return}report_utility.load_activities(b)}});$("#reports-listerners-container").html(getRandomLoadingImg());a.render()},campaignReportAdd:function(){count=0;$("#content").html("<div id='reports-listerners-container'></div>");$("#reports-listerners-container").html(getRandomLoadingImg());SEARCHABLE_CONTACT_CUSTOM_FIELDS=undefined;var a=new Report_Filters_Event_View({url:"core/api/campaignReports",template:"reports-campaign-add",window:"campaign-reports",isNew:true,postRenderCallback:function(c){initializeReportsListeners();var b="<option value='{{id}}'{{#if is_disabled}}disabled=disabled>{{name}} ("+_agile_get_translated_val("campaigns","disabled")+"){{else}}>{{name}}{{/if}}</option>";fillSelect("campaign-select","/core/api/workflows","workflow",function(d){},b,false,c);if(count!=0){return}report_utility.load_contacts(c,count)}});$("#reports-listerners-container").html(getRandomLoadingImg());a.render()},campaignReportEdit:function(c){$("#content").html("<div id='reports-listerners-container'></div>");$("#reports-listerners-container").html(getRandomLoadingImg());count=0;var a=this.reports.collection.get(c);var b=new Report_Filters_Event_View({url:"core/api/campaignReports",change:false,model:a,template:"reports-campaign-add",window:"campaign-reports",id:"reports-listerners-container",postRenderCallback:function(f){initializeReportsListeners();if(count!=0){return}var e="<option value='{{id}}'{{#if is_disabled}}disabled=disabled>{{name}} ("+_agile_get_translated_val("campaigns","disabled")+"){{else}}>{{name}}{{/if}}</option>";
fillSelect("campaign-select","/core/api/workflows","workflow",function d(){var g=a.toJSON();if(g){$("#campaign-select",f).find("option[value="+g.campaignId+"]").attr("selected","selected")}},e,false,f);fillSelect("custom-fields-optgroup","core/api/custom-fields/scope?scope=CONTACT",undefined,function(){loadActivityReportLibs(function(){report_utility.edit_contacts(f,a,true)})},'<option value="custom_{{field_label}}">{{field_label}}</option>',true,f);head.js(LIB_PATH+"lib/jquery-ui.min.js",LIB_PATH+"lib/agile.jquery.chained.min.js?_="+_agile_get_file_hash("agile.jquery.chained.min.js"),LIB_PATH+"lib/jquery.multi-select.js",function(){chainFiltersForContact(f,a.toJSON(),function(){++count;if(count>1){deserialize_multiselect(a.toJSON(),f)}});scramble_input_names($(f).find("div#report-settings"))})}});$("#reports-listerners-container").html(getRandomLoadingImg());b.render()},activityReportEdit:function(c){if(!tight_acl.checkPermission("REPORT")){return}if(!tight_acl.checkPermission("ACTIVITY")){return}$("#content").html("<div id='reports-listerners-container'></div>");$("#reports-listerners-container").html(getRandomLoadingImg());count=0;if(!this.activityReports||!this.activityReports.collection||this.activityReports.collection.length==0||this.activityReports.collection.get(c)==null){this.navigate("activity-reports",{trigger:true});return}var b=this.activityReports.collection.get(c);var a=new Base_Model_View({url:"core/api/activity-reports",change:false,model:b,template:"activity-reports-add",window:"activity-reports",postRenderCallback:function(d){initializeActivityReportsListeners();initializeReportsListeners();if(count!=0){return}fillSelect("users-list","/core/api/users","domainUser",function(){var e=b.toJSON();var g=e.activity_start_time;var f=e.frequency;deserializeForm(e,$("#activityReportsForm",d));head.js(LIB_PATH+"lib/jquery.multi-select.js",CSS_PATH+"css/businesshours/jquerytimepicker.css",LIB_PATH+"lib/businesshours/jquerytimepicker.js",function(){report_utility.edit_activities(d,e)})},'<option value="{{id}}">{{name}}</option>',true,d)}});$("#reports-listerners-container").html(getRandomLoadingImg());a.render()},emailReports:function(){this.reports=new Base_Collection_View({url:"/core/api/reports",restKey:"reports",templateKey:"report",individual_tag_name:"tr",postRenderCallback:function(){initializeReportsListeners()}});this.reports.collection.fetch();var b=this.reports;report_utility.loadReportsTemplate(function(){$(".reports-Container").html(b.render().el)})},reportAdd:function(){count=0;$("#content").html("<div id='reports-listerners-container'></div>");$("#reports-listerners-container").html(getRandomLoadingImg());SEARCHABLE_CONTACT_CUSTOM_FIELDS=undefined;var a=new Report_Filters_Event_View({url:"core/api/reports",template:"reports-add",window:"contact-reports",isNew:true,postRenderCallback:function(b){initializeReportsListeners();if(count!=0){return}report_utility.load_contacts(b,count)}});$("#reports-listerners-container").html(getRandomLoadingImg());a.render()},reportEdit:function(c){$("#content").html("<div id='reports-listerners-container'></div>");$("#reports-listerners-container").html(getRandomLoadingImg());count=0;var a=this.reports.collection.get(c);var b=new Report_Filters_Event_View({url:"core/api/reports",change:false,model:a,template:"reports-add",window:"contact-reports",id:"reports-listerners-container",postRenderCallback:function(d){initializeReportsListeners();if(count!=0){return}fillSelect("custom-fields-optgroup","core/api/custom-fields/scope?scope=CONTACT",undefined,function(){loadActivityReportLibs(function(){report_utility.edit_contacts(d,a)})},'<option value="custom_{{field_label}}">{{field_label}}</option>',true,d);head.js(LIB_PATH+"lib/jquery-ui.min.js",LIB_PATH+"lib/agile.jquery.chained.min.js?_="+_agile_get_file_hash("agile.jquery.chained.min.js"),LIB_PATH+"lib/jquery.multi-select.js",function(){chainFiltersForContact(d,a.toJSON(),function(){++count;if(count>1){deserialize_multiselect(a.toJSON(),d)}});scramble_input_names($(d).find("div#report-settings"))})}});$("#reports-listerners-container").html(getRandomLoadingImg());b.render()},reportInstantResults:function(b,a){report_utility.loadReportsTemplate(function(){if(!a){if(!this.reports||!this.reports.collection||this.reports.collection.length==0||this.reports.collection.get(b)==null){$(".reports-Container").html(getRandomLoadingImg());var e=new Backbone.Model();e.url="core/api/reports/"+b;e.fetch({success:function(f){App_Reports.reportInstantResults(b,f.toJSON())}});return}else{a=this.reports.collection.get(b).toJSON()}}REPORT=a;var d=new Base_Collection_View({url:"core/api/reports/show-results/"+b,modelData:a,templateKey:"report-search",individual_tag_name:"tr",cursor:true,sort_collection:false,page_size:15,});var c=this;$.getJSON("core/api/custom-fields/type/scope?type=DATE&scope=CONTACT",function(f){d.appendItem=function(g){reportsContactTableView(g,f,this)};d.collection.fetch()});$(".reports-Container").html(d.render().el)})},campaignReportInstantResults:function(b,a){report_utility.loadReportsTemplate(function(){var d=new Base_Model_View({url:"core/api/campaignReports/show-results/"+b,template:"campaign-report-via-email"});var c=this;$(".reports-Container").html(d.render().el)})},showFunnelReport:function(a){hideTransitionBar();report_utility.loadReportsTemplate(function(){initReportLibs(function(){getTemplate("report-funnel",{},undefined,function(b){if(!b){return}$(".reports-Container").html($(b));$("#reports-funnel-tags").text(a);initFunnelCharts(function(){showFunnelGraphs(a)});$(".active").removeClass("active");$("#reportsmenu").addClass("active");highlightDatepickerOption()},".reports-Container")})})},showGrowthReport:function(a){hideTransitionBar();report_utility.loadReportsTemplate(function(){initReportLibs(function(){getTemplate("report-growth",{},undefined,function(b){if(!b){return}$(".reports-Container").html($(b));$("#reports-growth-tags").text(a);initFunnelCharts(function(){showGrowthGraphs(a)})},".reports-Container")});$(".active").removeClass("active");$("#reportsmenu").addClass("active");highlightDatepickerOption()})},showCallsReport:function(a){hideTransitionBar();report_utility.loadReportsTemplate(function(){initReportLibs(function(){var b="number-of-calls";var c="report-calls";if(a=="pie-graph"){c=c+"-piechart"}if(a=="timebased"){c=c+"-timeGraph"}getTemplate(c,{},undefined,function(d){if(!d){return}$(".reports-Container").html($(d));if(a=="average-calls"){b="average-calls";$('select[id="typeCall"]').find('option[value="average-calls"]').attr("selected",true)}else{$('select[id="typeCall"]').find('option[value="number-of-calls"]').attr("selected",true)}initReportsForCalls(function(){var m="?";var j=$("#range").html().split("-");var k=new Date(j[0]).getTime()/1000;var e=$.trim(j[1]);if(e){e=e+" 23:59:59"}var g=new Date(e).getTime()/1000;m+=("start-date="+k+"&end-date="+g);var f="core/api/portlets/calls-per-person/"+m;if(a=="timebased"){if($("#frequency").length>0){var l=$("#frequency").val();m+=("&frequency="+l)}f="core/api/reports/calls-time-based/"+m}b=$("#typeCall option:selected").val();var i=$("#users option:selected").val();if(i!=undefined){if(i!="All"&&i!=""){var h=f;f=f+'&user=["'+i+'"]'}}report_utility.call_reports(f,a,b)})},".reports-Container")})})},showUserReports:function(){hideTransitionBar();report_utility.loadReportsTemplate(function(){initReportLibs(function(){getTemplate("report-revenue-user",{},undefined,function(a){if(!a){return}$(".reports-Container").html($(a));initUserReports(function(){salesReportGraphForUserReports();showLossReasonGraphForUserReports();var c="core/api/portlets/calls-per-person/"+getSelectedDates();if($("#owner").length>0){if($("#owner").val()!=""&&$("#owner").val()!="All Owners"){var b=$("#owner").val();c=c+'&user=["'+b+'"]'}}report_utility.user_reports(c)})},".reports-Container")})})},showRatioReport:function(b,a){report_utility.loadReportsTemplate(function(){initReportLibs(function(){getTemplate("report-ratio",{},undefined,function(c){if(!c){return}$(".reports-Container").html($(c));$("#reports-ratio-tags").text(b+" versus "+a);initFunnelCharts(function(){showRatioGraphs(b,a)});$(".active").removeClass("active");$("#reportsmenu").addClass("active");highlightDatepickerOption()},".reports-Container")})})},reportCharts:function(a){report_utility.loadReportsTemplate(function(){var b="report-growth";if(a){b="report-"+a+"-form"}getTemplate(b,{},undefined,function(d){if(!d){return}var c=$(d);$(".reports-Container").html(c);initializeChartReportsListeners();if(a&&(a=="growth"||a=="funnel")){setup_tags_typeahead();return}$.each($("[id=tags-reports]",c),function(f,e){console.log(e);addTagsDefaultTypeahead(e)})},".reports-Container")})},showIncomingDeals:function(){hideTransitionBar();report_utility.loadReportsTemplate(function(){initReportLibs(function(){getTemplate("report-deals",{},undefined,function(a){if(!a){return}$(".reports-Container").html($(a));initFunnelCharts(function(){showDealsGrowthReport()})},".reports-Container")})})},showDealsLossReason:function(){hideTransitionBar();report_utility.loadReportsTemplate(function(){initReportLibs(function(){getTemplate("report-DealsLoss",{},undefined,function(a){if(!a){return}$(".reports-Container").html($(a));initSalesCharts(function(){showLossReasonGraphs()});$(".active").removeClass("active");$("#reportsmenu").addClass("active")},".reports-Container")})})},showDealsWonChart:function(){hideTransitionBar();report_utility.loadReportsTemplate(function(){initReportLibs(function(){getTemplate("report-DealsWon",{},undefined,function(a){if(!a){return}$(".reports-Container").html($(a));initSalesCharts(function(){showWonPieChart()});$(".active").removeClass("active");$("#reportsmenu").addClass("active")},".reports-Container")})})},showrevenuegraph:function(){hideTransitionBar();report_utility.loadReportsTemplate(function(){initReportLibs(function(){getTemplate("report-sales",{},undefined,function(a){if(!a){return}$(".reports-Container").html($(a));
initSalesCharts(function(){showsalesReportGraphs()})},".reports-Container")})})},showComparisonReport:function(){hideTransitionBar();report_utility.loadReportsTemplate(function(){initReportLibs(function(){getTemplate("report-comparison",{},undefined,function(a){if(!a){return}$(".reports-Container").html($(a));initComparisonReports(function(){showComparisonReportGraph()})},".reports-Container")})})},showRepPerformance:function(){hideTransitionBar();report_utility.loadReportsTemplate(function(){initReportLibs(function(){getTemplate("report-user-performance",{},undefined,function(a){if(!a){return}$(".reports-Container").html($(a));initRepReports(function(){showRepPerformanceReport()})},".reports-Container")})})},});var count=0;var ContactSearchRouter=Backbone.Router.extend({routes:{"contacts/search/:query":"searchResults"},searchResults:function(d){var f=_agile_get_prefs("agile_search_filter_"+CURRENT_DOMAIN_USER.id);var c=JSON.parse(f);if(!c){return}this.addResultsContainers(c);for(var b=0;b<c.length;b++){if(!this.isValid(c[b])){continue}var e=this.getTemplateName(c[b]);var a=new Base_Collection_View({url:"core/api/search/seachlist?q="+encodeURIComponent(d)+"&type="+c[b],templateKey:e,individual_tag_name:"tr",cursor:true,data:QUERY_RESULTS,sort_collection:false,scroll_target:$("#search_content_"+c[b]),page_size:8,infiniscroll_fragment:c[b],postRenderCallback:function(g,i){var h=App_Contact_Search.getModuleName(i.url);if(i.length==0){$("#search-query-heading",g).html('No matches found for "'+d+'" in <span style="font-weight:600;">'+h)}else{$("#search-query-heading",g).html('Search results for "'+d+'" in <span style="font-weight:600;">'+h)}}});a.collection.fetch();$("#search-results-container").find("#search_content_"+c[b]).html(a.render().el)}},addResultsContainers:function(b){$("#content").html("<div id='search-results-container'></div>");for(var a=0;a<b.length;a++){$("#search-results-container").append("<div class='search-results-scroll-container' id='search_content_"+b[a]+"'></div>")}},isValid:function(a){if(a){return true}return false},getTemplateName:function(b){var a={};if(b=="person"){return"search"}else{if(b=="company"){return"company-search"}else{if(b=="opportunity"){return"deal-search"}else{if(b=="document"){return"documents-search"}else{if(b=="tickets"){return"tickets-search"}}}}}},getModuleName:function(a){if(a.indexOf("type=person")!=-1){return"Contacts"}else{if(a.indexOf("type=company")!=-1){return"Companies"}else{if(a.indexOf("type=opportunity")!=-1){return"Deals"}else{if(a.indexOf("type=document")!=-1){return"Documents"}else{if(a.indexOf("type=tickets")!=-1){return"Tickets"}}}}}},});function initializeDealDetailSearch(){$("#content").find("#search_content_opportunity").off("click",'#deal-search-model-list > tr > td:not(":first-child")');$("#content").find("#search_content_opportunity").on("click",'#deal-search-model-list > tr > td:not(":first-child")',function(a){a.preventDefault();var b=$(this).closest("tr").data();Backbone.history.navigate("deal/"+b.id,{trigger:true})})}function initializeCaseSearch(){$("#content #search_content_cases #case-search-model-list > tr > td:not(':first-child')").off("click");$("#content #search_content_cases").on("click",'#case-search-model-list > tr > td:not(":first-child")',function(a){a.preventDefault();updatecases($(this).closest("tr").data())})}function initializeDocumentSearch(a){$("#content #search_content_document #documents-search-model-list > tr > td:not(':first-child')").off("click");$("#content #search_content_document").on("click",'#documents-search-model-list > tr > td:not(":first-child")',function(b){b.preventDefault();updateDocument($(b.currentTarget).closest("tr").data())})}var AgileConfigRouter=Backbone.Router.extend({routes:{"onboarding/:link":"onBoarding",},onBoarding:function(a){if(!CURRENT_DOMAIN_USER.is_admin){getTemplate("others-not-allowed",{},undefined,function(b){if(!b){return}$("#content").html($(b))},"#content");return}getTemplate("admin-settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));head.js(LIB_PATH+"lib/prettify-min.js","../lib/zeroclipboard/ZeroClipboard.js",function(){var c=new Base_Model_View({url:"/core/api/api-key",template:"admin-settings-api-key-model",postRenderCallback:function(d){prettyPrint();console.log(a+"link is");if(a){$(d).find('#APITab a[href="#'+a+'"]').trigger("click")}initZeroClipboard("saas_api_track_code_icon","saas_api_track_code")}});$("#content").find("#admin-prefs-tabs-content").html(c.render().el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".analytics-code-tab").addClass("select")});$.getJSON("core/api/api-key",function(c){console.log(c);getTemplate("onboarding-"+a,c,undefined,function(d){if(!d){return}$("#content").html($(d))},"#content")})},"#content")}});var TicketAutomationRouter=Backbone.Router.extend({routes:{automations:"automations","automation-add":"automationAdd","automation-edit/:id":"automationEdit",},automations:function(){},automationAdd:function(){},automationEdit:function(a){}});var VisitorsRouter=Backbone.Router.extend({routes:{"visitors-old":"loadGmap"},initialize:function(){},loadGmap:function(){head.js(LIB_PATH+"lib/date-charts-en.js",LIB_PATH+"lib/date-range-picker.js?_="+_agile_get_file_hash("date-range-picker.js"),LIB_PATH+"lib/markerclusterer.js",function(){var a=new Base_Model_View({model:new BaseModel(),template:"gmap-html-page",isNew:true,postRenderCallback:function(b){try{if(google.maps){gmap_initialize(b)}}catch(c){gmap_load_script(b)}}});$("#content").html(a.render().el)})}});var ContactViewsRouter=Backbone.Router.extend({routes:{"contact-view-prefs":"editContactView",},editContactView:function(){var a=new Base_Model_View({url:"core/api/contact-view-prefs",template:"contact-view",change:false,restKey:"contactView",window:"contacts",postRenderCallback:function(c,b){fillSelect("custom-fields-optgroup","core/api/custom-fields/scope?scope=CONTACT",undefined,function(d){head.js(LIB_PATH+"lib/jquery-ui.min.js",LIB_PATH+"lib/jquery.multi-select.js",function(){$("#multipleSelect",c).multiSelect();$(".ms-selection",c).children("ul").addClass("multiSelect").attr("name","fields_set").attr("id","fields_set").sortable();$.each(b.fields_set,function(e,f){$("#multipleSelect",c).multiSelect("select",f)})})},'<option value="CUSTOM_{{field_label}}">{{field_label}}</option>',true,c)},saveCallback:function(b){CONTACTS_HARD_RELOAD=true;App_Contacts.navigate("contacts",{trigger:true});if(App_Contacts.contactViewModel){App_Contacts.contactViewModel.fields_set=b.fields_set}}});$("#content").html(a.render().el)}});var DashboardsRouter=Backbone.Router.extend({routes:{"add-dashboard":"addDashboard",dashboards:"Dashboards","edit-dashboard/:id":"editDashboard"},addDashboard:function(){$("#content").html(LOADING_HTML);var a=this;var b=new Base_Model_View({url:"core/api/dashboards",template:"dashboard-add",isNew:"true",postRenderCallback:function(c){},saveCallback:function(c){if(a.dashboards_collection_view&&c){a.dashboards_collection_view.collection.add(new BaseModel(c))}if(c){CURRENT_USER_DASHBOARDS.push(c)}a.navigate("dashboards",{trigger:true})}});$("#content").html(b.render().el)},Dashboards:function(){$("#content").html(LOADING_HTML);if(!this.dashboards_collection_view){this.dashboards_collection_view=new Base_Collection_View({url:"core/api/dashboards",templateKey:"dashboard",isNew:"true",window:"dashboards",individual_tag_name:"tr",sortKey:"name",postRenderCallback:function(a){agileTimeAgoWithLngConversion($(".time-ago",a))}});this.dashboards_collection_view.collection.fetch();$("#content").html(this.dashboards_collection_view.render().el)}else{$("#content").html(this.dashboards_collection_view.render(true).el)}},editDashboard:function(e){if(!this.dashboards_collection_view||this.dashboards_collection_view.collection.length==0||this.dashboards_collection_view.collection.get(e)==null){this.navigate("dashboards",{trigger:true});return}$("#content").html(LOADING_HTML);var c=this;var b=this.dashboards_collection_view.collection.get(e);var a=b.toJSON();var d=new Base_Model_View({url:"core/api/dashboards",model:b,template:"dashboard-add",postRenderCallback:function(f){deserializeForm(a,$("#dashboardAddForm"))},saveCallback:function(f){if(c.dashboards_collection_view&&f){c.dashboards_collection_view.collection.get(e).set(new BaseModel(f))}if(f){$.each(CURRENT_USER_DASHBOARDS,function(g,h){if(e==this.id){this.name=f.name;this.description=f.description}})}c.navigate("dashboards",{trigger:true})},errorCallback:function(f){if(c.dashboards_collection_view&&a){c.dashboards_collection_view.collection.get(e).set(new BaseModel(a),{silent:true})}if(f&&f.responseText){$("span.error-message",$("#dashboardAddForm")).html('<small><p style="color:#B94A48; font-size:14px"><i>'+f.responseText+"</i></p></small>")}setTimeout(function(){$("span.error-message",$("#dashboardAddForm")).html("")},1000)}});$("#content").html(d.render().el)}});var WorkflowsRouter=Backbone.Router.extend({routes:{workflows:"workflows","workflow-add":"workflowAdd","workflow/:id":"workflowEdit","workflow-templates":"workflowTemplates","workflow-add/:c/:t":"workflowAddTemplate","workflows/logs/:id":"logsToCampaign","campaign-stats":"campaignStats","email-reports/:id":"emailReports",triggers:"triggers","trigger-add/:id":"triggerNewUI","trigger-add":"triggerNewUI","trigger/:id":"triggerEdit","workflow/all-subscribers/:id":"allSubscribers","workflow/active-subscribers/:id":"activeSubscribers","workflow/completed-subscribers/:id":"completedSubscribers","workflow/removed-subscribers/:id":"removedSubscribers","workflow/unsubscribed-subscribers/:id":"unsubscribedSubscribers","workflow/hardbounced-subscribers/:id":"hardBouncedSubscribers","workflow/softbounced-subscribers/:id":"softBouncedSubscribers","workflow/spam-reported-subscribers/:id":"spamReportedSubscribers","share-campaign/:c/:t":"shareWorkflow"},workflows:function(){$(".active").removeClass("active");$("#workflowsmenu").addClass("active");
getTemplate("workflows-static-container",{},undefined,function(d){$("#content").html(getTemplate("workflows-static-container"));var a=_agile_get_prefs("workflow_sort_key");if(a==undefined||a==null){a="name_dummy";_agile_set_prefs("workflow_sort_key",a)}var b=this;var c=new Workflow_Top_Header_Model_Events({template:"workflows-top-header",isNew:true,model:new Backbone.Model({sortKey:a}),postRenderCallback:function(e){console.log("Load collection");App_Workflows.loadworkflows($("#content"))}});$("#content").find("#workflows-top-view").html(c.render().el)},$("#content"))},loadworkflows:function(b){var a=_agile_get_prefs("workflow_sort_key");if(App_Workflows.workflow_list_view&&App_Workflows.workflow_list_view.options.global_sort_key==a&&App_Workflows.workflow_list_view.collection&&App_Workflows.workflow_list_view.collection.length>0){$(b).find("#workflows-collection-container").html(App_Workflows.workflow_list_view.render(true).el);return}App_Workflows.workflow_list_view=new Base_Collection_View({url:"/core/api/workflows",restKey:"workflow",sort_collection:false,templateKey:"workflows",individual_tag_name:"tr",customLoader:true,customLoaderTemplate:"agile-app-collection-loader",cursor:true,page_size:20,global_sort_key:a,postRenderCallback:function(c){agileTimeAgoWithLngConversion($("time.campaign-created-time",c));start_tour(undefined,b);if(App_Workflows.workflow_list_view&&!(App_Workflows.workflow_list_view.collection.length===0)){show_triggers_of_each_workflow(c)}if(App_Workflows.workflow_list_view&&!(App_Workflows.workflow_list_view.collection.length===0)){if(App_Workflows.workflow_list_view.collection.toJSON()[0]){b.find("#campaign_logs").attr("href","#email-reports/"+App_Workflows.workflow_list_view.collection.toJSON()[0].id);return}else{b.find("#campaign_logs").attr("href","#workflows");return}}else{b.find("#campaign_logs").attr("href","#workflows");return}},appendItemCallback:function(c){$("time.campaign-created-time",c).timeago();show_triggers_of_each_workflow(c)}});App_Workflows.workflow_list_view.collection.fetch();$("#content").find("#workflows-collection-container").html(App_Workflows.workflow_list_view.el)},workflowAdd:function(){if(!this.workflow_list_view||!this.workflow_list_view.collection){this.navigate("workflows",{trigger:true});return}this.workflow_json=undefined;this.workflow_model=undefined;var a=new Workflow_Model_Events({url:"core/api/workflow",template:"workflow-add",isNew:"true",data:{is_new:true,is_disabled:"false",was_disabled:"false"},postRenderCallback:function(c){initiate_tour("workflows-add",$("#content"));var b="<option value='{{id}}'> {{#if name}}{{name}}{{else}}{{subject}}{{/if}}</option>";fillSelect("sendEmailSelect","/core/api/email/templates","emailTemplates",function(){console.log($(c).html())},b,false,c,"Default template");send_verify_email(c)}});$("#content").html(a.render().el)},workflowEdit:function(g,f){if(!this.workflow_list_view||this.workflow_list_view.collection.length==0){this.navigate("workflows",{trigger:true});return}if(f){this.workflow_model=f}else{this.workflow_model=this.workflow_list_view.collection.get(g)}if(this.workflow_model===undefined){console.log("Downloading workflow.");var d=this.workflow_list_view.collection.at(0).attributes.count;if(this.workflow_list_view.collection.length!==d){var a=Backbone.Model.extend({url:"/core/api/workflows/"+g});var b=new a();b.id=g;b.fetch({success:function(h){if(!$.isEmptyObject(h.toJSON())){App_Workflows.workflowEdit(g,b);return}}})}}if(this.workflow_model===undefined){return}this.workflow_json=this.workflow_model.get("rules");this.is_disabled=this.workflow_model.get("is_disabled");this.is_unsubscribe_email_disabled=this.workflow_model.get("unsubscribe").is_unsubscribe_email_disabled;var c=this;var e=new Workflow_Model_Events({url:"core/api/workflow",template:"workflow-add",isNew:"true",data:{is_disabled:""+c.is_disabled,is_unsubscribe_email_disabled:""+c.is_unsubscribe_email_disabled},postRenderCallback:function(i){head.load(CSS_PATH+"css/bootstrap_switch.css",LIB_PATH+"lib/bootstrapSwitch.js",LIB_PATH+"lib/desktop-notify-min.js");$("#workflow-name",i).val(c.workflow_model.get("name"));var j=c.workflow_model.get("unsubscribe");$("#unsubscribe-email",i).val(j.unsubscribe_email);$("#unsubscribe-name",i).val(j.unsubscribe_name);$("#unsubscribe-tag",i).val(j.tag);$("#unsubscribe-action",i).val(j.action);$("#unsubscribe-action",i).trigger("change");var k=c.workflow_model.get("access_level");$("#access_level",i).val(k);change_access_level(k,i);console.log($(i).html());if(c.is_disabled){$("#designer-tour",i).addClass("blur").removeClass("anti-blur")}var h="<option value='{{id}}'> {{#if name}}{{name}}{{else}}{{subject}}{{/if}}</option>";fillSelect("sendEmailSelect","/core/api/email/templates","emailTemplates",function(){console.log($(i).html());var l=j.unsubscribe_subject;$('select option[value="'+l+'"]',i).attr("selected",true)},h,false,i,"Default template");send_verify_email(i)}});$("#content").html(e.render().el)},workflowTemplates:function(){if(!this.workflow_list_view||!this.workflow_list_view.collection){this.navigate("workflows",{trigger:true});return}$("#content").html('<div id="workflows-listener-container"></div>');getTemplate("workflow-categories",{},undefined,function(b){if(!b){return}$("#workflows-listener-container").html($(b));var a=_agile_get_prefs("workflows_tab");if(!a||a==null){_agile_set_prefs("workflows_tab","general");a="general"}$("#workflows-tab-container").on("click",".tab-container ul li",function(){var c=$(this).find("a").attr("href").split("#");_agile_set_prefs("workflows_tab",c[1])});$('#workflows-tab-container a[href="#'+a+'"]').tab("show")},"#workflows-listener-container")},workflowAddTemplate:function(c,f){if(!this.workflow_list_view||!this.workflow_list_view.collection){this.navigate("workflows",{trigger:true});return}this.workflow_json=undefined;this.workflow_model=undefined;var d=Backbone.Model.extend({url:"misc/campaign-templates/"+c+"/"+f+"_template.jsp"});var a=new d();var b=this;a.fetch({success:function(g){b.workflow_json=JSON.stringify(g)}});var e=new Workflow_Model_Events({url:"core/api/workflow",template:"workflow-add",isNew:"true",data:{is_new:true,is_disabled:false,was_disabled:false},postRenderCallback:function(h){var g="<option value='{{id}}'> {{#if name}}{{name}}{{else}}{{subject}}{{/if}}</option>";fillSelect("sendEmailSelect","/core/api/email/templates","emailTemplates",function(){console.log($(h).html())},g,false,h,"Default template");send_verify_email(h)}});$("#content").html(e.render().el)},logsToCampaign:function(c,a,b){this.render_email_reports_select_ui(c,function(){getTemplate("campaign-analysis-tabs",{id:c},undefined,function(e){if(!e){return}$("#campaign-analysis-tabs").html($(e));if(a==undefined||a=="ALL"){a=""}else{a="?log-type="+a}var d=new Workflow_Reports_Events({url:"/core/api/campaigns/logs/"+c+a,templateKey:"campaign-logs",cursor:true,page_size:20,individual_tag_name:"tr",sort_collection:false,postRenderCallback:function(f){initializeTriggersListeners();agileTimeAgoWithLngConversion($("time.log-created-time",f));$("#log-filter-title").html(b)},appendItemCallback:function(f){includeTimeAgo(f)}});d.collection.fetch({success:function(f){if(f.length===0){fill_logs_slate("logs-slate",a.split("=")[1])}}});$("#campaign-analysis-tabs-content").html(d.el);$("#campaign-tabs .select").removeClass("select");$(".campaign-logs-tab").addClass("select")},"#campaign-analysis-tabs")})},campaignStats:function(){hideTransitionBar();getTemplate("campaign-stats-chart",{},undefined,function(a){if(!a){return}$("#content").html($(a));showBar("/core/api/campaign-stats/stats/","campaign-stats-chart",_agile_get_translated_val("campaigns","campaigns-comparison"),_agile_get_translated_val("campaigns","email-stats"),null);$(".active").removeClass("active");$("#workflowsmenu").addClass("active")},"#content")},emailReports:function(a){showTransitionBar();this.render_email_reports_select_ui(a,function(){getTemplate("campaign-analysis-tabs",{id:a},undefined,function(b){if(!b){return}$("#campaign-analysis-tabs").html($(b));$("#subscribers-block").hide();initReportLibs(function(){getTemplate("campaign-email-reports",{},undefined,function(c){if(!c){return}$("#campaign-analysis-tabs-content").html($(c));initChartsUI(function(){get_email_table_reports(a);showEmailGraphs(a)})},"#campaign-analysis-tabs-content")});$(".active").removeClass("active");$("#workflowsmenu").addClass("active");$("#campaign-tabs .select").removeClass("select");$(".campaign-stats-tab").addClass("select");hideTransitionBar()},"#campaign-analysis-tabs")})},triggers:function(){this.triggersCollectionView=new Base_Collection_View({url:"/core/api/triggers",restKey:"triggers",templateKey:"triggers",individual_tag_name:"tr",postRenderCallback:function(a,b){$.each(b.models,function(d,c){var e=c.toJSON();if(e.type=="FORM_SUBMIT"&&e.trigger_form_event&&e.trigger_form_event!=""){getFormNameForTrigger(e.trigger_form_event,function(f){$("#"+getFormNameCellIDForFormSubmitTriggers(e.trigger_form_event)).parent().html(f)})}})}});this.triggersCollectionView.collection.fetch();$("#content").html(this.triggersCollectionView.el);make_menu_item_active("triggersmenu")},triggerNewUI:function(b){$("#content").html("<div id='trigger-listener'>&nbsp;</div>");this.triggerModelview=new Base_Model_View({url:"core/api/triggers",template:"trigger-categories",isNew:true,window:"triggers",postRenderCallback:function(d){$("#campaign-id").val(b);initializeTriggerEventListners(b);var c=_agile_get_prefs("triggers_tab");if(!c||c==null){_agile_set_prefs("triggers_tab","contact")}$("#triggers-tab-container",d).on("click",".tab-container ul li",function(){var e=$(this).find("a").attr("href").split("#");_agile_set_prefs("triggers_tab",e[1])});c=_agile_get_prefs("triggers_tab");$('#triggers-tab-container a[href="#'+c+'"]').tab("show")}});var a=this.triggerModelview.render();$("#trigger-listener").html(a.el);$("#campaign-id").val(b)},triggerAdd:function(b,a){setGlobalAPIKey(function(){$("#content").html("<div id='trigger-selector'>&nbsp;</div>");
this.triggerModelview=new Base_Model_View({url:"core/api/triggers",template:"trigger-add",isNew:true,window:"triggers",postRenderCallback:function(f){initializeTriggerListEventListners(b,a);head.js(LIB_PATH+"lib/agile.jquery.chained.min.js?_="+_agile_get_file_hash("agile.jquery.chained.min.js"),function(){var i,h;i=$("#LHS",f);h=$("#RHS",f);CALL=$("#CALL",f);h.chained(i);CALL.chained(i)});var d="<option value='{{id}}'{{#if is_disabled}}disabled=disabled>{{name}} ("+_agile_get_translated_val("campaigns","disabled")+"){{else}}>{{name}}{{/if}}</option>";var e=a;var g=b;setTimeout(function(){$("#trigger-type",f).val(e).attr("selected","selected").trigger("change")},100);if(g){fillSelect("campaign-select","/core/api/workflows","workflow",function(h){$("#campaign-select",f).find("option[value="+g+"]").attr("selected","selected")},d,false,f)}else{fillSelect("campaign-select","/core/api/workflows","workflow","no-callback",d,false,f)}},saveCallback:function(){App_Workflows.triggersCollectionView=undefined}});var c=this.triggerModelview.render();$("#trigger-selector").html(c.el)})},triggerEdit:function(c){if(!this.triggersCollectionView||this.triggersCollectionView.collection.length==0){this.navigate("triggers",{trigger:true});return}var b=this.triggersCollectionView.collection.get(c);$("#content").html("<div id='trigger-edit-selector'>&nbsp;</div>");var a=new Base_Model_View({url:"core/api/triggers",model:b,template:"trigger-add",window:"triggers",postRenderCallback:function(g){initializeTriggersListeners();head.js(LIB_PATH+"lib/agile.jquery.chained.min.js?_="+_agile_get_file_hash("agile.jquery.chained.min.js"),function(){var p,o;p=$("#LHS",g);o=$("#RHS",g);CALL=$("#CALL",g);o.chained(p);CALL.chained(p)});var j=b.toJSON()["type"];initializeTriggerListEventListners(c,j);$("#trigger-type",g).val(j).attr("selected","selected").trigger("change");if(j==="DEAL_MILESTONE_IS_CHANGED"){var i=b.toJSON()["trigger_deal_milestone"];populate_milestones_in_trigger($("form#addTriggerForm",g),"trigger-deal-milestone",i)}if(j=="FORM_SUBMIT"){var l=b.toJSON()["trigger_form_event"];var m=b.toJSON()["trigger_run_on_new_contacts"];populate_forms_in_trigger($("form#addTriggerForm",g),"trigger-form-event",l,m)}if(j=="RUNS_DAILY"||j=="RUNS_WEEKLY"||j=="RUNS_MONTHLY"||j=="RUNS_HOURLY"){var n=b.toJSON()["contact_filter_id"];populate_contact_filters_in_trigger($("form#addTriggerForm",g),"contact-filter",n)}if(j=="TAG_IS_ADDED"||j=="TAG_IS_DELETED"){$("#trigger-custom-tags",g).closest("div.control-group").css("display","");$(".trigger-tags",g).on("focus",function(o){o.preventDefault();addTagsDefaultTypeahead($("form#addTriggerForm").find("div#RHS"))})}if(j=="ADD_SCORE"){$("#trigger-custom-score",g).closest("div.control-group").css("display","")}if(j=="STRIPE_CHARGE_EVENT"){var k=b.toJSON()["trigger_stripe_event"];var m=b.toJSON()["trigger_run_on_new_contacts"];populate_stripe_events_in_trigger($("form#addTriggerForm",g),"trigger-stripe-event",k,m)}if(j=="SHOPIFY_EVENT"){var h=b.toJSON()["trigger_shopify_event"];var m=b.toJSON()["trigger_run_on_new_contacts"];populate_shopify_events_in_trigger($("form#addTriggerForm",g),"trigger-shopify-event",h,m)}if(j=="INBOUND_MAIL_EVENT"){var d=b.toJSON()["new_email_trigger_run_on_new_contacts"];populate_inbound_mail_events_in_trigger($("form#addTriggerForm",g),"trigger-inbound-mail-event",d)}if(j=="EMAIL_OPENED"||j=="EMAIL_LINK_CLICKED"||j=="UNSUBSCRIBED"){if(j!=="UNSUBSCRIBED"){$("#email-tracking-type",g).closest("div.control-group").css("display","");$("#email-tracking-type",g).find("option[value="+b.toJSON()["email_tracking_type"]+"]").attr("selected","selected").trigger("change")}if(b.toJSON()["email_tracking_type"]=="CAMPAIGNS"||j=="UNSUBSCRIBED"){$("#email-tracking-campaign-id",g).closest("div.control-group").css("display","");var f="<option value='{{id}}'>{{name}}</option>";fillSelect("email-tracking-campaign-id","/core/api/workflows?allow_campaign="+b.toJSON().email_tracking_campaign_id,"workflow",function e(){$("#email-tracking-campaign-id option:first").after('<option value="0">All</option>');var o=b.toJSON();if(o){$("#email-tracking-campaign-id",g).find("option[value="+o.email_tracking_campaign_id+"]").attr("selected","selected")}$(".loading",g).remove()},f,false,g)}if(j=="EMAIL_LINK_CLICKED"){$("#custom-link-clicked",g).closest("div.control-group").css("display","")}}if(j=="EVENT_IS_ADDED"){$("form#addTriggerForm",g).find("select#event-type").closest("div.control-group").css("display","");$("#email-type",g).find("option[value="+b.toJSON()["email_type"]+"]").attr("selected","selected").trigger("change");populate_owners_in_trigger($("form#addTriggerForm",g),"event-owner-id",b.toJSON()["event_owner_id"])}if(j=="INBOUND_CALL"||j=="OUTBOUND_CALL"){populate_call_trigger_options($("form#addTriggerForm",g),b.toJSON())}var f="<option value='{{id}}'{{#if is_disabled}}disabled=disabled>{{name}} ("+_agile_get_translated_val("campaigns","disabled")+"){{else}}>{{name}}{{/if}}</option>";fillSelect("campaign-select","/core/api/workflows?allow_campaign="+b.toJSON().campaign_id,"workflow",function e(){var o=b.toJSON();if(o){$("#campaign-select",g).find("option[value="+o.campaign_id+"]").attr("selected","selected")}},f,false,g)},saveCallback:function(){App_Workflows.triggersCollectionView=undefined}});$("#trigger-edit-selector").html(a.render().el)},automationAdd:function(){this.automationModelview=new Base_Model_View({url:"/core/api/automations",template:"automation-add",isNew:true,window:"automations",postRenderCallback:function(c){var b="<option value='{{id}}'>{{name}}</option>";fillSelect("campaign-select","/core/api/workflows","workflow","no-callback",b,false,c);fillSelect("filter-select","/core/api/filters","workflow","no-callback",b,false,c)}});var a=this.automationModelview.render();$("#content").html(a.el)},automations:function(){this.automationsCollectionView=new Base_Collection_View({url:"/core/api/automations",restKey:"automations",templateKey:"automations",individual_tag_name:"tr"});this.automationsCollectionView.collection.fetch();$("#content").html(this.automationsCollectionView.el);$(".active").removeClass("active");$("#workflowsmenu").addClass("active")},automationEdit:function(c){if(!this.automationsCollectionView||this.automationsCollectionView.collection.length==0){this.navigate("automations",{trigger:true});return}var b=this.automationsCollectionView.collection.get(c);var a=new Base_Model_View({url:"core/api/automations",model:b,template:"automation-add",window:"automations",postRenderCallback:function(g){var h=b.toJSON()["durationType"];$("#period-type",g).val(h).attr("selected","selected").trigger("change");var f="<option value='{{id}}'>{{name}}</option>";fillSelect("campaign-select","/core/api/workflows","workflow",function e(){var i=b.toJSON();if(i){$("#campaign-select",g).find("option[value="+i.campaign_id+"]").attr("selected","selected")}},f,false,g);fillSelect("filter-select","/core/api/filters","workflow",function d(){var i=b.toJSON();if(i){$("#filter-select",g).find("option[value="+i.contactFilter_id+"]").attr("selected","selected")}},f,false,g)},});$("#content").html(a.render().el)},allSubscribers:function(a){this.render_email_reports_select_ui(a,function(){getTemplate("campaign-analysis-tabs",{id:a},undefined,function(c){if(!c){return}abortCountQueryCall();$("#campaign-analysis-tabs").html($(c));var b=get_campaign_subscribers_collection(a,"core/api/workflows/all-subscribers/"+a,"workflow-other-subscribers");b.collection.fetch({success:function(d){if(d.length===0){fill_subscribers_slate("subscribers-slate","all-subscribers")}}});$("#campaign-analysis-tabs-content").html(b.el);$("#subscribers-block").hide();$("#campaign-tabs .select").removeClass("select");$(".campaign-subscribers-tab").addClass("select")},"#campaign-analysis-tabs")})},activeSubscribers:function(b){var a=this;a.render_email_reports_select_ui(b,function(){if(!a.workflow_list_view||a.workflow_list_view.collection.length==0){a.navigate("workflows",{trigger:true});return}a.active_subscribers_collection=get_campaign_subscribers_collection(b,"core/api/workflows/active-subscribers/"+b,"workflow-active-contacts");a.active_subscribers_collection.collection.fetch({success:function(c){if(c.length===0){fill_subscribers_slate("subscribers-slate","active-subscribers")}}});$("#campaign-analysis-tabs-content").html(a.active_subscribers_collection.el);$("#subscribers-block").hide();$("#campaign-tabs .select").removeClass("select");$(".campaign-subscribers-tab").addClass("select")})},completedSubscribers:function(b){var a=this;a.render_email_reports_select_ui(b,function(){if(!a.workflow_list_view||a.workflow_list_view.collection.length==0){a.navigate("workflows",{trigger:true});return}var c=get_campaign_subscribers_collection(b,"core/api/workflows/completed-subscribers/"+b,"workflow-other-subscribers");c.collection.fetch({success:function(d){if(d.length===0){fill_subscribers_slate("subscribers-slate","completed-subscribers")}}});$("#campaign-analysis-tabs-content").html(c.el);$("#subscribers-block").hide();$("#campaign-tabs .select").removeClass("select");$(".campaign-subscribers-tab").addClass("select")})},removedSubscribers:function(b){var a=this;a.render_email_reports_select_ui(b,function(){if(!a.workflow_list_view||a.workflow_list_view.collection.length==0){a.navigate("workflows",{trigger:true});return}var c=get_campaign_subscribers_collection(b,"core/api/workflows/removed-subscribers/"+b,"workflow-other-subscribers");c.collection.fetch({success:function(d){if(d.length===0){fill_subscribers_slate("subscribers-slate","removed-subscribers")}}});$("#campaign-analysis-tabs-content").html(c.el);$("#subscribers-block").hide();$("#campaign-tabs .select").removeClass("select");$(".campaign-subscribers-tab").addClass("select")})},unsubscribedSubscribers:function(b){var a=this;a.render_email_reports_select_ui(b,function(){if(!a.workflow_list_view||a.workflow_list_view.collection.length==0){a.navigate("workflows",{trigger:true});return}var c=get_campaign_subscribers_collection(b,"core/api/workflows/unsubscribed-subscribers/"+b,"workflow-other-subscribers");
c.collection.fetch({success:function(d){if(d.length===0){fill_subscribers_slate("subscribers-slate","unsubscribe-subscribers")}}});$("#campaign-analysis-tabs-content").html(c.el);$("#subscribers-block").hide();$("#campaign-tabs .select").removeClass("select");$(".campaign-subscribers-tab").addClass("select")})},hardBouncedSubscribers:function(b){var a=this;a.render_email_reports_select_ui(b,function(){if(!a.workflow_list_view||a.workflow_list_view.collection.length==0){a.navigate("workflows",{trigger:true});return}var c=get_campaign_subscribers_collection(b,"core/api/workflows/hardbounced-subscribers/"+b,"workflow-other-subscribers");c.collection.fetch({success:function(d){if(d.length===0){fill_subscribers_slate("subscribers-slate","hardbounced-subscribers")}}});$("#campaign-analysis-tabs-content").html(c.el);$("#subscribers-block").hide();$("#campaign-tabs .select").removeClass("select");$(".campaign-subscribers-tab").addClass("select")})},softBouncedSubscribers:function(b){var a=this;a.render_email_reports_select_ui(b,function(){if(!a.workflow_list_view||a.workflow_list_view.collection.length==0){a.navigate("workflows",{trigger:true});return}var c=get_campaign_subscribers_collection(b,"core/api/workflows/softbounced-subscribers/"+b,"workflow-other-subscribers");c.collection.fetch({success:function(d){if(d.length===0){fill_subscribers_slate("subscribers-slate","softbounced-subscribers")}}});$("#campaign-analysis-tabs-content").html(c.el);$("#subscribers-block").hide();$("#campaign-tabs .select").removeClass("select");$(".campaign-subscribers-tab").addClass("select")})},spamReportedSubscribers:function(b){var a=this;a.render_email_reports_select_ui(b,function(){if(!a.workflow_list_view||a.workflow_list_view.collection.length==0){a.navigate("workflows",{trigger:true});return}var c=get_campaign_subscribers_collection(b,"core/api/workflows/spam-reported-subscribers/"+b,"workflow-other-subscribers");c.collection.fetch({success:function(d){if(d.length===0){fill_subscribers_slate("subscribers-slate","spam-reported-subscribers")}}});$("#campaign-analysis-tabs-content").html(c.el);$("#subscribers-block").hide();$("#campaign-tabs .select").removeClass("select");$(".campaign-subscribers-tab").addClass("select")})},render_email_reports_select_ui:function(b,a){if(!$("#campaign-reports-select").html()){getTemplate("campaign-analysis",{},undefined,function(e){if(!e){return}$("#content").html($(e));var d="<option value='{{id}}'>{{name}}</option>";fillSelect("campaign-reports-select","/core/api/workflows","workflow",function c(){if(b){$("#campaign-reports-select").find("option[value="+b+"]").attr("selected","selected")}},d);initializeLogReportHandlers();if(a){a()}},"#content");return}if(a){a()}},shareWorkflow:function(b,f,g){this.workflow_list_view=new Base_Collection_View({url:"/core/api/workflows",restKey:"workflow",sort_collection:false,templateKey:"workflows",individual_tag_name:"tr",cursor:true,page_size:20,postRenderCallback:function(h){}});var e=new Workflow_Model_Events({url:"core/api/workflow",template:"workflow-add",isNew:"true",data:{is_new:true,is_disabled:false,was_disabled:false},postRenderCallback:function(h){send_verify_email(h)}});var d=Backbone.Model.extend({url:"/core/api/workflows/shareCampAPI?id="+b+"&senderDomain="+f});var a=new d();var c=this;a.fetch({success:function(h){c.workflow_json=h.toJSON().rules;console.log(h.toJSON().rules);$("#content").html(e.render().el);App_Workflows.workflow_list_view.collection.remove()},error:function(h){$("#content").html(e.render().el)}})}});var TicketMacroRouter=Backbone.Router.extend({routes:{macros:"macros","macro-add":"macroAdd","macro-edit/:id":"macroEdit"},macros:function(){this.macrosCollection=new Base_Collection_View({url:"/core/api/ticket/macros",sort_collection:false,templateKey:"ticket-macros",individual_tag_name:"tr",cursor:true,page_size:20,slateKey:"ticket-macros",postRenderCallback:function(a){agileTimeAgoWithLngConversion($("time.macro-created-time",a))}});this.macrosCollection.collection.fetch();$("#content").html(this.macrosCollection.el)},macroAdd:function(){var b=Backbone.Model.extend({url:"misc/ticket-templates/macro_template.jsp"});var a=new b();a.fetch({success:function(c){App_Ticket_Macros.constructMacroAddEditTemplate(a)}})},macroEdit:function(c){try{var b=this.macrosCollection.collection.get(c);b.set("actions",JSON.parse(b.toJSON().actions));this.constructMacroAddEditTemplate(b)}catch(a){this.navigate("macros",{trigger:true});return}},constructMacroAddEditTemplate:function(a){this.macroModelview=new Base_Model_View({url:"/core/api/ticket/macros",template:"ticket-macro-add-edit",isNew:true,model:a,window:"macros",errorCallback:function(b){showAlertModal(b.responseText,undefined,undefined,undefined,"Error")},postRenderCallback:function(b){initializeTicketMacroListeners(b)}});$("#content").html(this.macroModelview.render().el)}});var TicketsUtilRouter=Backbone.Router.extend({routes:{tickets:"tickets","tickets/filter/:id":"ticketsByFilter","tickets/filter/:id/ticket/:id":"ticketDetailsByFilter","ticket/:id":"ticketDetails","tickets/bulk-actions/:action_type":"ticketsBulkActions","ticket-groups":"ticketGroups","add-ticket-group":"addTicketGroup","ticket-group/:id":"editTicketGroup","ticket-labels":"ticketLabels","add-ticket-label":"addTicketLabel","ticket-label/:id":"editTicketLabel","ticket-views":"ticketFilters","add-ticket-view":"addTicketFilter","ticket-view/:id":"editTicketFilter","canned-responses":"cannedResponses","add-canned-response":"addCannedResponse","edit-canned-response/:id":"editCannedResponse","ticket-reports":"ticketReports","ticket-report/:report_type":"ticketReport",knowledgebase:"categories","knowledgebase/:id/sections":"sections","knowledgebase/:name/articles":"articles","knowledgebase/add-article":"addArticle","knowledgebase/add-article/:id":"addArticle","knowledgebase/section/:section_id/edit-article/:name":"editArticle","knowledgebase/section/:section_id/article/:id":"showArticle","knowledgebase/add-section":"addSection","knowledgebase/add-section/:id":"addSection","knowledgebase/category/:categorie_id/section/:id/edit-section":"editSection","knowledgebase/add-category":"addCategory","knowledgebase/:id/edit-category":"editCategory",selectlandingpage:"addLandingpage"},tickets:function(){loadServiceLibrary(function(){App_Ticket_Module.ticketsByFilter(Ticket_Filter_ID)});make_menu_item_active("tickets")},renderNewTicketModalView:function(){loadServiceLibrary(function(){var a=new Base_Model_View({isNew:true,template:"ticket-new-modal",url:"/core/api/tickets/new-ticket",saveCallback:function(){$("#ticketsModal").modal("hide")},prePersist:function(d){var e={};var f=$("#groupID option:selected").data("assignee-id");if(f){e.assigneeID=f}var b=$("#last_name").val();if(b){e.requester_name=$("#first_name").val()+" "+b}var c=$("#email_input").val();if(c){e.requester_email=c}d.set(e,{silent:true})},postRenderCallback:function(b){b.on("click",".add-ticket-contact",function(c){$("div.new-contact-row").toggle();$("div.search-contact-row").toggle();$("#email_input").val($("#requester_email").val())})}});$("#ticketsModal").html(a.render().el).modal("show").on("shown.bs.modal",function(){Tickets.initNewTicketTypeahead($("#ticketsModal"))});$("#ticketsModal").on("hidden.bs.modal",function(b){$(b.currentTarget).unbind()})})},ticketsByFilter:function(a){loadServiceLibrary(function(){$.getJSON("/core/api/tickets/count",function(b){if(b.count){Helpdesk_Enabled=true}});if(App_Ticket_Module.ticketsCollection&&App_Ticket_Module.ticketsCollection.collection.length>0&&Ticket_Filter_ID==a){Tickets.renderExistingCollection();return}Ticket_Filter_ID=a;Tickets.renderLayout(function(){Ticket_Custom_Filters.renderLayout();Ticket_Filters.fetchFiltersCollection(function(){Ticket_Custom_Filters.reset();Ticket_Filters.updateFilterName();Tickets.fetchTicketsCollection()})})})},ticketDetailsByFilter:function(b,a){loadServiceLibrary(function(){Ticket_Filter_ID=b;App_Ticket_Module.ticketDetails(a)})},ticketDetails:function(a){loadServiceLibrary(function(){var b=null;if(App_Ticket_Module.ticketsCollection&&App_Ticket_Module.ticketsCollection.collection){b=App_Ticket_Module.ticketsCollection.collection.get(a)}Current_Ticket_ID=a;Ticket_Canned_Response.fetchCollection(function(){if(!b){Tickets.fetchTicketModel(a,function(c){App_Ticket_Module.getTicketModelView(c)});return}App_Ticket_Module.getTicketModelView(b);return})})},getTicketModelView:function(a){loadServiceLibrary(function(){if(!a||!a.toJSON().id){return}var b=a.toJSON().id;App_Ticket_Module.ticketView=new Ticket_Base_Model({model:a,isNew:true,template:"ticket-details",url:"/core/api/tickets/"+b,postRenderCallback:function(c,d){Ticket_Utils.fetchContact(d.contactID,function(){App_Ticket_Module.renderNotesCollection(b,$("#notes-collection-container",c),function(){});if(Ticket_Utils.Current_Ticket_Contact&&!$.isEmptyObject(Ticket_Utils.Current_Ticket_Contact.toJSON())){$("#ticket-contact-details",c).html(getTemplate("ticket-contact",Ticket_Utils.Current_Ticket_Contact.toJSON()))}else{$("#ticket-contact-details",c).html(getTemplate("ticket-contact-fallback",d))}loadWidgets(c,Ticket_Utils.Current_Ticket_Contact.toJSON(),"widgets")});Tickets_Notes.repltBtn("reply",c);Ticket_Utils.enableTooltips(c);Ticket_Labels.showSelectedLabels(d.labels,$(c),true);Tickets.ticketsloadWidgets(App_Ticket_Module.ticketView.el);Tickets.fillAssigneeAndGroup(c);Tickets.initializeTicketSLA(c);Tickets.initializeTicketSLAinHours(c);Tickets.ticket_detail_view_navigation(b,c);agile_type_ahead("cc_email_field",c,Tickets_Typeahead.contact_typeahead,function(g,e){e=e.split(" ").join("");var f=TYPEHEAD_EMAILS[e+"-"+g];if(!f||f=="No email"){return}$("#cc_email_field").val("");Tickets.updateCCEmails(f,"add")},undefined,undefined,"core/api/search/");Tickets.initCCEmailsListeners();Tickets.showPreviousTicketCount(d.requester_email,c)}});$("#content").html(App_Ticket_Module.ticketView.render().el)})},ticketsBulkActions:function(a){loadServiceLibrary(function(){Ticket_Bulk_Ops.renderTemplate(a)
})},ticketGroups:function(){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsHelpdeskTemplate({groups:true},function(a){App_Ticket_Module.groupsCollection=new Base_Collection_View({url:"/core/api/tickets/groups",templateKey:"ticket-groups",sort_collection:true,descending:true,sortKey:"updated_time",individual_tag_name:"tr",postRenderCallback:function(b,c){$("#ticket-groups-model-list",b).on("click","a.a-frwd-email",function(d){console.log("e");d.stopPropagation();d.stopImmediatePropagation()});loadZeroclipboard2(function(){var f=c.toJSON();for(var e=0;e<f.length;e++){var d=f[e];initZeroClipboard2($("#grp-"+d.id),$("#source-"+d.id))}})}});App_Ticket_Module.groupsCollection.collection.fetch();$(".ticket-settings",$("#admin-prefs-tabs-content")).html(App_Ticket_Module.groupsCollection.el);if(a){a()}})});make_menu_item_active("ticketgroupsmenu")},addTicketGroup:function(){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(b){var a=new Base_Model_View({isNew:true,template:"add-edit-ticket-group",url:"/core/api/tickets/groups",saveCallback:function(){Backbone.history.navigate("ticket-groups",{trigger:true})},postRenderCallback:function(c){App_Ticket_Module.renderUsersCollection($("#users-collection",c));var d="<option value='{{id}}'>{{name}}</option>";fillSelect("template_id","/core/api/email/templates","",function(e){},d,false,c)}});$("#admin-prefs-tabs-content").html(a.render().el);if(b){b()}})})},editTicketGroup:function(a){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(d){if(!App_Ticket_Module.groupsCollection||!App_Ticket_Module.groupsCollection.collection){Backbone.history.navigate("ticket-groups",{trigger:true});return}var c=App_Ticket_Module.groupsCollection.collection.get(a);var b=new Base_Model_View({model:c,isNew:true,template:"add-edit-ticket-group",saveCallback:function(){Backbone.history.navigate("ticket-groups",{trigger:true})},url:"/core/api/tickets/groups",postRenderCallback:function(e,f){App_Ticket_Module.renderUsersCollection($("#users-collection",e),function(){var j=f.agents_keys;for(var g=0;g<j.length;g++){$("input[data='"+j[g]+"']").attr("checked","checked")}var h="<option value='{{id}}'>{{name}}</option>";fillSelect("template_id","/core/api/email/templates","",function(){if(f.template_id){$("#template_id option[value="+f.template_id+"]",e).attr("selected","selected")}},h,false,e);loadZeroclipboard2(function(){initZeroClipboard2($("#grp-"+f.id),$("#source-"+f.id))})})}});$("#admin-prefs-tabs-content").html(b.render().el);if(d){d()}})})},ticketLabels:function(){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsHelpdeskTemplate({labels:true},function(a){Ticket_Labels.labelsCollection=new Base_Collection_View({url:"core/api/tickets/labels",templateKey:"ticket-label",individual_tag_name:"tr",sort_collection:true,descending:true,sortKey:"updated_time"});Ticket_Labels.labelsCollection.collection.fetch();$(".ticket-settings",$("#admin-prefs-tabs-content")).html(Ticket_Labels.labelsCollection.el);if(a){a()}})});make_menu_item_active("ticketlabelsmenu")},addTicketLabel:function(){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(b){var a=new Base_Model_View({isNew:false,template:"ticket-label-add-edit",url:"/core/api/tickets/labels",window:"ticket-labels",errorCallback:function(c){$(".error_message_label").css("display","block");$(".error_message_label").text(c.responseText).delay(5000).hide(1)}});$("#admin-prefs-tabs-content").html(a.render().el);if(b){b()}})})},editTicketLabel:function(a){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(d){if(!Ticket_Labels.labelsCollection||!Ticket_Labels.labelsCollection.collection){Backbone.history.navigate("ticket-labels",{trigger:true});return}var c=Ticket_Labels.labelsCollection.collection.get(a);var b=new Base_Model_View({model:c,isNew:true,template:"ticket-label-add-edit",url:"/core/api/tickets/labels",window:"ticket-labels"});$("#admin-prefs-tabs-content").html(b.render().el);if(d){d()}})})},ticketFilters:function(){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsHelpdeskTemplate({filters:true},function(a){App_Ticket_Module.ticketFiltersCollection=new Base_Collection_View({url:"/core/api/tickets/filters",templateKey:"ticket-filters",individual_tag_name:"tr",sort_collection:true,sortKey:"updated_time",descending:true,slateKey:"no-ticket-filters"});App_Ticket_Module.ticketFiltersCollection.collection.fetch();$(".ticket-settings",$("#admin-prefs-tabs-content")).html(App_Ticket_Module.ticketFiltersCollection.el);if(a){a()}})});make_menu_item_active("ticketviewsmenu")},addTicketFilter:function(){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(b){var a=new Ticket_Base_Model({isNew:true,template:"ticket-filter-add-edit",url:"/core/api/tickets/filters",window:"ticket-views",postRenderCallback:function(c){head.js("lib/agile.jquery.chained.min.js?_="+_agile_get_file_hash("agile.jquery.chained.min.js"),function(){Ticket_Filters.initChaining(c)})}});$("#admin-prefs-tabs-content").html(a.render().el);if(b){b()}})})},editTicketFilter:function(a){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(d){if(!App_Ticket_Module.ticketFiltersCollection||!App_Ticket_Module.ticketFiltersCollection.collection){Backbone.history.navigate("ticket-views",{trigger:true});return}var b=App_Ticket_Module.ticketFiltersCollection.collection.get(a);var c=new Ticket_Base_Model({model:b,isNew:true,url:"/core/api/tickets/filters",template:"ticket-filter-add-edit",window:"ticket-views",postRenderCallback:function(e,f){head.js(LIB_PATH+"lib/agile.jquery.chained.min.js?_="+_agile_get_file_hash("agile.jquery.chained.min.js"),function(){Ticket_Filters.initChaining(e,f)})}});$("#admin-prefs-tabs-content").html(c.render().el);if(d){d()}})})},cannedResponses:function(){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsHelpdeskTemplate({canned_responses:true},function(a){Ticket_Labels.fetchCollection(function(){App_Ticket_Module.cannedResponseCollection=new Base_Collection_View({url:"/core/api/tickets/canned-messages",templateKey:"ticket-canned-response",individual_tag_name:"tr",sort_collection:true,sortKey:"updated_time",descending:true,slateKey:"no-groups"});App_Ticket_Module.cannedResponseCollection.collection.fetch();$(".ticket-settings",$("#admin-prefs-tabs-content")).html(App_Ticket_Module.cannedResponseCollection.el);if(a){a()}})})});make_menu_item_active("ticketcannedmessagesmenu")},addCannedResponse:function(){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(b){var a=new Base_Model_View({isNew:true,template:"ticket-canned-response-add-edit",url:"/core/api/tickets/canned-messages",window:"canned-responses",postRenderCallback:function(c){Ticket_Labels.showSelectedLabels([],$(c));initTicketCannedResponseEvents(c)}});$("#admin-prefs-tabs-content").html(a.render().el);if(b){b()}})})},editCannedResponse:function(a){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(d){if(!App_Ticket_Module.cannedResponseCollection||!App_Ticket_Module.cannedResponseCollection.collection){Backbone.history.navigate("canned-responses",{trigger:true});return}var b=App_Ticket_Module.cannedResponseCollection.collection.get(a);var c=new Base_Model_View({model:b,isNew:true,url:"/core/api/tickets/canned-messages",template:"ticket-canned-response-add-edit",window:"canned-responses",postRenderCallback:function(e){Ticket_Labels.showSelectedLabels(b.toJSON().labels,$(e));initTicketCannedResponseEvents(e)}});$("#admin-prefs-tabs-content").html(c.render().el);if(d){d()}})})},ticketReports:function(){loadServiceLibrary(function(){getTemplate("ticket-report-container",{},undefined,function(a){if(!a){return}$("#content").html($(a));hideTransitionBar();$('#ticket-reports-tab-container a[href="#overview"]').tab("show")})})},ticketReport:function(a){loadServiceLibrary(function(){report_utility.loadReportsTemplate(function(){hideTransitionBar();$(".active").removeClass("active");$("#reportsmenu").addClass("active");initReportLibs(function(){var b="",c;switch(a){case"tickets":b="tickets-report";c=Ticket_Reports.tickets;break;case"priority-report":b="ticket-priority-report";c=Ticket_Reports.priorityReports;break;case"sla-report":b="ticket-sla-report";c=Ticket_Reports.slaReport;break;case"avg-first-resp-time":b="ticket-avg-first-resp-time";c=Ticket_Reports.avgFirstRespTime;break}getTemplate(b,{},undefined,function(e){if(!e){return}var d=$(e);$(".reports-Container").html(d);initDateRange(c);c()},".reports-Container")})})})},renderActivitiesCollection:function(b,a,c){App_Ticket_Module.activitiesCollection=new Base_Collection_View({url:"/core/api/tickets/activity?id="+b,templateKey:"ticket-activities",sort_collection:true,sortKey:"time",customLoader:true,customLoaderTemplate:"ticket-notes-loader",descending:true,individual_tag_name:"div",postRenderCallback:function(d){agileTimeAgoWithLngConversion($("time",d));if(c){c()}}});App_Ticket_Module.activitiesCollection.collection.fetch();a.html(App_Ticket_Module.activitiesCollection.el)},renderNotesCollection:function(b,a,c){App_Ticket_Module.notesCollection=new Base_Collection_View({url:"/core/api/tickets/notes/"+b,templateKey:"ticket-notes",sortKey:"created_time",customLoader:true,customLoaderTemplate:"ticket-notes-loader",descending:true,individual_tag_name:"div",postRenderCallback:function(d){agileTimeAgoWithLngConversion($("time",d));if(c){c()}}});App_Ticket_Module.notesCollection.collection.fetch();a.html(App_Ticket_Module.notesCollection.el)},renderUsersCollection:function(c,d){var a=Backbone.Collection.extend({url:"/core/api/users"});var b=new a();b.fetch({success:function(){var g=b.toJSON();g.sort(function(i,h){if(i.name<h.name){return -1}if(h.name<i.name){return 1}return 0});var f="";for(var e=0;e<g.length;e++){f+=getTemplate("ticket-add-group-user",g[e])}c.html(f);if(d){d()
}}})},loadAdminsettingsTemplate:function(a){getTemplate("admin-settings",{},undefined,function(c){if(!c){return}$("#content").html($(c));var b=function(){$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".helpdesk-tab").addClass("select")};if(a){a(b)}})},categories:function(){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsHelpdeskTemplate({knowledgebase:true},function(a){App_Ticket_Module.categoriesCollection=new Base_Collection_View({url:"/core/api/knowledgebase/categorie",templateKey:"ticket-helpcenter-categories",individual_tag_name:"tr",sortKey:"updated_time",sort_collection:"true",postRenderCallback:function(b,c){head.js(LIB_PATH+"lib/jquery-ui.min.js",function(){$(b).find("tbody").each(function(d){$(this).sortable({items:"tr",helper:function(h,f){var g=f.children();var i=f.clone();i.children().each(function(e){$(this).width(g.eq(e).width());console.log("-----------"+g.eq(e).width())});return i},start:function(e,f){$.each(f.item.children(),function(g,h){f.helper.children().eq(g).width(f.helper.children().eq(g).width()-$(this).width())});f.helper.width(f.helper.width())},sort:function(e,f){f.helper.css("top",(f.helper.offset().top+f.item.offset().top)+"px")},forceHelperSize:true,placeholder:"<tr><td></td></tr>",forcePlaceholderSize:true,handle:".icon-move",cursor:"move",tolerance:"intersect",});$("#ticket-helpcenter-categories-model-list",$("#ticket-categorie-table")).on("sortstop",function(f,g){var e=[];$("#ticket-helpcenter-categories-model-list > tr").each(function(h){e[h]=$(this).data().id});$.ajax({type:"POST",url:"/core/api/knowledgebase/categorie/position",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",success:function(h){$.each(e,function(i,j){$("#dealSourcesForm_"+j).find('input[name="order"]').val(i)})}})})})})}});if(!App_Ticket_Module.categoriesCollection.collection.fetch()){setTimeout(function(){App_Ticket_Module.categoriesCollection.collection.fetch()},2000)}$(".ticket-settings",$("#admin-prefs-tabs-content")).html(App_Ticket_Module.categoriesCollection.el)})});make_menu_item_active("ticketknowledgebasemenu")},sections:function(a){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsHelpdeskTemplate({knowledgebase:true},function(b){App_Ticket_Module.sectionsCollection=new Base_Collection_View({url:"/core/api/knowledgebase/section/"+a,templateKey:"ticket-helpcenter-sections",individual_tag_name:"tr",sort_collection:true,sortKey:"order",postRenderCallback:function(c,d){head.js(LIB_PATH+"lib/jquery-ui.min.js",function(){$(c).find("tbody").each(function(e){$(this).sortable({items:"tr",helper:function(h,f){var g=f.children();var i=f.clone();i.children().each(function(j){$(this).width(g.eq(j).width());console.log("-----------"+g.eq(j).width())});return i},start:function(f,g){$.each(g.item.children(),function(h,i){g.helper.children().eq(h).width(g.helper.children().eq(h).width()-$(this).width())});g.helper.width(g.helper.width())},sort:function(f,g){g.helper.css("top",(g.helper.offset().top+g.item.offset().top)+"px")},forceHelperSize:true,placeholder:"<tr><td></td></tr>",forcePlaceholderSize:true,handle:".icon-move",cursor:"move",tolerance:"intersect",});$("#ticket-helpcenter-sections-model-list",$("#ticket-section-table")).on("sortstop",function(g,h){var f=[];$("#ticket-helpcenter-sections-model-list > tr").each(function(i){f[i]=$(this).data().id});$.ajax({type:"POST",url:"/core/api/knowledgebase/section/position",data:JSON.stringify(f),contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){$.each(f,function(j,k){$("#dealSourcesForm_"+k).find('input[name="order"]').val(j)})}})})})})}});App_Ticket_Module.sectionsCollection.collection.fetch();$(".ticket-settings",$("#admin-prefs-tabs-content")).html(App_Ticket_Module.sectionsCollection.el)})})},articles:function(a){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsHelpdeskTemplate({knowledgebase:true},function(b){App_Ticket_Module.articlesCollection=new Base_Collection_View({url:"/core/api/knowledgebase/article/admin-articles?section_id="+a,templateKey:"ticket-helpcenter-articles",individual_tag_name:"tr",sort_collection:true,sortKey:"order",postRenderCallback:function(c,d){head.js(LIB_PATH+"lib/jquery-ui.min.js",function(){$(c).find("tbody").each(function(e){$(this).sortable({items:"tr",helper:function(h,f){var g=f.children();var i=f.clone();i.children().each(function(j){$(this).width(g.eq(j).width());console.log("-----------"+g.eq(j).width())});return i},start:function(f,g){$.each(g.item.children(),function(h,i){g.helper.children().eq(h).width(g.helper.children().eq(h).width()-$(this).width())});g.helper.width(g.helper.width())},sort:function(f,g){g.helper.css("top",(g.helper.offset().top+g.item.offset().top)+"px")},forceHelperSize:true,placeholder:"<tr><td></td></tr>",forcePlaceholderSize:true,handle:".icon-move",cursor:"move",tolerance:"intersect",});$("#ticket-helpcenter-articles-model-list",$("#ticket-article-table")).on("sortstop",function(g,h){var f=[];$("#ticket-helpcenter-articles-model-list > tr").each(function(i){f[i]=$(this).data().id});$.ajax({type:"POST",url:"/core/api/knowledgebase/article/position",data:JSON.stringify(f),contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){$.each(f,function(j,k){$("#dealSourcesForm_"+k).find('input[name="order"]').val(j)})}})})})})}});App_Ticket_Module.articlesCollection.collection.fetch();$(".ticket-settings",$("#admin-prefs-tabs-content")).html(App_Ticket_Module.articlesCollection.el)})})},addArticle:function(a){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(c){var b=new Base_Model_View({isNew:true,url:"/core/api/knowledgebase/article",template:"ticket-helpcenter-add-article",window:"back",prePersist:function(e){var i=e.toJSON().title;i=$.trim(i);var f={};var d=$("#catogery option:selected").data("catogery-id");var j=encodeURIComponent(i);f={categorie_id:d,title:i,encodedtitle:j};var h="";try{h=$(tinyMCE.activeEditor.getBody()).text();f.plain_content=h}catch(g){}e.set(f,{silent:true})},postRenderCallback:function(d){setupTinyMCEEditor("textarea#description-article",true,undefined,function(){$("textarea#description-article").css("display","none")});a=decodeURIComponent(a);fillSelect("catogery","/core/api/knowledgebase/categorie/kb-admin","",function(e){getTemplate("helpcenter-section-category",e.toJSON(),undefined,function(f){if(!f){return}$("#catogery",d).html($(f));if(a){$('#catogery option[value="'+a+'"]',d).attr("selected","selected")}if(c){c()}})},"",true)},});$("#admin-prefs-tabs-content").html(b.render().el);if(c){c()}})})},editArticle:function(b,a){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(d){var c=new Base_Model_View({isNew:false,url:"/core/api/knowledgebase/article/"+a,template:"ticket-helpcenter-add-article",window:"back",prePersist:function(f){var h=f.toJSON().title;h=$.trim(h);var i=encodeURIComponent(h);var g={};var e=$("#catogery option:selected").data("catogery-id");g={categorie_id:e,title:h,encodedtitle:i};f.set(g,{silent:true})},postRenderCallback:function(e){setupTinyMCEEditor("textarea#description-article",true,undefined,function(){$("textarea#description-article").css("display","none")});fillSelect("catogery","/core/api/knowledgebase/categorie/kb-admin","",function(f){$("#catogery",e).html(getTemplate("helpcenter-section-category",f.toJSON()));$('#catogery option[value="'+b+'"]',e).attr("selected",true)},"",true)}});$("#admin-prefs-tabs-content").html(c.render().el);if(d){d()}})})},showArticle:function(b,a){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(d){var c=new Base_Model_View({isNew:false,template:"ticket-helpcenter-article",url:"/core/api/knowledgebase/article/"+a,postRenderCallback:function(e,f){}});$("#admin-prefs-tabs-content").html(c.render().el)})})},addSection:function(a){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(c){var b=new Base_Model_View({isNew:true,url:"/core/api/knowledgebase/section",template:"ticket-helpcenter-add-section",window:"back",prePersist:function(e){var f={};var d=e.toJSON().name;d=$.trim(d);f={name:d};e.set(f,{silent:true})},postRenderCallback:function(e){var d="<option value={{id}}>{{name}}</option>";fillSelect("catogery","/core/api/knowledgebase/categorie","",function(){if(!a){return}$('select option[value="'+a+'"]').attr("selected",true)},d,true)}});$("#admin-prefs-tabs-content").html(b.render().el)})})},editSection:function(c,b){var a=$("#"+b).data("id");loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(e){var d=new Base_Model_View({isNew:false,template:"ticket-helpcenter-add-section",url:"/core/api/knowledgebase/section/kb-admin?id="+b,window:"back",postRenderCallback:function(g){var f="<option value={{id}}>{{name}}</option>";fillSelect("catogery","/core/api/knowledgebase/categorie","",function(){$('select option[value="'+c+'"]').attr("selected",true)},f,true)},prePersist:function(g){var h={};var f=g.toJSON().name;f=$.trim(f);h={name:f};g.set(h,{silent:true})}});$("#admin-prefs-tabs-content").html(d.render().el)})})},addLandingpage:function(){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(b){var a=new Base_Model_View({isNew:false,template:"ticket-helpcenter-select-landingpage",url:"/core/api/knowledgebase/KBlandingpage",postRenderCallback:function(e,d){var f=d.kb_landing_page_id;var c=d.id;var g="<option value='{{id}}'>{{name}}</option>";fillSelect("template_id","/core/api/landingpages?page_size=20","",function(){$("#template_id",e).append("<option value=1>Default</option>");$('#template_id option[value=""]',e).attr("value",0);$('#template_id option[value="'+f+'"]',e).attr("selected",true)},g,false,e,"Basic")}});$("#admin-prefs-tabs-content").html(a.render().el)})})},addCategory:function(){loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(b){var a=new Base_Model_View({isNew:true,url:"/core/api/knowledgebase/categorie",template:"helpcenter-add-catogery",window:"back",});
$("#admin-prefs-tabs-content").html(a.render().el)})})},editCategory:function(a){if(!App_Ticket_Module.categoriesCollection||!App_Ticket_Module.categoriesCollection.collection){return}loadServiceLibrary(function(){App_Ticket_Module.loadAdminsettingsTemplate(function(d){var c=App_Ticket_Module.categoriesCollection.collection.get(a);console.log(c);var b=new Base_Model_View({model:c,isNew:true,url:"/core/api/knowledgebase/categorie",template:"helpcenter-add-catogery",window:"back",});$("#admin-prefs-tabs-content").html(b.render().el)})})},loadAdminsettingsHelpdeskTemplate:function(a,b){getTemplate("admin-settings",{},undefined,function(c){if(!c){return}$("#content").html($(c));getTemplate("ticket-settings-nav-tab",a,undefined,function(e){if(!e){return}$("#admin-prefs-tabs-content").html($(e));var d=function(){$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".helpdesk-tab").addClass("select")};if(b){b(d)}},"#admin-prefs-tabs-content")},"#content")},});var PortletsRouter=Backbone.Router.extend({routes:{"add-dashlet":"adddashlet"},adddashlet:function(){$("#content").html("<div id='portlets-add-listener'></div>");this.Catalog_Portlets_View=new Base_Collection_View({url:"/core/api/portlets/default",templateKey:"portlets-add",sort_collection:false,individual_tag_name:"div",postRenderCallback:function(a){$('#dashlet-tabs-content a[href="#contacts_dashlet"]').tab("show");var b=["deals","taksAndEvents","userActivity"];$.each(b,function(c,d){if($("#"+d).children().length==0){$("#"+d).closest(".tab-container").find("."+d+"-aclpermission").hide()}});preloadImages([updateImageS3Path("flatfull/img/dashboard_images/Mini-Calendar.jpg"),updateImageS3Path("flatfull/img/dashboard_images/stats.png"),updateImageS3Path("flatfull/img/dashboard_images/Leaderboard.png"),updateImageS3Path("flatfull/img/dashboard_images/account-information.png"),updateImageS3Path("flatfull/img/dashboard_images/Activities.png"),updateImageS3Path("flatfull/img/dashboard_images/Agile-Blog.png"),updateImageS3Path("flatfull/img/dashboard_images/Calls.png"),updateImageS3Path("flatfull/img/dashboard_images/Deals-Funnel.png"),updateImageS3Path("flatfull/img/dashboard_images/Email-opened.png"),updateImageS3Path("flatfull/img/dashboard_images/Events.png"),updateImageS3Path("flatfull/img/dashboard_images/Milestone.png"),updateImageS3Path("flatfull/img/dashboard_images/My-contacts.png"),updateImageS3Path("flatfull/img/dashboard_images/Pending-Deals.png"),updateImageS3Path("flatfull/img/dashboard_images/Revenue-graph.png"),updateImageS3Path("flatfull/img/dashboard_images/Tag-Graph.png"),updateImageS3Path("flatfull/img/dashboard_images/Task-report.png"),updateImageS3Path("flatfull/img/dashboard_images/Task.png"),updateImageS3Path("flatfull/img/dashboard_images/User-Activities.png"),updateImageS3Path("flatfull/img/dashboard_images/Campaign-stats-new.jpg"),updateImageS3Path("flatfull/img/dashboard_images/Quota.png"),updateImageS3Path("flatfull/img/dashboard_images/incoming-deals-new.png"),updateImageS3Path("flatfull/img/dashboard_images/lost-deal-analysis-new.png"),updateImageS3Path("flatfull/img/dashboard_images/Average_deviation.png"),updateImageS3Path("flatfull/img/dashboard_images/Refferalurl-Stats-new.png"),]);initializeAddPortletsListeners()}});this.Catalog_Portlets_View.appendItem=organize_portlets;this.Catalog_Portlets_View.collection.fetch();$("#portlets-add-listener").html(this.Catalog_Portlets_View.render().el)}});function preloadImages(a){$(a).each(function(){$("<img />").attr("src",this).appendTo("body").css("display","none")})}function deletePortlet(d){var f=d.id.split("-close")[0];var b=$("#portletDeleteModal");b.modal("show");b.find(".save-modal").attr("id",f);var a=Portlets_View.collection.get(f);var g=$("#"+f).parent().find(".portlet_header > h4 > span").text();var e=$("#"+f).parent().find(".portlet_header > h4 > small").text();var c="";if(g&&g.trim()!="Getting Started"){c=_agile_get_translated_val("portlets","delete-dashlet-confirm")+g.trim()+" "+e.trim()+"?"}else{if(g&&g.trim()=="Getting Started"){c=_agile_get_translated_val("portlets","delete-dashlet-confirm")+g.trim()+"?<br/>"+_agile_get_translated_val("portlets","no-back-after-delete")}else{if(a.get("name")=="Leaderboard"){c=_agile_get_translated_val("portlets","delete-leaderboard-dashlet-confirm")+portlet_utility.getDurationForPortlets(a.get("settings").duration,function(h){return h})+"?"}else{if(a.get("name")=="Mini Calendar"){c=_agile_get_translated_val("portlets","delete-mini-calendar-dashlet-confirm")}else{if(a.get("name")=="Deal Goals"){c=_agile_get_translated_val("portlets","delete-deal-goals-dashlet-confirm")+" "+portlet_utility.getDurationForPortlets(a.get("settings").duration,function(h){return h})+"?"}else{c=_agile_get_translated_val("portlets","delete-activity-overview-dashlet-confirm")+" "+portlet_utility.getDurationForPortlets(a.get("settings").duration,function(h){return h})+"?"}}}}}b.find(".modal-body").html(c)}function hidePortletErrors(a){if($("#"+a.id).next().is(":visible")){$("#"+a.id).next().hide()}}function displayTimeAgo(a){agileTimeAgoWithLngConversion($(".time-ago",a));console.log($("article.stream-item").parent());$("article.stream-item").parent().addClass("social-striped")}function updateImageS3Path(a){if(!a){a=""}try{if(a){a=a.replace("flatfull/","").replace(/\.{2}/g,"")}}catch(b){}if(!S3_STATIC_IMAGE_PATH){S3_STATIC_IMAGE_PATH="//doxhze3l6s7v9.cloudfront.net/beta/static/"}return(S3_STATIC_IMAGE_PATH+a)}var DEAL_TRACKS_COUNT;var DealDetailsRouter=Backbone.Router.extend({routes:{"deal/:id":"dealdetails","dealEdit/:id":"dealEdit"},dealdetails:function(c){$("#content").html("<div id='deal-detail-page'></div>");if(App_Deals.customFieldsList==null||App_Deals.customFieldsList==undefined){App_Deals.customFieldsList=new Base_Collection_View({url:"/core/api/custom-fields/scope/position?scope=DEAL",sort_collection:false,restKey:"customFieldDefs",templateKey:"admin-settings-customfields",individual_tag_name:"tr"});App_Deals.customFieldsList.collection.fetch()}this.dealDetailView=new Deal_Modal_Event_View({url:"/core/api/opportunity/"+c,template:"deal-detail",postRenderCallback:function(d){$(".content-tabs",d).tabCollapse();if(!DEAL_TRACKS_COUNT){getTracksCount(function(e){DEAL_TRACKS_COUNT=e;initializeDealTabWithCount(c,d)})}else{initializeDealTabWithCount(c,d)}}});var a=this;this.dealDetailView.model.fetch();var b=a.dealDetailView.render(true).el;$("#deal-detail-page").html(getRandomLoadingImg());$("#deal-detail-page").html(b);setup_tags_typeahead()},dealEdit:function(d,b){if(!b){console.log("Downloading deal");var c=Backbone.Model.extend({url:function(){return"/core/api/opportunity/"+this.id}});var a=new c();a.id=d;a.fetch({success:function(e){App_Deal_Details.dealEdit(d,e)},error:function(f,e){if(e&&e.status=="403"){$("#content").html(e.responseText)}}});return}add_custom_fields_to_form(b,function(e){deserialize_deal(e,"deal-detail-edit")},"DEAL")}});function dealNameEdit(c){var a=App_Deal_Details.dealDetailView.model.toJSON();a.name=c;var b=new BaseModel();b.url="/core/api/opportunity";b.save(a,{success:function(d){$("#deals-inline").text(c);$("#inline-input").addClass("hidden");$("#deals-inline").removeClass("hidden");$("#inline-input").removeClass("error-inputfield");App_Deal_Details.dealDetailView.model=b}})}function fill_deal_owners(b,c,d){var a="<li><a href='javascript:void(0);' class='deal-owner-list' data='{{id}}'>{{name}}</a></li>";fillSelect("deal-detail-owner","/core/api/users","domainUsers",d,a,true)}function show_deal_owner(){$("#deal-owner").css("display","inline-block")}function deal_detail_view_navigation(g,b,c){console.log("collection >>>>>>>>>>>>>>>>");console.log(b);var d=b.length;var f=b.indexOf(b.get(g));var a;var e;if(d>1&&f<d&&b.at(f+1)&&b.at(f+1).has("id")){e=b.at(f+1).id}if(d>0&&f!=0&&b.at(f-1)&&b.at(f-1).has("id")){a=b.at(f-1).id}if(a!=null){$(".navigation",c).append('<a style="float:left;" href="#deal/'+a+'" class=""><i class="icon icon-chevron-left"></i></a>')}if(e!=null){$(".navigation",c).append('<a style="float:right;" href="#deal/'+e+'" class=""><i class="icon icon-chevron-right"></i></a>')}}function fill_relation_deal(c){var a=App_Deal_Details.dealDetailView.model.toJSON();var d=a.name;var b=Handlebars.compile('<li class="tag inline-block v-middle m-r-xs btn btn-xs btn-primary" data="{{id}}">{{name}}</li>');$(".tags",c).html(b({name:d,id:a.id}))}function deserialize_deal(b,a){b=b.toJSON();getTemplate(a,b,undefined,function(d){if(!d){return}var c=$("#content").html($(d));deserializeForm(b,c);agile_type_ahead("relates_to",c,contacts_typeahead);populateUsers("owners-list",c,b,"owner",function(e){c.find("#owners-list").html(e);if(b.owner){$("#owners-list",c).find("option[value="+b.owner.id+"]").attr("selected","selected");$("#owners-list",c).closest("div").find(".loading-img").hide()}});populateTracks(c,undefined,b,function(e){populateMilestones(c,undefined,b.pipeline_id,b,function(f){c.find("#milestone").html(f);if(b.milestone){$("#milestone",c).find('option[value="'+b.milestone+'"]').attr("selected","selected")}$("#milestone",c).closest("div").find(".loading-img").hide()})});$("#close_date",c).datepicker({format:CURRENT_USER_PREFS.dateFormat,weekStart:CALENDAR_WEEK_START_DAY,autoclose:true});add_custom_fields_to_form(b,function(f){var e=show_custom_fields_helper(f.custom_fields,[]);$("#custom-field-deals",c).html(fill_custom_fields_values_generic($(e),b.custom_data));$(".date_input",c).datepicker({format:CURRENT_USER_PREFS.dateFormat,weekStart:CALENDAR_WEEK_START_DAY,autoclose:true})},"DEAL")},"#content")}function getTracksCount(a){accessUrlUsingAjax("core/api/milestone/tracks/count",function(b){if(!isNaN(b)){return a(b)}return a(0)})}function initializeDealTabWithCount(c,b){load_deal_tab(b,"");var a;if(App_Deals.opportunityCollectionView&&App_Deals.opportunityCollectionView.collection){a=App_Deals.opportunityCollectionView.collection}if(a!=null&&_agile_get_prefs("agile_deal_view")){deal_detail_view_navigation(c,a,b)
}}function fill_relation_deal_task(c){var a=App_Deal_Details.dealDetailView.model.toJSON();var d=a.name;var b=Handlebars.compile('<li class="tag inline-block v-middle m-r-xs btn btn-xs btn-primary" data="{{id}}">{{name}}</li>');var e=a.contacts;$.each(e,function(g,f){var h=true;$.each($("ul.tags",c).children("li"),function(k,j){if($(j).attr("data")==f.id){h=false;return}});if(h){var i={};i.email_item=f.id;if(f.type=="PERSON"){i.type_item="#contact/"}else{if(f.type=="COMPANY"){i.type_item="#company/"}}i.tag_item=f.id;i.item=getContactName(f);$("ul.tags",c).append(getTemplate("tag-item-li",i))}});$(".deal_tags",c).html(b({name:d,id:a.id}))}var ContactFiltersRouter=Backbone.Router.extend({routes:{"contact-filters":"contactfilters","contact-filter-add":"contactFilterAdd","contact-filter-edit/:id":"contactFilterEdit","contact-filter/:id":"showFilterContacts"},contactfilters:function(){this.contactFiltersList=new Base_Collection_View({url:"/core/api/filters",restKey:"ContactFilter",templateKey:"contact-filter",individual_tag_name:"tr",sort_collection:false,postRenderCallback:function(a){agileTimeAgoWithLngConversion($(".created_time",a))}});this.contactFiltersList.collection.fetch();$("#content").html(this.contactFiltersList.render().el)},contactFilterAdd:function(){var a=new Report_Filters_Event_View({url:"core/api/filters",template:"filter-contacts",isNew:"true",window:"contact-filters",postRenderCallback:function(b){head.js(LIB_PATH+"lib/agile.jquery.chained.min.js?_="+_agile_get_file_hash("agile.jquery.chained.min.js"),function(){chainFiltersForContactAndCompany(b,undefined,function(){$("#content").html(b);scramble_input_names($(b).find("#filter-settings"));$("#contact_type").trigger("change")})})}});$("#content").html(LOADING_HTML);a.render()},contactFilterEdit:function(c){if(!this.contactFiltersList||this.contactFiltersList.collection.length==0||this.contactFiltersList.collection.get(c)==null){this.navigate("contact-filters",{trigger:true});return}$("#content").html(LOADING_HTML);var b=this.contactFiltersList.collection.get(c);var a=new Report_Filters_Event_View({url:"core/api/filters",model:b,template:"filter-contacts",window:"contact-filters",postRenderCallback:function(d){$(d).on("agile_model_loaded",function(f){$("#contact_type").trigger("change")});$("#content").html(LOADING_HTML);head.js(LIB_PATH+"lib/agile.jquery.chained.min.js?_="+_agile_get_file_hash("agile.jquery.chained.min.js"),function(){$("#content").html(LOADING_HTML);chainFiltersForContactAndCompany(d,b.toJSON(),function(){$("#content").html(d)});scramble_input_names($(d).find("#filter-settings"))})},saveCallback:function(d){var e=_agile_get_prefs("contact_filter");if(e&&e==d.id){CONTACTS_HARD_RELOAD=true}}});$("#content").html(LOADING_HTML);a.render()},showFilterContacts:function(a){if(App_Contacts){App_Contacts.contacts(undefined,a)}}});var taskDetailView;var task_tab_position_cookie_name="task_tab_position";var TaskDetailsRouter=Backbone.Router.extend({routes:{"task/:id":"taskDetailView"},taskDetailView:function(c){if(c){if(App_Calendar.allTasksListView){var a=App_Calendar.allTasksListView.collection.get(c);taskDetailView=a;getTemplate("task-detail",a.toJSON(),undefined,function(d){if(!d){return}$("#content").html($(d));initializeTaskDetailListeners();task_details_tab.loadActivitiesView()},"#content")}else{if(App_Calendar.tasksListView){var a=App_Calendar.tasksListView.collection.get(c);if(a){taskDetailView=a;getTemplate("task-detail",a.toJSON(),undefined,function(d){if(!d){return}$("#content").html($(d));initializeTaskDetailListeners();task_details_tab.loadActivitiesView()},"#content")}else{var b=Backbone.Model.extend({});$.ajax({url:"core/api/tasks/getTaskObject/"+c,success:function(d){taskDetailView=new b(d);getTemplate("task-detail",taskDetailView.toJSON(),undefined,function(e){if(!e){return}$("#content").html($(e));initializeTaskDetailListeners();task_details_tab.loadActivitiesView()},"#content")}})}}else{var b=Backbone.Model.extend({});$.ajax({url:"core/api/tasks/getTaskObject/"+c,success:function(d){taskDetailView=new b(d);getTemplate("task-detail",taskDetailView.toJSON(),undefined,function(e){if(!e){return}$("#content").html($(e));initializeTaskDetailListeners();task_details_tab.loadActivitiesView()},"#content")}})}}}}});function initializeTaskDetailListeners(){var a;$('#task-tab-container-header #taskDetailsTab a[href="#timeline"]').off();$("#task-tab-container-header").on("click",'#taskDetailsTab a[href="#timeline"]',function(b){b.preventDefault();save_task_tab_position_in_cookie("timeline");task_details_tab.load_timeline()});$('#task-tab-container-header #taskDetailsTab a[href="#notes"]').off();$("#task-tab-container-header").on("click",'#taskDetailsTab a[href="#notes"]',function(b){b.preventDefault();save_task_tab_position_in_cookie("notes");task_details_tab.load_notes()});$('#task-tab-container-header #taskDetailsTab a[href="#contacts"]').off();$("#task-tab-container-header").on("click",'#taskDetailsTab a[href="#contacts"]',function(b){b.preventDefault();save_task_tab_position_in_cookie("contacts");task_details_tab.loadTaskRelatedContactsView()});$('#task-tab-container-header #taskDetailsTab a[href="#activity"]').off();$("#task-tab-container-header").on("click",'#taskDetailsTab a[href="#activity"]',function(b){b.preventDefault();save_task_tab_position_in_cookie("activity");task_details_tab.loadActivitiesView()});$('#task-tab-container-header #taskDetailsTab a[href="#deals"]').off();$("#task-tab-container-header").on("click",'#taskDetailsTab a[href="#deals"]',function(b){b.preventDefault();save_task_tab_position_in_cookie("deals");task_details_tab.loadTaskRelatedDealsView()});$("#change-owner-element .task-owner-list").off();$("#change-owner-element").on("click",".task-owner-list",function(g){$("#change-task-owner-ul").css("display","none");var b=$(this).attr("data");var d=$(this).text();var f=$("#task-owner").attr("data");if(b==f){show_task_owner();return}var c=new BaseModel();c.url="/core/api/tasks/change-owner/"+b+"/"+taskDetailView.get("id");c.save(taskDetailView.toJSON(),{success:function(e){$("#task-owner").text(d);$("#task-owner").attr("data",b);show_task_owner();taskDetailView=e;task_details_tab.loadActivitiesView()}})});$("#change-owner-element .task-owner-add").off();$("#change-owner-element").on("click",".task-owner-add",function(b){b.preventDefault();fill_task_owners(undefined,undefined,function(){$(".task-owner-add").css("display","none");$("#change-task-owner-ul").css("display","inline-block");$("#change-task-owner-ul").addClass("open");if($("#change-owner-element > #change-task-owner-ul").css("display")=="inline-block"){$("#change-owner-element").find(".loading").remove()}})});$("#change-owner-element #task-owner").off();$("#change-owner-element").on("click","#task-owner",function(b){b.preventDefault();fill_task_owners(undefined,undefined,function(){$("#task-owner").css("display","none");$("#change-task-owner-ul").css("display","inline-block");if($("#change-task-owner-ul").css("display")=="inline-block"){$("#change-owner-element").find(".loading").remove()}})});$("#task_tab_detail .task-note-edit").off();$("#task_tab_detail").on("click",".task-note-edit",function(c){c.preventDefault();var b=notesView.collection.get($(this).attr("data"));console.log(b);deserializeForm(b.toJSON(),$("#tasknoteUpdateForm",$("#tasknoteupdatemodal")));fill_relation_task($("#tasknoteUpdateForm"));$("#tasknoteupdatemodal").modal("show")});$("#tasknoteupdatemodal #task_note_update").off();$("#tasknoteupdatemodal").on("click","#task_note_update",function(c){c.preventDefault();if($(this).attr("disabled")){return}disable_save_button($(this));if(!isValidForm("#tasknoteUpdateForm")){enable_save_button($(this));return}var b=serializeForm("tasknoteUpdateForm");saveTaskNote($("#tasknoteUpdateForm"),$("#tasknoteupdatemodal"),this,b)});$("#task-detail-lhs .delete_task").off();$("#task-detail-lhs").on("click",".delete_task",function(b){var c=$(".delete_task").attr("data");b.preventDefault();showAlertModal("delete_task","confirm",function(){$.ajax({url:"core/api/tasks/"+c,type:"DELETE",success:function(d){document.location.href=document.location.origin+"#/tasks";getDueTasksCount(function(f){var e=f;if(e!=0){$("#due_tasks_count").html(e)}else{$("#due_tasks_count").html("")}})}})})});$("#task_tab_detail .activity-delete").off();$("#task_tab_detail").on("click",".activity-delete",function(b){b.preventDefault();Contact_Details_Tab_Actions.deleteActivity(b)});$("#new-task-modal").on("click","#tasknote_validate",function(c){c.preventDefault();if($(this).attr("disabled")){return}if(!isValidForm("#tasknoteForm")){return}disable_save_button($(this));var b=serializeForm("tasknoteForm");console.log(b);saveTaskNote($("#tasknoteForm"),$("#new-task-modal"),this,b)})}$(function(){$("#content #task_edit").off("click");$("#content").on("click","#task_edit",function(b){b.preventDefault();var c=$(this).attr("data");var a;if(App_Calendar.allTasksListView){a=App_Calendar.allTasksListView.collection.get(c)}else{if(App_Calendar.tasksListView){a=App_Calendar.tasksListView.collection.get(c);if(!a){a=taskDetailView}}else{a=taskDetailView}}if(a){update_task(a.toJSON())}});$("#content .task-add-contact").off("click");$("#content").on("click",".task-add-contact",function(a){a.preventDefault();update_task(taskDetailView.toJSON())});$("#content .task-add-deal").off("click");$("#content").on("click",".task-add-deal",function(a){a.preventDefault();update_task(taskDetailView.toJSON());setTimeout(function(){$("#update_task_relates_to_deals").focus()},1000)})});function activate_timeline_tab(){$("#contactDetailsTab").find("li.active").removeClass("active");$("#contactDetailsTab li:first-child").addClass("active");$("div.tab-content").find("div.active").removeClass("active");$("div.tab-content > div:first-child").addClass("active");if(App_Contacts.contactDetailView.model.get("type")=="COMPANY"){fill_company_related_contacts(App_Contacts.contactDetailView.model.id,"company-contacts")}}function save_task_tab_position_in_cookie(b){var a="";
if(_agile_get_prefs(task_tab_position_cookie_name)){a=_agile_get_prefs(task_tab_position_cookie_name)}if(a==b){return}_agile_set_prefs(task_tab_position_cookie_name,b)}function update_task(a){$("#updateTaskModal").html(getTemplate("task-update-modal")).modal("show");loadProgressSlider($("#updateTaskForm"),function(b){deserializeForm(a,$("#updateTaskForm"));categories.getCategoriesHtml(a,function(c){$("#type",$("#updateTaskForm")).html(c);populateUsers("owners-list",$("#updateTaskForm"),a,"taskOwner",function(d){$("#updateTaskForm").find("#owners-list").html(d);if(a.taskOwner){$("#owners-list",$("#updateTaskForm")).find("option[value="+a.taskOwner.id+"]").attr("selected","selected")}$("#owners-list",$("#updateTaskForm")).closest("div").find(".loading-img").hide()})});activateSliderAndTimerToTaskModal();showNoteOnForm("updateTaskForm",a.notes)});$(".update-task-timepicker",$("#updateTaskModal")).val(fillTimePicker(a.due))}function fill_task_owners(b,c,d){var a="<li><a href='javascript:void(0);' class='task-owner-list' data='{{id}}'>{{name}}</a></li>";fillSelect("task-detail-owner","/core/api/users","domainUsers",d,a,true)}function show_task_owner(){$("#task-owner").css("display","inline-block")}function fill_relation_task(c){var a=taskDetailView.toJSON();var d=a.name;var b=Handlebars.compile('<li class="tag btn btn-xs btn-primary m-r-xs m-b-xs inline-block" data="{{id}}">{{name}}</li>');$(".tags",c).html(b({name:d,id:a.id}))}function saveTaskNote(d,a,b,c){var e=new Backbone.Model();e.url="core/api/notes";e.save(c,{success:function(i){enable_save_button($(b));d.each(function(){this.reset()});a.modal("hide");var g=i.toJSON();console.log(g);if(!notesView){notesView=new Base_Collection_View(i)}if(notesView&&notesView.collection){if(notesView.collection.get(g.id)){notesView.collection.get(g.id).set(new BaseModel(g))}else{var j=taskDetailView.toJSON();var h=[];$.each(j.contacts,function(m,l){h.push(l.id)});var f=[];$.each(j.notes,function(l,m){f.push(m.id)});f.push(g.id);j.contacts=h;j.notes=f;if(j.taskOwner){j.owner_id=j.taskOwner.id}var k=new Backbone.Model();k.url="core/api/tasks";k.save(j,{success:function(l){notesView.collection.add(new BaseModel(g),{sort:false});notesView.collection.sort();taskDetailView=l}})}}}})}CONTACTS_HARD_RELOAD=true;var import_tab_Id;var REFER_DATA;var contact_company;var ContactsRouter=Backbone.Router.extend({routes:{"":"dashboard",dashboard:"dashboard","navigate-dashboard":"navigateDashboard",contacts:"contactsNew","contact/:id":"contactDetails","import":"importContacts","import/salesforce":"salesforceImport","contact-edit":"editContact","contact-add":"addContact","contact-duplicate":"duplicateContact","duplicate-contacts/:id":"duplicateContacts","merge-contacts":"mergeContacts","tags/:tag":"contactsNew","send-email":"sendEmail","send-email/:id":"sendEmail","send-emails/:id":"sendEmailCustom","add-campaign":"addContactToCampaign",gmail:"email",twitter:"socialPrefs",linkedin:"socialPrefs","contacts/call-lead/:first/:last":"addLead","contacts/call-lead/:first/:last/:mob":"addLeadDirectly","contacts/call-lead/:mob":"addMobLead","call-contacts":"callcontacts"},initialize:function(){},salesforceImport:function(){App_Datasync.salesforce()},navigateDashboard:function(){Backbone.history.navigate("#",{trigger:true})},dashboard:function(){insidePopover=false;$("#agile-menu-navigation-container .active").removeClass("active");if(CURRENT_DOMAIN_USER.domain=="admin"){Backbone.history.navigate("domainSearch",{trigger:true});return}var a=_agile_get_prefs("dashboard_"+CURRENT_DOMAIN_USER.id);if(!a){var c=_agile_get_prefs("selected_dashboard_"+CURRENT_DOMAIN_USER.id);if(c=="Dashboard"){a="Dashboard"}}if(!a){_agile_set_prefs("selected_dashboard_"+CURRENT_DOMAIN_USER.id,id);if(CURRENT_DOMAIN_USER.role=="SALES"){a="SalesDashboard"}else{if(CURRENT_DOMAIN_USER.role=="MARKETING"){a="MarketingDashboard"}}}a=a?a:"DashBoard";var b={};if(CURRENT_USER_DASHBOARDS&&a!="DashBoard"){$.each(CURRENT_USER_DASHBOARDS,function(d,e){if(a!="DashBoard"&&e.id==a){b.id=e.id;b.name=e.name;b.description=e.description}})}if(a==="MarketingDashboard"){b.id="MarketingDashboard";b.name="Marketing";b.description=_agile_get_translated_val("dashboards","marketing-help")}else{if(a=="SalesDashboard"){b.id="SalesDashboard";b.name="Sales";b.description=_agile_get_translated_val("dashboards","sales-help")}else{if(!b.id){a="DashBoard"}}}getTemplate("portlets",b,undefined,function(g){if(!g){return}var d=$(g);$("#content").html(d);$('[data-toggle="tooltip"]').tooltip();if((navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&navigator.userAgent.toLowerCase().indexOf("opr/")==-1)&&!document.getElementById("agilecrm_extension")){try{if(typeof chrome&&typeof chrome.app&&!chrome.app.isInstalled){$("#chrome-extension-button").removeClass("hide")}}catch(f){}}loadPortlets(a,d)},"#content")},contacts:function(a,k,d,l){insidePopover=false;if(SCROLL_POSITION){$("html, body").animate({scrollTop:SCROLL_POSITION},1000);SCROLL_POSITION=0}else{$(window).scrollTop(0)}SELECT_ALL=false;var m=null;var n=20;var g=false;var i="contacts";var j="tr";var f=_agile_get_prefs("sort_by_name");if(!f||f==null){f="-created_time";_agile_set_prefs("sort_by_name",f)}if(d||_agile_get_prefs("agile_contact_view")){i="contacts-grid";j="div";m="#contacts-grid-model-list"}var b="/core/api/contacts/list";var h=false;this.tag_id=a;var c;if(a){a=decodeURI(a);a=decodeURI(a);_agile_delete_prefs("contact_filter");_agile_delete_prefs("dynamic_contact_filter");if(this.contactsListView&&this.contactsListView.collection){if(this.contactsListView.collection.url.indexOf("core/api/tags/list/"+a)==-1){this.contactsListView=undefined}}this.customView(_agile_get_prefs("contact_view"),undefined,"core/api/tags/list/"+a,a);return}else{if(this.contactsListView&&this.contactsListView.collection){if(this.contactsListView.collection.url.indexOf("core/api/tags/list")!=-1){console.log(window.location.hash="#contacts");this.contactsListView=undefined}}}if(k||(k=_agile_get_prefs("contact_filter"))){h=false;b="core/api/filters/query/list/"+k}if(!_agile_get_prefs("agile_contact_view")){if(_agile_get_prefs("dynamic_contact_filter")){this.customView(_agile_get_prefs("contact_view"),undefined,"core/api/filters/filter/dynamic-filter",undefined,l,_agile_get_prefs("dynamic_contact_filter"));return}if(_agile_get_prefs("contact_filter")){this.customView(_agile_get_prefs("contact_view"),undefined,"core/api/filters/query/list/"+_agile_get_prefs("contact_filter"),a);return}this.customView(_agile_get_prefs("contact_view"),undefined,undefined,undefined,l);return}console.log("while creating new base collection view : "+h);if(CONTACTS_HARD_RELOAD==true){this.contactsListView=undefined;CONTACTS_HARD_RELOAD=false}if(this.contactsListView&&this.contactsListView.collection){this.contactsListView.collection.url=b;$("#content").html('<div id="contacts-listener-container"></div>');$("#contacts-listener-container").html(this.contactsListView.render(true).el);$(".active").removeClass("active");$("#contactsmenu").addClass("active");contactFiltersListeners();return}if(_agile_get_prefs("dynamic_contact_filter")){b="core/api/filters/filter/dynamic-filter";c=_agile_get_prefs("dynamic_contact_filter")}var e=getContactPadcontentKey(b);if(l){i="contacts-table";if(d||_agile_get_prefs("agile_contact_view")){i="contacts-grid-table";j="div";m="#contacts-grid-table-model-list"}}this.contactsListView=new Contacts_Events_Collection_View({url:b,custom_scrollable_element:m,sort_collection:false,templateKey:i,individual_tag_name:j,cursor:true,page_size:25,global_sort_key:f,slateKey:e,request_method:"POST",post_data:{filterJson:c},postRenderCallback:function(p,s){$("#contacts-view-options").css("pointer-events","auto");var o=App_Contacts.contactsListView.el;var s=App_Contacts.contactsListView.collection;abortCountQueryCall();if(l){setupViews(p);setupContactFilterList();if(s.models.length>0&&!s.models[0].get("count")){getAndUpdateCollectionCount("contacts",p)}else{var q=0;if(s.models.length>0){q=s.models[0].attributes.count||s.models.length}var r;if(q>9999&&(_agile_get_prefs("contact_filter")||_agile_get_prefs("dynamic_contact_filter"))){r="<small> ("+10000+"+ "+_agile_get_translated_val("other","total")+') </small><span style="vertical-align: text-top; margin-left: 0px"><img border="0" src="'+updateImageS3Path("/img/help.png")+'"style="height: 10px; vertical-align: middle" rel="popover"data-placement="bottom" data-title="Lead Score"data-content="'+_agile_get_translated_val("results","over-count")+'"id="element" data-trigger="hover"></span>'}else{r="<small> ("+q+" "+_agile_get_translated_val("other","total")+") </small>"}$("#contacts-count").html(r)}}else{setupLhsFilters(o,g);setupViews(o);setupContactFilterList(o,a);setUpContactView(o);loadPortlets("Contacts",o);if(s.models.length>0&&!s.models[0].get("count")){getAndUpdateCollectionCount("contacts",p)}}$('[data-toggle="tooltip"]').tooltip();start_tour("contacts",p)}});this.contactsListView.collection.fetch();if(!l){$("#content").html('<div id="contacts-listener-container"></div>');$("#contacts-listener-container").html(this.contactsListView.render().el);contactFiltersListeners();contactListener()}else{$("#contacts-listener-container").find(".contacts-inner-div").html(this.contactsListView.render().el);$("#bulk-actions").css("display","none");$("#bulk-select").css("display","none");$("#bulk-action-btns > button").addClass("disabled");if($("#select_grid_contacts1")){$("#select_grid_contacts1").attr("checked",false)}CONTACTS_HARD_RELOAD=true}$(".active").removeClass("active");$("#contactsmenu").addClass("active");$('[data-toggle="tooltip"]').tooltip()},duplicateContacts:function(c){dup_contacts1_array.length=0;var d=20;var a="tr";this.contact_id=c;var b="/core/api/search/duplicate-contacts/"+c;var e=false;template_key="duplicate-contacts";if(App_Contacts.contactDetailView===undefined){Backbone.history.navigate("contact/"+c,{trigger:true});return}this.duplicateContactsListView=new Contacts_Events_Collection_View({url:b,templateKey:template_key,individual_tag_name:"tr",cursor:true,page_size:25,sort_collection:e,slateKey:null,postRenderCallback:function(f){}});
this.duplicateContactsListView.collection.fetch();$("#content").html(this.duplicateContactsListView.render().el);$(".active").removeClass("active");$("#contactsmenu").addClass("active")},mergeContacts:function(){var a=dup_contacts1_array[0];var j=20;var g="table";var e=false;template_key="merge-contacts";if(App_Contacts.duplicateContactsListView==undefined||dup_contacts1_array.length<1){Backbone.history.navigate("contacts",{trigger:true});return}var k=[];for(var d=0;d<dup_contacts1_array.length;d++){var f=Number(dup_contacts1_array[d]);var c=App_Contacts.duplicateContactsListView.collection.where({id:f});var h=k.concat(c);k=h}var n={};var m=App_Contacts.contactDetailView.model.toJSON();console.log(m);var l=[];var b=0;l[0]=m;for(d=0;d<k.length;d++){l[d+1]=k[d].toJSON();b++}n.contacts=l;n.length=b;add_custom_fields_to_form(n,function(i){this.mergeContactsView=new Contact_Details_Model_Events({template:template_key,data:n,postRenderCallback:function(o){}});$("#content").html(this.mergeContactsView.render(true).el);$(window).scrollTop(0);$(".active").removeClass("active");$("#contactsmenu").addClass("active")},m.type)},contactDetails:function(f,a){$('[data-toggle="tooltip"]').tooltip();if(CALL_CAMPAIGN.last_clicked=="start-bulk-campaign"){startCallCampaign(CALL_CAMPAIGN.contact_id_list);CALL_CAMPAIGN.last_clicked=""}if(timeline_collection_view&&timeline_collection_view.queue){timeline_collection_view.queue.pop()}if(App_Contacts.customFieldsList==null||App_Contacts.customFieldsList==undefined){App_Contacts.customFieldsList=new Contacts_Events_Collection_View({url:"/core/api/custom-fields/position",sort_collection:false,restKey:"customFieldDefs",templateKey:"admin-settings-customfields",individual_tag_name:"tr"});App_Contacts.customFieldsList.collection.fetch()}var e;if(!a&&this.contactDetailView&&this.contactDetailView.model!=null){if(f==this.contactDetailView.model.toJSON()["id"]){App_Contacts.contactDetails(f,this.contactDetailView.model);return}}if(!a){if(!this.contactsListView||this.contactsListView.collection.length==0||this.contactsListView.collection.get(f)==null){console.log("Downloading contact");var d=Backbone.Model.extend({url:function(){return"/core/api/contacts/"+this.id}});var b=new d();b.id=f;b.fetch({success:function(g){if(g.type=="COMPANY"){App_Companies.companyDetails(f);return}App_Contacts.contactDetails(f,b)},error:function(h,g){if(g&&g.status=="403"){$("#content").html("<div class='well'><div class='alert bg-white text-center'><div class='slate-content p-md text'><h4 style='opacity:0.8;margin-bottom:5px!important;'> "+_agile_get_translated_val("contacts","invalid-viewer")+"</h4><div class='text'style='opacity:0.6;'>"+_agile_get_translated_val("companies","enable-permission")+"</div></div></div></div>")}}});return}}if(!a){a=this.contactsListView.collection.get(f)}if(this.contactsListView&&this.contactsListView.collection){e=this.contactsListView.collection}add_recent_view(a);if(a.get("type")=="COMPANY"){Backbone.history.navigate("company/"+f,{trigger:true});return}this.contactDetailView=new Contact_Details_Model_Events({model:a,isNew:true,template:"contact-detail",postRenderCallback:function(h){$(h).on("click",function(j){var i=j.target.id;if(i=="contact_name"){return}if(i=="contactName"){return}if(i=="Contact-input-firstname"||i=="Contact-input-lastname"){return}inlineNameChange(j,i)});$(".content-tabs").tabCollapse();if(canEditCurrentContact()){var g=new Backbone.Model();g.url="core/api/contacts/viewed-at/"+a.get("id");g.save()}if(App_Contacts.contactsListView&&App_Contacts.contactsListView.collection&&App_Contacts.contactsListView.collection.get(f)){App_Contacts.contactsListView.collection.get(f).attributes=a.attributes}load_contact_tab(h,a.toJSON());loadWidgets(h,a.toJSON(),"widgets");starify(h);show_map(h);if(e!=null){contact_detail_view_navigation(f,App_Contacts.contactsListView,h)}start_tour("contact-details",h);if(default_call_option.callOption.length==0){$(".contact-make-call",h).removeClass("c-progress");$(".contact-make-skype-call",h).removeClass("c-progress")}if(a){addTypeCustomData(a.get("id"),h)}}});var c=this.contactDetailView.render(true).el;$(c).find(".content-tabs").tabCollapse();$("#content").html(c);checkContactUpdated();if(_agile_get_prefs("MAP_VIEW")=="disabled"){$("#map_view_action").html("<i class='icon-plus text-sm c-p' title='"+_agile_get_translated_val("contact-details","show-map")+"' id='enable_map_view'></i>")}else{$("#map_view_action").html("<i class='icon-minus text-sm c-p' title='"+_agile_get_translated_val("contact-details","hide-map")+"' id='disable_map_view'></i>")}},editContact:function(a){if(!this.contactDetailView||!this.contactDetailView.model.id){this.navigate("contacts",{trigger:true});return}var d=this.contactDetailView.model.id;if(this.contactDetailView&&this.contactDetailView.model.id){a=this.contactDetailView.model.toJSON()}else{if(this.contactsListView&&this.contactsListView.collection&&this.contactsListView.collection.get(d)){a=this.contactsListView.collection.get(d).toJSON()}else{if(this.contact_custom_view&&this.contact_custom_view.collection&&this.contact_custom_view.collection.get(d)){a=this.contact_custom_view.collection.get(d).toJSON()}else{if(!a){var c=Backbone.Model.extend({url:function(){return"/core/api/contacts/"+d}});var b=new c();b.fetch({success:function(e){App_Contacts.editContact(e.toJSON())}});return}}}}if(a.contact_company_id){$.ajax({url:"/core/api/contacts/"+a.contact_company_id,type:"GET",dataType:"json",success:function(e){if(e){console.log(e);contact_company=e}}})}add_custom_fields_to_form(a,function(e){if(e.type=="COMPANY"){deserialize_contact(e,"continue-company")}else{deserialize_contact(e,"continue-contact")}},a.type)},duplicateContact:function(){if(!this.contactDetailView||!this.contactDetailView.model.id||!this.contactsListView||this.contactsListView.collection.length==0){this.navigate("contacts",{trigger:true});return}var a=this.contactDetailView.model;var d=a.toJSON();var c=$.extend(true,{},d);c=delete_contact_property(c,"email");delete c.id;var b=new Backbone.Model();b.url="core/api/contacts";b.save(c,{success:function(e){add_custom_fields_to_form(e.toJSON(),function(f){deserialize_contact(f,"continue-contact")})}})},importContacts:function(){App_Contacts.importContacts=new CONTACTS_IMPORT_VIEW({url:"core/api/upload/status/CONTACTS",template:"import-contacts",postRenderCallback:function(a){initializeImportEvents("import-contacts-event-listener");if(import_tab_Id){$('#import-tabs-content a[href="#'+import_tab_Id+'"]',a).tab("show");import_tab_Id=undefined}else{$('#import-tabs-content a[href="#csv-tab"]',a).tab("show")}}});$("#content").html(App_Contacts.importContacts.render().el)},addContactToCampaign:function(){getTemplate("contact-detail-campaign",{},undefined,function(a){if(!a){return}$("#content").html($(a));$("body").trigger("fill_campaigns_contact")},"#content")},sendEmail:function(a,j,e,b,g,d){if(!d&&Agile_Old_Hash&&Agile_Old_Hash.indexOf("contact/")>-1){var c=Agile_Old_Hash.split("/")[1];var k=App_Contacts.contactDetailView.model.toJSON();if(c==k.id){var i=k.properties;var h;$.each(i,function(n,m){if(m.name=="email"){h=m.value;return false}})}this.sendEmail(h,j,e,b,g,true);return}var f=this;sendMail(a,j,e,b,g,f);var l={};l[_agile_get_translated_val("others","add-new")]="verify_email";fetchAndFillSelect("core/api/account-prefs/verified-emails/all","email","email",undefined,l,$("#from_email"),"prepend",function(m,n){var o=m.find('option[value = "'+CURRENT_DOMAIN_USER.email+'"]').val();if(typeof(o)=="undefined"){m.find("option:first").before("<option value="+CURRENT_DOMAIN_USER.email+">"+CURRENT_DOMAIN_USER.email+"</option>");m.val(CURRENT_DOMAIN_USER.email).attr("selected","selected")}else{m.val(CURRENT_DOMAIN_USER.email).attr("selected","selected")}rearrange_from_email_options(m,n)})},sendEmailCustom:function(g,d,a,f,c,b){var e=this.contact_popover;insidePopover=false;sendMail(g,d,a,f,c,e,true)},customView:function(c,l,b,a,m,d){console.log("customView");tpl_directory.loadTemplates(["contact-detail"],function(){});SELECT_ALL=false;App_Contacts.tag_id=a;if(!b){b="core/api/contacts/list"}if(CONTACTS_HARD_RELOAD==true){this.contact_custom_view=undefined;CONTACTS_HARD_RELOAD=false;l=undefined}if(!l){if(!App_Contacts.contactViewModel){var n=new Backbone.Model();n.url="core/api/contact-view-prefs";n.fetch({success:function(o){if($.isEmptyObject(o.toJSON())){_agile_delete_prefs("contact_view");App_Contacts.contacts();return}App_Contacts.contactViewModel=o.toJSON();App_Contacts.customView(undefined,App_Contacts.contactViewModel,b,a,m)}});return}l=App_Contacts.contactViewModel}if(this.contact_custom_view&&this.contact_custom_view.collection.url==b){var e=App_Contacts.contact_custom_view.render(true).el;$("#content").html('<div id="contacts-listener-container"></div>');$("#contacts-listener-container").html(e);$("#contacts-view-options").css("pointer-events","auto");if(agile_is_mobile_browser()){}contactFiltersListeners();contactListener();if(_agile_get_prefs("company_filter")){$("#contact-heading",e).text("Companies")}setupViews(e,l.name);setupContactFilterList(e,a);setUpContactView(e);$(".active").removeClass("active");$("#contactsmenu").addClass("active");App_Contacts.contactsListView.delegateEvents();return}var f=getContactPadcontentKey(b);var h=_agile_get_prefs("sort_by_name");if(!h||h==null){h="-created_time";_agile_set_prefs("sort_by_name",h)}var i="contacts-custom-view";var j="tr";var k=null;if(_agile_get_prefs("agile_contact_view")){i="contacts-grid";j="div";k="#contacts-grid-model-list"}if(_agile_get_prefs("dynamic_contact_filter")){b="core/api/filters/filter/dynamic-filter";d=_agile_get_prefs("dynamic_contact_filter")}if(m){i="contacts-custom-view-table";if(_agile_get_prefs("agile_contact_view")){i="contacts-grid-table";j="div";k="#contacts-grid-table-model-list"}}that=this;this.contact_custom_view=new Contacts_Events_Collection_View({url:b,restKey:"contact",modelData:l,global_sort_key:h,templateKey:i,custom_scrollable_element:k,individual_tag_name:j,slateKey:f,cursor:true,request_method:"POST",post_data:{filterJson:d},page_size:25,sort_collection:false,postRenderCallback:function(p,s){App_Contacts.contactsListView=App_Contacts.contact_custom_view;
contactListener();setupViews(p,l.name);$("#contacts-view-options").css("pointer-events","auto");setupContactFilterList(p,App_Contacts.tag_id);if(a){setUpContactView(p,true)}else{setUpContactView(p)}setupContactFields(p);abortCountQueryCall();if(m){if(s.models.length>0&&!s.models[0].get("count")){getAndUpdateCollectionCount("contacts",p)}else{var q=0;if(s.models.length>0){q=s.models[0].attributes.count||s.models.length}var r;if(q>9999&&(_agile_get_prefs("contact_filter")||_agile_get_prefs("dynamic_contact_filter"))){r="<small> ("+10000+"+ "+_agile_get_translated_val("other","total")+') </small><span style="vertical-align: text-top; margin-left: 0px"><img border="0" src="'+updateImageS3Path("/img/help.png")+'"style="height: 10px; vertical-align: middle" rel="popover"data-placement="bottom" data-title="Lead Score"data-content="'+_agile_get_translated_val("results","over-count")+'"id="element" data-trigger="hover"></span>'}else{r="<small> ("+q+" "+_agile_get_translated_val("other","total")+") </small>"}$("#contacts-count").html(r)}}else{if(s.models.length>0&&!s.models[0].get("count")){getAndUpdateCollectionCount("contacts",p)}setupLhsFilters(p);loadPortlets("Contacts",p)}if(agile_is_mobile_browser()){var o=$('<td><div class="text-md text-muted m-t contact-list-mobile"><i class="fa fa-angle-right"></i></div></td>')}},appendItemCallback:function(o){if(agile_is_mobile_browser()){}},});var g=this;App_Contacts.contactDateFields=CONTACTS_DATE_FIELDS;App_Contacts.contactContactTypeFields=CONTACTS_CONTACT_TYPE_FIELDS;App_Contacts.contactCompanyTypeFields=CONTACTS_COMPANY_TYPE_FIELDS;if(!App_Contacts.contactDateFields){$.getJSON("core/api/custom-fields/type/scope?type=DATE&scope=CONTACT",function(o){App_Contacts.contactDateFields=o;g.contact_custom_view.appendItem=function(p){contactTableView(p,App_Contacts.contactDateFields,this,App_Contacts.contactContactTypeFields,App_Contacts.contactCompanyTypeFields)};g.contact_custom_view.collection.fetch();contactListener()})}else{g.contact_custom_view.appendItem=function(o){contactTableView(o,App_Contacts.contactDateFields,this,App_Contacts.contactContactTypeFields,App_Contacts.contactCompanyTypeFields)};g.contact_custom_view.collection.fetch()}if(!m){$("#content").html('<div id="contacts-listener-container"></div>');$("#contacts-listener-container").html(this.contact_custom_view.el);contactFiltersListeners()}else{$("#contacts-listener-container").find(".contacts-inner-div").html(this.contact_custom_view.el);$("#bulk-actions").css("display","none");$("#bulk-select").css("display","none");$("#bulk-action-btns > button").addClass("disabled");if($("#select_grid_contacts1")){$("#select_grid_contacts1").attr("checked",false)}CONTACTS_HARD_RELOAD=true}$(".active").removeClass("active");$("#contactsmenu").addClass("active")},addLead:function(b,a){$("#personModal").on("show.bs.modal",function(){$(this).find("#fname").val(b);$(this).find("#lname").val(a)});$("#personModal").modal()},addLeadDirectly:function(c,b,a){$("#personModal").on("show.bs.modal",function(){$(this).find("#fname").val(c);$(this).find("#lname").val(b);$(this).find("#phone").val(a)});$("#personModal").modal()},addMobLead:function(a){$("#personModal").on("show.bs.modal",function(){$(this).find("#phone").val(a)});$("#personModal").modal()},addContact:function(){$.getJSON("core/api/custom-fields/scope?scope=CONTACT",function(b){if(b.length>0){var a={custom_fields:b,properties:[]};getTemplate("continue-contact",a,undefined,function(d){if(!d){return}$("#content").html($(d));$(".date_input").attr("placeholder",_agile_get_translated_val("contacts","select-date"));$(".date_input").datepicker({format:CURRENT_USER_PREFS.dateFormat,weekStart:CALENDAR_WEEK_START_DAY,autoclose:true});setup_tags_typeahead();var c=function(f,e){$("#content [name='contact_company_id']").html('<li class="inline-block tag btn btn-xs btn-primary m-r-xs m-b-xs" data="'+f+'"><span><a class="text-white m-r-xs" href="#contact/'+f+'">'+e+'</a><a class="close" id="remove_tag">&times</a></span></li>');$("#content #contact_company").hide();if(f){$.ajax({url:"/core/api/contacts/"+f,type:"GET",dataType:"json",success:function(g){if(g){console.log(g);contact_company=g;var h=null;$.each(contact_company.properties,function(){if(this.name=="address"&&this.subtype=="office"){h=JSON.parse(this.value)}});if(h){$("#content .address-type").val("office");if(h.address){$("#content #address").val(h.address)}if(h.city){$("#content #city").val(h.city)}if(h.state){$("#content #state").val(h.state)}if(h.zip){$("#content #zip").val(h.zip)}if(h.country){$("#content #country").val(h.country)}}}}})}};agile_type_ahead("contact_company",$("#content"),contacts_typeahead,c,"type=COMPANY","<b>"+_agile_get_translated_val("others","no-results")+"</b> <br/> "+_agile_get_translated_val("others","add-new-one"));$(".contact_input",$("#content")).each(function(){agile_type_ahead($(this).attr("id"),$("#custom_contact_"+$(this).attr("id"),$("#content")),contacts_typeahead,undefined,"type=PERSON")});$(".company_input",$("#content")).each(function(){agile_type_ahead($(this).attr("id"),$("#custom_company_"+$(this).attr("id"),$("#content")),contacts_typeahead,undefined,"type=COMPANY")})},"#content")}else{Backbone.history.navigate("contacts",{trigger:true});$("#personModal").modal("show")}})},callcontacts:function(){$(".active").removeClass("active");var b=CALL_CAMPAIGN.total_count;var a={};a.total_count=b;a.time=[10,20,30,40,50,60];getTemplate("call-campaign-setting",a,undefined,function(c){if(!c){return}$(".butterbar").hide();$("#content").html($(c));$('[data-toggle="tooltip"]').tooltip()},"#content")},contactsNew:function(b){if(b){_agile_delete_prefs("contact_filter");_agile_delete_prefs("dynamic_contact_filter")}if(_agile_get_prefs("contacts_tag")!=b){CONTACTS_HARD_RELOAD=true;_agile_set_prefs("contacts_tag",b)}$("#content").html('<div id="contacts-listener-container"></div>');var a=new Contacts_And_Companies_Events_View({data:{},template:"contacts-header",isNew:true,postRenderCallback:function(c){contacts_view_loader.buildContactsView(c,b);contacts_view_loader.setUpContactsCount(c);loadPortlets("Contacts",c)}});$("#contacts-listener-container").html(a.render().el);$(".active").removeClass("active");$("#contactsmenu").addClass("active");$('[data-toggle="tooltip"]').tooltip()},});function getAndUpdateCollectionCount(d,c,b){console.log("countFetchURL = "+b);var e="";$("#contacts-count").html(e);var a="";if(d=="contacts"){a=App_Contacts.contactsListView.options.url+"/count"}else{if(d=="workflows"){a=b+"/count"}else{a=App_Companies.companiesListView.options.url+"/count"}}$(".thead_check",c).closest("label").css("visibility","hidden");$("table",c).addClass("hide-head-checkbox");abortCountQueryCall();Count_XHR_Call=$.get(a,{},function(f){f=parseInt(f);e="<small> ("+f+" "+_agile_get_translated_val("other","total")+") </small>";$("#contacts-count").html(e);if(d=="workflows"){$("span.badge.bg-primary",c).html(f)}if(d=="contacts"){App_Contacts.contactsListView.collection.models[0].set("count",f,{silent:true})}else{if(d=="workflows"){if(App_Workflows.active_subscribers_collection&&App_Workflows.active_subscribers_collection.collection&&App_Workflows.active_subscribers_collection.collection.length>0){App_Workflows.active_subscribers_collection.collection.models[0].set("count",f,{silent:true})}}else{App_Companies.companiesListView.collection.models[0].set("count",f,{silent:true})}}$(".thead_check",c).closest("label").css("visibility","visible");$("table",c).removeClass("hide-head-checkbox")})}function abortCountQueryCall(){try{Count_XHR_Call.abort()}catch(a){}}function sendMail(a,n,j,e,m,l,f){var h={};if(!canSendEmails(1)){var k=getPendingEmails();window.history.back();var o=_agile_get_translated_val("campaigns","emails-limit");var c="";var p=_agile_get_translated_val("reputation","Ok");var d=_agile_get_translated_val("contact-details","please")+' <a  href="#subscribe" class="action text-info" data-dismiss="modal" subscribe="subscribe" action="deny"> '+_agile_get_translated_val("portlets","upgrade")+" </a> "+_agile_get_translated_val("billing","your-email-subscription");var g='<div class="m-t-xs">'+_agile_get_translated_val("billing","continue-send-emails")+", "+_agile_get_translated_val("contact-details","please")+'<a href="#subscribe" class="action text-info" data-dismiss="modal" subscribe="subscribe" action="deny"> '+_agile_get_translated_val("plan-and-upgrade","purchase")+" </a>"+_agile_get_translated_val("plan-and-upgrade","more")+".</div>";var q="<div>"+_agile_get_translated_val("billing","email-quota-exceed")+"</div>"+g;showModalConfirmation(o,q,"",function(r){Backbone.history.navigate("subscribe",{trigger:true});return},function(r){},c,p);return}if(f){h=l.toJSON()}else{if(l.contactDetailView&&!l.contactDetailView.model.get(a)){h=l.contactDetailView.model.toJSON()}if(App_Companies.companyDetailView){var i=getPropertyValue(App_Companies.companyDetailView.model.toJSON().properties,"email");if(a&&a==i){h=App_Companies.companyDetailView.model.toJSON()}}}var b=$("#content").html('<div id="send-email-listener-container"></div>').find("#send-email-listener-container").html(getTemplate("send-email",h));agile_type_ahead("to",b,contacts_typeahead,null,null,"email-search",null,true,null,true);$("#content").html('<div id="send-email-listener-container"></div>');getTemplate("send-email",h,undefined,function(x){if(!x){return}var v=$("#send-email-listener-container").html($(x));agile_type_ahead("to",v,contacts_typeahead,null,null,"email-search",null,true,null,true);agile_type_ahead("email_cc",v,contacts_typeahead,null,null,"email-search",null,true,null,true);agile_type_ahead("email_bcc",v,contacts_typeahead,null,null,"email-search",null,true,null,true);if(a){var t;if(h&&a.indexOf(",")==-1){if(h.type=="PERSON"){var u=getPropertyValue(h.properties,"first_name");var s=getPropertyValue(h.properties,"last_name");if(u||s){t=u?u:"";t=(t+" "+(s?s:"")).trim()}}else{var r=getPropertyValue(h.properties,"name");t=(r?r:"").trim()}}if(t&&t.length){var w=a;
if(a.indexOf("<")==-1&&a.indexOf(">")==-1){w=t+" <"+a.trim()+">"}$("#to",v).closest("div.controls").find(".tags").append('<li class="tag  btn btn-xs btn-primary m-r-xs inline-block" data="'+w+'"><a href="#contact/'+h.id+'">'+t+'</a><a class="close" id="remove_tag">&times</a></li>')}else{$("#emailForm",v).find('input[name="to"]').val(a)}}else{$("#emailForm",v).find('input[name="to"]').val("")}if(checkTagAgile("Zoomifier")&&l.contactDetailView){head.js(LIB_PATH+"lib/zoomifier.contentpicker.min.js",function(){$("#emailForm",v).find('textarea[name="body"]').closest(".controls").append('<div><a style="cursor:pointer;" onclick="Javascript:loadZoomifierDocSelector();"><i class="icon-plus-sign"></i> '+_agile_get_translated_val("tags","attach-zoomifier")+"</a></div>")})}populate_send_email_details(v);if(n){$("#emailForm",v).find('input[name="subject"]').val(n)}if(e){$("#emailForm",v).find("#email_cc").closest(".control-group").show();$("#emailForm",v).find('input[name="email_cc"]').val(e)}if(m){$("#emailForm",v).find("#email_bcc").closest(".control-group").show();$("#emailForm",v).find('input[name="email_bcc"]').val(m)}if(a){setupTinyMCEEditor("textarea#email-body",false,undefined,function(){if(!j){j=""}set_tinymce_content("email-body",j);register_focus_on_tinymce("email-body")})}else{setupTinyMCEEditor("textarea#email-body",true,undefined,function(){if(!j){j=""}set_tinymce_content("email-body",j);register_focus_on_tinymce("email-body")})}initializeSendEmailListeners();sendEmailAttachmentListeners("send-email-listener-container")},"#send-email-listener-container")}function addTypeCustomData(c,a){var b=new Base_Collection_View({url:"core/api/contacts/getCustomfieldBasedContacts?id="+c+"&type=CONTACT",sortKey:"time",descending:true,templateKey:"contact-type-custom-fields",cursor:true,page_size:20,postRenderCallback:function(d){}});b.collection.fetch({success:function(d){if(d.length){$("#contacts-type-custom-fields",a).removeClass("hidden")}}});$("#contacts-type-custom-fields",a).html(b.render().el)}var VoiceMailRouter=Backbone.Router.extend({routes:{voicemail:"voicemail"},voicemail:function(){var a=this;getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));$("#PrefsTab .select").removeClass("select");$(".add-widget-prefs-tab").addClass("select");a.VoiceMailCollectionView=new Base_Collection_View({url:"core/api/voicemails",templateKey:"voice-mail",cursor:true,page_size:20,individual_tag_name:"tr",postRenderCallback:function(c){includeTimeAgo(c)},appendItemCallback:function(c){includeTimeAgo(c)}});a.VoiceMailCollectionView.collection.fetch();console.log(a.VoiceMailCollectionView);$("#prefs-tabs-content").html(a.VoiceMailCollectionView.render().el)},"#content")}});var EmailBuilderRouter=Backbone.Router.extend({routes:{"emailbuilder-add":"showEmailBuilder","emailbuilder-templates":"getListOfTemplates","emailbuilder-add/:id":"loadSelectedTemplate","emailbuilder/:id":"loadSavedTemplate","emailbuilder-copy/:id":"copyEmailTemplate"},showEmailBuilder:function(){$("#content").html("<div id='emailbuilder-listeners'></div>");initializeEmailBuilderListeners();getTemplate("emailbuilder-add",{},undefined,function(a){$("#emailbuilder-listeners").html($(a))},"#emailbuilder-listeners");collapseLeftMenuInBuilder();hideTransitionBar()},getListOfTemplates:function(){$("#content").html("<link rel='stylesheet' type='text/css' href='flatfull/css/jquery.fancybox.css'><div id='emailbuilder-listeners'></div>");initializeEmailBuilderListeners();$.getJSON("misc/emailbuilder/templates/templates.json",function(a){getTemplate("emailbuilder-categories",a.templates[0],undefined,function(b){$("#emailbuilder-listeners").html($(b))},"#emailbuilder-listeners");hideTransitionBar()})},loadSelectedTemplate:function(a){$("#content").html("<div id='emailbuilder-listeners'></div>");initializeEmailBuilderListeners();var b={templateId:a,action:"new"};getTemplate("emailbuilder-add",b,undefined,function(c){$("#emailbuilder-listeners").html($(c))},"#emailbuilder-listeners");$("html, body").animate({scrollTop:$("body").offset().top},500);collapseLeftMenuInBuilder();hideTransitionBar()},loadSavedTemplate:function(a){$("#content").html("<div id='emailbuilder-listeners'></div>");initializeEmailBuilderListeners();var b={templateId:a,action:"edit"};getTemplate("emailbuilder-add",b,undefined,function(c){$("#emailbuilder-listeners").html($(c))},"#emailbuilder-listeners");collapseLeftMenuInBuilder();$("html, body").animate({scrollTop:$("body").offset().top},500);hideTransitionBar()},copyEmailTemplate:function(a){$("#content").html("<div id='emailbuilder-listeners'></div>");initializeEmailBuilderListeners();var b={templateId:a,action:"copy"};getTemplate("emailbuilder-add",b,undefined,function(c){$("#emailbuilder-listeners").html($(c))},"#emailbuilder-listeners");collapseLeftMenuInBuilder();$("html, body").animate({scrollTop:$("body").offset().top},500);hideTransitionBar()}});function collapseLeftMenuInBuilder(){$wrapElement=$("#wrap");if(!$wrapElement.hasClass("app-aside-dock")){if(!$wrapElement.hasClass("app-aside-folded")){$wrapElement.addClass("app-aside-folded")}}}var WidgetsRouter=Backbone.Router.extend({routes:{"add-widget":"addWidget",Twitter:"Twitter","Twitter/:id":"Twitter",GooglePlus:"GooglePlus","GooglePlus/:id":"GooglePlus",Rapleaf:"Rapleaf","Rapleaf/:id":"Rapleaf",Facebook:"Facebook","Facebook/:id":"Facebook",ClickDesk:"ClickDesk","ClickDesk/:id":"ClickDesk",HelpScout:"HelpScout","HelpScout/:id":"HelpScout",Zendesk:"Zendesk","Zendesk/:id":"Zendesk",Uservoice:"Uservoice","Uservoice/:id":"Uservoice",Sip:"Sip","Sip/:id":"Sip",Twilio:"Twilio","Twilio/:id":"Twilio",TwilioIO:"TwilioIO","TwilioIO/:id":"TwilioIO","callscript/rules":"CallScriptShow","callscript/add-rules":"CallScriptAdd","callscript/editrules/:id":"CallScriptEdit",callscript:"CallScript","callscript/:id":"CallScript",FreshBooks:"FreshBooks","FreshBooks/:id":"FreshBooks",Stripe:"Stripe","Stripe/:id":"Stripe",Braintree:"Braintree","Braintree/:id":"Braintree",Xero:"Xero","Xero/:id":"Xero",QuickBooks:"QuickBooks","QuickBooks/:id":"QuickBooks",PayPal:"PayPal","PayPal/:id":"PayPal",Shopify:"Shopify","Shopify/:id":"Shopify","Custom-widget":"Custom","Custom-widget/:id":"Custom",Bria:"Bria","Bria/:id":"Bria",Skype:"Skype","Skype/:id":"Skype"},addWidget:function(){var a=this;loadSettingsUI(function(){a.Catalog_Widgets_View=new Base_Collection_View({url:"/core/api/widgets/default",restKey:"widget",templateKey:"widgets-add-new",sort_collection:false,individual_tag_name:"div",postRenderCallback:function(c){var b=_agile_get_prefs("widget_tab");if(!b||b==null){_agile_set_prefs("widget_tab","call-tab");b="call-tab"}$('#prefs-tabs-content a[href="#'+b+'"]').tab("show");initializeWidgetSettingsListeners();$("#prefs-tabs-content .tab-container ul li").off("click");$("#prefs-tabs-content").on("click",".tab-container ul li",function(){var d=$(this).find("a").attr("href").split("#");_agile_set_prefs("widget_tab",d[1])});$('[data-toggle="tooltip"]').tooltip()}});a.Catalog_Widgets_View.appendItem=organize_widgets;a.Catalog_Widgets_View.collection.fetch({success:function(b){console.log(b.where({is_added:true}));_plan_restrictions.process_widgets(b);console.log(b);console.log("****")}});$("#prefs-tabs-content").html(a.Catalog_Widgets_View.el)})},FreshBooks:function(a){addConfigurableWidget(a,"FreshBooks","freshbooks-login")},TwilioIO:function(a){addConfigurableWidget(a,"TwilioIO","twilioio-login")},Custom:function(a){addConfigurableWidget(a,"Custom","custom-widget-edit")},Bria:function(a){addConfigurableWidget(a,"Bria","bria-login")},Skype:function(a){addConfigurableWidget(a,"Skype","skype-login")},Rapleaf:function(a){addConfigurableWidget(a,"Rapleaf","rapleaf-login")},ClickDesk:function(a){addConfigurableWidget(a,"ClickDesk","clickdesk-login")},Zendesk:function(a){addConfigurableWidget(a,"Zendesk","zendesk-login")},Uservoice:function(a){addConfigurableWidget(a,"Uservoice","uservoice-login")},HelpScout:function(a){addConfigurableWidget(a,"HelpScout","helpscout-login")},Sip:function(a){addConfigurableWidget(a,"Sip","sip-login")},Twitter:function(a){if(!a){addOAuthWidget("Twitter","twitter-login",("/scribe?service=twitter&linkType=widget&isForAll="+isForAll+"&return_url="+encodeURIComponent(window.location.href)))}else{addWidgetProfile(a,"Twitter","twitter-revoke-access","core/api/widgets/social/profile/"+a)}},Facebook:function(a){if(!a){addOAuthWidget("Facebook","facebook-login",("/scribe?service=facebook&linkType=widget&isForAll="+isForAll+"&return_url="+encodeURIComponent(window.location.href)))}else{addWidgetProfile(a,"Facebook","facebook-revoke-access","/core/api/widgets/facebook/currentUserProfile/"+a)}},Xero:function(a){if(!a){addOAuthWidget("Xero","xero-login",("http://integrations.clickdesk.com:8080/ClickdeskPlugins/agile-xero-oauth?callbackUrl="+encodeURIComponent(window.location.protocol+"//"+window.location.host+"/XeroServlet?isForAll="+isForAll+"&linkType=widget&data=")))}else{addWidgetProfile(a,"Xero","xero-revoke-access","core/api/widgets/Xero")}},QuickBooks:function(a){if(!a){addOAuthWidget("QuickBooks","quickbooks-login",("/OAuthServlet?service=quickbooks&linkType=widget&isForAll="+isForAll+"&return_url="+encodeURIComponent(window.location.href)))}else{addWidgetProfile(a,"QuickBooks","quickbooks-revoke-access","core/api/widgets/QuickBooks")}},PayPal:function(a){if(!a){addOAuthWidget("PayPal","paypal-login",("/paypalScribe?isForAll="+isForAll+"&return_url="+encodeURIComponent(window.location.href)))}else{addWidgetProfile(a,"PayPal","paypal-revoke-access","core/api/widgets/paypal")}},Shopify:function(a){if(!a){addOAuthWidget("Shopify","shopify-login","")}else{addWidgetProfile(a,"Shopify","shopify-revoke-access","/core/api/widgets/default")}},GooglePlus:function(a){if(!a){addOAuthWidget("GooglePlus","googleplus-login",("/scribe?service=googleplus&linkType=widget&isForAll="+isForAll+"&return_url="+encodeURIComponent(window.location.href)))}else{addWidgetProfile(a,"GooglePlus","googleplus-revoke-access","core/api/widgets/GooglePlus")
}},Stripe:function(a){if(!a){addOAuthWidget("Stripe","stripe-login",("/scribe?service=stripe&linkType=widget&isForAll="+isForAll))}else{addWidgetProfile(a,"Stripe","stripe-revoke-access","core/api/widgets/Stripe")}},Braintree:function(a){addConfigurableWidget(a,"Braintree","braintree-login")},CallScript:function(a){addConfigurableWidget(a,"CallScript","callscript-login");if(a){adjust_form()}},CallScriptShow:function(){showCallScriptRule()},CallScriptAdd:function(){addCallScriptRule()},CallScriptEdit:function(a){editCallScriptRule(a)}});function getAgileConfiguredWidgetCollection(a){if(App_Widgets.Catalog_Widgets_View&&App_Widgets.Catalog_Widgets_View.collection){a(App_Widgets.Catalog_Widgets_View.collection);return}App_Widgets.Catalog_Widgets_View=new Base_Collection_View({url:"/core/api/widgets/default"});App_Widgets.Catalog_Widgets_View.collection.fetch({success:function(){getAgileConfiguredWidgetCollection(a)}})}function renderWidgetView(b,e,d,a){var f=new Widget_Model_Events({template:b,url:e,isNew:true,data:d,postRenderCallback:function(h){if(d&&d.name!="Stripe"){deserializeWidget(d,h)}if(d&&d.name=="CallScript"){adjust_form()}var g=_agile_get_prefs("widget_tab");$("#prefs-tabs-content").find('a[href="#'+g+'"]').closest("li").addClass("active");initializeTabListeners("widget_tab","add-widget")}});var c=f.render().el;$(a).html(c)}COMPANIES_HARD_RELOAD=true;var CompaniesRouter=Backbone.Router.extend({routes:{companies:"companiesNew","company/:id":"companyDetails","company-edit":"editCompany","company-view-prefs":"companyViewPrefs","duplicate-company/:id":"duplicateCompany","merge-companies":"mergeCompanies"},companies:function(a,n,e,m,l){if(SCROLL_POSITION){$("html, body").animate({scrollTop:SCROLL_POSITION},1000);SCROLL_POSITION=0}else{$(window).scrollTop(0)}SELECT_ALL=false;if(COMPANIES_HARD_RELOAD==true){this.companiesListView=undefined;COMPANIES_HARD_RELOAD=false;l=undefined}if(!l){if(!App_Companies.companyViewModel){var o=new Backbone.Model();o.url="core/api/contact-view-prefs/company";o.fetch({success:function(p){if($.isEmptyObject(p.toJSON())){_agile_delete_prefs("contact_view");App_Companies.companies();return}App_Companies.companyViewModel=p.toJSON();App_Companies.companies(a,undefined,undefined,m,App_Companies.companyViewModel)}});return}l=App_Companies.companyViewModel}var j="companies-custom-view";var k="tr";var h=_agile_get_prefs("company_sort_field");if(!h||h==null){h="-created_time";_agile_set_prefs("company_sort_field",h)}var b="/core/api/contacts/companies/list";var i=false;this.tag_id=a;var c;if(a){a=decodeURI(a);a=decodeURI(a);_agile_delete_prefs("company_filter");if(this.companiesListView&&this.companiesListView.collection){if(this.companiesListView.collection.url.indexOf("core/api/tags/list/"+a)==-1){this.companiesListView=undefined}}this.customView(_agile_get_prefs("contact_view"),undefined,"core/api/tags/list/"+a,a);return}else{if(this.companiesListView&&this.companiesListView.collection){if(this.companiesListView.collection.url.indexOf("core/api/tags/list")!=-1){console.log(window.location.hash="#companies");this.companiesListView=undefined}}}if(n||(n=_agile_get_prefs("company_filter"))){i=false;b="core/api/filters/query/list/"+n}console.log("while creating new base collection view : "+i);if(this.companiesListView&&this.companiesListView.collection.url==b){this.companiesListView.collection.url=b;var d=this.companiesListView.render(true).el;$("#content").html(d);contactFiltersListeners("lhs_filters_conatiner");contactListener();$(".active").removeClass("active");$("#companiesmenu").addClass("active");return}if(_agile_get_prefs("dynamic_company_filter")){b="core/api/filters/filter/dynamic-filter";c=_agile_get_prefs("dynamic_company_filter")}var f=getCompanyPadcontentKey(b);if(m){j="companies-custom-view-table"}this.companiesListView=new Contacts_Events_Collection_View({url:b,restKey:"contact",modelData:l,global_sort_key:h,templateKey:j,individual_tag_name:"tr",slateKey:f,cursor:true,request_method:"POST",post_data:{filterJson:c},page_size:25,sort_collection:false,postRenderCallback:function(p,s){contactListener();company_list_view.init(p);setUpCompanySortFilters(p);setUpCompanyFields(p);abortCountQueryCall();if(m){if(s.models.length>0&&!s.models[0].get("count")){getAndUpdateCollectionCount("companies",p)}else{var q=0;if(s.models.length>0){q=s.models[0].attributes.count||s.models.length}var r;if(q>9999&&(_agile_get_prefs("company_filter")||_agile_get_prefs("dynamic_company_filter"))){r="<small> ("+10000+"+ "+_agile_get_translated_val("other","total")+') </small><span style="vertical-align: text-top; margin-left: -5px"><img border="0" src="'+updateImageS3Path("/img/help.png")+'"style="height: 10px; vertical-align: middle" rel="popover"data-placement="bottom" data-title="Lead Score"data-content="'+_agile_get_translated_val("results","over-count")+'"id="element" data-trigger="hover"></span>'}else{r="<small> ("+q+" "+_agile_get_translated_val("other","total")+") </small>"}$("#contacts-count").html(r)}}else{if(s.models.length>0&&!s.models[0].get("count")){getAndUpdateCollectionCount("companies",p)}setupLhsFilters(p,true);contactFiltersListeners("lhs_filters_conatiner")}}});var g=this;App_Companies.companyDateFields=COMPANY_DATE_FIELDS;App_Companies.companyContactTypeFields=COMPANIES_CONTACT_TYPE_FIELDS;App_Companies.companyCompanyTypeFields=COMPANIES_COMPANY_TYPE_FIELDS;if(!App_Companies.companyDateFields){$.getJSON("core/api/custom-fields/type/scope?type=DATE&scope=COMPANY",function(p){App_Companies.companyDateFields=p;g.companiesListView.appendItem=function(q){contactTableView(q,p,this,App_Companies.companyContactTypeFields,App_Companies.companyCompanyTypeFields)};g.companiesListView.collection.fetch();contactListener()})}else{g.companiesListView.appendItem=function(p){contactTableView(p,App_Companies.companyDateFields,this,App_Companies.companyContactTypeFields,App_Companies.companyCompanyTypeFields)};g.companiesListView.collection.fetch()}if(!m){$("#content").html(this.companiesListView.el);contactListener()}else{$("#content").find(".contacts-inner-div").html(this.companiesListView.el);$("#bulk-actions").css("display","none");$("#bulk-select").css("display","none");$("#bulk-action-btns > button").addClass("disabled");COMPANIES_HARD_RELOAD=true}$(".active").removeClass("active");$("#companiesmenu").addClass("active")},companyDetails:function(f,a){insidePopover=false;if(App_Companies.customFieldsList==null||App_Companies.customFieldsList==undefined){App_Companies.customFieldsList=new Base_Collection_View({url:"/core/api/custom-fields/position",sort_collection:false,restKey:"customFieldDefs",templateKey:"admin-settings-customfields",individual_tag_name:"tr"});App_Companies.customFieldsList.collection.fetch()}var e;if(!a&&this.companyDetailView&&this.companyDetailView.model!=null){if(f==this.companyDetailView.model.toJSON()["id"]){App_Companies.companyDetails(f,this.companyDetailView.model);return}}if(!a){if(!this.companiesListView||this.companiesListView.collection.length==0||this.companiesListView.collection.get(f)==null){console.log("Downloading contact");var b=Backbone.Model.extend({url:function(){return"/core/api/contacts/"+this.id}});var c=new b();c.id=f;c.fetch({success:function(g){App_Companies.companyDetails(f,c)},error:function(h,g){if(g&&g.status=="403"){$("#content").html("<div class='well'> <div class='alert bg-white text-center'><div class='slate-content p-md text'><h4 style='opacity:0.8'> "+_agile_get_translated_val("companies","invalid-viewer")+"</h4><div class='text'style='opacity:0.6'>"+_agile_get_translated_val("companies","enable-permission")+"</div></div></div></div>")}}});return}}if(!a){a=this.companiesListView.collection.get(f)}if(this.companiesListView&&this.companiesListView.collection){e=this.companiesListView.collection}add_recent_view(a);this.companyDetailView=new Contact_Details_Model_Events({model:a,isNew:true,template:"company-detail",postRenderCallback:function(h){var g=new Backbone.Model();g.url="core/api/contacts/viewed-at/"+a.get("id");g.save();if(App_Companies.companiesListView&&App_Companies.companiesListView.collection&&App_Companies.companiesListView.collection.get(f)){App_Companies.companiesListView.collection.get(f).attributes=a.attributes}company_util.starify(h);company_util.show_map(h);load_company_tab(h,a.toJSON());if(a){addTypeCustomData(a.get("id"),h)}}});var d=this.companyDetailView.render(true).el;$("#content").html(d);checkCompanyUpdated();return},companyViewPrefs:function(){var a=new Base_Model_View({url:"core/api/contact-view-prefs/company",template:"company-view",change:false,restKey:"companyView",window:"companies",postRenderCallback:function(c,b){fillSelect("custom-fields-optgroup","core/api/custom-fields/scope?scope=COMPANY",undefined,function(d){head.js(LIB_PATH+"lib/jquery-ui.min.js",LIB_PATH+"lib/jquery.multi-select.js",function(){$("#multipleSelect",c).multiSelect();$(".ms-selection",c).children("ul").addClass("multiSelect").attr("name","fields_set").attr("id","fields_set").sortable();$.each(b.fields_set,function(e,f){$("#multipleSelect",c).multiSelect("select",f)})})},'<option value="CUSTOM_{{field_label}}">{{field_label}}</option>',true,c)},saveCallback:function(b){COMPANIES_HARD_RELOAD=true;if(App_Companies.companyViewModel){App_Companies.companyViewModel.fields_set=b.fields_set}App_Companies.navigate("companies",{trigger:true})}});$("#content").html(a.render().el)},editCompany:function(a){var b=null;if(!this.companyDetailView||!this.companyDetailView.model.id){this.navigate("companies",{trigger:true});return}var e=this.companyDetailView.model.id;if(this.companyDetailView&&this.companyDetailView.model.id){b=this.companyDetailView.model.toJSON()}else{if(this.companiesListView&&this.companiesListView.collection&&this.companiesListView.collection.get(e)){b=this.companiesListView.collection.get(e).toJSON()}else{if(!b){var c=Backbone.Model.extend({url:function(){return"/core/api/contacts/"+e}});var d=new c();d.fetch({success:function(f){App_Companies.editCompany(b.toJSON())
}});return}}}add_custom_fields_to_form(b,function(f){deserialize_contact(f,"continue-company")},b.type)},duplicateCompany:function(b){dup_companies_array.length=0;var d=20;var a="tr";this.contact_id=b;var c="/core/api/search/duplicate-companies/"+b;var e=false;template_key="duplicate-companies";if(App_Companies.companyDetailView===undefined){Backbone.history.navigate("company/"+b,{trigger:true});return}this.duplicateCompanyListView=new Contacts_Events_Collection_View({url:c,templateKey:template_key,individual_tag_name:"tr",cursor:true,page_size:25,sort_collection:e,slateKey:null,postRenderCallback:function(f){}});this.duplicateCompanyListView.collection.fetch();$("#content").html(this.duplicateCompanyListView.render().el);$(".active").removeClass("active");$("#companiesmenu").addClass("active")},mergeCompanies:function(){var a=dup_companies_array[0];var e=20;var h="table";var f=false;template_key="merge-companies";if(App_Companies.duplicateCompanyListView==undefined||dup_companies_array.length<1){Backbone.history.navigate("companies",{trigger:true});return}var k=[];for(var d=0;d<dup_companies_array.length;d++){var g=Number(dup_companies_array[d]);var c=App_Companies.duplicateCompanyListView.collection.where({id:g});var j=k.concat(c);k=j}var n={};var m=App_Companies.companyDetailView.model.toJSON();console.log(m);var l=[];var b=0;l[0]=m;for(d=0;d<k.length;d++){l[d+1]=k[d].toJSON();b++}n.contacts=l;n.length=b;add_custom_fields_to_form(n,function(i){this.mergeContactsView=new Contact_Details_Model_Events({template:template_key,data:n,postRenderCallback:function(o){}});$("#content").html(this.mergeContactsView.render(true).el);$(window).scrollTop(0);$(".active").removeClass("active");$("#companiesmenu").addClass("active")},m.type)},companiesNew:function(b){$("#content").html('<div id="companies-listener-container"></div>');var a=new Contacts_And_Companies_Events_View({data:{},template:"companies-header",isNew:true,postRenderCallback:function(c){companies_view_loader.buildCompaniesView(c,b);companies_view_loader.setUpCompaniesCount(c)}});$("#companies-listener-container").html(a.render().el);$(".active").removeClass("active");$("#companiesmenu").addClass("active");$('[data-toggle="tooltip"]').tooltip()}});var DataSyncRouter=Backbone.Router.extend({routes:{sync:"dataSync","sync/contacts":"google_contacts_sync","sync/calendar-setup":"google_calendar_setup","sync/stripe-import":"stripe_sync","sync/shopify":"shopify","sync/officeCalendar":"office365_calendar_sync","sync/officeCalendar/:id":"office365_calendar_sync","sync/salesforce":"salesforce","sync/zoho-import":"zoho_sync","sync/quickbook":"quickbook_import","sync/xero":"xero_import","sync/freshbooks":"freshbooks_sync","sync/freshbooks/setting":"freshbooks_sync_setting",importcrm:"importFromCRMS",},importFromCRMS:function(){var a=this;getTemplate("import-from-crm",{},undefined,function(b){if(!b){return}$("#content").html($(b));a.agile_sync_collection_view=new Base_Collection_View({url:"core/api/contactprefs/allPrefs",type:"GET",individual_tag_name:"div",templateKey:"data-import",postRenderCallback:function(c){var d=_agile_get_prefs("dataimport_tab");if(!d||d==null){_agile_set_prefs("dataimport_tab","salesforce-tab");d="salesforce-tab"}$('#prefs-tabs-content a[href="#'+d+'"]').tab("show");$("#prefs-tabs-content .tab-container ul li").off("click");$("#prefs-tabs-content").on("click",".tab-container ul li",function(){var e=$(this).find("a").attr("href").split("#");_agile_set_prefs("dataimport_tab",e[1])});initializeDataSyncListners()}});a.agile_sync_collection_view.collection.fetch();a.agile_sync_collection_view.appendItem=organize_sync_widgets;$("#prefs-tabs-content").html(a.agile_sync_collection_view.render().el)},"#content")},salesforce:function(a){var b=this;getTemplate("import-from-crm",{},undefined,function(c){if(!c){return}$("#content").html($(c));getTemplate("data-import-settings",{},undefined,function(d){if(!d){return}$("#prefs-tabs-content").html(d);var e=_agile_get_prefs("dataimport_tab");$("#prefs-tabs-content").find('a[href="#'+e+'"]').closest("li").addClass("active");initializeTabListeners("dataimport_tab","sync");initializeDataSyncListners();getSyncModelFromName("SALESFORCE",function(g){var f="core/api/contactprefs/SALESFORCE",h="admin-settings-import-salesforce-prefs";renderInnerSyncView(f,h,g,function(i){showNotyPopUp("information",_agile_get_translated_val("datasync","salesforce-initiated"),"top",1000);DATA_SYNC_FORCE_FETCH=true;App_Datasync.salesforce()},function(){$(".checkedMultiCheckbox").find(".help-inline").remove();if($(".checkedMultiCheckbox").find("input:checked").length>0){return true}else{$(".checkedMultiCheckbox").append("<span generated='true' class='help-inline' style='display: block;'>"+_agile_get_translated_val("validation-msgs","pls-select-atleast-one-option")+"</span>")}return false})})},null)},"#content")},dataSync:function(){var a=this;getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));$("#PrefsTab .select").removeClass("select");$(".contact-sync-tab").addClass("select");a.agile_sync_collection_view=new Base_Collection_View({url:"core/api/contactprefs/allPrefs",type:"GET",individual_tag_name:"div",templateKey:"data-sync",postRenderCallback:function(c){var d=_agile_get_prefs("datasync_tab");if(!d||d==null){_agile_set_prefs("datasync_tab","google-tab");d="google-tab"}$('#prefs-tabs-content a[href="#'+d+'"]').tab("show");$("#prefs-tabs-content .tab-container ul li").off("click");$("#prefs-tabs-content").on("click",".tab-container ul li",function(){var e=$(this).find("a").attr("href").split("#");_agile_set_prefs("datasync_tab",e[1])});a.google_calendar(c);a.office_calendar(c);initializeDataSyncListners()}});a.agile_sync_collection_view.collection.fetch();a.agile_sync_collection_view.appendItem=organize_sync_widgets;$("#prefs-tabs-content").html(a.agile_sync_collection_view.render().el)},"#content")},google_calendar:function(a){this.calendar_sync_google=new GoogleCalendar_Event_Modal_View({url:"core/api/calendar-prefs/type/GOOGLE",template:"import-google-calendar",postRenderCallback:function(b){initializeImportListeners()}});$("#calendar-prefs").html(this.calendar_sync_google.render().el)},office_calendar:function(a){var b=new Calendar_Sync_Settings_View({url:"core/api/calendar-prefs/type/OFFICE365",template:"admin-settings-import-office365-sync-details"});$("#office365").html(b.render().el)},google_contacts_sync:function(){var a=this;getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));$("#PrefsTab .select").removeClass("select");$(".contact-sync-tab").addClass("select");getTemplate("data-sync-settings",{},undefined,function(c){if(!c){return}$("#prefs-tabs-content").html(c);var d=_agile_get_prefs("datasync_tab");$("#prefs-tabs-content").find('a[href="#'+d+'"]').closest("li").addClass("active");initializeTabListeners("datasync_tab","sync");getSyncModelFromName("GOOGLE",function(f){var e="core/api/contactprefs/GOOGLE",g="admin-settings-import-google-contacts-setup";renderInnerSyncView(e,g,f,function(h){showNotyPopUp("information",_agile_get_translated_val("misc-keys","sync-conatcts-init"),"top",1000)})})},null)},"#content")},google_calendar_setup:function(){getTemplate("settings",{},undefined,function(a){$("#content").html($(a));$("#PrefsTab .select").removeClass("select");$(".contact-sync-tab").addClass("select");getTemplate("data-sync-settings",{},undefined,function(b){if(!b){return}$("#prefs-tabs-content").html(b);var c=_agile_get_prefs("datasync_tab");$("#prefs-tabs-content").find('a[href="#'+c+'"]').closest("li").addClass("active");initializeTabListeners("datasync_tab","sync");var d=new Calendar_Sync_Settings_View({url:"core/api/calendar-prefs/type/GOOGLE",template:"import-google-calendar-setup",change:false,saveCallback:function(e){erase_google_calendar_prefs_cookie();showNotyPopUp("information",_agile_get_translated_val("datasync","gc-prefs-saved"),"top",1000)},postRenderCallback:function(f){var e=d.model;prefs=e.get("prefs");if(prefs){if(typeof prefs!="object"){JSON.parse(e.get("prefs"));e.set("prefs",JSON.parse(e.get("prefs")),{silent:true});prefs=e.get("prefs")}}console.log(e);$("#multi-select-calendars-container",f).html(getRandomLoadingImg());erase_google_calendar_prefs_cookie();_fetchGoogleCalendarList(function(g){getTemplate("dynamic-multi-calendar",g,"no",function(h){head.js(LIB_PATH+"lib/jquery.multi-select.js",function(){$("#multi-select-calendars-container",f).html(h);deserialize_multiselect(e.toJSON(),f);var i=$("#multi-select-calendars",f);i.multiSelect({selectableHeader:'<label class="control-label"><b>Google</b></label>',selectedHeader:'<label class="control-label"><b>Agile</b></label>'});var j=get_calendar_ids_form_prefs(e.toJSON());if(j&&j.length==1&&j[0]=="primary"){if(g&&g.items){$.each(g.items,function(k,l){if(l.primary){i.multiSelect("select",l.summary)}})}}else{$.each(get_calendar_ids_form_prefs(e.toJSON()),function(k,l){i.multiSelect("select",l)})}})})})}});$("#data-sync-settings-tab-content").html(d.render().el)},null)},"#content")},stripe_sync:function(){var a=this;getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));$("#PrefsTab .select").removeClass("select");$(".contact-sync-tab").addClass("select");getTemplate("data-sync-settings",{},undefined,function(c){if(!c){return}$("#prefs-tabs-content").html(c);var d=_agile_get_prefs("datasync_tab");$("#prefs-tabs-content").find('a[href="#'+d+'"]').closest("li").addClass("active");initializeTabListeners("datasync_tab","sync");getSyncModelFromName("STRIPE",function(f){var e="core/api/contactprefs/STRIPE",g="admin-settings-import-stripe-contact-sync-prefs";renderInnerSyncView(e,g,f,function(h){showNotyPopUp("information",_agile_get_translated_val("misc-keys","sync-conatcts-init"),"top",1000)})})},null)},"#content")},office365_calendar_sync:function(){var a=this;getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));$("#PrefsTab .select").removeClass("select");
$(".contact-sync-tab").addClass("select");getTemplate("data-sync-settings",{},undefined,function(c){if(!c){return}$("#prefs-tabs-content").html(c);var d=_agile_get_prefs("datasync_tab");$("#prefs-tabs-content").find('a[href="#'+d+'"]').closest("li").addClass("active");initializeTabListeners("datasync_tab","sync");var e=new Calendar_Sync_Settings_View({url:"core/api/calendar-prefs/type/OFFICE365",template:"admin-settings-import-office365-calendar-prefs",postRenderCallback:function(h){var g=e.model;if(g&&g.get("prefs")){try{var f=g.get("prefs");if(typeof f!="object"){g.set("prefs",JSON.parse(f),{silent:true})}}catch(i){console.log(i)}}},saveCallback:function(){App_Datasync.dataSync();showNotyPopUp("information",_agile_get_translated_val("datasync","office365-initiated"),"top",1000)}});$("#data-sync-settings-tab-content").html(e.render().el)},null)},"#content")},shopify:function(){var a=this;getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));$("#PrefsTab .select").removeClass("select");$(".contact-sync-tab").addClass("select");getTemplate("data-sync-settings",{},undefined,function(c){if(!c){return}$("#prefs-tabs-content").html(c);var d=_agile_get_prefs("datasync_tab");$("#prefs-tabs-content").find('a[href="#'+d+'"]').closest("li").addClass("active");initializeTabListeners("datasync_tab","sync");getSyncModelFromName("SHOPIFY",function(f){var e="core/api/contactprefs/SHOPIFY",g="admin-settings-import-shopify-prefs";renderInnerSyncView(e,g,f,function(h){showNotyPopUp("information",_agile_get_translated_val("misc-keys","sync-conatcts-init"),"top",1000)})})},null)},"#content")},freshbooks_sync:function(){var a=this;getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));$("#PrefsTab .select").removeClass("select");$(".contact-sync-tab").addClass("select");getTemplate("data-sync-settings",{},undefined,function(c){if(!c){return}$("#prefs-tabs-content").html(c);var d=_agile_get_prefs("datasync_tab");$("#prefs-tabs-content").find('a[href="#'+d+'"]').closest("li").addClass("active");initializeTabListeners("datasync_tab","sync");getSyncModelFromName("FRESHBOOKS",function(f){var e="core/api/contactprefs/FRESHBOOKS",g="admin-settings-import-freshbooks-contacts-form";renderInnerSyncView(e,g,f,function(h){showNotyPopUp("information",_agile_get_translated_val("misc-keys","sync-conatcts-init"),"top",1000)})})},null)},"#content")},freshbooks_sync_setting:function(){var a=this;getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));$("#PrefsTab .select").removeClass("select");$(".contact-sync-tab").addClass("select");getTemplate("data-sync-settings",{},undefined,function(c){if(!c){return}$("#prefs-tabs-content").html(c);var d=_agile_get_prefs("datasync_tab");$("#prefs-tabs-content").find('a[href="#'+d+'"]').closest("li").addClass("active");initializeTabListeners("datasync_tab","sync");getSyncModelFromName("FRESHBOOKS",function(f){var e="core/api/contactprefs/FRESHBOOKS",g="admin-settings-import-freshbooks-settings";renderInnerSyncView(e,g,f,function(h){showNotyPopUp("information",_agile_get_translated_val("misc-keys","sync-conatcts-init"),"top",1000)})})},null)},"#content")},quickbook_import:function(){var a=this;getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));$("#PrefsTab .select").removeClass("select");$(".contact-sync-tab").addClass("select");getTemplate("data-sync-settings",{},undefined,function(c){if(!c){return}$("#prefs-tabs-content").html(c);var d=_agile_get_prefs("datasync_tab");$("#prefs-tabs-content").find('a[href="#'+d+'"]').closest("li").addClass("active");initializeTabListeners("datasync_tab","sync");getSyncModelFromName("QUICKBOOK",function(f){var e="core/api/contactprefs/QUICKBOOK",g="admin-settings-import-quickbook-settings";renderInnerSyncView(e,g,f,function(h){showNotyPopUp("information",_agile_get_translated_val("misc-keys","sync-conatcts-init"),"top",1000)})})},null)},"#content")},xero_import:function(){var a=this;getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));$("#PrefsTab .select").removeClass("select");$(".contact-sync-tab").addClass("select");getTemplate("data-sync-settings",{},undefined,function(c){if(!c){return}$("#prefs-tabs-content").html(c);var d=_agile_get_prefs("datasync_tab");$("#prefs-tabs-content").find('a[href="#'+d+'"]').closest("li").addClass("active");initializeTabListeners("datasync_tab","sync");getSyncModelFromName("XERO",function(f){var e="core/api/contactprefs/XERO",g="admin-settings-import-xero-settings";renderInnerSyncView(e,g,f,function(h){showNotyPopUp("information",_agile_get_translated_val("misc-keys","sync-conatcts-init"),"top",1000)})})},null)},"#content")},zoho_sync:function(){var a=this;getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));$("#PrefsTab .select").removeClass("select");$(".contact-sync-tab").addClass("select");getTemplate("data-sync-settings",{},undefined,function(c){if(!c){return}$("#prefs-tabs-content").html(c);var d=_agile_get_prefs("datasync_tab");$("#prefs-tabs-content").find('a[href="#'+d+'"]').closest("li").addClass("active");initializeTabListeners("datasync_tab","sync");getSyncModelFromName("ZOHO",function(f){var e="core/api/contactprefs/ZOHO",g="admin-settings-import-zoho-prefs";renderInnerSyncView(e,g,f,function(h){showNotyPopUp("information",_agile_get_translated_val("misc-keys","sync-conatcts-init"),"top",1000)})})},null)},"#content")}});var FormsRouter=Backbone.Router.extend({routes:{forms:"formSettings","form-builder-templates":"getListOfTemplates"},formSettings:function(){console.log("forms collection template");this.formsListView=new Form_Collection_Events({url:"/core/api/forms",restKey:"forms",templateKey:"forms",individual_tag_name:"tr",postRenderCallback:function(a){agileTimeAgoWithLngConversion($("time.form-modified-time",a))}});this.formsListView.collection.fetch();$("#content").html(this.formsListView.el);make_menu_item_active("formsmenu")},getListOfTemplates:function(){$("#content").html("<link rel='stylesheet' type='text/css' href='flatfull/css/jquery.fancybox.css'><div id='formbuilder-listeners'></div>");head.js("flatfull/lib/jquery.fancybox.js",function(){$.getJSON("misc/formbuilder/templates/templates.json",function(a){getTemplate("formbuilder-categories",a.templates[0],undefined,function(b){$("#formbuilder-listeners").html($(b))},"#formbuilder-listeners");$(".form_fancybox").fancybox({autoDimensions:true,padding:0,autoScale:true,overflow:"visible"});hideTransitionBar()})});$(".active").removeClass("active")}});var ContactBulkActionRouter=Backbone.Router.extend({routes:{"bulk-owner":"ownerBulk","bulk-campaigns":"campaignsBulk","bulk-tags":"tagsBulk","bulk-tags-remove":"tagsRemoveBulk","bulk-email":"emailBulk","company-bulk-owner":"companyOwnerBulk","company-bulk-email":"companyEmailBulk","company-bulk-tags":"companyTagsBulk","company-bulk-tags-remove":"companyTagsRemoveBulk",},ownerBulk:function(){if(!App_Contacts.contactsListView){Backbone.history.navigate("contacts",{trigger:true})}else{getTemplate("bulk-actions-owner",{},undefined,function(a){if(!a){return}$("#content").html($(a));$("body").trigger("fill_owners")},"#content")}},campaignsBulk:function(){if(!App_Contacts.contactsListView){Backbone.history.navigate("contacts",{trigger:true})}else{getTemplate("bulk-actions-campaign",{},undefined,function(a){if(!a){return}$("#content").html($(a));$("body").trigger("fill_campaigns")},"#content")}},tagsBulk:function(){if(!App_Contacts.contactsListView){Backbone.history.navigate("contacts",{trigger:true})}else{getTemplate("bulk-actions-tags",{},undefined,function(a){if(!a){return}$("#content").html($(a))},"#content")}},tagsRemoveBulk:function(){if(!App_Contacts.contactsListView){Backbone.history.navigate("contacts",{trigger:true})}else{getTemplate("bulk-actions-tags-remove",{},undefined,function(a){if(!a){return}$("#content").html($(a))},"#content")}},emailBulk:function(){if(!App_Contacts.contactsListView){Backbone.history.navigate("contacts",{trigger:true})}else{$("#content").html('<div id="send-email-listener-container"></div>');getTemplate("send-email",{},undefined,function(b){if(!b){return}$("#send-email-listener-container").html($(b));$("#emailForm").find(".add-attachment-select").hide();$("body").trigger("fill_emails");initializeSendEmailListeners();sendEmailAttachmentListeners("send-email-listener-container")},"#send-email-listener-container")}var a={};a[_agile_get_translated_val("others","add-new")]="verify_email";fetchAndFillSelect("core/api/account-prefs/verified-emails/all","email","email",undefined,a,$("#from_email"),"prepend",function(b,c){var d=b.find('option[value = "'+CURRENT_DOMAIN_USER.email+'"]').val();if(typeof(d)=="undefined"){b.find("option:first").before("<option value="+CURRENT_DOMAIN_USER.email+">"+CURRENT_DOMAIN_USER.email+"</option>");b.val(CURRENT_DOMAIN_USER.email).attr("selected","selected")}else{b.find('option[value = "'+CURRENT_DOMAIN_USER.email+'"]').attr("selected","selected")}rearrange_from_email_options(b,c)})},companyOwnerBulk:function(){if(!App_Companies.companiesListView){Backbone.history.navigate("companies",{trigger:true})}else{getTemplate("bulk-actions-company-owner",{},undefined,function(a){if(!a){return}$("#content").html($(a));$("body").trigger("fill_owners")},"#content")}},companyEmailBulk:function(){if(!App_Companies.companiesListView){Backbone.history.navigate("companies",{trigger:true})}else{$("#content").html('<div id="send-email-listener-container"></div>');getTemplate("send-email-company",{},undefined,function(a){if(!a){return}$("#send-email-listener-container").html($(a));$("#emailForm").find(".add-attachment-select").hide();$("body").trigger("fill_emails");initializeSendEmailListeners();sendEmailAttachmentListeners("send-email-listener-container")},"#send-email-listener-container")}},companyTagsRemoveBulk:function(){if(!App_Companies.companiesListView){Backbone.history.navigate("companies",{trigger:true})
}else{getTemplate("bulk-actions-companies-tags-remove",{},undefined,function(a){if(!a){return}$("#content").html($(a))},"#content")}},companyTagsBulk:function(){if(!App_Companies.companiesListView){Backbone.history.navigate("companies",{trigger:true})}else{getTemplate("bulk-actions-companies-tags",{},undefined,function(a){if(!a){return}$("#content").html($(a))},"#content")}}});var view={};var AdminSettingsRouter=Backbone.Router.extend({routes:{admin:"adminSettings","account-prefs":"accountPrefs","account-ipaccess":"ipaccess",users:"users","users-add":"usersAdd","user-edit/:id":"userEdit","custom-fields":"customFields","analytics-code":"analyticsCode","analytics-code/:id":"analyticsCode",milestones:"milestones",categories:"categories","menu-settings":"menu_settings","integrations-stats":"integrationsStats",integrations:"integrations","tag-management":"tagManagement","email-gateways/:id":"emailGateways","sms-gateways/:id":"smsGateways","lost-reasons":"lostReasons","deal-sources":"dealSources",goals:"dealGoal",webhook:"webhookSettings","change-domain":"changeDomain","js-security":"jsSecuritySettings","sso-login":"ssoLoginSettings"},menu_settings:function(){if(!CURRENT_DOMAIN_USER.is_admin){getTemplate("others-not-allowed",{},undefined,function(a){if(!a){return}$("#content").html($(a))},"#content");return}getTemplate("admin-settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));var a=new Base_Model_View({url:"/core/api/menusetting",template:"admin-settings-menu-settings",reload:true});$("#content").find("#admin-prefs-tabs-content").html(a.render().el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".menu-settings-tab").addClass("select")},"#content");$(".active").removeClass("active")},accountPrefs:function(){if(!CURRENT_DOMAIN_USER.is_admin){getTemplate("others-not-allowed",{},undefined,function(b){if(!b){return}$("#content").html($(b))},"#content");return}var a=this;$("#content").html("<div id='account-pref'>&nbsp;</div>");getTemplate("admin-settings",{},undefined,function(c){if(!c){return}$("#account-pref").html($(c));$("#account-pref").find("#admin-prefs-tabs-content").html(getTemplate("settings-account-tab"),{});var b=new AccountPrefs_Events_Model_View({url:"/core/api/account-prefs",template:"admin-settings-account-prefs",postRenderCallback:function(){ACCOUNT_DELETE_REASON_JSON=undefined},saveCallback:function(){location.reload(true)}});$("#account-pref").find("#admin-prefs-tabs-content").find("#settings-account-tab-content").html(b.render().el);$("#account-pref").find("#AdminPrefsTab .select").removeClass("select");$("#account-pref").find(".account-prefs-tab").addClass("select");$(".active").removeClass("active");$(".settings-account-prefs").addClass("active");$("#account-pref").find("#admin-prefs-tabs-content").parent().removeClass("bg-white")},"#account-pref");$(".settings-account-prefs").addClass("active");$("#account-pref").find("#admin-prefs-tabs-content").parent().removeClass("bg-white")},ipaccess:function(){if(!CURRENT_DOMAIN_USER.is_admin){$("#content").html(getTemplate("others-not-allowed",{}));return}var a=this;$("#content").html("<div id='account-pref'>&nbsp;</div>");getTemplate("admin-settings",{},undefined,function(c){if(!c){return}$("#account-pref").html($(c));$("#account-pref").find("#admin-prefs-tabs-content").html(getTemplate("settings-account-tab"),{});var b=new Base_Model_View({url:"/core/api/allowedips",template:"admin-settings-ip-prefs",postRenderCallback:function(d){loadip_access_events()},saveCallback:function(){console.log("saveCallback");showNotyPopUp("information",_agile_get_translated_val("security","ip-added"),"top",4000);App_Admin_Settings.ipaccess()},errorCallback:function(d){showNotyPopUp("warning",d.responseText,"top")}});$("#content").find("#admin-prefs-tabs-content").find("#settings-account-tab-content").html(b.render().el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".account-prefs-tab").addClass("select");$(".active").removeClass("active");$(".settings-account-ips").addClass("active");$("#account-pref").find("#admin-prefs-tabs-content").parent().removeClass("bg-white")},"#account-pref")},webhookSettings:function(){var a=new Base_Model_View({url:"/core/api/webhooksregister",template:"admin-settings-webhook",no_reload_on_delete:true,postRenderCallback:function(){},form_custom_validate:function(){$(".checkedMultiCheckbox").find(".help-inline").remove();if($(".checkedMultiCheckbox").find("input:checked").length>0){return true}else{$(".checkedMultiCheckbox").append("<span generated='true' class='help-inline col-sm-offset-4 col-xs-offset-4 controls col-sm-8 col-xs-8' style='display: block;'>"+_agile_get_translated_val("validation-msgs","select-atleast-one")+"</span>")}return false},saveCallback:function(){console.log("saveCallback");App_Admin_Settings.webhookSettings();showNotyPopUp("information",_agile_get_translated_val("others","prefs-saved-success"),"top",1000)},errorCallback:function(b){showNotyPopUp("warning",b.responseText,"top",2000)},deleteCallback:function(){console.log("deleteCallback");App_Admin_Settings.webhookSettings()}});$("#content").find("#webhook-accordian-template").html(a.render().el)},jsSecuritySettings:function(){var a=new Base_Model_View({url:"/core/api/jspermission/",template:"admin-settings-js-security",no_reload_on_delete:true,postRenderCallback:function(){},form_custom_validate:function(){$(".checkedMultiCheckbox").find(".help-inline").remove();if($(".checkedMultiCheckbox").find("input:checked").length>0){return true}else{$(".checkedMultiCheckbox").append("<span generated='true' class='help-inline col-sm-offset-4 col-xs-offset-4 controls col-sm-8 col-xs-8' style='display: block;'>"+_agile_get_translated_val("validation-msgs","select-atleast-one")+"</span>")}return false},saveCallback:function(){console.log("saveCallback");App_Admin_Settings.jsSecuritySettings();showNotyPopUp("information",_agile_get_translated_val("others","prefs-saved-success"),"top",1000)}});$("#content").find("#js-security-accordian-template").html(a.render().el)},ssoLoginSettings:function(){if(!CURRENT_DOMAIN_USER.is_admin){$("#content").html(getTemplate("others-not-allowed",{}));return}var a=this;$("#content").html("<div id='account-pref'>&nbsp;</div>");getTemplate("admin-settings",{},undefined,function(c){if(!c){return}$("#account-pref").html($(c));$("#account-pref").find("#admin-prefs-tabs-content").html(getTemplate("settings-account-tab"),{});var b=new Base_Model_View({url:"/core/api/sso/jwt",template:"admin-settings-sso-login",postRenderCallback:function(){},saveCallback:function(){console.log("saveCallback");App_Admin_Settings.ssoLoginSettings();showNotyPopUp("information",_agile_get_translated_val("others","prefs-saved-success"),"top",1000)},deleteCallback:function(){console.log("deleteCallback");App_Admin_Settings.ssoLoginSettings()}});$("#content").find("#admin-prefs-tabs-content").find("#settings-account-tab-content").html(b.render().el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".account-prefs-tab").addClass("select");$(".active").removeClass("active");$(".settings-sso-login").addClass("active");$("#account-pref").find("#admin-prefs-tabs-content").parent().removeClass("bg-white")},"#account-pref")},users:function(){if(!CURRENT_DOMAIN_USER.is_admin){getTemplate("others-not-allowed",{},undefined,function(b){if(!b){return}$("#content").html($(b))},"#content");return}var a=this;getTemplate("admin-settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));a.usersListView=new Base_Collection_View({url:"/core/api/users",restKey:"domainUser",templateKey:"admin-settings-users",individual_tag_name:"tr",sortKey:"name",postRenderCallback:function(c){$("i").tooltip();agileTimeAgoWithLngConversion($(".last-login-time",c))}});a.usersListView.collection.fetch();$("#content").find("#admin-prefs-tabs-content").html(a.usersListView.el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".users-tab").addClass("select");$(".active").removeClass("active")},"#content")},usersAdd:function(){if(!CURRENT_DOMAIN_USER.is_admin){getTemplate("others-not-allowed",{},undefined,function(a){if(!a){return}$("#content").html($(a))},"#content");return}getTemplate("admin-settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));var a=new Base_Model_View({url:"core/api/users",template:"admin-settings-user-add",isNew:true,window:"users",reload:false,postRenderCallback:function(c){if(a.model.get("id")){addTagAgile("User invited")}bindAdminChangeAction(c,a.model.toJSON());setTimeout(function(){$('a[href="#sales-previlages"]').tab("show")},100)},saveCallback:function(c){$.getJSON("core/api/users/current-owner",function(d){if(d){console.log("data of current-owner = "+d);d.created_user_email=c.email;add_created_user_info_as_note_to_owner(d)}location.reload(true)})},saveAuth:function(c){if(CURRENT_DOMAIN_USER.is_account_owner&&$("#userForm",c).find("#owner:checked").length==1&&$("#userForm",c).find("#eaddress").val()!=CURRENT_DOMAIN_USER.email){$("#saveUserAuthentication",c).html(getTemplate("conform-owner-change-model",{}));$("#saveUserAuthentication",c).modal("show");return true}else{return false}}});$("#content").find("#admin-prefs-tabs-content").html(a.render().el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".users-tab").addClass("select");$(".active").removeClass("active")},"#content")},userEdit:function(b){if(!CURRENT_DOMAIN_USER.is_admin){getTemplate("others-not-allowed",{},undefined,function(c){if(!c){return}$("#content").html($(c))},"#content");return}var a=this;getTemplate("admin-settings",{},undefined,function(g){if(!g){return}$("#content").html($(g));if(!a.usersListView||!a.usersListView.collection.get(b)){a.navigate("users",{trigger:true});return}var e=a.usersListView.collection.get(b);var f=e.attributes.email;var d=false;if(CURRENT_DOMAIN_USER.email==e.attributes.email){d=true
}var c=new Base_Model_View({url:"core/api/users",model:e,template:"admin-settings-user-add",change:false,saveCallback:function(h){update_contact_in_our_domain(f,h,function(){if(d&&CURRENT_DOMAIN_USER.email!=h.email){console.log("Logging out...");showNotyPopUp("information",_agile_get_translated_val("domain-user","email-edited"),"top");var i=window.location.hash;setTimeout(function(){window.location.href=window.location.protocol+"//"+window.location.host+"/login"+i},5000)}else{location.reload(true)}})},postRenderCallback:function(h){bindAdminChangeAction(h,c.model.toJSON());setTimeout(function(){$("#deals-privilege",h).trigger("change");$("#calendar-privilege",h).trigger("change");$('a[href="#sales-previlages"]',h).tab("show");$('a[href="#sales-previlages"]',h).trigger("click")},500)},saveAuth:function(h){if(CURRENT_DOMAIN_USER.is_account_owner&&$("#userForm",h).find("#owner:checked").length==1&&$("#userForm",h).find("#eaddress").val()!=CURRENT_DOMAIN_USER.email){$("#saveUserAuthentication",h).html(getTemplate("conform-owner-change-model",{}));$("#saveUserAuthentication",h).modal("show");return true}else{return false}}});$("#content").find("#admin-prefs-tabs-content").html(c.render().el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".users-tab").addClass("select");$(".active").removeClass("active")},"#content")},customFields:function(){if(!CURRENT_DOMAIN_USER.is_admin){getTemplate("others-not-allowed",{},undefined,function(b){if(!b){return}$("#content").html($(b))},"#content");return}var a=this;getTemplate("admin-settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));a.customFieldsListView=new Base_Collection_View({url:"/core/api/custom-fields/allScopes",restKey:"customFieldDefs",templateKey:"admin-settings-customfields",individual_tag_name:"tr",postRenderCallback:function(c){initializeCustomFieldsListeners()}});a.customFieldsListView.appendItem=groupingCustomFields;a.customFieldsListView.collection.fetch();$("#content").find("#admin-prefs-tabs-content").html(a.customFieldsListView.el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".custom-fields-tab").addClass("select");$(".active").removeClass("active")},"#content")},analyticsCode:function(a){if(!CURRENT_DOMAIN_USER.is_admin){getTemplate("others-not-allowed",{},undefined,function(b){if(!b){return}$("#content").html($(b))},"#content");return}getTemplate("admin-settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));head.js(LIB_PATH+"lib/prettify-min.js",function(){var c=new Base_Model_View({url:"/core/api/api-key",template:"admin-settings-api-key-model",postRenderCallback:function(d){$("#content").find("#admin-prefs-tabs-content").html(c.el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".analytics-code-tab").addClass("select");if(a){$(d).find('#APITab a[href="#'+a+'"]').trigger("click")}try{if(ACCOUNT_PREFS.plan.plan_type.split("_")[0]=="PRO"||ACCOUNT_PREFS.plan.plan_type.split("_")[0]=="ENTERPRISE"){$("#tracking-webrules, .tracking-webrules-tab").hide()}else{$("#tracking-webrules-whitelist, .tracking-webrules-whitelist-tab").hide()}}catch(f){$("#tracking-webrules-whitelist, .tracking-webrules-whitelist-tab").hide()}prettify_api_add_events()}})})},"#content")},api:function(){if(!CURRENT_DOMAIN_USER.is_admin){getTemplate("others-not-allowed",{},undefined,function(a){if(!a){return}$("#content").html($(a))},"#content");return}getTemplate("admin-settings",{},undefined,function(a){if(!a){return}$("#content").html($(a));head.js(LIB_PATH+"lib/prettify-min.js",function(){var b=new Base_Model_View({url:"/core/api/api-key",template:"admin-settings-api-model",postRenderCallback:function(c){initializeRegenerateKeysListeners();prettyPrint()}});$("#content").find("#admin-prefs-tabs-content").html(b.el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".analytics-code-tab").addClass("select");$(".active").removeClass("active")})},"#content")},milestones:function(){if(!CURRENT_DOMAIN_USER.is_admin){getTemplate("others-not-allowed",{},undefined,function(b){if(!b){return}$("#content").html($(b))},"#content");return}var a=this;$("#content").html("<div id='milestone-listner'>&nbsp;</div>");getTemplate("admin-settings",{},undefined,function(b){if(!b){return}$("#milestone-listner").html($(b));$("#milestone-listner").find("#admin-prefs-tabs-content").html(getTemplate("settings-milestones-tab"),{});a.pipelineGridView=new Track_And_Milestone_Events_Collection_View({url:"/core/api/milestone/pipelines",templateKey:"admin-settings-milestones",individual_tag_name:"div",sortKey:"name",postRenderCallback:function(c){setup_milestones(c);var d=App_Admin_Settings.pipelineGridView.collection.length;if(d==1){$("#milestone-listner").find("#deal-tracks-accordion").find(".collapse").addClass("in")}initializeMilestoneListners(c);milestone_util.init(c)}});a.pipelineGridView.collection.fetch();$("#milestone-listner").find("#admin-prefs-tabs-content").find("#settings-milestones-tab-content").html(a.pipelineGridView.render().el);$("#milestone-listner").find("#AdminPrefsTab .select").removeClass("select");$("#milestone-listner").find(".milestones-tab").addClass("select");$(".active").removeClass("active");$(".settings-milestones").addClass("active");$("#milestone-listner").find("#admin-prefs-tabs-content").parent().removeClass("bg-white")},"#milestone-listner");$(".settings-milestones").addClass("active");$("#milestone-listner").find("#admin-prefs-tabs-content").parent().removeClass("bg-white")},categories:function(){if(!CURRENT_DOMAIN_USER.is_admin){$("#content").html(getTemplate("others-not-allowed",{}));return}$("#content").html(getTemplate("admin-settings"),{});this.categoryGridView=new Base_Collection_View({url:"/core/api/categories?entity_type=TASK",templateKey:"admin-settings-categories",individual_tag_name:"tr",sortKey:"order",postRenderCallback:function(a){console.log("loaded categories : ",a);categories.setup_categories(a);categories.init()}});this.categoryGridView.collection.fetch();$("#content").find("#admin-prefs-tabs-content").html(this.categoryGridView.render().el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".categories-tab").addClass("select");$(".active").removeClass("active")},integrationsStats:function(){if(!CURRENT_DOMAIN_USER.is_admin){getTemplate("others-not-allowed",{},undefined,function(a){if(!a){return}$("#content").html($(a))},"#content");return}$("#content").html("<div id='email-stats-listners'></div>");getTemplate("admin-settings",{},undefined,function(a){if(!a){return}$("#email-stats-listners").html($(a));$("#email-stats-listners").find("#AdminPrefsTab .select").removeClass("select");$("#email-stats-listners").find(".stats-tab").addClass("select");$(".active").removeClass("active");$("#email-stats-listners").find("#admin-prefs-tabs-content").html(getRandomLoadingImg());getTemplate("admin-settings-integrations-stats-new",{},undefined,function(b){if(!b){return}$("#email-stats-listners").find("#admin-prefs-tabs-content").html($(b));$('#integration-stats a[href="#account-stats-new"]',$("#email-stats-listners")).tab("show");$("#email-stats-listners").find("#account-stats-new").html(LOADING_ON_CURSOR);account_stats_integrations.loadAccountStats($("#email-stats-listners"));initializeStatsListners($("#email-stats-listners"));hideTransitionBar()},$("#email-stats-listners").find("#admin-prefs-tabs-content"))},"#email-stats-listners")},integrations:function(){if(!CURRENT_DOMAIN_USER.is_admin){getTemplate("others-not-allowed",{},undefined,function(b){if(!b){return}$("#content").html($(b))},"#content");return}var a=this;getTemplate("admin-settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));a.integrations=new Base_Collection_View({url:"core/api/widgets/integrations",templateKey:"admin-settings-web-to-lead-new",postRenderCallback:function(d){var c=_agile_get_prefs("integrations_tab");if(!c||c==null){_agile_set_prefs("integrations_tab","web-to-lead-tab");c="web-to-lead-tab"}$('#admin-prefs-tabs-content a[href="#'+c+'"]').tab("show");$("#admin-prefs-tabs-content .tab-container ul li").off("click");$("#admin-prefs-tabs-content").on("click",".tab-container ul li",function(){var e=$(this).find("a").attr("href").split("#");_agile_set_prefs("integrations_tab",e[1])})}});a.integrations.collection.fetch();$("#content").find("#admin-prefs-tabs-content").html(a.integrations.render().el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".integrations-tab").addClass("select");$(".active").removeClass("active")},"#content")},tagManagement:function(){if(!CURRENT_DOMAIN_USER.is_admin){getTemplate("others-not-allowed",{},undefined,function(b){if(!b){return}$("#content").html($(b))},"#content");return}var a=this;getTemplate("admin-settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));a.tagsview1=new Base_Collection_View({url:"core/api/tags/stats1",templateKey:"tag-management",individual_tag_name:"li",sort_collection:true,sortKey:"tag",postRenderCallback:function(c){acl_util.initTagACL(c);initializeTagManagementListeners();$(".allow_users_switch").tooltip({title:"<p>"+_agile_get_translated_val("tag-manage","allow-users-to-add")+"</p><p>"+_agile_get_translated_val("tag-manage","allow-tooltip")+"</p>",html:true,placement:"bottom"})}});a.tagsview1.appendItem=append_tag_management;console.log(a.tagsview1);a.tagsview1.collection.fetch();$("#content").find("#admin-prefs-tabs-content").html(a.tagsview1.render().el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".tag-management-tab").addClass("select");$(".active").removeClass("active")},"#admin-prefs-tabs-content")},emailGateways:function(b){console.log(App_Admin_Settings.integrations.collection);var a=this;getTemplate("admin-settings",{},undefined,function(c){if(!c){return}$("#content").html($(c));getTemplate("web-to-lead-settings",{},undefined,function(e){if(!e){return
}$("#admin-prefs-tabs-content").html($(e));var d=_agile_get_prefs("integrations_tab");$("#admin-prefs-tabs-content").find('a[href="#'+d+'"]').closest("li").addClass("active");if(!a.integrations||a.integrations.collection==undefined){a.navigate("integrations",{trigger:true});return}var g="SEND_GRID";if(b=="mandrill"){g="MANDRILL"}else{if(b=="ses"){g="SES"}else{if(b=="mailgun"){g="MAILGUN"}}}var f;$.each(a.integrations.collection.where({name:"EmailGateway"}),function(h,i){f=JSON.parse(i.attributes.prefs)});if(f&&f.email_api){if(f.email_api.toUpperCase()!=g){modalAlert("sms-integration-alert-modal",_agile_get_translated_val("emailgateway","already-exists"),_agile_get_translated_val("emailgateway","configured"));a.navigate("integrations",{trigger:true});return}}if(!f){f={email_api:g,api_user:"",api_key:""}}a.email_gateway=new Base_Model_View({data:f,url:"core/api/email-gateway",template:"settings-email-gateway",postRenderCallback:function(h){initializeIntegrationsTabListeners("integrations_tab","integrations");if(b=="mandrill"){$("#integrations-image",h).attr("src","img/crm-plugins/mandrill_logo.png")}if(b=="sendgrid"){$("#integrations-image",h).attr("src","img/crm-plugins/sendgrid_logo.png")}if(b=="ses"){$("#integrations-image",h).attr("src","img/crm-plugins/ses_logo.png")}if(b=="mailgun"){$("#integrations-image",h).attr("src","img/crm-plugins/mailgun.png")}},saveCallback:function(){$(".ses-success-msg").show();Backbone.history.navigate("integrations",{trigger:true});if(g=="SES"){return}data=App_Admin_Settings.email_gateway.model.toJSON();$.getJSON("core/api/email-gateway/add-webhook?api_user="+data.api_user+"&api_key="+data.api_key+"&type="+data.email_api,function(h){console.log(h)})},errorCallback:function(j){var i=$(".save","#email-gateway-integration-form");disable_save_button(i);var k=j.responseText;if(k.indexOf("SignatureDoesNotMatch")!=-1){k=k.replace("SignatureDoesNotMatch",_agile_get_translated_val("emailgateway","sign-mis-match"))}if(k.indexOf("InvalidClientTokenId")!=-1){k=k.replace("InvalidClientTokenId",_agile_get_translated_val("emailgateway","invalid-acceess-key"))}var h=$('<div style="display:inline-block"><small><p style="color:#B94A48; font-size:14px"><i>'+k+"</i></p></small></div>");i.closest(".form-actions",this.el).append(h);if(j.status!=406){h.show().delay(3000).hide(1,function(){enable_save_button(i)})}}});$("#content").find("#admin-settings-integrations-tab-content").html(a.email_gateway.render().el);$("#content").find(".integrations-tab").addClass("select")},"#admin-settings-integrations-tab-content")},null)},smsGateways:function(b){console.log("inside sms gateways");var a=this;getTemplate("admin-settings",{},undefined,function(c){if(!c){return}$("#content").html($(c));getTemplate("web-to-lead-settings",{},undefined,function(e){if(!e){return}$("#admin-prefs-tabs-content").html($(e));var d=_agile_get_prefs("integrations_tab");$("#admin-prefs-tabs-content").find('a[href="#'+d+'"]').closest("li").addClass("active");if(!a.integrations||a.integrations.collection==undefined){a.navigate("integrations",{trigger:true});return}var g,h;if(b=="plivo"){g="PLIVO";h="account_id"}if(b=="twilio"){g="TWILIO";h="account_sid"}var f;$.each(a.integrations.collection.models,function(i,j){var k=JSON.parse(j.attributes.prefs);if(k.sms_api){f=k.sms_api}});if(f!=undefined){if(f.toUpperCase()!=g){modalAlert("sms-integration-alert-modal",_agile_get_translated_val("smsgateway","already-exists"),_agile_get_translated_val("smsgateway","configured"));a.navigate("integrations",{trigger:true});return}}view=new Base_Model_View({model:App_Admin_Settings.integrations.collection.where({name:"SMS-Gateway"})[0],url:"core/api/sms-gateway",template:"settings-sms-gateway",prePersist:function(i){if(b=="plivo"){var j={account_id:i.attributes.account_id,auth_token:i.attributes.auth_token,endpoint:i.attributes.endpoint,sms_api:g}}if(b=="twilio"){var j={account_sid:i.attributes.account_sid,auth_token:i.attributes.auth_token,endpoint:i.attributes.endpoint,sms_api:g}}i.set({prefs:JSON.stringify(j)},{silent:true})},postRenderCallback:function(i){initializeIntegrationsTabListeners("integrations_tab","integrations");if(b=="plivo"){$("#integrations-image",i).attr("src","/img/plugins/plivo.png");$("#accoundID",i).attr("name","account_id");$("#accoundID",i).attr("placeholder",_agile_get_translated_val("integrations","auth-id"));$("#integrations-label",i).text(_agile_get_translated_val("integrations","you-need-a-paid-plivo-account"))}if(b=="twilio"){$("#integrations-image",i).attr("src","/img/plugins/twilio.png");$("#accoundID",i).attr("name","account_sid");$("#accoundID",i).attr("placeholder",_agile_get_translated_val("integrations","account-sid"));$("#integrations-label",i).text(_agile_get_translated_val("integrations","account-details"))}},saveCallback:function(i){Backbone.history.navigate("integrations",{trigger:true})},errorCallback:function(i){if($("#sms-gateway-error").is(":visible")){$("#sms-gateway-error").remove()}$responceText="<div style='color:#B94A48; font-size:14px' id='sms-gateway-error'><i>"+i.responseText+"</i></div>";$("#sms-integration-error",a.el).append($responceText)}});$("#content").find("#admin-settings-integrations-tab-content").html(view.render().el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".integrations-tab").addClass("select")},"#admin-settings-integrations-tab-content")},null)},lostReasons:function(){if(!CURRENT_DOMAIN_USER.is_admin){$("#content").html(getTemplate("others-not-allowed",{}));return}var a=this;$("#content").html("<div id='milestone-listner'>&nbsp;</div>");getTemplate("admin-settings",{},undefined,function(b){if(!b){return}$("#milestone-listner").html($(b));$("#milestone-listner").find("#admin-prefs-tabs-content").html(getTemplate("settings-milestones-tab"),{});a.dealLostReasons=new Sources_Loss_Reasons_Events_Collection_View({url:"/core/api/categories?entity_type=DEAL_LOST_REASON",templateKey:"admin-settings-lost-reasons",individual_tag_name:"tr",sortKey:"name",postRenderCallback:function(c){initializeMilestoneListners(c)}});a.dealLostReasons.collection.fetch();$("#content").find("#admin-prefs-tabs-content").find("#settings-milestones-tab-content").html(a.dealLostReasons.render().el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".milestones-tab").addClass("select");$(".active").removeClass("active");$(".settings-lost-reasons").addClass("active");$("#milestone-listner").find("#admin-prefs-tabs-content").parent().removeClass("bg-white")},"#milestone-listner")},dealSources:function(){if(!CURRENT_DOMAIN_USER.is_admin){$("#content").html(getTemplate("others-not-allowed",{}));return}var a=this;$("#content").html("<div id='milestone-listner'>&nbsp;</div>");getTemplate("admin-settings",{},undefined,function(b){if(!b){return}$("#milestone-listner").html($(b));$("#milestone-listner").find("#admin-prefs-tabs-content").html(getTemplate("settings-milestones-tab"),{});a.dealSourcesView=new Sources_Loss_Reasons_Events_Collection_View({url:"/core/api/categories?entity_type=DEAL_SOURCE",templateKey:"admin-settings-deal-sources",individual_tag_name:"tr",sort_collection:false,postRenderCallback:function(c){initializeMilestoneListners(c);dealSourcesSorting()}});a.dealSourcesView.collection.fetch();$("#content").find("#admin-prefs-tabs-content").find("#settings-milestones-tab-content").html(a.dealSourcesView.render().el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".milestones-tab").addClass("select");$(".active").removeClass("active");$(".settings-deal-sources").addClass("active");$("#milestone-listner").find("#admin-prefs-tabs-content").parent().removeClass("bg-white")},"#milestone-listner")},dealGoal:function(){if(!CURRENT_DOMAIN_USER.is_admin){$("#content").html(getTemplate("others-not-allowed",{}));return}var a=this;$("#content").html("<div id='milestone-listner'>&nbsp;</div>");getTemplate("admin-settings",{},undefined,function(b){if(!b){return}$("#milestone-listner").html($(b));$("#milestone-listner").find("#admin-prefs-tabs-content").html(getTemplate("settings-milestones-tab"),{});a.dealGoalsView=new Sources_Loss_Reasons_Events_Collection_View({url:"/core/api/users",templateKey:"admin-settings-deal-goals",individual_tag_name:"tr",sortKey:"name",postRenderCallback:function(c){initQuota(function(){initializeMilestoneListners(c);var e=$("#goal_duration span").html();if(window.navigator.userAgent.indexOf("Mozilla")!=-1&&window.navigator.userAgent.indexOf("Chrome")==-1){e="01 "+e}e=new Date(e);var f=getUTCMidNightEpochFromDate(e);$.ajax({type:"GET",url:"/core/api/goals?start_time="+f/1000,contentType:"application/json; charset=utf-8",dataType:"json",success:function(h){console.log(h);var g=0,d=0;$("#deal-sources-table").find("tr").not(":first").each(function(i){var j=$(this);j.find(".count").val("");j.find(".amount").val("");$.each(h,function(k,l){console.log(l);if(l.domain_user_id==j.find(".goalid").attr("id")){j.find(".count").val(l.count);j.find(".amount").val(l.amount);j.attr("id",l.id);j.attr("data",l.start_time)}});if(j.find(".count").val()!=""){g=g+parseInt(j.find(".count").val())}if(j.find(".amount").val()!=""){d=d+parseFloat(j.find(".amount").val())}});percentCountAndAmount(g,d)}})})}});a.dealGoalsView.collection.fetch();$("#content").find("#admin-prefs-tabs-content").find("#settings-milestones-tab-content").html(a.dealGoalsView.render().el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".milestones-tab").addClass("select");$(".active").removeClass("active");$(".settings-deal-goal").addClass("active");$("#milestone-listner").find("#admin-prefs-tabs-content").parent().removeClass("bg-white")},"#milestone-listner")},changeDomain:function(){if(!CURRENT_DOMAIN_USER.is_admin){getTemplate("others-not-allowed",{},undefined,function(a){if(!a){return}$("#content").html($(a))},"#content");return}getTemplate("admin-settings",{},undefined,function(b){if(!b){return
}$("#content").html($(b));var a=new Base_Model_View({url:"/core/api/alias",template:"admin-settings-domain-alias",postRenderCallback:function(c){},prePersist:function(d){var c=[];$.each($("#alias_domain").find('input[name="alias"]'),function(e,f){c.push(($(f).val().toLowerCase()))});d.set({alias:c},{silent:true})},saveAuth:function(d){var c=$("#alias",d).closest("form").attr("id");if(!isValidForm("#"+c)){return false}if(getDomainFromURL()!=$("#alias",d).val()){$("#saveAliasAuthentication",d).html(getTemplate("conform-domain-change-model",{}));$("#saveAliasAuthentication",d).modal("show");return true}else{return false}},saveCallback:function(c){console.log("saveCallback");var d=getDomainFromURL();if(d==null){window.location.href="/login"}if(d!=c.alias[0]){showNotyPopUp("information",_agile_get_translated_val("domain-user","domain-edited"),"top");setTimeout(function(){window.location.href=window.location.protocol+"//"+c.alias[0]+".agilecrm.com/login"+window.location.hash},5000)}},errorCallback:function(c){showNotyPopUp("warning",c.responseText,"top")}});$("#content").find("#admin-prefs-tabs-content").html(a.render().el);$("#content").find("#AdminPrefsTab .select").removeClass("select");$("#content").find(".account-prefs-tab").addClass("select");$(".active").removeClass("active")},"#content")}});function initQuota(a){$("#goal_duration span.date").datepicker({format:"MM yyyy",minViewMode:"months",weekStart:CALENDAR_WEEK_START_DAY,autoclose:true}).on("changeMonth",function(b){$("#goal_duration span").html(b.date.format("mmmm yyyy"));a()}).datepicker("setDate",new Date());a()}function toggle_admin_user_bulk_actions_delete(d,c,b){$("#bulk-action-btns button").addClass("disabled");if($(d).is(":checked")){$("#bulk-action-btns button").removeClass("disabled")}else{if(c){$("#bulk-action-btns button").addClass("disabled");return}var a=0;$.each($(".tbody_check"),function(e,f){if($(f).is(":checked")){a++;return false}});if(a==0){$("#bulk-action-btns button").addClass("disabled")}}}function getDomainFromURL(){var a=window.location.host.split("-dot");if(a.length==1){a=window.location.host.split(".")}if(a.length==1){return"my"}return a[0]}var AccountPrefs_Events_Model_View=Base_Model_View.extend({events:{"click .invoice_option":"toggleInvoiceOption",},toggleInvoiceOption:function(b){b.preventDefault();var c=$(b.currentTarget);$(c).toggleClass("fa-toggle-off fa-toggle-on");var a=$("#sendInvoiceBeforeCharge");if(a.is(":checked")){a.removeAttr("checked")}else{a.attr("checked","checked")}},});var templateUrl;var WebreportsRouter=Backbone.Router.extend({routes:{"web-rules":"webrules","webrules-add":"web_reports_add","webrule-edit/:id":"web_reports_edit","webrules-templates":"webrules_display","webrules-add/*path":"webrules_template_load","webrules-custom":"load_empty_editor"},webrules:function(){var a=this;this.webrules=new Base_Collection_View({url:"/core/api/webrule",restKey:"webrule",templateKey:"webrule",individual_tag_name:"tr",sortKey:"position",postRenderCallback:function(b){if(a.webrules.collection&&a.webrules.collection.length==0){head.js(LIB_PATH+"lib/prettify-min.js",function(){$.ajax({url:"core/api/api-key",type:"GET",dataType:"json",success:function(c){getTemplate("webrule-collection",c,undefined,function(d){if(!d){return}$("#content").html($(d));if(ACCOUNT_PREFS.plan.plan_type.split("_")[0]=="PRO"){$("#whitelist-disabled").addClass("hide");$("#whitelist-enabled").removeClass("hide")}prettyPrint()},"#content")}})})}else{enableWebrulesSorting(b)}}});this.webrules.collection.fetch();$("#content").html(this.webrules.render().el);$(".active").removeClass("active");$("#web-rules-menu").addClass("active")},web_reports_add:function(){$(".fancybox-wrap").hide();if(!tight_acl.checkPermission("WEBRULE")){return}var a=new Web_Rules_Event_View({url:"core/api/webrule",template:"webrules-add",window:"web-rules",isNew:true,postRenderCallback:function(b){head.js(LIB_PATH+"lib/agile.jquery.chained.min.js?_="+_agile_get_file_hash("agile.jquery.chained.min.js"),function(){chainFilters(b,undefined,function(){chainWebRules(b,undefined,true);$("#content").html(b)},true)})}});$("#content").html(getRandomLoadingImg());a.render()},web_reports_edit:function(e){$(".fancybox-wrap").hide();if(!tight_acl.checkPermission("WEBRULE")){return}if(!this.webrules||!this.webrules.collection||this.webrules.collection.length==0||this.webrules.collection.get(e)==null){this.navigate("web-rules",{trigger:true});return}var b=0;var c=this.webrules.collection.get(e);var a="webrules-add";var d=new Web_Rules_Event_View({url:"core/api/webrule",model:c,template:a,window:"web-rules",postRenderCallback:function(f){if(b>0){return}head.js(LIB_PATH+"lib/agile.jquery.chained.min.js?_="+_agile_get_file_hash("agile.jquery.chained.min.js"),function(){chainFilters(f,c.toJSON(),function(){chainWebRules(f,c.toJSON(),false,c.toJSON()["actions"]);$("#content").html(f)},true)});b++},form_custom_validate:function(){if($("#action select").val()=="CALL_POPUP"){if(App_WebReports.isTwilioSMS=="TWILIO"){return true}else{$("#twilio_call_setup").show();return false}}return true}});$("#content").html(getRandomLoadingImg());d.render()},webrules_display:function(){$(".fancybox-overlay").hide();$("#content").html("<link rel='stylesheet' type='text/css' href='flatfull/css/jquery.fancybox.css'><div id='webrule-listeners'></div>");head.js("flatfull/lib/jquery.fancybox.js",function(){$.getJSON("misc/modal-templates/webrule-templates.json",function(a){getTemplate("webrule-categories",null,undefined,function(b){$("#webrule-listeners").append($(b))},"#webrule-listeners");$(".web_fancybox").fancybox({autoDimensions:true,padding:0,autoScale:true,overflow:"visible"});hideTransitionBar()})})},webrules_template_load:function(a){$(".fancybox-wrap").hide();if(!tight_acl.checkPermission("WEBRULE")){return}var b=new Web_Rules_Event_View({url:"core/api/webrule",template:"webrules-add",window:"web-rules",isNew:true,postRenderCallback:function(c){if(a.includes("callpopup.html")){c.find("#action select").val("CALL_POPUP")}else{if(a.includes("sitebar.html")){c.find("#action select").val("SITE_BAR")}}head.js(LIB_PATH+"lib/agile.jquery.chained.min.js?_="+_agile_get_file_hash("agile.jquery.chained.min.js"),function(){chainFilters(c,undefined,function(){chainWebRules(c,undefined,true);$("#content").html(c);loadSavedTemplate(a,function(d){$("#tiny_mce_webrules_link").trigger("click")})},true)})},form_custom_validate:function(){if($("#action select").val()=="CALL_POPUP"){if(App_WebReports.isTwilioSMS=="TWILIO"){return true}else{$("#twilio_call_setup").show();return false}}return true}});$("#content").html(getRandomLoadingImg());b.render()},load_empty_editor:function(){$(".fancybox-wrap").hide();if(!tight_acl.checkPermission("WEBRULE")){return}var a=new Web_Rules_Event_View({url:"core/api/webrule",template:"webrules-add",window:"web-rules",isNew:true,postRenderCallback:function(b){head.js(LIB_PATH+"lib/agile.jquery.chained.min.js?_="+_agile_get_file_hash("agile.jquery.chained.min.js"),function(){chainFilters(b,undefined,function(){chainWebRules(b,undefined,true);$("#content").html(b);$("#tinyMCEhtml_email").text(" ");$("#tiny_mce_webrules_link").trigger("click")},true)})},form_custom_validate:function(){if($("#action select").val()=="CALL_POPUP"){if(App_WebReports.isTwilioSMS=="TWILIO"){return true}else{$("#twilio_call_setup").show();return false}}return true}});$("#content").html(getRandomLoadingImg());a.render()}});function show_fancy_box(a){var b={href:a.href,link:a.getAttribute("data-link"),title:a.title};$.fancybox.open(b,{padding:10,margin:[20,60,20,60],width:100,helpers:{overlay:{css:{background:"rgba(58, 42, 45, 0.95)"}}},beforeLoad:function(){a.title="<a data-link="+this.link+' style="color: white; text-decoration: underline;" href="#webrules-add/'+this.link+'" >Load in Editor</a>'},afterLoad:function(){}})}function loadSavedTemplate(a,b){templateUrl=a;a="/misc/modal-templates/"+a;$.ajax({url:a,data:{},success:function(c){c=c.trim();if(isNotValid(c)){showError("Please enter a valid html message");return}if(templateUrl.includes("callpopup.html")){$("#callwebrule-code").text(c)}else{if(templateUrl.includes("sitebar.html")){$("#agile-bar-code").text(c)}else{$("#tinyMCEhtml_email").text(c)}}if(b&&typeof(b)==="function"){b(c)}}})}function isNotValid(a){if(a==undefined){return true}if(a.length==0){return true}return false}var FacebookPageTabRouter=Backbone.Router.extend({routes:{"facebook-integration":"fbPageTab"},fbPageTab:function(){$("#content").html("<div id='fbPageTab-listners'>&nbsp;</div>");getTemplate("admin-settings",{},undefined,function(a){if(!a){return}$("#fbPageTab-listners").html($(a));getTemplate("web-to-lead-settings",{},undefined,function(b){if(!b){return}$("#admin-prefs-tabs-content").html($(b));$("#admin-prefs-tabs-content").find('a[href="#web-to-lead-tab"]').closest("li").addClass("active");accessUrlUsingAjax("fbpage?action=GET_DETAILS",function(d){var c=d;accessUrlUsingAjax("core/api/forms",function(e){c.forms=e;getTemplate("fbpagetab",c,undefined,function(f){if(!f){return}$("#admin-settings-integrations-tab-content").html($(f));initializeFbPageTabListners()},"#admin-settings-integrations-tab-content")})});initializeIntegrationsTabListeners("integrations_tab","integrations");$("#content").find(".integrations-tab").addClass("select")},null)},null);hideTransitionBar()}});function accessUrlUsingAjax(b,c,a){$.ajax({url:b,dataType:"json",success:function(d){try{d=$.parseJSON(d)}catch(e){}if(c){c(d)}},error:function(d){if(a){a(d)}}})}var AFFILIATE_DETAILS;var AffiliateRouter=Backbone.Router.extend({routes:{commission:"showCommissionDetails",affiliate:"listAffiliates",affiliateDetails:"showaffiliateDetails",tools:"tools"},showCommissionDetails:function(){var a=this;getTemplate("affiliate",{},undefined,function(b){if(!b){return}$("#content").html($(b));a.commissionDetailsView=new Base_Model_View({url:"core/api/affiliate/total?userId="+CURRENT_DOMAIN_USER.id,template:"affiliate-commission-details",postRenderCallback:function(c){}});
$("#affiliate-tabs-content").html(a.commissionDetailsView.render().el);$("#affiliate-tabs .select").removeClass("select");$(".commission-details-tab").addClass("select")},"#content")},listAffiliates:function(){var a=this;checkForAffiliateDetails(function(){getTemplate("affiliate",{},undefined,function(b){if(!b){return}$("#content").html($(b));head.js(LIB_PATH+"lib/date-charts-en.js",LIB_PATH+"lib/date-range-picker.js?_="+_agile_get_file_hash("date-range-picker.js"),function(){a.showDateRangePicker()});$("#affiliate-tabs .select").removeClass("select");$(".referrals-tab").addClass("select")},"#content")},function(){a.showaffiliateDetails()})},showDateRangePicker:function(){var a=this;getTemplate("affiliate-datepicker",{},undefined,function(b){if(!b){return}$("#affiliate-datepicker").html($(b));initDateRange(a.showAffiliateCollection);a.showAffiliateCollection()},null)},showaffiliateDetails:function(){this.affiliateDetailsView=new Base_Model_View({url:"core/api/affiliate_details",template:"affiliate-details",postRenderCallback:function(a){if(!$("input[name='phone']",a).val()){$("input[name='phone']",a).val(CURRENT_DOMAIN_USER.phone)}},saveCallback:function(a){AFFILIATE_DETAILS=a;App_Affiliate.listAffiliates()},prePersist:function(a){var b={};$.each($(".address").find("input"),function(c,d){b[$(d).attr("name")]=$(d).val()});b.country=$(".address").find("#country").val();a.set({address:JSON.stringify(b)},{silent:true})}});$("#content").html(this.affiliateDetailsView.render().el)},showAffiliateCollection:function(){var a=getTimeFromDatePicker();this.affiliateCollectionView=new Base_Collection_View({url:"core/api/affiliate?userId="+CURRENT_DOMAIN_USER.id+"&startTime="+a.start+"&endTime="+a.end,sort_collection:false,templateKey:"affiliate",cursor:true,page_size:25,individual_tag_name:"tr",postRenderCallback:function(b){head.js(LIB_PATH+"lib/jquery.timeago.js",function(){$("time",b).timeago()});showCommission(undefined,a,b)}});this.affiliateCollectionView.collection.fetch();$("#affiliate-tabs-content").html(this.affiliateCollectionView.render().el)},tools:function(){getTemplate("affiliate",{},undefined,function(a){if(!a){return}$("#content").html($(a));head.js(LIB_PATH+"../lib/zeroclipboard/ZeroClipboard.js",function(){hideTransitionBar();getTemplate("affiliate-tools",{},undefined,function(c){if(!c){return}$("#affiliate-tabs-content").html($(c));for(var b=1;b<=6;b++){initZeroClipboard("url_clip_button"+b,"referral_url"+b)}$("#affiliate-tabs .select").removeClass("select");$(".tools-tab").addClass("select")},null)})},"#content")}});var ShopifyRouter=Backbone.Router.extend({routes:{"shopify/:shopurl":"shopify",shopify:"shopify"},shopify:function(b){var c="core/shopifyapp?shop="+b;var a={};a.shopurl=b;$.ajax({type:"GET",url:c,success:function(d){if(d){a.installed=true;getTemplate("shopifyboxes",a,undefined,function(e){if(!e){return}$("#content").html($(e))},"#content");return}else{$.ajax({type:"POST",url:c,success:function(e){a.installed=false;getTemplate("shopifyboxes",a,undefined,function(f){if(!f){return}$("#content").html($(f))},"#content");return}})}}})}});var ACLRestriction=Backbone.Router.extend({routes:{"not-allowed":"notAllowed",},notAllowed:function(a){getTemplate("not-allowed",a,undefined,function(b){if(!b){return}$("#content").html($(b));if(a.ERR_CONTAINER){$(a.ERR_CONTAINER).html($(b))}},"#content")}});var ReferelRouter=Backbone.Router.extend({routes:{referrals:"referrelprogram","refer-friends":"referFriends",referral:"Referrals"},referrelprogram:function(){head.js(LIB_PATH+"../lib/zeroclipboard/ZeroClipboard.js",function(){referelsview=new Base_Collection_View({url:"/core/api/users/getreferedbyme?reference_domain="+CURRENT_DOMAIN_USER.domain,templateKey:"referrals",individual_tag_name:"tr",postRenderCallback:function(a){initZeroClipboard("url_clip_button","referral_url")}});referelsview.collection.fetch();$("#content").html(referelsview.render().el)})},refer:function(){Agile_GA_Event_Tracker.track_event("Refer");load_facebook_lib_for_referrals();$.ajax({url:"core/api/refer",type:"GET",dataType:"json",success:function(a){REFER_DATA=a;getTemplate("refer-modal",{},undefined,function(b){if(!b){return}$("#referModal").html($(b));getTemplate("refer-modal-body",a,undefined,function(c){if(!c){return}$("#referModal").find(".modal-body").html($(c));$("#referModal").modal("show")},null)},null)}})},referFriends:function(){var b=_agile_get_translated_val("referrals","iam-using-agile")+_agile_get_translated_val("referrals","try-agile");var a=getTemplate("js-referal-program",{domain:CURRENT_DOMAIN_USER.domain});sendMail(undefined,b,a,undefined,undefined,this)},Referrals:function(b){var a=new Base_Collection_View({url:"core/api/refer/refered_domains",templateKey:"refer-users",individual_tag_name:"tr",postRenderCallback:function(c){console.log("Subscribers")}});a.collection.fetch();$("#content").html(a.render().el)}});var eventCollectionView;var googleEventCollectionView;var googleNextPageToken;var CalendarRouter=Backbone.Router.extend({routes:{calendar:"calendar",tasks:"tasks_new","tasks-new":"tasks_new"},calendar:function(){$("#due_tasks").css("pointer-events","none");_agile_delete_prefs("agile_calendar_view");$("#content").html("<div id='calendar-listers'>&nbsp;</div>");showTransitionBar();getTemplate("calendar",{},undefined,function(a){if(!a){return}$("#calendar-listers").html($(a));$("#calendar_event").html(LOADING_ON_CURSOR);$("#calendar-listers").find("#calendar-filters").html(LOADING_ON_CURSOR);getCalendarUsersDetails(function(b){getTemplate("event-left-filter",b,undefined,function(d){$("#calendar-listers").find("#calendar-filters").html($(d));buildCalendarLhsFilters();createRequestUrlBasedOnFilter();var c=_agile_get_prefs("agile_calendar_view");if(c){$("#list_event_time").removeClass("hide");$("#user_calendars").hide();loadGoogleEvents();loadAgileEvents();return}$("#list_event_time").addClass("hide");$("#user_calendars").show();$("#calendar-view-button").show();$(".active").removeClass("active");$("#calendarmenu").addClass("active");$("#agile_event_list").addClass("hide");put_thirdparty_calendar_links();$("#grp_filter").css("display","none");$("#event_tab").css("display","none");$("[data-toggle=tooltip").tooltip()},$("#calendar-listers").find("#calendar-filters"))});_agile_library_loader.load_fullcalendar_libs(function(){$("#calendar_event").html("");showCalendar([]);hideTransitionBar();initializeEventListners();loadPortlets("Events");$("#due_tasks").css("pointer-events","inherit")})},"#calendar-listers")},tasks:function(){getTemplate("tasks-list-header",{},undefined,function(b){if(!b){return}$("#content").html($(b));fillSelect("owner-tasks","/core/api/users/current-user","domainUser",function a(){$("#content").find("#owner-tasks").prepend("<li><a href=''>"+_agile_get_translated_val("tasks","All Tasks")+"</a></li>");$("#content").find("#owner-tasks").append("<li><a href='my-pending-tasks'>"+_agile_get_translated_val("tasks","My Pending Tasks")+"</a></li>");initOwnerslist()},"<li><a href='{{id}}'>"+_agile_get_translated_val("tasks","My Tasks")+"</a></li>",true);make_menu_item_active("tasksmenu")},"#content")},tasks_new:function(){console.log("tasks_new");$("#content").html("<div id='tasks-list-template'>&nbsp;</div>");getTemplate("new-tasks-list-header",{},undefined,function(b){if(!b){return}$("#tasks-list-template").html($(b));fillSelect("new-owner-tasks","/core/api/users/current-user","domainUser",function a(){$("#tasks-list-template").find("#new-owner-tasks").prepend("<li><a href=''>"+_agile_get_translated_val("tasks","All Tasks")+"</a></li>");$("#tasks-list-template").find("#new-owner-tasks").append("<li><a href='all-pending-tasks' class='hide-on-status'>"+_agile_get_translated_val("tasks","All Pending Tasks")+"</a></li>");$("#tasks-list-template").find("#new-owner-tasks").append("<li><a href='my-pending-tasks' class='hide-on-owner hide-on-status'>"+_agile_get_translated_val("tasks","My Pending Tasks")+"</a></li>");initializeTasksListeners();readDetailsFromCookie();bindDropdownEvents()},"<li><a href='{{id}}' class='hide-on-owner'>"+_agile_get_translated_val("tasks","My Tasks")+"</a></li>",true);$(".loading").remove();$(".active").removeClass("active");$("#tasksmenu").addClass("active");$(".hide-on-pending").hide();loadPortlets("Tasks")},"#tasks-list-template")},});function appendItem1(b){var d=new Base_List_View({model:b,view:"inline",template:this.options.templateKey+"-model",tagName:"tr",});console.log(b.get("title"));var f=get_activity_created_time(b.get("start"));if(f==0){var e=$("#today-heading",this.el);$("#today-event",this.el).append(d.render().el);$("#today-event",this.el).parent("table").css("display","block");$("#today-event",this.el).parent("table").removeClass("hide");$("#today-event",this.el).show();$("#today-heading",this.el).show()}else{if(f==1){var e=$("#tomorrow-heading",this.el);$("#tomorrow-event",this.el).append(d.render().el);$("#tomorrow-event",this.el).parent("table").css("display","block");$("#tomorrow-event",this.el).parent("table").removeClass("hide");$("#tomorrow-event",this.el).show();$("#tomorrow-heading",this.el).show()}else{if(f>1){var e=$("#next-week-heading",this.el);$("#next-week-event",this.el).append(d.render().el);$("#next-week-event",this.el).parent("table").css("display","block");$("#next-week-event",this.el).parent("table").removeClass("hide");$("#next-week-event",this.el).show();if($("#tomorrow-event").children().length>0||$("#today-event").children().length>0){$("#next-week-heading",this.el).show()}}}}var c=$.parseJSON(_agile_get_prefs("event-lhs-filters"));c=c[CURRENT_AGILE_USER.id];var a=c?c.owner_ids:null;if(a&&a.length==1&&a[0]==CURRENT_AGILE_USER.id){$(".e_owner").addClass("hide")}else{if($(".e_owner").hasClass("hide")){$(".e_owner").removeClass("hide")}}$(".contact_text").children().last().text($(".contact_text").children().last().text().replace(",","").trim())}function appendItem2(b){var d=new Base_List_View({model:b,view:"inline",template:this.options.templateKey+"-model",tagName:"tr",});
var e=$("#event-heading",this.el);$("#eventAll",this.el).append(d.render().el);$("#eventAll",this.el).parent("table").css("display","block");$("#eventAll",this.el).show();$("#event-heading",this.el).show();var c=$.parseJSON(_agile_get_prefs("event-lhs-filters"));c=c[CURRENT_AGILE_USER.id];var a=c?c.owner_ids:null;if(a&&a.length==1&&a[0]==CURRENT_AGILE_USER.id){$(".e_owner").addClass("hide")}else{if($(".e_owner").hasClass("hide")){$(".e_owner").removeClass("hide")}}$(".contact_text").children().last().text($(".contact_text").children().last().text().replace(",","").trim())}function appendGoogleEvent(a){var b=new Base_List_View({model:a,view:"inline",template:this.options.templateKey+"-model",tagName:"tr",});$("#google_event",this.el).append(b.render().el);$("#google_event",this.el).parent("table").css("display","block");$("#google_event",this.el).show();$(".contact_text").children().last().text($(".contact_text").children().last().text().replace(",","").trim())}function appendGoogleEventCategorization(a){var c=new Base_List_View({model:a,view:"inline",template:this.options.templateKey+"-model",tagName:"tr",});console.log(a.get("title"));var b=a.get("start");var f=new Date(b);var e=get_activity_created_time(f.getTime()/1000);if(e==0){$("#today-event",this.el).append(c.render().el);$("#today-event",this.el).parent("table").css("display","block");$("#today-event",this.el).parent("table").removeClass("hide");$("#today-event",this.el).show();$("#today-heading",this.el).show()}else{if(e==1){$("#tomorrow-event",this.el).append(c.render().el);$("#tomorrow-event",this.el).parent("table").css("display","block");$("#tomorrow-event",this.el).parent("table").removeClass("hide");$("#tomorrow-event",this.el).show();$("#tomorrow-heading",this.el).show()}else{if(e>1){$("#next-week-event",this.el).append(c.render().el);$("#next-week-event",this.el).parent("table").css("display","block");$("#next-week-event",this.el).parent("table").removeClass("hide");$("#next-week-event",this.el).show();if($("#tomorrow-event",this.el).children().length>0||$("#today-event",this.el).children().length>0){$("#next-week-heading",this.el).show()}}}}$(".contact_text").children().last().text($(".contact_text").children().last().text().replace(",","").trim())}function show_model(b){if($(window.event.target).is("a")){window.event.stopPropagation()}else{$("#updateActivityModal").html(getTemplate("update-activity-modal")).modal("show");var a=eventCollectionView.collection.get(b).toJSON();console.log("clicked event "+a);var d=a.contacts;for(var c=0;c<d.length;c++){var k=Handlebars.compile('<li class="tag btn btn-xs btn-primary m-r-xs m-b-xs inline-block" data="{{id}}"><a href="#contact/{{id}}" class="text-white v-middle">{{name}}</a><a class="close m-l-xs" id="remove_tag">&times</a></li>');var l={};fel.append();if(d[c].type=="COMPANY"){l={name:getCompanyName(d[c].properties),id:d[c].id}}else{l={name:getName(d[c].properties),id:d[c].id}}$("#updateActivityModal").find("ul[name='contacts']").append(k(l))}var h=a.color;$("#updateActivityModal").find("select").children().each(function(){if(this.value==h){$(this).attr("selected","selected")}});if(a.allDay){$("#updateActivityModal").find("input[name='allDay']").attr("checked","checked")}else{$("#updateActivityModal").find("input[name='allDay']").removeAttr("checked")}$("#updateActivityModal").find("input[name='title']").val(a.title);highlight_event();start=getDate(a.start);end=getDate(a.end);$("#update-event-date-1").val(getDateInFormatFromEpoc(a.start));$("#update-event-date-2").val(getDateInFormatFromEpoc(a.end));if((start.getHours()==0)&&(end.getHours()==0)&&(end.getMinutes()==0)){$("#update-event-time-1").val("");$("#update-event-time-2").val("")}else{$("#update-event-time-1").val((start.getHours()<10?"0":"")+start.getHours()+":"+(start.getMinutes()<10?"0":"")+start.getMinutes());$("#update-event-time-2").val((end.getHours()<10?"0":"")+end.getHours()+":"+(end.getMinutes()<10?"0":"")+end.getMinutes())}$("#updateActivityModal").find("input[name='id']").val(b);$("#updateActivityModal").find("input[name='type']").val(a.type);if(a.meeting_type){$("#updateActivityModal").find("input[name='meeting_type']").val(a.meeting_type)}else{$("#updateActivityModal").find("input[name='meeting_type']").val("")}if(a.type=="WEB_APPOINTMENT"&&parseInt(a.start)>parseInt(new Date().getTime()/1000)){$("[id='event_delete']").attr("id","delete_web_event");web_event_title=a.title;if(a.contacts.length>0){var e=getPropertyValue(a.contacts[0].properties,"first_name");if(e==undefined){e=""}var g=getPropertyValue(a.contacts[0].properties,"last_name");if(g==undefined){g=""}web_event_contact_name=e+" "+g}}else{$("[id='delete_web_event']").attr("id","event_delete")}if(a.description){var j='<label class="control-label"><b>'+_agile_get_translated_val("misc-keys","description")+' </b></label><div class="controls"><textarea id="description" name="description" rows="3" class="input form-control" placeholder="'+_agile_get_translated_val("misc-keys","add-description")+'"></textarea></div>';$("#event_desc").html(j);$("textarea#description").val(a.description)}else{var f='<div class="row-fluid"><div class="control-group form-group m-b-none"><a href="#" id="add_event_desctiption"><i class="icon-plus"></i> '+_agile_get_translated_val("misc-keys","add-description")+' </a><div class="controls event_discription hide"><textarea id="description" name="description" rows="3" class="input form-control w-full col-md-8" placeholder="'+_agile_get_translated_val("misc-keys","add-description")+'"></textarea></div></div></div>';$("#event_desc").html(f)}populateUsersInUpdateActivityModal(a)}}function getFormattedDate(b){var a="mm/dd/yyyy";if((b/100000000000)>1){var c=new Date(parseInt(b));return c.format(a)}else{var c=new Date(parseInt(b)*1000);return c.format(a)}}function getDate(a){if((a/100000000000)>1){return new Date(parseInt(a))}else{return new Date(parseInt(a)*1000)}}function getName(d){var b;var e;var a;for(var c=0;c<d.length;c++){if(d[c].name=="first_name"){e=d[c].value}if(d[c].name=="last_name"){a=d[c].value}}b=e+" "+a;return b.replace("undefined","").trim()}function getCompanyName(c){var a;for(var b=0;b<c.length;b++){if(c[b].name=="name"){a=c[b].value}}return a}function loadAgileEvents(){var a=false;accessUrlUsingAjax("core/api/calendar-prefs/get",function(c){if(c){a=true}var d=$.parseJSON(_agile_get_prefs("event-lhs-filters"));d=d[CURRENT_AGILE_USER.id];var f="";if(d){var e=d.owner_ids;if(e&&e.length>0){$.each(e,function(g,h){if(g>=1){f+=","}f+=h})}}var b=_agile_get_prefs("agile_calendar_view");if(b=="calendar_list_view"){eventCollectionView=new Base_Collection_View({url:"core/api/events/list?ownerId="+f+"",templateKey:"events",individual_tag_name:"tr",sort_collection:true,sortKey:"start",descending:false,cursor:true,page_size:25});eventCollectionView.appendItem=appendItem2;eventCollectionView.collection.fetch();if(a){$("#agile").html(this.eventCollectionView.render().el);$("#agile_event_list").addClass("hide")}else{$("#agile_event").html(this.eventCollectionView.render().el)}}else{if(b=="calendar_list_view_future"){eventCollectionView=new Base_Collection_View({url:"core/api/events/future/list?ownerId="+f,templateKey:"future",individual_tag_name:"tr",sort_collection:true,sortKey:"start",descending:false,cursor:true,page_size:25});eventCollectionView.appendItem=appendItem1;eventCollectionView.collection.fetch();if(a){$("#agile").html(this.eventCollectionView.render().el);$("#agile_event_list").addClass("hide")}else{$("#agile_event").html(this.eventCollectionView.render().el)}}}})}function loadGoogleEvents(){$.getJSON("core/api/calendar-prefs/get",function(a){console.log(a);if(a){_agile_set_prefs("google_event_token",a.access_token);head.js("https://apis.google.com/js/client.js","/lib/calendar/gapi-helper.js?t=27",function(){setupGC(function(){gapi.auth.setToken({access_token:a.access_token,state:"https://www.googleapis.com/auth/calendar"});var c=_agile_get_prefs("agile_calendar_view");if(c=="calendar_list_view"){var e=gapi.client.calendar.events.list({calendarId:"primary",maxResults:25,singleEvents:true,orderBy:"startTime"});e.execute(function(j){var h=new Array();console.log(j);for(var g=0;g<j.items.length;g++){var f=google2fcEvent(j.items[g]);console.log(f);h.push(f)}googleNextPageToken=j.nextPageToken;googleEventCollectionView=new Base_Collection_View({data:h,templateKey:"google-event",individual_tag_name:"tr",sort_collection:true,sortKey:"start",descending:false});googleEventCollectionView.appendItem=appendGoogleEvent;$("#google").html(googleEventCollectionView.render(true).el)})}else{var b=new Date();var d=b.toISOString();var e=gapi.client.calendar.events.list({calendarId:"primary",maxResults:25,singleEvents:true,timeMin:d});e.execute(function(j){var h=new Array();console.log(j);for(var g=0;g<j.items.length;g++){var f=google2fcEvent(j.items[g]);console.log(f);h.push(f)}googleEventCollectionView=new Base_Collection_View({data:h,templateKey:"googleEventCategorization",individual_tag_name:"tr",sort_collection:true,sortKey:"start",descending:false});googleEventCollectionView.appendItem=appendGoogleEventCategorization;$("#google").html(googleEventCollectionView.render(true).el)})}});return});$("#agile_event_list").addClass("hide")}else{$("#event_tab").addClass("hide");$("#agile_event").removeClass("hide")}})}function loadMoreEventsFromGoogle(){var a=_agile_get_prefs("google_event_token");if(googleNextPageToken){if(a){gapi.auth.setToken({access_token:a,state:"https://www.googleapis.com/auth/calendar"});var b=gapi.client.calendar.events.list({calendarId:"primary",maxResults:20,singleEvents:true,pageToken:googleNextPageToken,orderBy:"startTime"});b.execute(function(g){var f=new Array();console.log(g);for(var e=0;e<g.items.length;e++){var d=google2fcEvent(g.items[e]);console.log(d);f.push(d)}googleNextPageToken=g.nextPageToken;var c=_agile_get_prefs("agile_calendar_view");if(c=="calendar_list_view"){googleEventCollectionView.collection.add(f);googleEventCollectionView.collection.sort()
}else{googleEventCollectionView.collection.add(f);googleEventCollectionView.collection.sort()}})}else{$.getJSON("core/api/calendar-prefs/get",function(c){gapi.auth.setToken({access_token:c.access_token,state:"https://www.googleapis.com/auth/calendar"});var d=gapi.client.calendar.events.list({calendarId:"primary",maxResults:1000,singleEvents:true,pageToken:googleNextPageToken});d.execute(function(j){var h=new Array();console.log(j);for(var g=0;g<j.items.length;g++){var f=google2fcEvent(j.items[g]);console.log(f);h.push(f)}googleNextPageToken=j.nextSyncToken;var e=_agile_get_prefs("agile_calendar_view");if(e=="calendar_list_view"){googleEventCollectionView.collection.add(h);googleEventCollectionView.collection.sort()}else{googleEventCollectionView.collection.add(h);googleEventCollectionView.collection.sort()}})})}}}function loadOfficeEvents(c,b){showLoadingOnCalendar(true);var a="core/api/officecalendar/office365-appointments?startDate="+c.getTime()+"&endDate="+b.getTime();$.getJSON(a,function(e){if(e){var g=[];for(var f=0;f<e.length;f++){var j=e[f];var d=Math.round((new Date(j.start).getTime())/1000);j.start=d;var h=Math.round((new Date(j.end).getTime())/1000);j.end=h;g.push(j)}addEventSourceToCalendar("office",g);showLoadingOnCalendar(false)}else{showLoadingOnCalendar(false)}})}var DealsRouter=Backbone.Router.extend({routes:{deals:"deals","import-deals":"importDeals","deal-rc-0":"dealsRightClick","deal-rc-1":"dealsRightClick","deal-rc-2":"dealsRightClick","deal-rc-3":"dealsRightClick","deal-filters":"dealFilters","deal-filter-add":"dealFilterAdd","deal-filter-edit/:id":"dealFilterEdit","deal-filter/:id":"dealFilter","filter/:tag":"deals"},deals:function(){var b=null;if(window.location.hash.indexOf("filter")==1){b=window.location.hash.substr(window.location.hash.lastIndexOf("/")+1);_agile_set_prefs("agile_deal_view","list_view")}pipeline_id=0;if(_agile_get_prefs("agile_deal_track")){pipeline_id=_agile_get_prefs("agile_deal_track")}$("#content").html("<div id='opportunity-listners'>&nbsp;</div>");if(agile_is_mobile_browser()){createCookie("agile_deal_view","list_view")}if(!_agile_get_prefs("agile_deal_view")){template_key="opportunities-by-milestones";if(pipeline_id==1){pipeline_id=0}getTemplate("opportunities-header",{},undefined,function(c){if(!c){return}$("#opportunity-listners").html($(c));DEALS_LIST_COLLECTION=null;setupDealsTracksList();setupDealFilters();setUpDealSortFilters($("#opportunity-listners"));initializeDealListners();loadPortlets("Deals");contactListener()},"#opportunity-listners")}else{var a=this;DEALS_LIST_COLLECTION=null;setupDealFilters(function(c){if(b){c.dealToFilter=b}getTemplate("opportunities-header",{},undefined,function(d){if(!d){return}$("#opportunity-listners").html($(d));setUpDealSortFilters($("#opportunity-listners"));loadPortlets("Deals")});fetchDealsList(c)})}$(".active").removeClass("active");$("#dealsmenu").addClass("active");setTimeout(function(){$("a.deal-notes").tooltip();$(".deal_won_date").tooltip()},2000)},dealsRightClick:function(){var a=window.location.hash;var b=a.split("-")[2];if(b=="0"){_agile_set_prefs("agile_deal_view","list_view")}else{if(b=="1"){_agile_delete_prefs("agile_deal_view");_agile_delete_prefs("deal-milestone-view")}else{if(b=="2"){_agile_set_prefs("deal-milestone-view","compact")}else{if(b=="3"){_agile_set_prefs("deal-milestone-view","fit")}}}}App_Deals.deals();window.location.hash="deals"},importDeals:function(){if(!hasScope("CREATE_DEALS")){$("#content").html('<h2 class="p-l-md"><strong><i class="fa-exclamation-triangle icon-white"></i>&nbsp;&nbsp; '+_agile_get_translated_val("import","deals-no-priviliges")+"</strong></h2>");hideTransitionBar();return}$("#content").html("<div id='import-deals-listener'></div>");getTemplate("import-deals",{},undefined,function(a){if(!a){return}$("#import-deals-listener").html($(a));initializeImportEvents("import-deals-listener")},"#import-deals-listener")},dealFilters:function(){this.dealFiltersList=new Base_Collection_View({url:"/core/api/deal/filters",restKey:"DealFilter",templateKey:"deal-filter",isNew:"true",window:"deal-filters",individual_tag_name:"tr",sort_collection:false,postRenderCallback:function(a){agileTimeAgoWithLngConversion($(".created_time",a))}});this.dealFiltersList.collection.fetch();$("#content").html(this.dealFiltersList.render().el)},dealFilterAdd:function(){$("#content").html("<div id='opportunity-listners'></div>");var a=new Opportunity_Filters_Event_View({url:"/core/api/deal/filters",template:"filter-deals",isNew:"true",window:"deal-filters",postRenderCallback:function(b){head.js(LIB_PATH+"lib/agile.jquery.chained.min.js",function(){chainFiltersForOpportunity(b,undefined,function(){$("#opportunity-listners",$("#content")).html(b);scramble_input_names($(b).find("#filter-settings"))})});initializeDealListners();contactListener();$("input[name=name]").trigger("focus")}});a.render()},dealFilterEdit:function(d){if(!this.dealFiltersList||this.dealFiltersList.collection.length==0||this.dealFiltersList.collection.get(d)==null){this.navigate("deal-filters",{trigger:true});return}$("#content").html("<div id='opportunity-listners'></div>");$("#opportunity-listners").html(LOADING_HTML);var a=this.dealFiltersList.collection.get(d);var c=a.toJSON();var b=new Opportunity_Filters_Event_View({url:"core/api/deal/filters",model:a,template:"filter-deals",window:"deal-filters",postRenderCallback:function(e){head.js(LIB_PATH+"lib/agile.jquery.chained.min.js",function(){chainFiltersForOpportunity(e,c,function(){$("#opportunity-listners",$("#content")).html(e);setOportunityChainFilterValidations($(e).find("#filter-settings"))});scramble_input_names($(e).find("#filter-settings"))});initializeDealListners();contactListener();$("input[name=name]").trigger("focus")}});b.render()},dealFilter:function(c){var a=App_Deals.deal_filters.collection.get(c);var b=a.toJSON();_agile_set_prefs("deal-filters",JSON.stringify(b));App_Deals.deals()},});VISITORS_HARD_RELOAD=true;var VisitorsSegmentationRouter=Backbone.Router.extend({routes:{visitors:"visitorssegmentation"},visitorssegmentation:function(l,j,i,h){var c;var e;var b;var k;if(VISITORS_HARD_RELOAD==true){this.webstatsListView=undefined;VISITORS_HARD_RELOAD=false}_agile_delete_prefs("visitor_repeat_filter");var g="segmentation-custom-view";var a="core/api/web-stats/filter/dynamic-filter";if(h||(h=_agile_get_prefs("visitor_filter"))){a="core/api/web-stats/query/list/"+h}if(_agile_get_prefs("dynamic_visitors_filter")){c=_agile_get_prefs("dynamic_visitors_filter")}var d=getSegmentPadcontentKey(a);if(j){g="segmentation-custom-view-table"}var f=this;head.js(LIB_PATH+"lib/date-charts-en.js",LIB_PATH+"lib/date-range-picker.js?_="+_agile_get_file_hash("date-range-picker.js"),function(){if(!l&&_agile_get_prefs("duration")){var m=_agile_get_prefs("duration").split(",");e=Number(m[0].substr(m[0].indexOf(":")+1));b=Number(m[1].substr(m[1].indexOf(":")+1))}else{if(!l){l=getFirstTimeWebstats()}e=l[0];b=l[1]}k=new Date().getTimezoneOffset();f.webstatsListView=new Base_Collection_View({url:a,restKey:"contact",templateKey:g,individual_tag_name:"tr",slateKey:d,cursor:true,request_method:"POST",post_data:{filterJson:c,start_time:e,end_time:b,timeZone:k},page_size:20,sort_collection:false,postRenderCallback:function(n,o){if(o.models.length==0){$("#visitors-count").html("<small> ("+0+" "+_agile_get_translated_val("other","total")+" ) </small>")}else{if(o.models[o.models.length-1].attributes.count){total_count=o.models[o.models.length-1].attributes.count;count_message="<small> ("+total_count+" "+_agile_get_translated_val("other","total")+" ) </small>";$("#visitors-count").html(count_message)}}if(!j){setupAnalyticsLhsFilters(n);contactFiltersListeners("lhs_filters_segmentation")}if(a.includes("query/list")){setupSegmentFilterList(n,a.substr(30))}else{setupSegmentFilterList(n)}}});f.webstatsListView.collection.fetch();if(!j){$("#content").html(f.webstatsListView.el)}else{$("#content").find(".visitors-div").html(f.webstatsListView.el);VISITORS_HARD_RELOAD=true}$(".active").removeClass("active");$("#segmentationmenu").addClass("active")})}});var Streams_List_View;var Scheduled_Updates_View;var Past_Tweets=[];var Message_Model;var Pubnub=null;var SocialSuiteRouter=Backbone.Router.extend({routes:{social:"socialsuite",streams:"streams",scheduledmessages:"scheduledmessages"},before:{"*any":function(b,a,c){getTemplate("socialsuite-show-streams",{},undefined,function(d){head.js("jscore/min/locales/"+_LANGUAGE+"/social-suite-all-min.js?_="+_agile_get_file_hash("social-suite-all-min.js"),function(){c()})},"#content")}},socialsuite:function(){if(!tight_acl.checkPermission("SOCIAL")){return}initializeSocialSuite();$(".active").removeClass("active");$("#socialsuitemenu").addClass("active");getTemplate("socialsuite-show-streams",{},undefined,function(a){if(!a){return}$("#content").html($(a));initToPubNub(function(){if(!Pubnub.is_connected_call){return}Pubnub.is_connected_call=false;socialsuitecall.streams()});socialsuitecall.streams()},"#content")},streams:function(e){var d=document.location.href;if(d.search("social")!=-1){var c=$("#content").find("#socialsuite-tabs-content");if(c&&c.length>0){console.log("do nothing")}else{getTemplate("socialsuite-show-streams",{},undefined,function(g){if(!g){return}$("#content").html($(g))},"#content")}}checkScheduledUpdates();if(!Streams_List_View){console.log("Creating Collection First Time.");Streams_List_View=new Base_Collection_View({url:"/core/social",restKey:"stream",templateKey:"socialsuite-streams",individual_tag_name:"div",className:"social-app-content  clearfix",id:"stream_container",postRenderCallback:function(g){registerAll(0);console.log(Streams_List_View.collection)}});Streams_List_View.appendItem=this.socialSuiteAppendItem;Streams_List_View.collection.fetch();$("#socialsuite-tabs-content").append(Streams_List_View.render().el);return}if(Streams_List_View){console.log("Collection already defined.");if(e){Streams_List_View.collection.add(e)}$("#socialsuite-tabs-content").append(Streams_List_View.render(true).el);
displayTimeAgo($(".chirp-container"));showNotification(null)}var b=Streams_List_View.collection.length;for(var a=0;a<b;a++){var f=Streams_List_View.collection.models[a];if(typeof f!="undefined"){if(parseInt(f.get("stream_version"))!=2){$("#streamsMessageBox").show();break}}}$(".deleted").remove();removeWaiting()},socialSuiteAppendItem:function(b){console.log("base_model in append.");var a=new Base_List_View({model:b,view:"inline",template:this.options.templateKey+"-model",tagName:"li",className:"ui-state-default col-md-4 col-sm-6 col-xs-12 "+b.get("id"),id:b.get("id"),name:b.get("column_index"),});var d=new Base_Collection_View({data:[],templateKey:"Column",individual_tag_name:"div",});d.collection.comparator=function(e){if(e.get("id")){return -e.get("id")}};if(b.has("tweetListView")){d.collection.add(b.get("tweetListView").toJSON());d.collection.sort()}b.set("tweetListView",d.collection);var c=a.render().el;$("#stream",c).html(d.render(true).el);$("#socialsuite-streams-model-list",this.el).append(c)},scheduledmessages:function(){Scheduled_Updates_View=new Base_Collection_View({url:"/core/scheduledupdate",restKey:"scheduledUpdate",templateKey:"socialsuite-scheduled-updates",individual_tag_name:"tr",postRenderCallback:function(a){displayTimeAgo($(".is-actionable"))}});Scheduled_Updates_View.collection.fetch();console.log(Scheduled_Updates_View.collection);$("#content").html(Scheduled_Updates_View.render(true).el);$(".active").removeClass("active")}});var socialsuitecall=new SocialSuiteRouter();var _data=null;var IS_TRIAL=false;_IS_EMAIL_PLAN_ACTIVE=false;var IS_ALLOWED_TRIAL=false;var SubscribeRouter=Backbone.Router.extend({routes:{subscribe:"subscribe","trial-subscribe":"trialSubscribe","subscribe/:id/:plan":"subscribe","subscribe-plan":"subscribePlan","subscribe-plan/:id":"subscribePlan","billing-settings":"billingSettings","account-details":"accountDetails","invoice-details":"invoiceDetailsList",updateplan:"updatePlan","purchase-plan":"purchasePlan","purchase-email":"purchaseEmail",updateCreditCard:"cardUpdation",invoice:"invoice","invoice/:id":"getInvoiceDetails","getInvoiceDetails/:id":"getInvoiceDetails",},subscribePlan:function(){Backbone.history.navigate("subscribe",{trigger:true})},cardUpdation:function(){var a=new Base_Model_View({url:"core/api/subscription",template:"creditcard-update",window:"subscribe",saveCallback:function(){showNotyPopUp("information",_agile_get_translated_val("billing","card-updated"),"top")},errorCallback:function(b){showNotyPopUp("warning",b.responseText,"top")},postRenderCallback:function(c){card_expiry(c);var e=c.find("form.card_details"),b=a.model.toJSON().billingData;USER_CREDIRCARD_DETAILS=b;plan_json.customer=JSON.parse(USER_CREDIRCARD_DETAILS);var d=getActiveCard(plan_json.customer);if(!$.isEmptyObject(b)){deserialize_card_details(d,$(e))}}});$("#content").html(a.render().el)},billingSettings:function(){getTemplate("billing-settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));var a=new Base_Model_View({url:"/core/api/subscription",template:"account-details",postRenderCallback:function(){}});$("#content").find("#billing-settings-tab-content").html(a.render().el);$("#content").find("#BillingSettingsTab .select").removeClass("select");$("#content").find(".account-details-tab").addClass("select")},"#content");$(".active").removeClass("active")},accountDetails:function(){getTemplate("billing-settings",{},undefined,function(b){if(!b){return}$("#content").html($(b))},"#content");var a=new Base_Model_View({url:"/core/api/subscription",template:"account-details",postRenderCallback:function(){}});$("#content").find("#billing-settings-tab-content").html(a.render().el);$("#content").find("#BillingSettingsTab .select").removeClass("select");$("#content").find(".account-details-tab").addClass("select");$(".active").removeClass("active")},invoiceDetailsList:function(){var a=this;getTemplate("billing-settings",{},undefined,function(c){if(!c){return}$("#content").html($(c));getTemplate("invoice-details",{},undefined,function(d){if(!d){return}$("#billing-settings-tab-content").html($(d));$("#invoice-details-holder").html(getRandomLoadingImg())},"#billing-settings-tab-content");var b=new Base_Model_View({url:"core/api/subscription?reload=true",template:"subscribe-new",window:"subscribe",postRenderCallback:function(e){var f=b.model.toJSON();var d=new BaseModel(f);a.recent_invoice(d)}})},"#content")},purchaseEmail:function(){if(!email_json.quantity){this.navigate("subscribe",{trigger:true});return}var a=email_json;var b=new Base_Model_View({url:"core/api/subscription",data:email_json,template:"purchase-emails",window:"subscribe",saveCallback:function(){showNotyPopUp("information",_agile_get_translated_val("billing","email-added-success")+" <a href='#subscribe' onclick='document.location.reload();'>"+_agile_get_translated_val("others","click-here")+"</a> "+_agile_get_translated_val("others","if-not-added"),"top",15000)},postRenderCallback:function(c){_IS_EMAIL_PLAN_ACTIVE=true;card_expiry(c);head.js(LIB_PATH+"lib/countries.js",function(){print_country($("#country",c))})},errorCallback:function(c){showNotyPopUp("warning",c.responseText,"top")}});$("#content").html(b.render().el);$(".active").removeClass("active");$("#planView").addClass("active")},subscribe:function(e,d){IS_HAVING_MANDRILL=false;if(window.location.href.split("#")[1]=="subscribe"){IS_TRIAL=false}$("#content").html("<div id='subscribe_plan_change'></div>");if(IS_NEW_USER&&_plan_on_signup&&_plan_on_signup.plan_type&&_plan_on_signup.plan_type=="FREE"){_plan_on_signup=null;Backbone.history.navigate("dashboard",{trigger:true});return}if(!$.isEmptyObject(USER_CREDIRCARD_DETAILS)){plan_json.customer=JSON.parse(USER_CREDIRCARD_DETAILS)}var c=this;var a=0;showTransitionBar();var b;this.subscribe_plan=new Base_Model_View({url:"core/api/subscription?reload=true",template:"subscribe-new",window:"subscribe",postRenderCallback:function(i){var j=c.subscribe_plan.model.toJSON();_data=c.subscribe_plan.model.toJSON();initializeSubscriptionListeners();$('[data-toggle="tooltip"]').tooltip();var m=window;set_up_account_stats(i);USER_BILLING_PREFS=j;USER_CREDIRCARD_DETAILS=c.subscribe_plan.model.toJSON().billingData;if(j&&j.billingData){var l=JSON.parse(j.billingData);var g=getSubscription(j.billingData,j.plan)}var h="";var k;if(g==null){k="2";h="FREE"}else{k=j.plan.quantity;h=j.plan.plan_type.toUpperCase()}b="<span class='text-head-black'>"+_agile_get_translated_val("plan-and-upgrade","current-plan")+"</span></br><span class='text-head-black'>"+k+" "+_agile_get_translated_val("admin-settings","users")+"</span>";if(h.indexOf("STARTER")==0){e=$("#starter_plan")}else{if(h.indexOf("REGULAR")==0){e=$("#regular_plan")}else{if(h.indexOf("ENTERPRISE")==0||h.indexOf("PRO")==0){e=$("#pro_plan")}}}if(e){$("#plan_type").val(e.attr("id").split("_")[0])}element=setPriceTemplete(j.plan.plan_type,i);addStyleForAPlan(e,b);e=(e&&e=="coupon")?e:"";showCouponCodeContainer(e);price=update_price();$("#user_quantity").val(k);$("#users_quantity").text(k);(k&&k>1)?$("#users_quantity_text").text("users"):$("#users_quantity_text").text("user");$("#users_total_cost").text((k*price).toFixed(2));if($.isEmptyObject(j)){setPlan("free")}else{setPlan(j)}j=_data;_billing_restriction=_data.cachedData;init_acl_restriction();var f=new BaseModel(j);c.setup_email_plan(f);c.show_card_details(f);c.invoice_latest(f);hideTransitionBar();document.getElementById("email-quantity").value="";$(".selected-plan",i).trigger("click");if(_IS_EMAIL_PLAN_ACTIVE){$(".nav-tabs li").removeClass("active");$("#users-content").removeClass("active");$("#emailtab").addClass("active");$("#email-content").addClass("active")}}});addStyleForAPlan(e,b);$("#subscribe_plan_change").html(c.subscribe_plan.render().el);$(".active").removeClass("active");$("#planView").addClass("active")},getInvoiceDetails:function(d){var b;var a;var c;if(!d){return}accessUrlUsingAjax("core/api/subscription/getinvoice?d="+d,function(e){console.log("Invoice object");console.log(e);b=e;accessUrlUsingAjax("/core/api/account-prefs",function(f){console.log("Account prefs");console.log(f);a=f;c={invoice:b,company:a};console.log("xxxxxxxxxxxxxxx");console.log(c);head.js(LIB_PATH+"jscore/handlebars/handlebars-helpers.js",function(){getTemplate("invoice-detail",c,undefined,function(g){if(!g){return}$("#content").html($(g));$('[data-toggle="tooltip"]').tooltip()},"#content")})},function(f){showNotyPopUp("information",_agile_get_translated_val("billing","error-occured"),"top")})},function(e){showNotyPopUp("information",_agile_get_translated_val("billing","error-occured"),"top")})},updatePlan:function(){var a=new Base_Model_View({url:"core/api/subscription-addon/subscribe",template:"purchase-email-plan",saveCallback:function(){window.navigate("subscribe",{trigger:true});showNotyPopUp("information",_agile_get_translated_val("billing","plan-updated"),"top")},postRenderCallback:function(b){initializeSubscriptionListeners();card_expiry(b);head.js(LIB_PATH+"lib/countries.js",function(){print_country($("#country",b))})}});$("#content").html(a.render().el);$(".active").removeClass("active");$("#planView").addClass("active")},invoice:function(){Backbone.history.navigate("invoice-details",{trigger:true});this.invoice=new Base_Collection_View({url:"core/api/subscription/invoices",templateKey:"invoice",window:"subscribe",individual_tag_name:"tr"});this.invoice.collection.fetch();$("#content").html(this.invoice.el)},invoiceDetails:function(c){if(!this.invoice||!this.invoice.collection||this.invoice.collection==0||!this.invoice.collection.get(c)){this.navigate("invoice",{trigger:true});return}if(c){var b=this.invoice.collection.get(c);var a=new Base_Model_View({url:"core/api/subscription/getinvoice",model:b,template:"invoice-detail",postRenderCallback:function(d){}});$("#billing-settings-tab-content").html("");$("#billing-settings-tab-content").html(a.render().el)}else{return}},purchasePlan:function(){if(!plan_json.plan){this.navigate("subscribe",{trigger:true});
return}_plan_on_signup=null;var b=this;var c=plan_json;var a=new Base_Model_View({url:"core/api/subscription",template:"purchase-plan",isNew:true,data:c,postRenderCallback:function(d){initializeSubscriptionListeners();_IS_EMAIL_PLAN_ACTIVE=false;showCouponDiscountAmount(plan_json,d);card_expiry(d)},saveCallback:function(g){if(g&&!USER_BILLING_PREFS.status){var d=JSON.parse(g.billingData).id;var e='<img src="https://shareasale.com/sale.cfm?amount='+plan_json.cost+"&tracking="+d+'&transtype=sale&merchantID=65450" width="1" height="1">';$("body").append(e);addAsAffiliate(plan_json.cost*100)}b.navigate("subscribe",{trigger:true});showNotyPopUp("information",_agile_get_translated_val("plan-and-upgrade","your-plan-has-been-updated-successfully"),"top");try{push_actual_plan(g.plan)}catch(f){console.log(f)}},errorCallback:function(d){if(d.responseText){showNotyPopUp("warning",d.responseText,"top")}}});$("#content").html(a.render().el);$('[data-toggle="tooltip"]').tooltip();$(".active").removeClass("active");$("#planView").addClass("active")},setup_email_plan:function(d){var a=0;var c=this;IS_HAVING_MANDRILL=false;$.ajax({url:"core/api/email-gateway",type:"GET",success:function(e){if(e&&e.email_api){IS_HAVING_MANDRILL=true}}});var b=new Base_Model_View({url:"core/api/subscription",template:"email-update",model:d,window:"subscribe",postRenderCallback:function(e){}});$("#purchase-email").html(b.render(true).el)},show_card_details:function(d){var c=this;var a=0;var b=new Base_Model_View({url:"core/api/subscription",model:d,template:"customer-details-block",postRenderCallback:function(e){}});$("#customer-details-holder").html(b.render(true).el)},invoice_latest:function(a){$("#recent_invoice").html(getRandomLoadingImg());if(!a.get("billingData")){$("#invoice-details-holder").html("");$("#invoice-details-holder").append("<div class='text-lg p-l-sm p-t-sm'>"+_agile_get_translated_val("billing","no-invoices")+"</div>");return}$.get("core/api/subscription/invoices",{},function(b){if(!b||b.length<=0){return}b=new BaseCollection(b,{sortKey:"date",descending:true}).toJSON();getTemplate("latest-invoice",b[0],undefined,function(c){if(!c){return}$("#recent_invoice").html(c)},"#recent_invoice")}).fail(function(){$("#recent_invoice").html(_agile_get_translated_val("plan-and-upgrade","you-do-not-have-any-invoices-yet"))})},recent_invoice:function(a){if(!a.get("billingData")){$("#invoice-details-holder").html("");$("#invoice-details-holder").append(getTemplate("js-recent-invoice"));return}this.invoice=new Base_Collection_View({url:"core/api/subscription/invoices?page_size=20",templateKey:"invoice",window:"subscribe",individual_tag_name:"tr",sortKey:"date",descending:true});this.invoice.collection.fetch();$("#invoice-details-holder").html(this.invoice.render().el)},trialSubscribe:function(){IS_TRIAL=true;var a=this;if(!IS_ALLOWED_TRIAL){$.ajax({url:"core/api/subscription/agileTags?email="+CURRENT_DOMAIN_USER.email,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",success:function(b){console.log(b);if(b&&b.tags){if($.inArray("Cancellation Request",b.tags)==-1&&$.inArray("Cancelled Trial",b.tags)==-1&&$.inArray("Trial",b.tags)!=-1){IS_ALLOWED_TRIAL=true}}a.subscribe()},error:function(){showAlertModal("error")}})}else{a.subscribe()}}});function getPendingEmails(){var c=_billing_restriction.one_time_emails_count;var a=getMaxEmailsLimit();if(a>0){if(c<0){return 0}return c}if(a==0){var b=5000+c;if(b<0){return 0}return b}return c}function getMaxEmailsLimit(){var a=_billing_restriction.max_emails_count;if(a==undefined){a=0}return a}function canSendEmails(a){var b=getPendingEmails()+getEmailCreditsCount();if(b>=a){return true}return false}function is_free_plan(){return _IS_FREE_PLAN}function addStyleForAPlan(b,a){if(b){if(($("selected-plan"))!=($("#email-div"))){$(".plan-collection-in").removeClass("selected-plan");b.find(".plan-collection-in").addClass("selected-plan")}else{$("#email-div").addClass("selected-plan")}}}function removeStyleForAPlan(a){var a=$("#plans-panel");a.find(".plan-collection-bot").css("opacity","0.5");if(($("selected-plan"))!=($("#email-div"))){$(".plan-collection-in").removeClass("selected-plan")}}function getEmailsNextRenewalTime(){var a=_billing_restriction.last_renewal_time;if(a==undefined||a==null){$.getJSON("core/api/users/current-owner",function(b){$("#next_emails_renewal").html(new Date((b.createdTime+2592000)*1000).format("mmm dd, yyyy"));return})}else{return new Date((a+2592000)*1000).format("mmm dd, yyyy")}}function getEmailCreditsCount(){var a=_billing_restriction.email_credits_count;if(a==undefined){a=0}return a}var HAS_EMAIL_ACCOUNT_LIMIT_REACHED=false;var EMAIL_PREFS_WIDGET_SIZE=0;var SettingsRouter=Backbone.Router.extend({routes:{settings:"settings","user-prefs":"userPrefs","change-password":"changePassword",email:"email",imap:"imapAdd","imap/:id":"imapEdit",office:"officeAdd","office/:id":"officeEdit","social-prefs":"socialPrefs","gmail/:id":"gmailShare","email-templates":"emailTemplates","email-template-add":"emailTemplateAdd","email-template/:id":"emailTemplateEdit","notification-prefs":"notificationPrefs","scheduler-prefs":"scheduler",help:"support","contact-us":"contactUsEmail",themeandlayout:"themeandlayout"},userPrefs:function(){var a=this;getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));getTemplate("settings-user-prefs-tab",{},undefined,function(c){if(!c){return}$("#prefs-tabs-content").html($(c));$.getJSON("/core/api/user-prefs",function(e){var d=new BaseModel(e);a.userPrefsProfile(d);$('#prefs-tabs-content a[href="#settings-user-prefs"]').on("click",function(f){f.preventDefault();a.userPrefsProfile(d)});$('#prefs-tabs-content a[href="#settings-reminders"]').on("click",function(f){f.preventDefault();a.userPrefsReminders(d)});$('#prefs-tabs-content a[href="#settings-advanced"]').on("click",function(f){f.preventDefault();a.userPrefsAdvanced(d)})}).done(function(){hideTransitionBar()}).fail(function(){hideTransitionBar()});$("#PrefsTab .select").removeClass("select");$(".user-prefs-tab").addClass("select");$(".active").removeClass("active");$("#prefs-tabs-content .prefs-profile").addClass("active")},null)},"#content")},changePassword:function(){getTemplate("settings",{},undefined,function(a){if(!a){return}$("#content").html($(a));getTemplate("settings-change-password",{},undefined,function(b){if(!b){return}$("#prefs-tabs-content").html($(b));$("#PrefsTab .select").removeClass("select");$(".user-prefs-tab").addClass("select");$(".active").removeClass("active");$("#saveNewPassword").on("click",function(g){g.preventDefault();var f=$(this);if($(f).attr("disabled")){return}disable_save_button($(f));var c=$(this).closest("form").attr("id");if(!isValidForm("#"+c)){enable_save_button($(f));return false}if($("#current_pswd").val()==$("#new_pswd").val()){$("#changePasswordForm").find("span.save-status").html("<span style='color:red;margin-left:10px;'>"+_agile_get_translated_val("others","pwds-in-correct")+"</span>");$("#changePasswordForm").find("span.save-status").find("span").fadeOut(5000);enable_save_button($(f));return false}$("#changePasswordForm").find("span.save-status").html(getRandomLoadingImg());var d=serializeForm(c);$.ajax({url:"/core/api/user-prefs/changePassword",type:"PUT",data:d,success:function(){$("#changePasswordForm").find("span.save-status").html("<span style='color:green;margin-left:10px;'>"+_agile_get_translated_val("others","pwd-change-success")+"</span>").fadeOut(5000);enable_save_button($(f));$("#"+c).each(function(){this.reset()});history.back(-1)},error:function(e){$("#changePasswordForm").find("span.save-status").html("");$("#changePasswordForm").find('input[name="current_pswd"]').closest(".controls").append("<span style='color:red;margin-left:10px;'>"+_agile_get_translated_val("others","pwd-in-correct")+"</span>");$("#changePasswordForm").find('input[name="current_pswd"]').closest(".controls").find("span").fadeOut(5000);$("#changePasswordForm").find('input[name="current_pswd"]').focus();enable_save_button($(f))}})})},"#prefs-tabs-content")},"#content")},socialPrefs:function(){getTemplate("settings",{},undefined,function(d){if(!d){return}$("#content").html($(d));var c={service:"linkedin"};var b=new Settings_Modal_Events({url:"/core/api/social-prefs/LINKEDIN",template:"settings-social-prefs",data:c,postRenderCallback:function(e){}});$("#prefs-tabs-content").html(b.render().el);c={service:"twitter"};var a=new Settings_Modal_Events({url:"/core/api/social-prefs/TWITTER",template:"settings-social-prefs",data:c,postRenderCallback:function(e){}});$("#prefs-tabs-content").append(a.render().el);$("#PrefsTab .select").removeClass("select");$(".social-prefs-tab").addClass("select");$(".active").removeClass("active")},"#content")},email:function(){var a=this;getTemplate("settings",{},undefined,function(c){if(!c){return}$("#content").html($(c));getTemplate("settings-email-prefs",{},undefined,function(d){if(!d){return}$("#prefs-tabs-content").html($(d));a.imapListView={};a.officeListView={};a.gmailListView={};$("#PrefsTab .select").removeClass("select");$(".email-tab").addClass("select");$(".active").removeClass("active")},"#prefs-tabs-content");var b=0;$.getJSON("/core/api/emails/synced-accounts",function(e){if(typeof e!==undefined&&e.hasOwnProperty("emailAccountsLimitReached")&&e.emailAccountsLimitReached){HAS_EMAIL_ACCOUNT_LIMIT_REACHED=true}else{HAS_EMAIL_ACCOUNT_LIMIT_REACHED=false}var d=e.emailAccountsLimit;load_gmail_widgets(d);load_imap_widgets(d);load_office365_widgets(d)})},"#content")},imapEdit:function(a){getTemplate("settings",{},undefined,function(c){if(!c){return}$("#content").html($(c));if(App_Settings.imapListView===undefined){App_Settings.navigate("email",{trigger:true});return}var d=App_Settings.imapListView.collection.get(a);var b=new Settings_Modal_Events({url:"/core/api/imap/",model:d,template:"settings-imap-prefs",change:false,postRenderCallback:function(f){var e=b.model;var g=e.id;b.model.set("password","");load_imap_properties(e,f)
},saveCallback:function(){App_Settings.navigate("email",{trigger:true});return}});$("#prefs-tabs-content").html(b.render().el);$("#PrefsTab .select").removeClass("select");$(".email-tab").addClass("select");$(".active").removeClass("active")},"#content")},imapAdd:function(){getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));var a=new Settings_Modal_Events({url:"/core/api/imap/",template:"settings-imap-prefs",change:false,isNew:true,postRenderCallback:function(c){},saveCallback:function(){var c=a.model;var d=c.toJSON();if(typeof d.isUpdated!=="undefined"&&d.hasOwnProperty("isUpdated")&&d.isUpdated){App_Settings.navigate("email",{trigger:true})}else{a.render(true);var e=a.el;var c=a.model;load_imap_folders(e,c)}}});$("#prefs-tabs-content").html(a.render().el);$("#PrefsTab .select").removeClass("select");$(".email-tab").addClass("select");$(".active").removeClass("active")},"#content")},officeAdd:function(){getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));var a=new Settings_Modal_Events({url:"/core/api/office",template:"settings-office-prefs",isNew:true,change:false,postRenderCallback:function(c){a.model.set("password","")},saveCallback:function(){App_Settings.navigate("email",{trigger:true});return}});$("#prefs-tabs-content").html(a.render().el);$("#PrefsTab .select").removeClass("select");$(".email-tab").addClass("select");$(".active").removeClass("active")},"#content")},officeEdit:function(a){getTemplate("settings",{},undefined,function(c){if(!c){return}$("#content").html($(c));if(App_Settings.officeListView===undefined){App_Settings.navigate("email",{trigger:true});return}var d=App_Settings.officeListView.collection.get(a);var b=new Settings_Modal_Events({url:"/core/api/office/",model:d,template:"settings-office-prefs",postRenderCallback:function(e){b.model.set("password","")},saveCallback:function(){App_Settings.navigate("email",{trigger:true});return}});$("#prefs-tabs-content").html(b.render().el);$("#PrefsTab .active").removeClass("select");$(".email-tab").addClass("select");$(".active").removeClass("active")},"#content")},gmailShare:function(a){getTemplate("settings",{},undefined,function(d){if(!d){return}$("#content").html($(d));if(App_Settings.gmailListView===undefined){App_Settings.navigate("email",{trigger:true});return}var b=App_Settings.gmailListView.collection.get(a);var c=new Settings_Modal_Events({url:"core/api/social-prefs/share/"+a,model:b,template:"settings-gmail-prefs-share",postRenderCallback:function(e){},saveCallback:function(){App_Settings.navigate("email",{trigger:true});return}});$("#prefs-tabs-content").html(c.render().el);$("#PrefsTab .select").removeClass("select");$(".email-tab").addClass("select");$(".active").removeClass("active")},"#content")},emailTemplates:function(){var a=this;getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));a.emailTemplatesListView=new Base_Collection_View({url:"/core/api/email/templates",restKey:"emailTemplates",templateKey:"settings-email-templates",individual_tag_name:"tr",postRenderCallback:function(c){agileTimeAgoWithLngConversion($(".created_time",c))}});a.emailTemplatesListView.collection.fetch();$("#prefs-tabs-content").html(a.emailTemplatesListView.el);$("#PrefsTab .select").removeClass("select");$(".email-templates-tab").addClass("select");make_menu_item_active("email-templates-menu")},"#content")},emailTemplateAdd:function(){getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));var a=new Email_Template_Events({url:"/core/api/email/templates",isNew:true,template:"settings-email-template-add",window:"email-templates",postRenderCallback:function(){}});$("#prefs-tabs-content").html(a.render().el);setupTinyMCEEditor("textarea#email-template-html",false,undefined,function(){set_tinymce_content("email-template-html","");register_focus_on_tinymce("email-template-html");if(typeof BRING_YOUR_CODE_BTN!="undefined"&&BRING_YOUR_CODE_BTN){$(".mce-i-code").trigger("click");BRING_YOUR_CODE_BTN=false}});$("#PrefsTab .select").removeClass("select");$(".email-templates-tab").addClass("select");$(".active").removeClass("active")},"#content")},emailTemplateEdit:function(e){var d=this;getTemplate("settings",{},undefined,function(h){if(!h){return}$("#content").html($(h));if(!d.emailTemplatesListView||d.emailTemplatesListView.collection.length==0){d.navigate("email-templates",{trigger:true});return}var g=d.emailTemplatesListView.collection.get(e);var f=new Email_Template_Events({url:"/core/api/email/templates",model:g,template:"settings-email-template-add",window:"email-templates",postRenderCallback:function(){}});$("#prefs-tabs-content").html(f.render().el);setupTinyMCEEditor("textarea#email-template-html",false,undefined,function(){set_tinymce_content("email-template-html",g.toJSON().text);register_focus_on_tinymce("email-template-html")});$("#PrefsTab .select").removeClass("select");$(".email-templates-tab").addClass("select");$(".active").removeClass("active")},"#content");if($("#attachment_id").val()){var c=$("#tpl-attachment-select").closest("div");$("#tpl-attachment-select").hide();c.find(".attachment-document-select").css("display","inline");var a="<option value='{{id}}' network_type='{{titleFromEnums network_type}}' size='{{size}}' url='{{url}}'>{{name}}</option>";fillSelect("attachment-select","core/api/documents","documents",function b(){c.find("#attachment-select option:first").after("<option value='new'>"+_agile_get_translated_val("others","upload-new-doc")+"</option>");$("#attachment-select").find("option[value="+$("#attachment_id").val()+"]").attr("selected","selected");$(".add-tpl-attachment-confirm").trigger("click");$("#tpl-attachment-select").hide();$("#tpl-attachment-name").show()},a,false,c)}},notificationPrefs:function(){getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));var a=new Settings_Modal_Events({url:"core/api/notifications",template:"settings-notification-prefs",reload:true,postRenderCallback:function(c){notification_prefs=a.model.toJSON();console.log("updated notification prefs are...");console.log(notification_prefs);head.load(CSS_PATH+"css/bootstrap_switch.css",LIB_PATH+"lib/bootstrapSwitch.js",function(){showSwitchChanges(c);check_browser_notification_settings(c)});try{$("#notification-switch",c).bootstrapSwitch()}catch(d){console.log(d)}notification_play_button();if(navigator.userAgent.indexOf("Safari")!==-1&&navigator.userAgent.indexOf("Chrome")===-1){$("#notification-switch").parent().css("margin-top","-32px")}}});$("#prefs-tabs-content").html(a.render().el);$("#PrefsTab .select").removeClass("select");$(".notification-prefs-tab").addClass("select");$(".active").removeClass("active")},"#content")},support:function(){load_clickdesk_code();getTemplate("support-form",{},undefined,function(b){if(!b){return}$("#content").html($(b));$(".active").removeClass("active");$("#helpView").addClass("active");try{CLICKDESK_Live_Chat.onStatus(function(c){if(c=="online"){$("#clickdesk_status").html('Chat with our support representative.<br/> <a class="text-info c-p" onclick="CLICKDESK_LIVECHAT.show();">Start chat</a>.')}else{$("#clickdesk_status").html('No chat support representative is available at the moment. Please<br/> <a href="#contact-us" id="show_support">leave a message</a>.')}})}catch(a){setTimeout(function(){CLICKDESK_Live_Chat.onStatus(function(c){if(c=="online"){$("#clickdesk_status").html('Chat with our support representative.<br/> <a class="text-info c-p" onclick="CLICKDESK_LIVECHAT.show();">Start chat</a>.')}else{$("#clickdesk_status").html('No chat support representative is available at the moment. Please<br/> <a href="#contact-us" id="show_support">leave a message</a>.')}})},5000)}hideTransitionBar()},"#content")},scheduler:function(){$("#content").html("<div id='online-cal-listners'>&nbsp;</div>");getTemplate("settings",{},undefined,function(b){if(!b){return}$("#online-cal-listners").html($(b));var a=new Base_Model_View({url:"core/api/scheduleprefs",type:"GET",template:"settings-online-calendar-new",postRenderCallback:function(d){$('#online-calendar a[href="#calendar-tab"]',d).tab("show");var c=getCurrentDomain();var e="https://"+c+".agilecrm.com/calendar/"+a.model.get("schedule_id");$("#scheduleurl").attr("href",e);$("#scheduleurl").text(e);$("#scheduleurl").removeClass("nounderline");head.js(CSS_PATH+"css/businesshours/businesshours.css",CSS_PATH+"css/businesshours/jquerytimepicker.css",LIB_PATH+"lib/businesshours/businesshours.js",LIB_PATH+"lib/businesshours/jquerytimepicker.js",LIB_PATH+"lib/summer-note/summernote.js",CSS_PATH+"css/summernote/summernote.css",function(){var f=JSON.parse(a.model.get("business_hours"));console.log();businessHoursManager=$("#define-business-hours").businessHours({operationTime:f,postInit:function(){$(".operationTimeFrom, .operationTimeTill").timepicker({timeFormat:"H:i",step:30})},});$(".mini-time").keydown(false).addClass("form-control");$(".online_summer_note").summernote({toolbar:[["style",["bold","italic","underline","clear"]],["fontsize",["fontsize"]],["insert",["link"]]],height:"100"});$(".online_summer_note").code(a.model.get("user_calendar_title"))});initializeOnlineCalendarListners(d)}});$("#prefs-tabs-content").html(a.render().el);$("#PrefsTab .select").removeClass("select");$(".scheduler-prefs-tab").addClass("select");make_menu_item_active("schedulingmenu")},"#online-cal-listners")},contactUsEmail:function(){getTemplate("help-mail-form",{},undefined,function(a){if(!a){return}$("#content").html($(a));$(".active").removeClass("active");$("#helpView").addClass("active")},"#content")},themeandlayout:function(){showTransitionBar();$.ajax({url:"/core/api/user-prefs",type:"GET",dataType:"json",success:function(a){getTemplate("theme-layout-form",{},undefined,function(b){if(!b){return}$("#content").html($(b));initializeThemeSettingsListeners();$("#menuPosition").val(CURRENT_USER_PREFS.menuPosition);$("#layout").val(CURRENT_USER_PREFS.layout);
if(CURRENT_USER_PREFS.animations==true){$("#animations").attr("checked",true)}$('.magicMenu  input:radio[name="theme"]').filter("[value="+CURRENT_USER_PREFS.theme+"]").attr("checked",true);if(a.menuPosition!=CURRENT_USER_PREFS.menuPosition||a.layout!=CURRENT_USER_PREFS.layout||a.theme!=CURRENT_USER_PREFS.theme||a.animations!=CURRENT_USER_PREFS.animations){$(".theme-save-status").css("display","inline")}hideTransitionBar()},"#content")},error:function(){hideTransitionBar();showNotyPopUp("information",_agile_get_translated_val("billing","error-occured"),"top")}})},userPrefsProfile:function(b){var a=new Base_Model_View({url:"core/api/user-prefs",model:b,template:"settings-user-prefs",change:false,reload:true,postRenderCallback:function(c){setupTinyMCEEditor("textarea#WYSItextarea",true,["textcolor link image preview code"],function(){register_focus_on_tinymce("WYSItextarea")})}});$("#settings-user-prefs-tab-content").html(a.render(true).el)},userPrefsReminders:function(a){var b=new Base_Model_View({url:"core/api/user-prefs",model:a,template:"settings-reminders",change:false,reload:true,postRenderCallback:function(c){}});$("#settings-user-prefs-tab-content").html(b.render(true).el)},userPrefsAdvanced:function(b){var a=new Base_Model_View({url:"core/api/user-prefs",model:b,template:"settings-advanced",change:false,reload:true,postRenderCallback:function(c){}});$("#settings-user-prefs-tab-content").html(a.render(true).el)}});function getCurrentDomain(b){var a=window.location.host;var c=/(\.)/;if(a.search(c)>=0){return a.split(c)[0]}return" "}var DocumentsRouter=Backbone.Router.extend({routes:{documents:"documents",},documents:function(){getTemplate("documents-static-container",{},undefined,function(d){$("#content").html(getTemplate("documents-static-container"));var a=_agile_get_prefs("Documentssort_Key");if(a==undefined||a==null){a="dummy_name";_agile_set_prefs("Documentssort_Key",a)}var c=this;var b=new Document_Model_Events({template:"documents-top-header",isNew:true,model:new Backbone.Model({sortKey:a}),postRenderCallback:function(e){console.log("Load collection");App_Documents.loadDocuments($("#content"))}});$("#content").find("#documents-top-view").html(b.render().el)},$("#content"))},loadDocuments:function(b){var c=this;var a=_agile_get_prefs("Documentssort_Key");if(App_Documents.DocumentCollectionView&&App_Documents.DocumentCollectionView.options.global_sort_key==a&&App_Documents.DocumentCollectionView.collection&&App_Documents.DocumentCollectionView.collection.length>0){$(b).find("#documents_collection_container").html(App_Documents.DocumentCollectionView.render(true).el);return}$("#content").find("#documents_collection_container").html(LOADING_HTML);App_Documents.DocumentCollectionView=new Document_Collection_Events({url:"core/api/documents",sort_collection:false,templateKey:"documents",individual_tag_name:"tr",cursor:true,customLoader:true,customLoaderTemplate:"agile-app-collection-loader",page_size:20,global_sort_key:a,postRenderCallback:function(d){$(".active").removeClass("active");$("#documentsmenu").addClass("active")}});App_Documents.DocumentCollectionView.collection.fetch();$("#content").find("#documents_collection_container").html(App_Documents.DocumentCollectionView.el)}});var LandingPageRouter=Backbone.Router.extend({routes:{"landing-pages":"getListOfLandingPages","landing-page-add":"showLandingPageBuilder","landing-page-templates":"getListOfTemplates","landing-page-add/:id":"loadSelectedTemplate","landing-page/:id":"loadSavedLandingPage","landing-page-settings/:id":"pageSettings","landing-page-copy/:id":"copySelectedLandingPage"},getListOfLandingPages:function(){$("#content").html("<div id='landingpages-listeners'></div>");getTemplate("landingpages-static-container",{},undefined,function(d){$("#content").html(getTemplate("landingpages-static-container"));var b=_agile_get_prefs("landingpage_sort_menu");if(b==undefined||b==null){b="dummy_name";_agile_set_prefs("landingpage_sort_menu",b)}var c=this;var a=new LandingPages_Top_Header_Modal_Events({template:"landing-pages-top-header",isNew:true,model:new Backbone.Model({sortKey:b}),postRenderCallback:function(e){console.log("Load collection");App_LandingPageRouter.loadLandingPagesCollection($("#content"))}});$("#content").find("#Landingpages-top-view").html(a.render().el)},$("#content"))},loadLandingPagesCollection:function(b){var a=_agile_get_prefs("landingpage_sort_menu");if(this.LandingPageCollectionView&&this.LandingPageCollectionView.options.global_sort_key==a&&this.LandingPageCollectionView.collection&&this.LandingPageCollectionView.collection.length>0){$(b).find("#landing-pages-collection-container").html(this.LandingPageCollectionView.render(true).el);return}this.LandingPageCollectionView=new landingpage_collection_events({url:"core/api/landingpages",sort_collection:false,templateKey:"landingpages",cursor:true,page_size:20,individual_tag_name:"tr",customLoaderTemplate:"agile-app-collection-loader",customLoader:true,global_sort_key:a,postRenderCallback:function(c){includeTimeAgo(c);$(".active").removeClass("active");$("#landing-pages-menu").addClass("active")},appendItemCallback:function(c){includeTimeAgo(c)}});this.LandingPageCollectionView.collection.fetch();$("#content").find("#landing-pages-collection-container").html(App_LandingPageRouter.LandingPageCollectionView.el)},showLandingPageBuilder:function(){$("#content").html("<div id='landingpages-listeners'></div>");initializeLandingPageListeners();getTemplate("landingpages-add",{},undefined,function(a){$("#landingpages-listeners").html($(a))},"#landingpages-listeners");$(".active").removeClass("active");$("#landing-pages-menu").addClass("active");hideTransitionBar()},getListOfTemplates:function(){$("#content").html("<link rel='stylesheet' type='text/css' href='flatfull/css/jquery.fancybox.css'><div id='landingpages-listeners'></div>");head.js("flatfull/lib/jquery.fancybox.js",function(){$.getJSON("misc/landingpage/templates/templates.json",function(a){getTemplate("landingpages-categories",a.templates[0],undefined,function(b){$("#landingpages-listeners").html($(b))},"#landingpages-listeners");$(".lpt_fancybox").fancybox({autoDimensions:false,padding:0,autoScale:true,width:"600px",transitionIn:"none",transitionOut:"none",type:"iframe"});hideTransitionBar()})});$(".active").removeClass("active");$("#landing-pages-menu").addClass("active")},loadSelectedTemplate:function(a){$("#content").html("<div id='landingpages-listeners'></div>");initializeLandingPageListeners();var b={templateId:a,action:"new"};getTemplate("landingpages-add",b,undefined,function(c){$("#landingpages-listeners").html($(c))},"#landingpages-listeners");$("html, body").animate({scrollTop:$("body").offset().top},500);$(".active").removeClass("active");$("#landing-pages-menu").addClass("active");hideTransitionBar()},loadSavedLandingPage:function(b){if(typeof this.LandingPageCollectionView=="undefined"){this.navigate("landing-pages",{trigger:true});return}var c=this.LandingPageCollectionView.collection.get(b).toJSON();if(c.version>=2){window.location="pagebuilder/"+b;return}$("#content").html("<div id='landingpages-listeners'></div>");initializeLandingPageListeners(b);var d={templateId:b,action:"edit"};getTemplate("landingpages-add",d,undefined,function(e){$("#landingpages-listeners").html($(e))},"#landingpages-listeners");$("html, body").animate({scrollTop:$("body").offset().top},500);$(".active").removeClass("active");$("#landing-pages-menu").addClass("active");var a=setInterval(function(){if(Current_Route.indexOf("landing-page/")==-1){clearInterval(a)}else{saveLandingPageToDataStore(true,b)}},5*60*1000);hideTransitionBar()},pageSettings:function(a){$("#content").html("<div id='landingpages-listeners'></div>");initializeLandingPageListeners(a);$.getJSON("core/api/landingpages/custom-domain/"+a,function(b){b=b||{};b.pageid=a;getTemplate("landingpages-settings",b,undefined,function(d){$("#landingpages-listeners").html($(d));var c=document.getElementById("cname");if($("#cname").attr("href")!=""){var e=c.hostname.split(".");$("#sub_domain").val(e.shift());$("#domain").val(e.join("."));var f=c.pathname;if(f.charAt(0)==="/"){f=f.substr(1)}$("#directory_path").val(f)}},"#landingpages-listeners")});$(".active").removeClass("active");$("#landing-pages-menu").addClass("active");hideTransitionBar()},copySelectedLandingPage:function(a){$("#content").html("<div id='landingpages-listeners'></div>");initializeLandingPageListeners();var b={templateId:a,action:"copy"};getTemplate("landingpages-add",b,undefined,function(c){$("#landingpages-listeners").html($(c))},"#landingpages-listeners");$("html, body").animate({scrollTop:$("body").offset().top},500);$(".active").removeClass("active");$("#landing-pages-menu").addClass("active");hideTransitionBar()}});var CasesRouter=Backbone.Router.extend({routes:{cases:"listCases",},listCases:function(){$("#content").html("<div id='cases-listners'>&nbsp;</div>");this.casesCollectionView=new Base_Collection_View({url:"core/api/cases",sort_collection:false,restKey:"case",templateKey:"cases",cursor:true,page_size:25,individual_tag_name:"tr",postRenderCallback:function(a){includeTimeAgo(a);initializeCasesListeners(a)},appendItemCallback:function(a){includeTimeAgo(a)}});this.casesCollectionView.collection.fetch();$("#cases-listners").html(this.casesCollectionView.render().el);$(".active").removeClass("active");$("#casesmenu").addClass("active")}});var ActivitylogRouter=Backbone.Router.extend({routes:{activities:"activities","contact-activities":"contactActivities","contact-activities/:type":"contactActivities","activities/campaign/:id":"activities"},activities:function(a){if(!tight_acl.checkPermission("ACTIVITY")){return}head.js(LIB_PATH+"lib/date-charts-en.js",LIB_PATH+"lib/date-range-picker.js?_="+_agile_get_file_hash("date-range-picker.js"),function(){$("#content").html("<div id='activities-listners'>&nbsp;</div>");getTemplate("activity-list-header",{},undefined,function(b){if(!b){return}getTracksCount(function(f){DEAL_TRACKS_COUNT=f;
$("#activities-listners").html($(b));initActivitiesDateRange();var e=true;if(a==undefined){e=false}else{$("#selectedentity_type").html(_agile_get_translated_val("menu","menu-campaigns"));$("#activities_date_range").hide()}renderActivityView(getActivityFilterParameters(true,e)+"&campaign-id="+a);$(".activity-log-button").css("display","none");var g=JSON.parse(_agile_get_prefs(ACTIVITY_FILTER));var c="<li><a  href='{{id}}'>{{name}}</li>";fillSelect("user-select","core/api/users","domainuser",function d(){$("#activities-listners").find("#user-select").append("<li><a href=''>"+_agile_get_translated_val("report-view","all-users")+"</a></li>");if(g&&(g.user||g.entity)){$("ul#user-select li a").closest("ul").data("selected_item",g.userId);$("ul#entity_type li a").closest("ul").data("selected_item",g.entityId);$("#selectedusername").html(g.user);if(a!=undefined){g.entity=_agile_get_translated_val("menu","menu-campaigns")}$("#selectedentity_type").html(g.entity);$(".activity-sub-heading").html(g.entity)}$(".activity-log-button").css("display","inline-block")},c,true)})},"#activities-listners");$(".active").removeClass("active");$("#activitiesmenu").addClass("active")})},contactActivities:function(a){head.js(LIB_PATH+"lib/date-charts-en.js",LIB_PATH+"lib/date-range-picker.js?_="+_agile_get_file_hash("date-range-picker.js"),function(){getTemplate("contact-activity-header",{},undefined,function(g){if(!g){return}$("#content").html($(g));var d="core/api/campaigns/logs/ContactActivities";var c="";var b="";var e="time";switch(a){case"all":c="?log_type=All_Activities";b=_agile_get_translated_val("report-view","all-activities");break;case"page-views":c="?log_type=Page_Views";b=_agile_get_translated_val("contact-details","page-views");break;case"email-opens":c="?log_type=Email_Opened";b=_agile_get_translated_val("portlets","email-opens");break;case"email-clicks":c="?log_type=Email_Clicked";b=_agile_get_translated_val("contact-details","email-clicks");break;case"unsubscriptions":c="?log_type=Unsubscribed";b=_agile_get_translated_val("campaigns","unsubscriptions");break;case"spam-reports":c="?log_type=Email_Spam";b=_agile_get_translated_val("contact-details","spam-reports");break;case"hard-bounces":c="?log_type=Email_Hard_Bounced";b=_agile_get_translated_val("campaigns","hard-bounces");break;case"soft-bounces":c="?log_type=Email_Soft_Bounced";b=_agile_get_translated_val("campaigns","soft-bounces");break;default:c="?log_type=All_Activities";b=_agile_get_translated_val("report-view","all-activities")}d=d+c;if(a!=undefined&&a!="all"){$(".contact-activity-sub-heading").text(b)}$("#log-filter-title").text(b);var f=new Base_Collection_View({url:d,templateKey:"contact-activity-list-log",individual_tag_name:"li",cursor:true,scroll_symbol:"scroll",page_size:20,sort_collection:false,postRenderCallback:function(h){contactListener();agileTimeAgoWithLngConversion($("time",h))},appendItemCallback:function(h){includeTimeAgo(h)}});f.appendItem=append_contact_activities_log;f.collection.fetch();$("#contact-activity-list-based-condition").html(f.render().el);console.log("========contact activities ==========")},"#content")});$(".active").removeClass("active");$("#activitiesmenu").addClass("active")}});email=null;var AdminPanelRouter=Backbone.Router.extend({routes:{domainSubscribe:"domainSubscribeDetails","domainSubscribe/:id":"domainSubscribeDetails","purchase-plan-formAdminPanel":"purchasePlanFromAdminpanel","all-domain-users":"allDomainUsers","change-password-admin/:id":"changePasswordadmin","getDomainUserDetails/:id":"getDomainUserDetails",domainSearch:"domainSearch"},get_account_stats_for_domain_from_adminpanel:function(a,b){console.log("in accountstats object");console.log(b);$.ajax({url:"core/api/admin_panel/getdomainstats?d="+b,type:"GET",success:function(c){console.log(c);getTemplate("domain-info",c,undefined,function(e){if(!e){return}$(a).find("#account").html($(e))},$(a).find("#account"));var d=c.emailcount;c.emailcount=JSON.parse(c.emailcount);getTemplate("email-stats",JSON.parse(d),undefined,function(e){if(!e){return}$(a).find("#emailcount").html($(e));$(".delete-namespace").attr("data",b)},$(a).find("#emailcount"))},error:function(c){console.log(c)}})},get_subscription_from_db:function(a,b){console.log("in accountstats object");console.log(b);$.ajax({url:"core/api/admin_panel/get_subscription?d="+b,type:"GET",success:function(c){if(c&&c.status&&$.inArray(c.status,PAGEBLOCK_REASON)!=-1){$(a).find(".unblock_user").closest("div").show();$(a).find(".unblock_user").attr("domain",b)}},error:function(c){console.log(c)}})},get_customerobject_for_domain_from_adminpanel:function(a,c){var b=this;$.ajax({url:"core/api/admin_panel/getcustomer?d="+c,type:"GET",success:function(d){getTemplate("plan-info",d,undefined,function(e){if(!e){return}$(a).find("#planinfo").html($(e));if(d==null||d==""||d==undefined){$("#login_id").attr("href","https://"+c+".agilecrm.com/login")}else{b.get_collection_of_charges_for_customer_from_adminpanel(a,d.id)}},$(a).find("#planinfo"))}})},get_collection_of_invoices_for_domain_from_adminpanel:function(a,b){this.invoicecollection=new Base_Collection_View({url:"core/api/admin_panel/getinvoices?d="+b,templateKey:"admin-invoice",individual_tag_name:"tr"});this.invoicecollection.collection.fetch();$(".past-invoicecollection",a).html(this.invoicecollection.render().el)},get_collection_of_charges_for_customer_from_adminpanel:function(b,a){this.chargecollection=new Base_Collection_View({url:"core/api/admin_panel/getcharges?d="+a,templateKey:"admin-charge",individual_tag_name:"tr",sortKey:"createdtime",descending:true});this.chargecollection.collection.fetch();$(".past-chargecollection",b).html(this.chargecollection.render().el)},getDomainUserDetails:function(c){$("#content").html("<div id='admin-panel-listners'>&nbsp;</div>");var a=this;var b;this.usersListViewCollection=new Base_Collection_View({url:"core/api/admin_panel/getParticularDomainUsers?d="+c,templateKey:"all-domain",individual_tag_name:"tr",postRenderCallback:function(e){agileTimeAgoWithLngConversion($(".last-login-time",e));var d=a.usersListViewCollection.collection.models;b=d[0].get("domain");email=d[0].get("email");a.get_customerobject_for_domain_from_adminpanel(e,b);$("#account").html("<img src='"+updateImageS3Path("img/21-0.gif")+"'>");a.get_account_stats_for_domain_from_adminpanel(e,b);a.get_subscription_from_db(e,b);initializeAdminpanelListner(e)},});this.usersListViewCollection.collection.fetch();$("#admin-panel-listners").html(this.usersListViewCollection.el)},changePasswordadmin:function(a){getTemplate("settings",{},undefined,function(b){if(!b){return}$("#content").html($(b));getTemplate("settings-change-password-adminpanel",{},undefined,function(c){$("#content").html($(c));$("#saveNewPasswordFromAdmin").on("click",function(h){h.preventDefault();var g=$(this);if($(g).attr("disabled")){return}disable_save_button($(g));var d=$(this).closest("form").attr("id");if(!isValidForm("#"+d)){enable_save_button($(g));return false}$("#changePasswordForm").find("span.save-status").html(getRandomLoadingImg());var f=serializeForm(d);$.ajax({url:"/core/api/admin_panel/changepassword/"+a,type:"PUT",data:f,success:function(){add_password_change_info_as_note_to_owner(email);Backbone.history.navigate("all-domain-users",{trigger:true});showNotyPopUp("information",_agile_get_translated_val("others","pwd-change-success"),"top")},error:function(e){$("#changePasswordForm").find("span.save-status").html("");$("#changePasswordForm").find('input[name="current_pswd"]').closest(".controls").append("<span style='color:red;margin-left:10px;'>"+_agile_get_translated_val("others","pwd-in-correct")+"</span>");$("#changePasswordForm").find('input[name="current_pswd"]').closest(".controls").find("span").fadeOut(5000);$("#changePasswordForm").find('input[name="current_pswd"]').focus();enable_save_button($(g))}})})})},"#content")},allDomainUsers:function(){allDomainUsersCollectionView=new Base_Collection_View({url:"core/api/admin_panel/getAllDomainUsers",templateKey:"all-domain-users",individual_tag_name:"tr",cursor:true,page_size:25,postRenderCallback:function(a){initializeAdminpanelListner(a)}});allDomainUsersCollectionView.collection.fetch();$("#content").html(allDomainUsersCollectionView.el)},domainSubscribeDetails:function(b){$("#content").html("<div id='subscribe_plan_change'></div>");var a=new Base_Model_View({url:"core/api/admin_panel/subscriptionofparticulardomain?d="+b,template:"all-domain-admin-subscribe-new",window:"domainSubscribe",postRenderCallback:function(c){var d=a.model.toJSON();initializeSubscriptionListeners(c);set_up_account_stats(c);if(!$.isEmptyObject(d)){USER_BILLING_PREFS=d;USER_CREDIRCARD_DETAILS=a.model.toJSON().billingData;console.log(USER_CREDIRCARD_DETAILS);element=setPriceTemplete(d.plan.plan_type,c)}else{element=setPriceTemplete("free",c)}b=(b&&b=="coupon")?b:"";showCouponCodeContainer(b);$("#user_quantity",c).prop("value",d.plan.quantity);price=update_price();$("#users_quantity",c).text(d.plan.quantity);$("#users_total_cost",c).text((d.plan.quantity*price).toFixed(2));head.load(CSS_PATH+"css/misc/agile-plan-upgrade.css",LIB_PATH+"lib/jquery.slider.min.js",function(){if($.isEmptyObject(d)){setPlan("free")}else{setPlan(d)}})}});$("#subscribe_plan_change").html(a.render().el)},purchasePlanFromAdminpanel:function(){var b=this;var c=plan_json;var a=new Base_Model_View({url:"core/api/admin_panel/upgradesubscription",template:"admin-purchase-plan",isNew:true,data:c,postRenderCallback:function(d){showCouponDiscountAmount(plan_json,d);card_expiry(d);head.js(LIB_PATH+"lib/countries.js",function(){print_country($("#country",d))})},saveCallback:function(d){b.navigate("domainSubscribe/"+c.domain_name,{trigger:true});add_plan_change_info_as_note_to_owner(email,c.plan_type,c.plan_id,c.quantity);showNotyPopUp("information",_agile_get_translated_val("billing","upgrade-noty"),"top")}});$("#content").html(a.render().el);$(".active").removeClass("active")},domainSearch:function(){$("#content").html("<div id='domain-search-listners'></div>");
getTemplate("all-domain-search",{},undefined,function(a){if(!a){return}$("#domain-search-listners").html($(a));initializeDomainsearchListner();hideTransitionBar()},"#domain-search-listners")}});var Handlebars_Compiled_Templates={};function getTemplate(k,e,c,j,b){var d=j&&typeof(j)=="function";if(Handlebars_Compiled_Templates[k]){if(j){return j(Handlebars_Compiled_Templates[k](e))}else{return Handlebars_Compiled_Templates[k](e)}}else{Handlebars_Compiled_Templates={}}if(HANDLEBARS_PRECOMPILATION){var i=Handlebars.templates[k+"-template"];if(i){if(d){j(i(e));return}return i(e)}}else{var a=$("#"+k+"-template").html();if(a){var i=Handlebars.compile(a);Handlebars_Compiled_Templates[k]=i;if(d){j(i(e));return}return i(e)}}if(c=="no"){console.log("Not found "+k);return}if(b){try{var h=$(getRandomLoadingImg());$(b).html(h.css("margin","10px"))}catch(g){}}var f=getTemplateUrls(k);if(d){load_templates_async(k,e,f,j);return}load_templates_sync(f);return getTemplate(k,e,"no")}function agile_is_mobile_browser(){return(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))}function createCookie(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+escape(d)+a+"; path=/"}function createCookieInAllAgileSubdomains(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+escape(d)+a+"; path=/; domain=agilecrm.com"}function readCookie(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return unescape(f.substring(e.length,f.length))}}return null}function eraseCookie(a){createCookie(a,"",-1)}function _agile_get_translated_val(b,a){if(typeof _Agile_Resources_Json==="undefined"){_Agile_Resources_Json={}}if(!a){return _Agile_Resources_Json[b]}if(!_Agile_Resources_Json[b]){return""}return _Agile_Resources_Json[b][a]}(function(){try{var a=Handlebars.templates["agile-localization-template"]({});$("body").append('<script type="text/javascript">'+a+"<\/script>")}catch(b){}})();