function onloadProfileImg(){$("#add_twitter_stream").show();getTemplate("twitter-stream-type",{},undefined,function(a){if(!a){return}$("#streamDetails").html($(a));$("#twitter_profile_img").attr("src",document.getElementById("twitter_profile_img_url").src);document.getElementById("account_description_label").innerHTML="<b>"+$("#twitter_account").val()+"</b>"},"#streamDetails")}function socialsuite_add_website(){if(Tweet_Owner_For_Add_Contact!=null){$("#website",$("#continueform")).attr("value",Tweet_Owner_For_Add_Contact);$("div.website select").val("TWITTER");Tweet_Owner_For_Add_Contact=null}}function changeProperty(){try{var f=$("#network_handle",$("#personModal")).css("display");var a=$("#pic",$("#personModal")).css("display");var b=$("#pic",$("#personModal")).html();var d=$("#network_handle");var g=$("#handle");if((a=="inline"||a=="block")&&b!=""){if(f=="none"){d.removeAttr("class").addClass("after-img-load-hide")}else{if(f=="block"){d.removeAttr("class").addClass("after-img-load-show")}}g.removeAttr("class").addClass("add-form-input")}else{if((a=="none"||a==null||a=="")||(b==null||b=="")){if(f=="none"){d.removeAttr("class").addClass("network-handle")}else{if(f=="block"){d.removeAttr("class").addClass("socialsuite-network-handle")}}g.removeAttr("class")}}}catch(c){}}SOCIAL_SUITE_CONTACT={};$(function(){$("body").on("click",".add-twitter-contact",function(f){var a=($(this).closest("article").attr("stream-id"));var h=($(this).closest("article").attr("id"));SOCIAL_SUITE_CONTACT.streamId=a;SOCIAL_SUITE_CONTACT.tweetId=h;var l=Streams_List_View.collection.get(a);var g=l.get("tweetListView").get(h).toJSON();var c=g.user.name;var i=g.user.description;Tweet_Owner_For_Add_Contact=g.user.screen_name;var j=c.substr(0,c.indexOf(" "));var k=c.substr(c.indexOf(" ")+1);$("#fname",$("#personModal")).val(j);$("#lname",$("#personModal")).val(k);$("#job_title",$("#personModal")).attr("value",i);$("#network_handle").addClass("socialsuite-network-handle");$("#handle",$("#personModal")).attr("value",Tweet_Owner_For_Add_Contact);$("#website",$("#personModal")).attr("value",Tweet_Owner_For_Add_Contact);$("#image",$("#personModal")).attr("value",g.user.profile_image_url);$("div.website select").val("TWITTER");var d=g.user.profile_image_url;if(d!=undefined&&d!=null){var b=$('<img class="imgholder thumbnail person-img" onload="changeProperty()" style="display: inline;"  src="'+d+'"></img>');$("#pic").html(b).show();$("img").error(function(){$("#pic").css("display","none")})}changeProperty()});$("#personModal").on("hidden.bs.modal",function(){$("#network_handle").addClass("network-handle");$("#handle").addClass("");$("#pic").css("display","none");$("#pic").empty();changeProperty()});$("#personModal").on("shown.bs.modal",function(f){changeProperty();var a=SOCIAL_SUITE_CONTACT.streamId;var h=SOCIAL_SUITE_CONTACT.tweetId;var l=Streams_List_View.collection.get(a);var g=l.get("tweetListView").get(h).toJSON();var c=g.user.name;var j=g.user.description;var m=g.user.screen_name;var m="@"+m;var i;var k;if(!c.includes(" ")){i=c.substr(0)}else{i=c.substr(0,c.indexOf(" "));k=c.substr(c.indexOf(" ")+1)}$("#fname",$("#personModal")).val(i);$("#lname",$("#personModal")).val(k);$("#job_title",$("#personModal")).attr("value",j);$("#network_handle").addClass("socialsuite-network-handle");$("#handle",$("#personModal")).attr("value",m);$("#website",$("#personModal")).attr("value",m);$("#image",$("#personModal")).attr("value",g.user.profile_image_url);$("div.website-select").val("TWITTER");var d=g.user.profile_image_url;if(d!=undefined&&d!=null){var b=$('<img class="imgholder thumbnail person-img" onload="changeProperty()" style="display: inline;"  src="'+d+'"></img>');$("#pic").html(b).hide();$("#handle").val(m).hide();$("#img").error(function(){$("#pic").css("display","none")})}});$("#pic").change(function(){changeProperty()})});function isNewUnreadTweet(b){var a=null;if(b.id=="000"||b.type=="ACK"){console.log("got 000")}else{b.isNew="true"}a=Streams_List_View.collection.get(b.stream_id);rebuildTweet(a,b)}function rebuildTweet(a,c){$("#stream-spinner-modal-"+c.stream_id).hide();if(c.text=="There is no tweets to show here."||c.text=="Dear you do not have any tweets."){c.msg_type="NoTweet";c.show=true;c.text="No Tweets to show here."}else{if(c.type=="ACK"){c.msg_type="ACK";c.text="ACK"}else{if(c.text==null||c.user==null){return}c.msg_type="Tweet";if(a.get("tweetListView").length==2){clearNoTweetNotification(a)}if(a.get("screen_name")!=c.user.screen_name){c.tweetowner_not_streamuser=true}if(c.stream_type=="Sent"||a.get("screen_name")==c.user.screen_name){c.deletable_tweet=true}if(c.stream_type=="DM_Inbox"||c.stream_type=="DM_Outbox"){c.direct_message=true;c.deletable_tweet=true}var b=a.get("screen_name")+" retweeted";if(c.retweeted==b){c.retweeted_by_user=true}c.original_text=c.text;c.text=convertTextToTweet(c)}}if(Scroll_Down_Call==true){checkPastTweetAdd(c,a);return}if(c.type=="ACK"){Register_Counter++;registerAll(Register_Counter)}addTweetToStream(c,a)}function addTweetToStream(b,a){a.get("tweetListView").comparator=function(c){if(c.get("id")){return -c.get("id")}};a.get("tweetListView").add(b);a.get("tweetListView").sort();($(".chirp-container"))}function mergeNewUnreadTweets(b){var c=Streams_List_View.collection.get(b);var a=c.get("tweetListView").where({isNew:"true"});$.each(a,function(e,d){d.unset("isNew")});displayTimeAgo($(".chirp-container"));removeWaiting()}function removeWaiting(){var a=Streams_List_View.collection.toJSON();if(a==null){return}$.each(a,function(c,d){var b=Streams_List_View.collection.get(d.id);if(b!=null||b!=undefined){if(b.get("tweetListView").length>=1){$("#stream-spinner-modal-"+d.id).hide()}}})}function isTimeInPast(){var h=document.getElementById("scheduled_date").value;var g=document.getElementById("scheduled_time").value;var j=new Date().format("mm/dd/yyyy");var a=new Date();var f=(a.getMinutes()<10?"0":"")+a.getMinutes();a=a.getHours()+":"+f;var b=(g).split(":");var c=new Date(h);var k=c.setHours(b[0],b[1])/1000;var l=(a).split(":");var e=new Date(j);var d=e.setHours(l[0],l[1])/1000;if(k>d){var b=(g).split(":");var c=new Date(h);c=c.setHours(b[0],b[1])/1000;document.getElementById("schedule").value=c;var i=new Date(c*1000);$("#send_tweet").removeAttr("disabled");Schedule_In_Future=true;$("#twit-tweet").keypress()}else{showAlertModal("future_date",undefined,function(){$("#send_tweet").attr("disabled","disable");Schedule_In_Future=false})}}function checkScheduledUpdates(){$.getJSON("/core/scheduledupdate/getscheduledupdatescount",function(a){if(a>0){$("#show_scheduled_updates").show()}}).error(function(a,c,b){$("#show_scheduled_updates").hide();console.log("Error occured in scheduled updates search.")})}function scheduledmessagesEdit(b){$("#socialsuite_twitter_messageModal").remove();var a=Scheduled_Updates_View.collection.get(b);Scheduled_Edit=true;Message_Model=new Base_Model_View({url:"/core/scheduledupdate",model:a,template:"socialsuite-twitter-message",modal:"#socialsuite_twitter_messageModal",window:"scheduledmessages",postRenderCallback:function(c){$(".modal-backdrop").remove();if(!a.hasChanged()){$("#socialsuite_twitter_messageModal",c).on("shown.bs.modal",function(){$("#tweet_scheduling",c).click();$("input.date",$("#schedule_controls")).val((new Date(a.toJSON().scheduled_date*1000)).toLocaleDateString());$("#send_tweet").removeAttr("disabled")});$("#socialsuite_twitter_messageModal",c).modal("show")}},saveCallback:function(c){$("#socialsuite_twitter_messageModal").modal("hide");$("#socialsuite_twitter_messageModal").remove();$(".modal-backdrop").remove();Scheduled_Edit=false;c.checkbox=true;a.set(c);displayTimeAgo($(".is-actionable"))}});$("#schedule-edit-modal").html(Message_Model.render().el)}$(function(){$("body").on("click","#tweet_scheduling",function(a){if($("#schedule_controls").css("display")=="block"&&Scheduled_Edit){return}$("#schedule_controls").toggle();if($("#schedule_controls").css("display")=="block"){document.getElementById("send_tweet").innerHTML="Schedule";$("#send_tweet").attr("disabled","disable");this.className="tweet-scheduling tweet-scheduling-active";$("input.date").val(getDateInFormat(new Date()));$("#scheduled_date").datepicker({startDate:"today",autoclose:true,todayHighlight:true,format:CURRENT_USER_PREFS.dateFormat}).on("changeDate",function(b){console.log(new Date(b.date));isTimeInPast()});$("#scheduled_time").timepicker({showMeridian:false,defaultTime:"current"}).on("changeTime.timepicker",function(b){console.log(b.time.value);isTimeInPast()});Previous_URL=Message_Model.model.url;Message_Model.model.url="/core/scheduledupdate"}else{if(Scheduled_Edit){return}this.className="tweet-scheduling";$("#scheduled_time").attr("value","");Message_Model.model.url=Previous_URL;document.getElementById("send_tweet").innerHTML="Send";$("#send_tweet").removeAttr("disabled");Schedule_In_Future=false;$("#twit-tweet").keypress()}});$("body").on("click",".edit-scheduled-update",function(b){var a=$(this).closest("tr").find(".data").attr("data");scheduledmessagesEdit(a)})});Handlebars.registerHelper("get_stream_name",function(b){var a={Home:"Home",Retweets:"Retweets",DM_Inbox:"DM Inbox",DM_Outbox:"DM Outbox",Favorites:"Favorites",Sent:"Sent",Search:"Search",Scheduled:"Scheduled",All_Updates:"All Updates",My_Updates:"My Updates",Mentions:"Mentions",};if(!b){return}b=b.trim();if(a[b]){return a[b]}});Handlebars.registerHelper("get_stream_icon",function(b){if(!b){return}var a={Home:"icon-home",Retweets:"icon-retweet",DM_Inbox:"icon-download-alt",DM_Outbox:"icon-upload-alt",Favorites:"icon-star",Sent:"icon-share-alt",Search:"icon-search",Scheduled:"icon-time",All_Updates:"icon-home",My_Updates:"icon-share-alt"};b=b.trim();if(a[b]){return a[b]}return"icon-globe"});function fillStreamDetail(){Network_Type=null;Stream_Type=null;$("#twitter_account",$("#addStreamModal")).attr("value","");$("#stream_type",$("#addStreamModal")).attr("value","");$(".remove-keyword").remove();$("#domain_user_id",$("#addStreamModal")).attr("value",CURRENT_DOMAIN_USER.id);
$("#client_channel",$("#addStreamModal")).attr("value",CURRENT_DOMAIN_USER.id+"_Channel");$("#add_twitter_stream").hide();$("#stream_description_label").removeAttr("class").attr("class","description-hidden txt-mute");$("#twitter_profile_img_url").attr("src","")}function registerAll(b){var c=Streams_List_View.collection.toJSON();if(c==null||Register_All_Done==true||Pubnub==null||(Register_Counter!=null&&b==0)){console.log("Register_All_Done : "+Register_All_Done);return}var d=Streams_List_View.collection.at(b);if(d==null||d==undefined){return}if(b==0&&Register_Counter==null){Register_Counter=0;if(Add_Img_Done==false){addUserImgToColumn()}}var a={message_type:"register",stream:d};sendMessage(a);if(Register_Counter==(Streams_List_View.collection.length-1)){Register_All_Done=true}}function unregisterAll(){if(!Streams_List_View){return}if(Streams_List_View==undefined||Pubnub==null){return}var a={message_type:"unregister_all",client_channel:CURRENT_DOMAIN_USER.id+"_Channel"};sendMessage(a);Register_All_Done=false;Register_Counter=null;Add_Img_Done=false;Streams_List_View=undefined}function addUserImgToColumn(){var a=Streams_List_View.collection.toJSON();$.each(a,function(c,d){var b=Streams_List_View.collection.get(d.id);$.get("/core/social/getprofileimg/"+d.id,function(e){b.set("profile_img_url",e);socialsuitecall.streams(b)})});Add_Img_Done=true}function registerStreamAgain(b){var c=Streams_List_View.collection.get(b).toJSON();var a={message_type:"register",stream:c};sendMessage(a);$("#stream-spinner-modal-"+b).show()}function showNotification(b){if(b){updateNotification(b)}else{var a=Streams_List_View.collection.toJSON();if(a==null){return}$.each(a,function(c,d){updateNotification(d)})}$(".deleted").remove()}function updateNotification(c){var a=Streams_List_View.collection.get(c.id);var b=a.get("tweetListView").where({isNew:"true"});if(b.length==0&&a.get("tweetListView").length>=1){clearNoTweetNotification(Streams_List_View.collection.get(c.id));return}else{if(b.length==1){document.getElementById("stream_notifications_"+c.id).innerHTML='<p class="bg-info">'+b.length+" new Tweet </p>"}else{if(b.length>1){document.getElementById("stream_notifications_"+c.id).innerHTML='<p class="bg-info">'+b.length+" new Tweets </p>"}}}$("#stream_notifications_"+c.id).attr("rel","add-new-tweet")}function clearNoTweetNotification(a){var b=a.get("tweetListView").get("000");if(b!=null||b!=undefined){b.set("show",false);a.get("tweetListView").add(b)}}function displayErrorInStream(b){var c=null;if(b.id=="001"){c=b.stream_id}else{c=b.id}$("#stream-spinner-modal-"+c).hide();var a=Streams_List_View.collection.get(c);if(a.get("tweetListView").length==0){document.getElementById("stream_notifications_"+c).innerHTML='<p>Request rate limit exceeded, Retry after some time. <i class="icon icon-refresh" title="Retry again."></i></p>';$("#stream_notifications_"+c).attr("rel","retry")}}function OnScrollDiv(elementDiv){if(($(elementDiv).scrollTop()+$(elementDiv).innerHeight()>=$(elementDiv)[0].scrollHeight)&&($(elementDiv).attr("data")=="0")){$(elementDiv).attr("data","1");var streamId=($(elementDiv).closest("li").attr("id"));var modelStream=Streams_List_View.collection.get(streamId);if(modelStream==undefined||modelStream==null){return}var stream=modelStream.toJSON();var modelTweet=modelStream.get("tweetListView").at(modelStream.get("tweetListView").length-2);var tweet=modelTweet.toJSON();var currMsg=$("#"+tweet.id);var curOffset=currMsg.offset().top-$(elementDiv).scrollTop();$(elementDiv).append('<span id="stream-waiting-modal-'+streamId+'" class="social-loader-icon text-center"><img class="thumb-tiny" src="'+updateImageS3Path("img/ajax-spinner.gif")+'"></span>');$.getJSON("/core/social/pasttweets/"+stream.id+"/"+tweet.id+"/"+tweet.id_str,function(data){if(data==null){showNotyPopUp("information","No more updates available for stream "+stream.stream_type+" of "+stream.screen_name,"top",5000);$("#stream-waiting-modal-"+streamId).remove();$(elementDiv).attr("data","1");$(elementDiv).append('<span id="past-tweet-end-'+streamId+'" class="text-light p-t-sm p-b-sm  block text-center"><i class="icon icon-twitter icon-2x m-r-xs"></i><i class="icon icon-long-arrow-up icon-2x"></i></span>');return}if(data.length==0){showNotyPopUp("information","No more updates available for stream "+stream.stream_type+" of "+stream.screen_name,"top",5000);$("#stream-waiting-modal-"+streamId).remove();$(elementDiv).attr("data","1");$(elementDiv).append('<span id="past-tweet-end-'+streamId+'" class="text-light p-t-sm p-b-sm  block text-center"><i class="icon icon-twitter icon-2x m-r-xs"><i class="icon icon-long-arrow-up icon-2x"></i></i></span>');return}var i;var myObject;Scroll_Down_Call=true;for(i=0;i<data.length;i++){myObject=eval("("+data[i]+")");handleMessage(myObject);if(i+1==data.length){Scroll_Down_Call=false}}if(Scroll_Down_Call==false&&Past_Tweets_Count!=0&&Past_Tweets.length!=0){addPastTweetsToStream(modelStream)}var scrollOnDiv=$("#"+streamId).find("#Column-model-list");scrollOnDiv.scrollTop((currMsg.offset().top-curOffset)+650);$("#stream-waiting-modal-"+streamId).remove();$(elementDiv).attr("data","0")}).error(function(data){$("#stream-waiting-modal-"+streamId).remove();$(elementDiv).attr("data","0");var result=data.responseText;if(data.responseText==""){showNotyPopUp("information","No more updates available for stream "+stream.stream_type+" of "+stream.screen_name,"top",7000)}else{if(result.indexOf("rate")!=-1){showNotyPopUp("information","Request rate limit exceeded, Retry after some time.","top",5000)}else{if(result.indexOf("Could not fetch URL")!=-1){showNotyPopUp("information","Please, check your internet connection.","top",5000)}else{showNotyPopUp("information",data.responseText,"top",5000)}}}})}$(".deleted").remove()}function checkPastTweetAdd(b,a){if(Past_Tweets_Count<5){Past_Tweets[Past_Tweets_Count]=b;Past_Tweets_Count++}else{if(Past_Tweets_Count==5){addPastTweetsToStream(a)}}}function addPastTweetsToStream(a){if(Past_Tweets.length==0){return}addTweetToStream(Past_Tweets,a);Past_Tweets_Count=0;Past_Tweets=[]}$(function(){Stream_Type=null;Network_Type=null;Register_All_Done=false;Tweet_Owner_For_Add_Contact=null;Focused=true;Scheduled_Edit=false;Register_Counter=null;Add_Img_Done=false;Previous_URL=null;Schedule_In_Future=false;Scroll_Down_Call=false;Past_Tweets_Count=0});window.onfocus=function(){Focused=true};window.onblur=function(){Focused=false};window.onbeforeunload=unregisterAll;function initializeSocialSuite(){$(window).unload(function(){unregisterAll()});$("a").click(function(a){var b=$(this).attr("href");if(b=="/login"){unregisterAll()}});$("body").on("click",".add-stream",function(a){head.js("js/designer/ui.js",function(){});$("#streamDetail").each(function(){this.reset()});$("#addStreamModal").html(getTemplate("add-stream-modal"));$("#addStreamModal").modal("show");getTemplate("socialsuite-social-network",{},undefined,function(b){if(!b){return}$("#streamDetails").html($(b));fillStreamDetail()},"#streamDetails")});$("body").on("click",".network-type",function(a){if(this.id=="twitter_option"){openTwitter();Network_Type="TWITTER"}$("#network_type",$("#addStreamModal")).attr("value",Network_Type)});$("body").on("click",".stream-type",function(a){a.preventDefault();if(this.className=="stream-type stream-type-button-color"){$(".remove-keyword").remove();$(".stream-type").removeClass("stream-type-button-color");this.className="stream-type";Stream_Type=null;$("#stream_type",$("#addStreamModal")).attr("value","")}else{$(".stream-type").removeClass("stream-type-button-color");this.className="stream-type stream-type-button-color";Stream_Type=$(this).attr("value").trim();$("#stream_type",$("#addStreamModal")).attr("value",Stream_Type);if(Stream_Type=="Search"){$("#search_stream_keyword").html('<div class="remove-keyword"><div class="row"><div class="control-group col-md-5"><span class="controls"><input id="keyword" name="keyword" type="text" class="required form-control" required="required" autocapitalize="off" placeholder="Search Keyword..." value="" autofocus></span></div></div></div>')}else{$(".remove-keyword").remove()}}$(this).css("background-color","")});$(document).on("mouseover",".stream-type",function(b){$("#stream_description_label").addClass("txt-mute");mouseoverStream=$(this).attr("value");var a=$(this).css("background-color");if(a!="rgb(187, 187, 187)"){$(this).css("background-color","#EDEDED")}getTemplate("socialsuite-hover-helptext",{item:mouseoverStream},undefined,function(c){if(!c){return}$("#stream_description_label").removeClass("description-hidden");$("#stream_description_label").html(c)},null)});$(document).on("mouseout",".stream-type",function(a){$(this).css("background-color","");$("#stream_description_label").addClass("description-hidden txt-mute")});$("body").on("click",".save-twitter-stream",function(c){if($("#addStreamModal").find("#add_twitter_stream").attr("disabled")){return}if($("#twitter_account").val()==null||$("#twitter_account").val()==""){showAlertModal("social_access",undefined,function(){$("#add-stream").click()});return}if(Stream_Type==null||Stream_Type==""){$("#stream_description_label").addClass("txt-mute").html('<span style="color: red;"><i class="icon-exclamation"></i> You have to select your favorite stream type.</span>');return}if(!isValidForm("#streamDetail")){$("#streamDetail").find("input").focus();return false}$("#addStreamModal").find("#add_twitter_stream").attr("disabled","disabled");showNotyPopUp("information","Adding Stream...","top",2500);var b=jQuery(streamDetail).serializeArray();var a={};jQuery.each(b,function(){a[this.name]=this.value||""});a.column_index=Streams_List_View.collection.length+1;var d=new Backbone.Model();d.url="/core/social";d.save(a,{success:function(f){socialsuitecall.streams(f);$("html, body").animate({scrollTop:$(document).height()-$(window).height()});var e={message_type:"register",stream:f.toJSON()};sendMessage(e);showNotyPopUp("information","Stream added. You can add another Stream now.","top",4000);
setTimeout(function(){var g=$("#addStreamModal").find("div[value='"+Stream_Type+"']").attr("id");$("#"+g).click();$("#addStreamModal").find("#add_twitter_stream").removeAttr("disabled");Stream_Type=""},4000);addTagAgile(SOCIAL_TAG)},error:function(e){console.log(e)}})});$("body").on("click",".stream-delete",function(a){var b=$(this).attr("id");showAlertModal("delete_stream","confirm",function(){var d=Streams_List_View.collection.get(b).toJSON();delete d.tweetListView;var c={message_type:"unregister",stream:d};sendMessage(c);$.ajax({type:"DELETE",url:"/core/social/"+b,contentType:"application/json; charset=utf-8",success:function(e){Streams_List_View.collection.remove(b);Streams_List_View.render(true).el},dataType:"json"})})});$("body").on("click",".action-notify",function(c){var a=$(this).attr("rel");var b=$(this).attr("data");$("#"+this.id).html("");if(a=="add-new-tweet"){mergeNewUnreadTweets(b)}else{if(a=="retry"){registerStreamAgain(b)}}$(this).attr("rel","");$(".deleted").remove()})}function performTweetAction(a,g,d,c){var h=Streams_List_View.collection.get(a);if(g){var b=h.get("tweetListView").get(g);var e=b.toJSON();var f=e.id_str}var i=null;switch(c){case"favorite":i="/core/social/favorite/"+a+"/"+f;break;case"undofavorite":i="/core/social/undofavorite/"+a+"/"+f;break;case"followuser":i="/core/social/followuser/"+a+"/"+d;break;case"unfollowuser":i="/core/social/unfollowuser/"+a+"/"+d;break;case"blockuser":i="/core/social/blockuser/"+a+"/"+d;break;case"unblockuser":i="/core/social/unblockuser/"+a+"/"+d;break}requestAction(i,c,h,b,d)}function requestAction(d,b,a,c,e){$.get(d,function(f){if(f=="Unsuccessful"||f=="false"){showNotyPopUp("information","Retry after sometime.","top",5000);return}reflectActionOnTweet(f,b,a,c,e);displayTimeAgo($(".chirp-container"))}).error(function(f){displayError(null,f)})}function reflectActionOnTweet(d,b,a,c,f){if(c){var e=c.toJSON()}switch(b){case"favorite":c.set("favorited_by_user","true");a.get("tweetListView").add(c);break;case"undofavorite":c.unset("favorited_by_user");a.get("tweetListView").add(c);break;case"followuser":if(d=="true"){showNotyPopUp("information","Now you are following @"+f,"top",5000)}break;case"unfollowuser":if(d=="Unfollowed"){showNotyPopUp("information","Now you are not following @"+f,"top",5000)}break;case"blockuser":if(d=="true"){showNotyPopUp("information","You just blocked @"+f,"top",5000)}break;case"unblockuser":if(d=="Unblock"){showNotyPopUp("information","You just unblock @"+f,"top",5000)}break}}function displayError(c,b){$("#spinner-modal").hide();if(c!=null){$("#"+c).modal("hide")}var a=b.responseText;if(a.trim()=="Status is a duplicate."){showNotyPopUp("information","Whoops! You already tweeted that...","top",5000)}else{if(a.trim()=="Sorry, that page does not exist"){showNotyPopUp("information","Sorry, that tweet does not exist.","top",5000)}else{showNotyPopUp("information","Retry after sometime.","top",5000)}}console.log(b.responseText)}$(function(){$("body").on("click",".favorite-status",function(c){var b=($(this).closest("article").attr("stream-id"));var a=($(this).closest("article").attr("id"));performTweetAction(b,a,null,"favorite")});$("body").on("click",".undo-favorite-status",function(c){var b=($(this).closest("article").attr("stream-id"));var a=($(this).closest("article").attr("id"));performTweetAction(b,a,null,"undofavorite")});$("body").on("click",".more-options",function(f){var a=($(this).closest("article").attr("stream-id"));var i=($(this).closest("article").attr("id"));var d=$(this).attr("id");var k=Streams_List_View.collection.get(a);var b=k.get("tweetListView").get(i);var g=b.toJSON();var h=g.id_str;var c=g.user.screen_name;var j=k.toJSON();$(".list-clear").remove();$(".more-options-list").toggle(false);$("#"+d+"_list",$("#"+a)).toggle("slow");if(j.screen_name==c){return}$.get("/core/social/checkrelationship/"+a+"/"+c,function(e){if(e.follow=="true"){$("#"+d+"_list",$("#"+a)).append('<li class="list-clear"><a href="#social" class="unfollow-user" tweet-owner='+c+">Unfollow @"+c+"</a></li>")}else{if(e.follow=="false"){$("#"+d+"_list",$("#"+a)).append('<li class="list-clear"><a href="#social" class="follow-user" tweet-owner='+c+">Follow @"+c+"</a></li>")}}if(e.follower=="true"){$("#"+d+"_list",$("#"+a)).append('<li class="list-clear"><a href="#social" class="direct-message">Send Direct Message</a></li>')}if(e.blocked=="true"){$("#"+d+"_list",$("#"+a)).append('<li class="list-clear"><a href="#social" class="unblock-user" tweet-owner='+c+">Unblock @"+c+"</a></li>")}else{if(e.blocked=="false"){$("#"+d+"_list",$("#"+a)).append('<li class="list-clear"><a href="#social" class="block-user" tweet-owner='+c+">Block @"+c+"</a></li>")}}}).error(function(e){displayError(null,e)})});$("body").on("click",".follow-user",function(b){var a=($(this).closest("article").attr("stream-id"));var c=$(this).attr("tweet-owner");performTweetAction(a,null,c,"followuser")});$("body").on("click",".unfollow-user",function(b){var a=($(this).closest("article").attr("stream-id"));var c=$(this).attr("tweet-owner");performTweetAction(a,null,c,"unfollowuser")});$("body").on("click",".block-user",function(b){var a=($(this).closest("article").attr("stream-id"));var c=$(this).attr("tweet-owner");performTweetAction(a,null,c,"blockuser")});$("body").on("click",".unblock-user",function(b){var a=($(this).closest("article").attr("stream-id"));var c=$(this).attr("tweet-owner");performTweetAction(a,null,c,"unblockuser")});$("body").on("click",".delete-tweet",function(b){var a=$(this);showAlertModal("delete_tweet","confirm",function(){var g=(a.closest("article").attr("stream-id"));var f=(a.closest("article").attr("id"));var c=Streams_List_View.collection.get(g);var e=c.get("tweetListView").get(f);var h=e.toJSON();var d=h.id_str;var i=h.user.screen_name;$.get("/core/social/deletetweet/"+g+"/"+i+"/"+d,function(j){if(j=="Successful"){e.set("deleted_msg","deleted");c.get("tweetListView").add(e);showNotyPopUp("information","Your tweet has been deleted.","top",5000);$(".deleted").remove()}else{if(j=="Unsuccessful"){showNotyPopUp("information","Retry after sometime.","top",5000)}}}).error(function(j){displayError(null,j)})})});$("body").on("click",".show-retweet",function(g){$(".more-options-list").toggle(false);var f=($(this).closest("article").attr("stream-id"));var d=($(this).closest("article").attr("id"));var a=Streams_List_View.collection.get(f);var c=a.get("tweetListView").get(d);var h=c.toJSON();delete h.id;displayModal("socialsuite_RT_userlistModal","socialsuite-RT-userlist",h,null,null,"/core/social/tweet/"+f);$("#spinner-modal").show();var b=new Base_Collection_View({url:function(){return"/core/social/getrtusers/"+f+"/"+h.id_str},restKey:"user",templateKey:"socialsuite-RT-userlist",individual_tag_name:"li",});b.collection.fetch({success:function(e){$("#spinner-modal").hide()},error:function(e){console.log("ON ERROR");console.log(e);var i={};i.responseText="Sorry, that page does not exist";displayError("socialsuite_RT_userlistModal",i)}});$("#RTuser_list").html(b.render(true).el);displayTimeAgo($("#socialsuite_RT_userlistModal"))})});function handleMessage(b){if(b["delete"]!=null){return}if(b.id=="001"){displayErrorInStream(b);return}var a=Streams_List_View.collection.get(b.stream_id);if(a!=undefined){if(Current_Route=="social"&&Focused==true){if($("#stream_notifications_"+b.stream_id).is(":empty")==false){isNewUnreadTweet(b);showNotification(a)}else{rebuildTweet(a,b)}}else{isNewUnreadTweet(b);if(Current_Route=="social"){showNotification(a)}}}$(".deleted").remove()}function convertTextToTweet(h){var d=new Array();var f=h.text;var e=new RegExp();var a;e=new RegExp("&amp;","g");f=f.replace(e,"&");d=f.split(/[\s,?&;.'":!)({}]+/);d=_.uniq(d);for(var c=0;c<d.length;c++){if(d[c].charAt(0)=="@"){e=new RegExp(d[c],"g");f=f.replace(e,"&lt;a href='https://twitter.com/"+d[c].substring(1)+"' target='_blank' class='cd_hyperlink'>"+d[c]+"&lt;/a>")}else{if(d[c].charAt(0)=="#"){e=new RegExp(d[c],"g");var b="https://twitter.com/search?q=%23"+d[c].substring(1)+"&src=hash";f=f.replace(e,"&lt;a href='"+b+"' target='_blank' class='cd_hyperlink'>"+d[c]+"&lt;/a>")}}}d=new Array();d=f.split(/\s/);var g="^(https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]";$.each(d,function(i,j){if(j.match(g)){f=f.replace(j,"&lt;a href='"+j+"' target='_blank' class='cd_hyperlink'>"+j+"&lt;/a>")}});e=new RegExp("&lt;","g");f=f.replace(e,"<");return f}function displayFilledModal(a,g,c,e){var d="/core/social/tweet/"+a;var j=Streams_List_View.collection.get(a);var h=j.toJSON();if(g!=null){var b=j.get("tweetListView").get(g);var f=b.toJSON()}var i={};i.streamId=a;i.profileImg=$("#"+a+"-profile-img").prop("src");i.domain_user_id=CURRENT_DOMAIN_USER.id;i.screen_name=h.screen_name;i.network_type="TWITTER";i.token=h.token;i.secret=h.secret;i.schedule="0";switch(e){case"Tweet":i.headline="Tweet";i.info="Status from "+h.screen_name;i.description="What's happening?";break;case"Reply Tweet":if(e=="Reply Tweet"&&c==null){i.headline="Reply Tweet";i.info="Reply @"+f.user.screen_name+" from "+h.screen_name;i.description="@"+f.user.screen_name;i.tweetId=f.id_str;i.tweetOwner=f.user.screen_name}else{if(e=="Reply Tweet"&&c!=null){i.headline="Reply Tweet";i.info="Reply @"+c+" from "+h.screen_name;i.description="@"+c;i.tweetOwner=c;i.tweetId=null}}break;case"Direct Message":i.headline="Direct Message";i.info="Direct message from "+h.screen_name+" to "+f.user.screen_name;i.description="Tip: you can send a message to anyone who follows you.";i.tweetId=f.id_str;i.tweetOwner=f.user.screen_name;break;case"Retweet":i.headline="Retweet";i.info="Status of @"+f.user.screen_name;i.description=f.original_text;i.tweetId=f.id;i.tweetOwner=f.user.screen_name;d="/core/social/retweet/"+a+"/"+f.id_str;break}console.log(i);displayModal("socialsuite_twitter_messageModal","socialsuite-twitter-message",i,"twitter-counter","twit-tweet",d);$("#twit-tweet").on("cross",function(){$("#send_tweet").attr("disabled","disable")});$("#twit-tweet").on("uncross",function(){if(!Schedule_In_Future&&$("#schedule_controls").css("display")=="block"){return
}$("#send_tweet").removeAttr("disabled")})}function displayModal(f,d,e,c,a,b){$("#"+f).remove();Schedule_In_Future=false;Message_Model=new Base_Model_View({data:e,url:b,template:d,modal:"#"+f,postRenderCallback:function(g){$(".modal-backdrop").remove();if(Message_Model.model.get("id")||Message_Model.model.get("response")=="Successful"){return}$("#"+f,g).modal("show")},saveCallback:function(g){displayNoty(g);$("#"+f).modal("hide");$("#"+f).remove()}});$("#content").append(Message_Model.render().el);if(c!=null&&a!=null){$("#"+f).on("shown",function(){head.js(LIB_PATH+"lib/bootstrap-limit.js",function(){$(".twit-tweet-limit").limit({maxChars:140,counter:"#"+c});$("#"+f).find("#"+a).focus()})})}}function displayNoty(a){if(a.response=="Successful"){if(Message_Model.model.get("headline")=="Tweet"){showNotyPopUp("information","Your Tweet was posted!","top",5000)}else{showNotyPopUp("information","Your Tweet to @"+Message_Model.model.get("tweetOwner")+" has been sent!","top",5000)}}else{if(a.response=="Unsuccessful"){$("#socialsuite_twitter_messageModal").find("span.save-status").html("Retry");showNotyPopUp("information","Retry after sometime.","top",5000)}else{if(Message_Model.model.get("headline")=="Retweet"&&a.response!=undefined){showEffectOfRT(a)}else{if(a.id!=undefined&&a.schedule!=undefined){$("#show_scheduled_updates").show()}}}}}function showEffectOfRT(c){var a=Streams_List_View.collection.get(Message_Model.model.get("streamId"));var b=a.get("tweetListView").get(Message_Model.model.get("tweetId"));if(a==undefined||b==undefined){return}b.set("retweeted_by_user","true");b.set("retweet_id",c.response);a.get("tweetListView").add(b);displayTimeAgo($(".chirp-container"))}$(function(){$("body").on("click",".compose-message",function(b){$(".more-options-list").toggle(false);$("#socialsuite_twitter_messageModal").remove();var a=$(this).attr("stream-id");displayFilledModal(a,null,null,"Tweet")});$("body").on("keyup",".twit-tweet-limit",function(b){var a;a=140-$(this).val().length;if(a<0){$("#twitter-counter").addClass("text-danger");$("#send_tweet").attr("disabled",true)}else{$("#twitter-counter").removeClass("text-danger");$("#send_tweet").attr("disabled",false)}$("#twitter-counter").text(a)});$("body").on("click",".reply-message",function(c){$(".more-options-list").toggle(false);$("#socialsuite_twitter_messageModal").remove();var b=($(this).closest("article").attr("stream-id"));var a=($(this).closest("article").attr("id"));displayFilledModal(b,a,null,"Reply Tweet")});$("body").on("click",".tweet-to-user",function(b){$("#socialsuite_RT_userlistModal").modal("hide");$("#socialsuite_twitter_messageModal").remove();$(".more-options-list").toggle(false);var a=($(this).closest("article").attr("stream-id"));var c=$(this).attr("tweet-owner");displayFilledModal(a,null,c,"Reply Tweet")});$("body").on("click",".direct-message",function(c){$(".more-options-list").toggle(false);$("#socialsuite_twitter_messageModal").remove();var b=($(this).closest("article").attr("stream-id"));var a=($(this).closest("article").attr("id"));displayFilledModal(b,a,null,"Direct Message")});$("body").on("click",".retweet-status",function(c){$("#socialsuite_twitter_messageModal").remove();var b=($(this).closest("article").attr("stream-id"));var a=($(this).closest("article").attr("id"));displayFilledModal(b,a,null,"Retweet");$("#edit_retweet").click(function(d){d.preventDefault();if($("#send_retweet").hasClass("disabled")&&$("#edit_retweet").hasClass("disabled")){return}$("#send_retweet").remove();$("#edit_retweet").hide();$("#twit-retweet").hide();$("#send_tweet").show();$("#twit-tweet").show();$("#link-text").show();$("#tweet_scheduling").show();Message_Model.model.url="/core/social/tweet/"+b})});$("body").on("click",".undo-retweet-status",function(b){var a=$(this);showAlertModal("undow_retweet_status","confirm",function(){var g=(a.closest("article").attr("stream-id"));var f=(a.closest("article").attr("id"));var e=null;var c=Streams_List_View.collection.get(g);var d=c.get("tweetListView").get(f);var h=d.toJSON();if(c.toJSON().stream_type=="Sent"){e=h.id_str}else{if(c.toJSON().stream_type=="Home"){e=h.retweet_id}}$.get("/core/social/undoretweet/"+g+"/"+f+"/"+e,function(i){if(i=="Unsuccessful"){showNotyPopUp("information","Retry after sometime.","top",5000);return}if(h.stream_type=="Sent"){d.set("deleted_msg","deleted")}else{d.unset("retweeted_by_user")}c.get("tweetListView").add(d);$(".deleted").remove();displayTimeAgo($(".chirp-container"))}).error(function(i){displayError(null,i)})})});$("body").on("mouseleave","#twit-tweet",function(a){$("#twit-tweet").keypress()});$("body").on("click","#add_message",function(b){var a=" Sell & Market like Fortune 500 with @agilecrm";document.getElementById("twit-tweet").value+=a;$("#link-text").html("<b>Thank you.</b>");setTimeout(function(){$("#link-text").hide()},2000)});$("#socialsuite_twitter_messageModal").on("hidden.bs.modal",function(){if(this.id!="#socialsuite_twitter_messageModal"){return}$(".modal-backdrop").remove();Scheduled_Edit=false;$("#socialsuite_twitter_messageModal").remove()})});