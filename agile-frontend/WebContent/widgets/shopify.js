function showShopifyClient(i){console.log("calling show shopify client..");if(EmailList.length==0){shopifyError(Shopify_PLUGIN_NAME,"Please provide email for this contact");return}var g=[];for(var j=0;j<EmailList.length;j++){g[j]=EmailList[j].value}console.log(g);console.log("In show Shopify Client"+Shopify_Plugin_Id);queueGetRequest("widget_queue","/core/api/widgets/shopify/"+Shopify_Plugin_Id+"/"+g,"json",function h(b){console.log("In Shopify clients fetching data..");console.log(b);if(b){var d=agile_crm_get_contact_property("first_name")+" "+agile_crm_get_contact_property("last_name");var a=b;console.log("total spent "+a[0].customer.total_spent);b.unshift({name:d,id:a[0].customer.id,shop:i,total_spent:a[0].customer.total_spent,currency:a[0].currency});console.log("customer info "+d);console.log("final data "+b);var c=getTemplate("shopify-profile",b);console.log("libpath is"+LIB_PATH);console.log(c);head.js(LIB_PATH+"lib/jquery.timeago.js",function(){$(".time-ago",c).timeago()});$("#Shopify").html(c)}else{shopifyError(Shopify_PLUGIN_NAME,b.responseText)}},function f(a){console.log("In Shopify error ");console.log(a);console.log("error response "+a);$("#SHOPIFY_PROFILE_LOAD_IMAGE").remove();var b=a.responseText;if(b.indexOf("No Customer found")!=-1){console.log("No customer found");createContact(b)}else{shopifyError("Shopify",b)}})}function createContact(b){$("#"+Shopify_PLUGIN_NAME).html(getTemplate("shopify-profile-addcontact"))}function addContactToShopify(c){var d="https://"+c+"/admin/customers/new";window.open(d,"_blank")}function shopifyError(f,d){var e={};e.message=d;console.log("shopify error ");$("#"+f).html(getTemplate("shopify-error",e))}$(function(){Shopify_PLUGIN_NAME="Shopify";console.log(" welcome to shopify plugin..");SHOPIFY_PROFILE_LOAD_IMAGE='<center><img id="shopify_profile_load" src="img/ajax-loader-cursor.gif" style="margin-top: 10px;margin-bottom: 14px;"></img></center>';var i=agile_crm_get_widget(Shopify_PLUGIN_NAME);console.log("In Shopify");console.log("found widget "+i);Shopify_Plugin_Id=i.id;var j=JSON.parse(i.prefs);var h=j.shop;console.log("shop name"+h);console.log("showing shopify plugin id "+Shopify_Plugin_Id);Email=agile_crm_get_contact_property("email");console.log("email search found "+Email);EmailList=agile_crm_get_contact_properties_list("email");console.log("List of email in contact "+EmailList);var f=agile_crm_get_contact_property("first_name");var g=agile_crm_get_contact_property("last_name");console.log("found first name "+f);console.log("found last name"+g);if(g==undefined||g==null){g=" "}showShopifyClient(h);$("#shopify_add_contact").die().live("click",function(a){a.preventDefault();addContactToShopify(h)});$(".order").die().live("click",function(a){a.preventDefault();var b=$(this).attr("value");console.log("order id is "+b);$("#collapse-"+b).html(SHOPIFY_PROFILE_LOAD_IMAGE);$.ajax({url:"/core/api/widgets/shopify/items/"+Shopify_Plugin_Id+"/"+b,dataType:"json",success:function(c){console.log("success data"+c);console.log("in success order fetch.");$("#collapse-"+b).html(getTemplate("shopify-line-item",c));$("#SHOPIFY_PROFILE_LOAD_IMAGE").remove()},error:function(c){console.log("in item fetch error"+c);shopifyError(Shopify_PLUGIN_NAME,c);$("#SHOPIFY_PROFILE_LOAD_IMAGE").remove()}});if($("#collapse-"+b).hasClass("collapse")){$("#collapse-"+b).removeClass("collapse")}else{$("#collapse-"+b).addClass("collapse")}})});