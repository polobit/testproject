function showShopifyClient(g){console.log("calling show shopify client..");if(EmailList.length==0){shopifyError(Shopify_PLUGIN_NAME,"Please provide email for this contact");return}var j=[];for(var h=0;h<EmailList.length;h++){j[h]=EmailList[h].value}console.log(j);console.log("In show Shopify Client"+Shopify_Plugin_Id);queueGetRequest("widget_queue","/core/api/widgets/shopify/"+Shopify_Plugin_Id+"/"+j,"json",function f(b){console.log("In Shopify clients fetching data..");console.log(b);if(b){var d=agile_crm_get_contact_property("first_name")+" "+agile_crm_get_contact_property("last_name");var a=b;console.log("total spent "+a[0].customer.total_spent);b.unshift({name:d,id:a[0].customer.id,shop:g,total_spent:a[0].customer.total_spent,currency:a[0].currency});console.log("customer info "+d);console.log("final data "+b);var c=getTemplate("shopify-profile",b);console.log("libpath is"+LIB_PATH);console.log(c);head.js(LIB_PATH+"lib/jquery.timeago.js",function(){$(".time-ago",c).timeago()});$("#Shopify").html(c)}else{shopifyError(Shopify_PLUGIN_NAME,b.responseText)}},function i(a){console.log("In Shopify error ");console.log(a);console.log("error response "+a);$("#SHOPIFY_PROFILE_LOAD_IMAGE").remove();var b=a.responseText;if(b.indexOf("No Customer found")!=-1){console.log("No customer found");createContact(b)}else{shopifyError("Shopify",b)}})}function createContact(b){$("#"+Shopify_PLUGIN_NAME).html(getTemplate("shopify-profile-addcontact"))}function addContactToShopify(c){var d="https://"+c+"/admin/customers/new";window.open(d,"_blank")}function shopifyError(e,f){var d={};d.message=f;console.log("shopify error ");$("#"+e).html(getTemplate("shopify-error",d))}$(function(){Shopify_PLUGIN_NAME="Shopify";console.log(" welcome to shopify plugin..");SHOPIFY_PROFILE_LOAD_IMAGE='<center><img id="shopify_profile_load" src="img/ajax-loader-cursor.gif" style="margin-top: 10px;margin-bottom: 14px;"></img></center>';var g=agile_crm_get_widget(Shopify_PLUGIN_NAME);console.log("In Shopify");console.log("found widget "+g);Shopify_Plugin_Id=g.id;var h=JSON.parse(g.prefs);var f=h.shop;console.log("shop name"+f);console.log("showing shopify plugin id "+Shopify_Plugin_Id);Email=agile_crm_get_contact_property("email");console.log("email search found "+Email);EmailList=agile_crm_get_contact_properties_list("email");console.log("List of email in contact "+EmailList);var i=agile_crm_get_contact_property("first_name");var j=agile_crm_get_contact_property("last_name");console.log("found first name "+i);console.log("found last name"+j);if(j==undefined||j==null){j=" "}showShopifyClient(f);$("#shopify_add_contact").die().live("click",function(a){a.preventDefault();addContactToShopify(f)});$(".order").die().live("click",function(a){a.preventDefault();var b=$(this).attr("value");console.log("order id is "+b);$("#collapse-"+b).html(SHOPIFY_PROFILE_LOAD_IMAGE);$.ajax({url:"/core/api/widgets/shopify/items/"+Shopify_Plugin_Id+"/"+b,dataType:"json",success:function(c){console.log("success data"+c);console.log("in success order fetch.");$("#collapse-"+b).html(getTemplate("shopify-line-item",c));$("#SHOPIFY_PROFILE_LOAD_IMAGE").remove()},error:function(c){console.log("in item fetch error"+c);shopifyError(Shopify_PLUGIN_NAME,c);$("#SHOPIFY_PROFILE_LOAD_IMAGE").remove()}});if($("#collapse-"+b).hasClass("collapse")){$("#collapse-"+b).removeClass("collapse")}else{$("#collapse-"+b).addClass("collapse")}})});