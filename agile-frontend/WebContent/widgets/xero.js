function showXeroClient(){if(EmailList.length==0){xeroError(Xero_PLUGIN_NAME,"No email for this contact");return}var f=[];for(var h=0;h<EmailList.length;h++){f[h]=EmailList[h].value}console.log(f);console.log("In show Xero Client"+Xero_PLUGIN_ID);queueGetRequest("widget_queue","/core/api/widgets/xero/clients/"+Xero_PLUGIN_ID+"/"+f,"json",function g(a){console.log("In Xero clients");console.log(a);if(a){var b=$("#Xero").html(getTemplate("xero-profile",a));console.log("libpath is"+LIB_PATH);console.log(b);head.js(LIB_PATH+"lib/jquery.timeago.js",function(){$(".time-ago",b).timeago()})}else{xeroError(Xero_PLUGIN_NAME,a.responseText)}},function e(b){console.log("In Xero error ");$("#XERO_PROFILE_LOAD_IMAGE").remove();var c=b.responseText;console.log(c);if(c.indexOf("No contact found")!=-1){createContact(c)}else{if(c.indexOf("No invoices Exist for this contact")!=-1){var a={};a.ContactID=b.Contact.ContactID;console.log("invoices screen  ");$("#"+Xero_PLUGIN_NAME).html(getTemplate("xero-profile-addinvoice",a))}else{xeroError("Xero",c)}}})}function xeroError(e,f){var d={};d.message=f;console.log("error ");$("#"+e).html(getTemplate("xero-error",d))}function createContact(c){var d={};d.message=c;console.log("error ");$("#"+Xero_PLUGIN_NAME).html(getTemplate("xero-profile-addcontact",d))}function addContactToXero(c,d){console.log("in xero ad contact");$("#xero_add_contact").attr("disabled",true);$.get("/core/api/widgets/xero/add/contact/"+Xero_PLUGIN_ID+"/"+c+"/"+d+"/"+Email,function(a){console.log("In Xero add contact ");console.log(a);if(a.Status="OK"){showXeroClient()}else{xeroError(Xero_PLUGIN_NAME,a)}$("#xero_add_contact").removeAttr("disabled")})}$(function(){console.log("in xero widget.js");Xero_PLUGIN_NAME="Xero";XERO_PROFILE_LOAD_IMAGE='<center><img id="xero_profile_load" src="img/ajax-loader-cursor.gif" style="margin-top: 10px;margin-bottom: 14px;"></img></center>';var f=agile_crm_get_widget(Xero_PLUGIN_NAME);Xero_PLUGIN_ID=f.id;console.log("plugin Id"+Xero_PLUGIN_ID);if(f.prefs==undefined){xeroError(Xero_PLUGIN_NAME,"Authentication Error.Please reconfigure your Xero widget.");return}var g=JSON.parse(f.prefs);SHORT_CODE=g.xero_org_shortcode;if(typeof SHORT_CODE=="undefined"){xeroError(Xero_PLUGIN_NAME,"Authentication Error.Please reconfigure your Xero widget.");return}Email=agile_crm_get_contact_property("email");EmailList=agile_crm_get_contact_properties_list("email");var h=agile_crm_get_contact_property("first_name");var e=agile_crm_get_contact_property("last_name");if(e==undefined||e==null){e=" "}showXeroClient();$("#xero_add_contact").die().live("click",function(a){a.preventDefault();addContactToXero(h,e,Email)});$(".invoices").die().live("click",function(b){b.preventDefault();var a=$(this).attr("value");if($("#collapse-"+a).text().trim()===""){console.log("no data present");$("#collapse-"+a).html(XERO_PROFILE_LOAD_IMAGE);$.get("/core/api/widgets/xero/lineItems/"+Xero_PLUGIN_ID+"/"+a,function(c){if(c.Status="OK"){console.log((JSON.parse(c)).Invoices.Invoice);$("#collapse-"+a).html(getTemplate("xero-invoice-lineitems",(JSON.parse(c)).Invoices.Invoice))}else{console.log("error");xeroError(Xero_PLUGIN_NAME,c)}$("#XERO_PROFILE_LOAD_IMAGE").remove()})}if($("#collapse-"+a).hasClass("collapse")){$("#collapse-"+a).removeClass("collapse")}else{$("#collapse-"+a).addClass("collapse")}})});