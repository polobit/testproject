function showXeroClient(){if(EmailList.length==0){xeroError(Xero_PLUGIN_NAME,"No email for this contact");return}var c=[];for(var a=0;a<EmailList.length;a++){c[a]=EmailList[a].value}console.log(c);console.log("In show Xero Client"+Xero_PLUGIN_ID);queueGetRequest("widget_queue","/core/api/widgets/xero/clients/"+Xero_PLUGIN_ID+"/"+c,"json",function b(f){console.log("In Xero clients");console.log(f);if(f){var e=$("#Xero").html(getTemplate("xero-profile",f));console.log("libpath is"+LIB_PATH);console.log(e);head.js(LIB_PATH+"lib/jquery.timeago.js",function(){$(".time-ago",e).timeago()})}else{xeroError(Xero_PLUGIN_NAME,f.responseText)}},function d(e){console.log("In Xero error ");$("#XERO_PROFILE_LOAD_IMAGE").remove();var g=e.responseText;console.log(g);if(g.indexOf("No contact found")!=-1){createContact(g)}else{if(g.indexOf("No invoices Exist for this contact")!=-1){var f={};f.ContactID=e.Contact.ContactID;console.log("invoices screen  ");$("#"+Xero_PLUGIN_NAME).html(getTemplate("xero-profile-addinvoice",f))}else{xeroError("Xero",g)}}})}function xeroError(b,a){var c={};c.message=a;console.log("error ");$("#"+b).html(getTemplate("xero-error",c))}function createContact(b){var a={};a.message=b;console.log("error ");$("#"+Xero_PLUGIN_NAME).html(getTemplate("xero-profile-addcontact",a))}function addContactToXero(b,a){console.log("in xero ad contact");$("#xero_add_contact").attr("disabled",true);$.get("/core/api/widgets/xero/add/contact/"+Xero_PLUGIN_ID+"/"+b+"/"+a+"/"+Email,function(c){console.log("In Xero add contact ");console.log(c);if(c.Status="OK"){showXeroClient()}else{xeroError(Xero_PLUGIN_NAME,c)}$("#xero_add_contact").removeAttr("disabled")})}$(function(){console.log("in xero widget.js");Xero_PLUGIN_NAME="Xero";XERO_PROFILE_LOAD_IMAGE='<center><img id="xero_profile_load" src="img/ajax-loader-cursor.gif" style="margin-top: 10px;margin-bottom: 14px;"></img></center>';var c=agile_crm_get_widget(Xero_PLUGIN_NAME);Xero_PLUGIN_ID=c.id;console.log("plugin Id"+Xero_PLUGIN_ID);if(c.prefs==undefined){xeroError(Xero_PLUGIN_NAME,"Authentication Error.Please reconfigure your Xero widget.");return}var b=JSON.parse(c.prefs);SHORT_CODE=b.xero_org_shortcode;if(typeof SHORT_CODE=="undefined"){xeroError(Xero_PLUGIN_NAME,"Authentication Error.Please reconfigure your Xero widget.");return}Email=agile_crm_get_contact_property("email");EmailList=agile_crm_get_contact_properties_list("email");var a=agile_crm_get_contact_property("first_name");var d=agile_crm_get_contact_property("last_name");if(d==undefined||d==null){d=" "}showXeroClient();$("#xero_add_contact").die().live("click",function(e){e.preventDefault();addContactToXero(a,d,Email)});$(".invoices").die().live("click",function(e){e.preventDefault();var f=$(this).attr("value");if($("#collapse-"+f).text().trim()===""){console.log("no data present");$("#collapse-"+f).html(XERO_PROFILE_LOAD_IMAGE);$.get("/core/api/widgets/xero/lineItems/"+Xero_PLUGIN_ID+"/"+f,function(g){if(g.Status="OK"){console.log((JSON.parse(g)).Invoices.Invoice);$("#collapse-"+f).html(getTemplate("xero-invoice-lineitems",(JSON.parse(g)).Invoices.Invoice))}else{console.log("error");xeroError(Xero_PLUGIN_NAME,g)}$("#XERO_PROFILE_LOAD_IMAGE").remove()})}if($("#collapse-"+f).hasClass("collapse")){$("#collapse-"+f).removeClass("collapse")}else{$("#collapse-"+f).addClass("collapse")}})});