function showXeroClient(){if(EmailList.length==0){xeroError(Xero_PLUGIN_NAME,"No email for this contact");return}var a=[];for(var c=0;c<EmailList.length;c++){a[c]=EmailList[c].value}console.log(a);console.log("In show Xero Client"+Xero_PLUGIN_ID);queueGetRequest("widget_queue","/core/api/widgets/xero/clients/"+Xero_PLUGIN_ID+"/"+a,"json",function d(f){console.log("In Xero clients");console.log(f);if(f){var e=$("#Xero").html(getTemplate("xero-profile",f));console.log("libpath is"+LIB_PATH);console.log(e);head.js(LIB_PATH+"lib/jquery.timeago.js",function(){$(".time-ago",e).timeago()})}else{xeroError(Xero_PLUGIN_NAME,f.responseText)}},function b(g){console.log("In Xero error ");$("#XERO_PROFILE_LOAD_IMAGE").remove();var f=g.responseText;console.log(f);if(f.indexOf("No contact found")!=-1){createContact(f)}else{if(f.indexOf("No invoices Exist for this contact")!=-1){var e={};e.ContactID=g.Contact.ContactID;console.log("invoices screen  ");$("#"+Xero_PLUGIN_NAME).html(getTemplate("xero-profile-addinvoice",e))}else{xeroError("Xero",f)}}})}function xeroError(c,b){var a={};a.message=b;console.log("error ");$("#"+c).html(getTemplate("xero-error",a))}function createContact(b){var a={};a.message=b;console.log("error ");$("#"+Xero_PLUGIN_NAME).html(getTemplate("xero-profile-addcontact",a))}function addContactToXero(b,a){console.log("in xero ad contact");$("#xero_add_contact").attr("disabled",true);$.get("/core/api/widgets/xero/add/contact/"+Xero_PLUGIN_ID+"/"+b+"/"+a+"/"+Email,function(c){console.log("In Xero add contact ");console.log(c);if(c.Status="OK"){showXeroClient()}else{xeroError(Xero_PLUGIN_NAME,c)}$("#xero_add_contact").removeAttr("disabled")})}$(function(){console.log("in xero widget.js");Xero_PLUGIN_NAME="Xero";XERO_PROFILE_LOAD_IMAGE='<center><img id="xero_profile_load" src="img/ajax-loader-cursor.gif" style="margin-top: 10px;margin-bottom: 14px;"></img></center>';var a=agile_crm_get_widget(Xero_PLUGIN_NAME);Xero_PLUGIN_ID=a.id;console.log("plugin Id"+Xero_PLUGIN_ID);if(a.prefs==undefined){xeroError(Xero_PLUGIN_NAME,"Authentication Error.Please reconfigure your Xero widget.");return}var d=JSON.parse(a.prefs);SHORT_CODE=d.xero_org_shortcode;if(typeof SHORT_CODE=="undefined"){xeroError(Xero_PLUGIN_NAME,"Authentication Error.Please reconfigure your Xero widget.");return}Email=agile_crm_get_contact_property("email");EmailList=agile_crm_get_contact_properties_list("email");var c=agile_crm_get_contact_property("first_name");var b=agile_crm_get_contact_property("last_name");if(b==undefined||b==null){b=" "}showXeroClient();$("#xero_add_contact").die().live("click",function(f){f.preventDefault();addContactToXero(c,b,Email)});$(".invoices").die().live("click",function(f){f.preventDefault();var g=$(this).attr("value");if($("#collapse-"+g).text().trim()===""){console.log("no data present");$("#collapse-"+g).html(XERO_PROFILE_LOAD_IMAGE);$.get("/core/api/widgets/xero/lineItems/"+Xero_PLUGIN_ID+"/"+g,function(e){if(e.Status="OK"){console.log((JSON.parse(e)).Invoices.Invoice);$("#collapse-"+g).html(getTemplate("xero-invoice-lineitems",(JSON.parse(e)).Invoices.Invoice))}else{console.log("error");xeroError(Xero_PLUGIN_NAME,e)}$("#XERO_PROFILE_LOAD_IMAGE").remove()})}if($("#collapse-"+g).hasClass("collapse")){$("#collapse-"+g).removeClass("collapse")}else{$("#collapse-"+g).addClass("collapse")}})});