function showChargifyClient(){if(EmailList.length==0){chargifyError(CHARGIFY_PLUGIN_NAME,"Please provide email for this contact");return}var h=[];for(var f=0;f<EmailList.length;f++){h[f]=EmailList[f].value}console.log(h);queueGetRequest("widget_queue","core/api/widgets/chargify/clients/"+CHARGIFY_PLUGIN_ID+"/"+h,"json",function e(a){console.log(a);if(a){console.log(a);var b=$("#"+CHARGIFY_PLUGIN_NAME).html(getTemplate("chargify-profile",a));head.js(LIB_PATH+"lib/jquery.timeago.js",function(){$(".time-ago",b).timeago()})}else{chargifyError(CHARGIFY_PLUGIN_NAME,a.responseText)}},function g(a){console.log(a.responseText);if(a.responseText=="Customer not found"){$("#"+CHARGIFY_PLUGIN_NAME).html(getTemplate("chargify-profile-addcontact",{message:"agilecrm domain of doesn't contain any customers"}))}})}function chargifyError(d,e){var f={};f.message=e;console.log("error ");$("#"+d).html(getTemplate("chargify-error",f))}function addContactToChargify(c,d){$("#chargify_add_contact").attr("disabled",true);$.get("/core/api/widgets/chargify/add/customer/"+CHARGIFY_PLUGIN_ID+"/"+c+"/"+d+"/"+Email,function(a){console.log("In Chargify add contact ");console.log(a);if(a.Status="OK"){showChargifyClient()}else{chargifyError(CHARGIFY_PLUGIN_NAME,a)}$("#chargify_add_contact").removeAttr("disabled")})}$(function(){console.log("in Chargify.js");CHARGIFY_PLUGIN_NAME="Chargify";CHARGIFY_PROFILE_LOAD_IMAGE='<center><img id="chargify_profile_load" src="img/ajax-loader-cursor.gif" style="margin-top: 10px;margin-bottom: 14px;"></img></center>';var d=agile_crm_get_widget(CHARGIFY_PLUGIN_NAME);CHARGIFY_PLUGIN_ID=d.id;console.log("plugin Id"+CHARGIFY_PLUGIN_ID);Email=agile_crm_get_contact_property("email");EmailList=agile_crm_get_contact_properties_list("email");var e=agile_crm_get_contact_property("first_name");var f=agile_crm_get_contact_property("last_name");if(f==undefined||f==null){f==" "}showChargifyClient();$("#chargify_add_contact").die().live("click",function(a){a.preventDefault();addContactToChargify(e,f,Email)})});