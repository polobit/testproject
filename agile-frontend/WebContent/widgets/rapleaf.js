function setupRapleafAuth(){$("#Rapleaf").html(getTemplate("rapleaf-login",""));console.log("In Rapleaf Auth");$("#save_api_key").die().live("click",function(b){b.preventDefault();if(!isValidForm($("#rapleaf_login_form"))){return}saveRaplefPrefs()})}function saveRaplefPrefs(){var b={};b.rapleaf_api_key=$("#rapleaf_api_key").val();agile_crm_save_widget_prefs(RAPLEAF_PLUGIN_NAME,JSON.stringify(b),function(a){showRapleafDetails()})}function showRapleafDetails(){$("#Rapleaf").html(RAPLEAF_LOADING_IMAGE);if(!Email){rapleafError(RAPLEAF_PLUGIN_NAME,"Please provide email for this contact");return}var d="core/api/widgets/rapleaf/"+Rapleaf_Plugin_Id+"/"+Email;queueGetRequest("widget_queue",d,"json",function f(a){$("#Rapleaf").html(getTemplate("rapleaf-profile",a))},function e(a){rapleafError(RAPLEAF_PLUGIN_NAME,a.responseText)})}function rapleafError(f,d){var e={};e.message=d;$("#"+f).html(getTemplate("rapleaf-error",e))}$(function(){RAPLEAF_PLUGIN_NAME="Rapleaf";RAPLEAF_LOADING_IMAGE='<div id="rap_info_load"><center><img  src="img/ajax-loader-cursor.gif" style="margin-top: 10px;margin-bottom: 14px;"></img></center></div>';var b=agile_crm_get_widget(RAPLEAF_PLUGIN_NAME);console.log("In Rapleaf");console.log(b);Rapleaf_Plugin_Id=b.id;Email=agile_crm_get_contact_property("email");console.log("Email: "+Email);if(b.prefs==undefined){setupRapleafAuth();return}showRapleafDetails()});