function showMatchedPeople(a){var d=getMatchingPeople(a);if(typeof d.errors=="undefined"){var c=d.items;if(c.length==0){if(searchDetails.keywords&&searchDetails.keywords!=""){displayError(WIDGET_NAME,"<p class='a-dotted' style='margin-bottom:0px;'>No matches found for <a href='#' class='peoplesearch'>"+searchDetails.keywords+"</a>",true)}else{displayError(WIDGET_NAME,"<p class='a-dotted' style='margin-bottom:0px;'>No matches found. <a href='#' class='peoplesearch'>Modify search</a>",true)}return}var b;if(searchDetails.keywords&&searchDetails.keywords!=""){b="<div><p class='a-dotted'>Search results for <a href='#' class='peoplesearch'>"+searchDetails.keywords+"</a></p>"}else{b="<div><p class='a-dotted'>Search results. <a href='#' class='peoplesearch'>Modify search</a></p>"}b=b.concat(getTemplate("googleplus-search-result",c));b=b+"</div>";$("#"+WIDGET_NAME).html(b)}else{return}}function showGooglePlusProfile(c){var a={};if(typeof PROFILE_DATA[""+c]=="undefined"){a=getGooglePlusUserDetails(c)}else{a=PROFILE_DATA[""+c]}var a=getGooglePlusUserDetails(c);if(typeof a.errors=="undefined"){var b;b=getTemplate("googleplus-profile",a);$("#"+WIDGET_NAME).html(b);showGooglePlusPosts(c)}else{return}}function showGooglePlusPosts(c,a){var b={};if(typeof a!="undefined"){b=getGooglePlusPosts(c,a)}else{b=getGooglePlusPosts(c)}if(typeof a!="undefined"){$("#gplus_social_stream").append(getTemplate("googleplus-posts",b));$("#gplusstreammore").attr("ntoken",b.nextPageToken)}else{$("#gpostscontainer").html(getTemplate("googleplus-profile-tabs",b));if(!b.items.length){$("#recentPostsText").html('<div style="text-align: center;font-size: 13px;padding: 5px 0 6px 0;">No Posts.</div>')}}head.js(LIB_PATH+"lib/jquery.timeago.js",function(){$(".time-ago").timeago()})}function getGooglePlusUserDetails(e){var c="https://www.googleapis.com/plus/v1/people/"+e;var a="fields=aboutMe%2CcurrentLocation%2CdisplayName%2Cdomain%2Cgender%2Cid%2Cimage%2CisPlusUser%2Coccupation%2Corganizations%2CplacesLived%2Curl";var d=googlePlusApiCall(c,a);var b=d.error;if(typeof b!="undefined"){if(b.code==401&&b.message=="Invalid Credentials"){refreshAccessToken()}else{displayError(WIDGET_NAME,b.message);return}}else{return d}return googlePlusApiCall(c,a)}function getGooglePlusPosts(f,a){var d="https://www.googleapis.com/plus/v1/people/"+f+"/activities/public";var b="fields=id%2Citems(actor(displayName%2Cid%2Cimage%2Curl)%2Cid%2Ckind%2Clocation%2Cobject(actor%2Cattachments(content%2CdisplayName%2Cid%2Cimage%2CobjectType%2Cthumbnails%2Curl)%2Ccontent%2Cid%2CobjectType%2CoriginalContent%2Curl)%2Cpublished%2Ctitle%2Cupdated%2Curl%2Cverb)%2CnextPageToken%2CselfLink%2Cupdated&maxResults=4";if(typeof a!="undefined"){b+="&pageToken="+a}var e=googlePlusApiCall(d,b);var c=e.error;if(typeof c!="undefined"){if(c.code==401&&c.message=="Invalid Credentials"){refreshAccessToken()}else{displayError(WIDGET_NAME,c.message);return}}else{return e}return googlePlusApiCall(d,b)}function getMatchingPeople(b){var d="https://www.googleapis.com/plus/v1/people";var a="query="+b+"&maxResults=20";var e=googlePlusApiCall(d,a);var c=e.error;if(typeof c!="undefined"){if(c.code==401&&c.message=="Invalid Credentials"){refreshAccessToken()}else{displayError(WIDGET_NAME,c.message);return}}else{return e}return googlePlusApiCall(d,a)}function refreshAccessToken(){var a="reqType=googleplusrefresh&widgetId="+pluginId+"&refreshToken="+widgetPref.refresh_token+"&code_token="+widgetPref.code_token;$.ajax({type:"POST",url:"/scribe",async:false,data:a,success:function(c,d,b){widgetDetails=getWidgetDetails();widgetPref=JSON.parse(widgetDetails.prefs)},error:function(b,d,c){}})}function getWidgetDetails(){return $.parseJSON($.ajax({url:"core/api/widgets/GooglePlus",async:false,dataType:"json"}).responseText)}function googlePlusApiCall(c,b){var a=$.ajax({type:"GET",url:c,async:false,data:b+"&access_token="+widgetPref.access_token,dataType:"json"});return $.parseJSON(a.responseText)}function displayError(d,c,b){var a={};a.message=c;a.disable_check=b;$("#"+d).html(getTemplate("googleplus-error-panel",a))}$(function(){WIDGET_NAME="GooglePlus";LODING_IMAGE='<div id="tweet_load"><center><img  src="img/ajax-loader-cursor.gif" style="margin-top: 10px;margin-bottom: 14px;"></img></center></div>';PROFILE_DATA={};widgetDetails=agile_crm_get_widget(WIDGET_NAME);pluginId=widgetDetails.id;widgetPref=JSON.parse(widgetDetails.prefs);searchDetails={};var a="";if(agile_crm_get_contact_property("first_name")){a=a+agile_crm_get_contact_property("first_name")}if(agile_crm_get_contact_property("last_name")){a=a+" "+agile_crm_get_contact_property("last_name")}searchDetails.keywords=a.trim();contactGooglePlusId=agile_crm_get_contact_property_by_subtype("website","GOOGLE-PLUS");if(typeof contactGooglePlusId=="undefined"){showMatchedPeople(searchDetails.keywords)}else{showGooglePlusProfile(contactGooglePlusId)}$("#GooglePlus_plugin_delete").die().live("click",function(b){b.preventDefault();contactGooglePlusId=agile_crm_get_contact_property_by_subtype("website","GOOGLE-PLUS");agile_crm_delete_contact_property_by_subtype("website","GOOGLE-PLUS",contactGooglePlusId,function(c){showMatchedPeople(searchDetails.keywords)})});$(".peoplesearch").die().live("click",function(b){b.preventDefault();$("#"+WIDGET_NAME).html(getTemplate("googleplus-modified-search",searchDetails))});$("#gpsearchbtn").die().live("click",function(c){c.preventDefault();if(!isValidForm($("#gpsearchform"))){return}var b=$("#searchkeywords").val();$("#spinner-search").show();searchDetails.keywords=b;showMatchedPeople(searchDetails.keywords)});$("#searchkeywords").die().live("keypress",function(b){if(b.keyCode==13){b.preventDefault();$("#gpsearchbtn").trigger("click")}});$("#gpsearchclose").die().live("click",function(b){showMatchedPeople(searchDetails.keywords);b.preventDefault()});$(".GoogleplusDisplayPic").die().live("mouseover",function(b){profileID=$(this).attr("id");$(this).popover({placement:"left"});$(this).popover("show");$("#"+profileID).die().live("click",function(f){f.preventDefault();$(this).popover("hide");var d=[{name:"website",value:profileID,subtype:"GOOGLE-PLUS"}];if(!agile_crm_get_contact_property("image")){var c=$(this).attr("src");d.push({name:"image",value:c})}agile_crm_update_contact_properties(d);contactGooglePlusId=profileID;showGooglePlusProfile(profileID)})});$("#gplusstreammore").die().live("click",function(c){c.preventDefault();var b=$(this).attr("ntoken");if(b==""){$("#gplusstreammore").html("No more posts.");return}$("#spinnerspan").show();showGooglePlusPosts(contactGooglePlusId,b);$("#spinnerspan").hide()})});