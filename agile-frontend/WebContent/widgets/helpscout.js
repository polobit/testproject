function showHelpScoutMails(){$("#HelpScout").html(HELPSCOUT_UPDATE_LOAD_IMAGE);if(!Email){helpscoutError(HELPSCOUT_PLUGIN_NAME,"Please provide email for this contact");return}getMailsFromHelpScout(function(a){console.log("HelpScout profile : "+a);if(a.hasOwnProperty("message")){helpscoutError(HELPSCOUT_PLUGIN_NAME,a.message)}else{$("#HelpScout").html(getTemplate("helpscout-profile",a));customerId=a.id;showMailsInHelpScout(a.id)}})}function getMailsFromHelpScout(b){queueGetRequest("widget_queue","/core/api/widgets/helpscout/get/"+HelpScout_Plugin_Id+"/"+Email,"json",function a(d){if(b&&typeof(b)==="function"){b(d)}},function c(d){helpscoutError(HELPSCOUT_PLUGIN_NAME,d.responseText)})}function showMailsInHelpScout(a){$("#all_conv_panel").html(HELPSCOUT_UPDATE_LOAD_IMAGE);queueGetRequest("widget_queue","/core/api/widgets/helpscout/get/"+HelpScout_Plugin_Id+"/customer/"+a,"json",function b(d){$("#all_conv_panel").html(getTemplate("helpscout-conversation",d));head.js(LIB_PATH+"lib/jquery.timeago.js",function(){$(".time-ago").timeago()})},function c(d){helpscoutError(HELPSCOUT_PLUGIN_NAME,d.responseText)})}function addTicketToHelpScout(){$("#add_conv").toggle();$("#helpscout_loading").toggle();var a={};a.headline="Add Conversation to HelpScout";a.info="Add Conversation in HelpScout";a.customerId=customerId;a.email=Email;$("#helpscout_messageModal").remove();queueGetRequest("widget_queue","/core/api/widgets/helpscout/get/createform/"+HelpScout_Plugin_Id,"json",function b(d){if(d.hasOwnProperty("mailboxes")){a.mailboxes=d.mailboxes;a.assignees=d.assignees;console.log(a);var e=getTemplate("helpscout-message",a);$("#content").append(e);$("#helpscout_messageModal").modal("show");$("#helpscout_messageModal input[type='radio']").live("click",function(){$("#helpscout_messageModal label.btn").toggleClass("active")});$("#add_conv").toggle();$("#helpscout_loading").toggle()}},function c(d){$("#add_conv").toggle();$("#helpscout_loading").hide();$("#helpscout_error").show();setTimeout(function(){$("#helpscout_error").hide()},2000)});$("#helpscout_send_request").die().live("click",function(d){d.preventDefault();console.log("subbmitting the HelpScout form");if(!isValidForm($("#helpscout_messageForm"))){return}sendRequestToHelpScout("/core/api/widgets/helpscout/add/"+HelpScout_Plugin_Id,"helpscout_messageForm","helpscout_messageModal","add-conv-error-panel")})}function sendRequestToHelpScout(a,b,c,d){$.post(a,$("#"+b).serialize(),function(e){$("#"+c).find("span.save-status").html("sent");setTimeout(function(){$("#"+c).modal("hide");showMailsInHelpScout(customerId)},2000)}).error(function(e){$("#"+c).remove();helpscoutStreamError(d,e.responseText)})}function helpscoutError(b,a){var c={};c.message=a;$("#"+b).html(getTemplate("helpscout-error",c))}function helpscoutStreamError(b,a){helpscoutError(b,a);$("#"+b).show();$("#"+b).fadeOut(10000)}$(function(){HELPSCOUT_PLUGIN_NAME="HelpScout";HELPSCOUT_UPDATE_LOAD_IMAGE='<center><img id="conv_load" src="img/ajax-loader-cursor.gif" style="margin-top: 10px;margin-bottom: 14px;"></img></center>';var a=agile_crm_get_widget(HELPSCOUT_PLUGIN_NAME);console.log("In HelpScout");console.log(a);HelpScout_Plugin_Id=a.id;Email=agile_crm_get_contact_property("email");console.log("Email: "+Email);customerId=0;showHelpScoutMails();$("#add_conv").die().live("click",function(b){b.preventDefault();addTicketToHelpScout()})});