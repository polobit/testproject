function showFacebookMatchingProfile(g){var f=agile_crm_get_contact_property("image");console.log("am in facebook show");queueGetRequest("widget_queue","/core/api/widgets/facebook/contacts/"+FACEBOOK_PLUGIN_ID+"?searchKey="+g,"json",function e(a){console.log("Facebook");if(a){a.searchString=SEARCH_STRING;console.log("data is:");console.log(a);var b=$("#"+FACEBOOK_PLUGIN_NAME).html(getTemplate("facebook-matching-profiles",a));$(".facebookImage").die().live("mouseover",function(){Facebook_id=$(this).attr("id");$(this).popover({placement:"left"});$(this).popover("show");$("#"+Facebook_id).die().live("click",function(d){d.preventDefault();console.log(Facebook_id);$(this).popover("hide");console.log("on click in search");var l="@"+Facebook_id;web_url=l;console.log(l);var k=[{name:"website",value:l,subtype:"FACEBOOK"}];if(!f){var c=$(this).attr("src");k.push({name:"image",value:c})}if(!agile_crm_get_contact_property("title")){}console.log(k);agile_crm_update_contact_properties(k);showFacebookProfile(Facebook_id)})})}else{facebookError(a.responseText)}},function h(a){facebookError(a.responseText)})}function facebookError(c){var d={};d.message=c;console.log("error ");$("#"+FACEBOOK_PLUGIN_NAME).html(getTemplate("facebook-error",d))}function getModifiedFacebookMatchingProfiles(){console.log("am in getModifiedFacebookMatchingProfiles");if(!isValidForm($("#facebook-search_form"))){return}$("#spinner-facebook-search").show();SEARCH_STRING=$("#facebook_keywords").val();showFacebookMatchingProfile(SEARCH_STRING)}function showFacebookProfile(e){console.log("am in facbook profile");queueGetRequest("widget_queue","/core/api/widgets/facebook/userProfile/"+FACEBOOK_PLUGIN_ID+"/"+e,"json",function d(c){console.log("Facebook");console.log(c);if(c){var a=agile_crm_get_contact_property("image");console.log(a);c.image=a;$("#Twitter_plugin_delete").show();var b=$("#"+FACEBOOK_PLUGIN_NAME).html(getTemplate("facebook-profile",c));$("#facebook_post_btn").die().live("click",function(){console.log("post on a wall");queueGetRequest("widget_queue","/core/api/widgets/facebook/postonwall/"+FACEBOOK_PLUGIN_ID+"/"+e+"/hai","json",function i(g){console.log("am at success")},function j(g){facebookError(g.responseText)})})}else{facebookError(c.responseText)}},function f(a){facebookError(a.responseText)})}function getUserNameOrUserID(d){var c=d.lastIndexOf("/");return d.substring(c+1)}$(function(){console.log("in facebook.js");FACEBOOK_PLUGIN_NAME="Facebook";FACEBOOK_PROFILE_LOAD_IMAGE='<center><img id="facebook_profile_load" src="img/ajax-loader-cursor.gif" style="margin-top: 10px;margin-bottom: 14px;"></img></center>';var p=agile_crm_get_widget(FACEBOOK_PLUGIN_NAME);FACEBOOK_PLUGIN_ID=p.id;console.log("plugin Id"+FACEBOOK_PLUGIN_ID);var o=agile_crm_get_contact_property("first_name");var j=agile_crm_get_contact_property("last_name");if(j==undefined||j==null){j=""}console.log("firstName:"+o+"lastname:"+j);SEARCH_STRING=o+" "+j;console.log("    SEARCH_STRING"+SEARCH_STRING);web_url=agile_crm_get_contact_property_by_subtype("website","FACEBOOK");console.log(web_url);if(web_url){console.log("profile attched"+web_url);var l=buildFacebookProfileURL(web_url);var k=getUserNameOrUserID(l);var n=k;console.log(n);if(isNaN(n)){console.log("In getID facebook");var q="https://graph.facebook.com/"+n;console.log(q);var r=$.parseJSON($.ajax({url:q,async:false,dataType:"json"}).responseText);console.log(r);if(typeof r.id!="undefined"){n=r.id;var m=[{name:"website",value:"@"+n,subtype:"FACEBOOK"}];console.log(m);agile_crm_update_contact_properties(m)}else{if(typeof r.error!="undefined"){facebookError("Facebook profile do not exist.("+l+")");return}}}showFacebookProfile(n)}else{console.log("no profile attached");showFacebookMatchingProfile(SEARCH_STRING)}$("#facebook_search_btn").die().live("click",function(a){a.preventDefault();getModifiedFacebookMatchingProfiles()});$(".facebook_modify_search").die().live("click",function(a){a.preventDefault();$("#"+FACEBOOK_PLUGIN_NAME).html(getTemplate("facebook-modified-search",{searchString:SEARCH_STRING}))});$("#facebook_search_close").die().live("click",function(a){a.preventDefault()});$("#Facebook_plugin_delete").die().live("click",function(a){a.preventDefault();web_url=agile_crm_get_contact_property_by_subtype("website","FACEBOOK");console.log("deleting facebook acct.",web_url);agile_crm_delete_contact_property_by_subtype("website","FACEBOOK",web_url,function(b){console.log("In facebook delete callback");showFacebookMatchingProfile()})})});