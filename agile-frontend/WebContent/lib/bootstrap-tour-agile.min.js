(function(){(function(d,c){var b,a;a=c.document;b=(function(){function e(f){this._options=d.extend({name:"tour",labels:{end:"End tour",next:"Next &raquo;",prev:"&laquo; Prev"},template:'<div class="popover page-tour '+f.name+'"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>',container:"body",keyboard:true,useLocalStorage:false,debug:false,backdrop:false,redirect:true,endOnLast:false,basePath:"",afterSetState:function(g,h){},afterGetState:function(g,h){},afterRemoveState:function(g){},onStart:function(g){},onEnd:function(g){},onShow:function(g){},onShown:function(g){},onHide:function(g){},onHidden:function(g){},onNext:function(g){},onPrev:function(g){}},f);if(!this._options.useLocalStorage&&!d.cookie){this._debug("jQuery.cookie is not loaded.")}this._steps=[];this.setCurrentStep();this.backdrop={overlay:null,step:null,background:null}}e.prototype.setState=function(f,g){f=""+this._options.name+"_"+f;if(this._options.useLocalStorage){c.localStorage.setItem(f,g)}else{d.cookie(f,g,{expires:36500,path:"/"})}return this._options.afterSetState(f,g)};e.prototype.removeState=function(f){f=""+this._options.name+"_"+f;if(this._options.useLocalStorage){c.localStorage.removeItem(f)}else{d.removeCookie(f,{path:"/"})}return this._options.afterRemoveState(f)};e.prototype.getState=function(f){var g;if(this._options.useLocalStorage){g=c.localStorage.getItem(""+this._options.name+"_"+f)}else{g=d.cookie(""+this._options.name+"_"+f)}if(g===void 0||g==="null"){g=null}this._options.afterGetState(f,g);return g};e.prototype.addSteps=function(h){var i,j,g,f;f=[];for(j=0,g=h.length;j<g;j++){i=h[j];f.push(this.addStep(i))}return f};e.prototype.addStep=function(f){return this._steps.push(f)};e.prototype.getStep=function(f){if(this._steps[f]!=null){return d.extend({path:"",placement:"right",title:"",content:"",id:"step-"+f,next:f===this._steps.length-1?-1:f+1,prev:f-1,animation:true,backdrop:this._options.backdrop,redirect:this._options.redirect,onShow:this._options.onShow,onShown:this._options.onShown,onHide:this._options.onHide,onHidden:this._options.onHidden,onNext:this._options.onNext,onPrev:this._options.onPrev,template:this._options.template,container:this._options.container},this._steps[f])}};e.prototype.start=function(f){var g,h=this;if(f==null){f=false}if(this.ended()&&!f){return this._debug("Tour ended, start prevented.")}d(a).off("click.bootstrap-tour",".popover .next").on("click.bootstrap-tour",".popover .next",function(i){i.preventDefault();return h.next()});d(a).off("click.bootstrap-tour",".popover .prev").on("click.bootstrap-tour",".popover .prev",function(i){i.preventDefault();return h.prev()});d(a).off("click.bootstrap-tour",".popover .end").on("click.bootstrap-tour",".popover .end",function(i){i.preventDefault();return h.end()});this._onresize(function(){return h.showStep(h._current)});this._setupKeyboardNavigation();g=this._makePromise(this._options.onStart!=null?this._options.onStart(this):void 0);return this._callOnPromiseDone(g,this.showStep,this._current)};e.prototype.next=function(){var f;f=this.hideStep(this._current);return this._callOnPromiseDone(f,this.showNextStep)};e.prototype.prev=function(){var f;f=this.hideStep(this._current);return this._callOnPromiseDone(f,this.showPrevStep)};e.prototype.end=function(){var f,g,h=this;f=function(i){d(a).off("click.bootstrap-tour");d(a).off("keyup.bootstrap-tour");d(c).off("resize.bootstrap-tour");h.setState("end","yes");h._hideBackdrop();if(h._options.onEnd!=null){return h._options.onEnd(h)}};g=this.hideStep(this._current);return this._callOnPromiseDone(g,f)};e.prototype.ended=function(){return !!this.getState("end")};e.prototype.restart=function(){this.removeState("current_step");this.removeState("end");this.setCurrentStep(0);return this.start()};e.prototype.hideStep=function(g){var f,j,h,k=this;h=this.getStep(g);j=this._makePromise((h.onHide!=null?h.onHide(this):void 0));f=function(l){var i;i=d(h.element).popover("hide");if(h.reflex){i.css("cursor","").off("click.boostrap-tour")}if(h.backdrop){k._hideBackdrop()}if(h.onHidden!=null){return h.onHidden(k)}};this._callOnPromiseDone(j,f);return j};e.prototype.showStep=function(f){var j,h,g,k=this;g=this.getStep(f);if(!g){return}j=this._makePromise((g.onShow!=null?g.onShow(this):void 0));h=function(l){var m,i;k.setCurrentStep(f);i=typeof g.path==="function"?g.path.call():k._options.basePath+g.path;m=[a.location.pathname,a.location.hash].join("");if(k._isRedirect(i,m)){k._redirect(g,i);return}if(!((g.element!=null)&&d(g.element).length!==0&&d(g.element).is(":visible"))){k._debug("Skip the step "+(k._current+1)+". The element does not exist or is not visible.");k.showNextStep();return}if(g.backdrop){k._showBackdrop(g.element)}k._showPopover(g,f);if(g.onShown!=null){g.onShown(k)}return k._debug("Step "+(k._current+1)+" of "+k._steps.length)};return this._callOnPromiseDone(j,h)};e.prototype.setCurrentStep=function(f){if(f!=null){this._current=f;return this.setState("current_step",f)}else{this._current=this.getState("current_step");if(this._current===null){return this._current=0}else{return this._current=parseInt(this._current)}}};e.prototype.showNextStep=function(){var h,f,g,i=this;g=this.getStep(this._current);f=function(j){return i.showStep(g.next)};h=this._makePromise((g.onNext!=null?g.onNext(this):void 0));return this._callOnPromiseDone(h,f)};e.prototype.showPrevStep=function(){var h,f,g,i=this;g=this.getStep(this._current);f=function(j){return i.showStep(g.prev)};h=this._makePromise((g.onPrev!=null?g.onPrev(this):void 0));return this._callOnPromiseDone(h,f)};e.prototype._debug=function(f){if(this._options.debug){return c.console.log("Bootstrap Tour '"+this._options.name+"' | "+f)}};e.prototype._isRedirect=function(g,f){return(g!=null)&&g!==""&&g.replace(/\?.*$/,"").replace(/\/?$/,"")!==f.replace(/\/?$/,"")};e.prototype._redirect=function(f,g){if(typeof f.redirect==="function"){return f.redirect.call(this,g)}else{if(f.redirect===true){this._debug("Redirect to "+g);return a.location.href=g}}};e.prototype._renderNavigation=function(h,f){var g,i;i=[];if(h.prev>=0){i.push("<a href='#"+h.prev+"' class='prev'>"+f.labels.prev+"</a>")}if(h.next>=0&&f.endOnLast&&h.prev!=-1){i.push("<a href='#"+h.next+"' class='next pull-right'>"+f.labels.next+"</a>")}else{if(h.next>=0){i.push("<a href='#"+h.next+"' class='next'>"+f.labels.next+"</a>")}}if(f.endOnLast){g=i.join(" ")}else{g=i.join(" | ")}if(!f.endOnLast){return g+="<a href='#' class='pull-right end'>"+f.labels.end+"</a>"}else{if(h.next<=0){return g+="<a href='#' class='pull-right end'>"+f.labels.end+"</a>"}}return g};e.prototype._showPopover=function(j,g){var k,h,f,l=this;h=""+j.content+"<br /><p>";f=d.extend({},this._options);if(j.options){d.extend(f,j.options)}if(j.reflex){d(j.element).css("cursor","pointer").on("click.bootstrap-tour",function(i){return l.next()})}h+=this._renderNavigation(j,f);d(j.element).popover({placement:j.placement,trigger:"manual",title:j.title,content:h,html:true,animation:j.animation,container:j.container,template:j.template}).popover("show");k=d(j.element).data("popover").tip();k.attr("id",j.id);this._reposition(k,j);return this._scrollIntoView(k)};e.prototype._reposition=function(n,g){var i,k,h,l,j,f,m;j=n[0].offsetWidth;l=n[0].offsetHeight;m=n.offset();h=m.left;f=m.top;i=d(a).outerHeight()-m.top-d(n).outerHeight();if(i<0){m.top=m.top+i}k=d("html").outerWidth()-m.left-d(n).outerWidth();if(k<0){m.left=m.left+k}if(m.top<0){m.top=0}if(m.left<0){m.left=0}n.offset(m);if(g.placement==="bottom"||g.placement==="top"){if(h!==m.left){return this._replaceArrow(n,(m.left-h)*2,j,"left")}}else{if(f!==m.top){return this._replaceArrow(n,(m.top-f)*2,l,"top")}}};e.prototype._replaceArrow=function(g,i,h,f){return g.find(".arrow").css(f,i?50*(1-i/h)+"%":"")};e.prototype._scrollIntoView=function(f){var g;g=f.get(0).getBoundingClientRect();if(!(g.top>=0&&g.bottom<d(c).height()&&g.left>=0&&g.right<d(c).width())){return f.get(0).scrollIntoView(true)}};e.prototype._onresize=function(f,g){return d(c).on("resize.bootstrap-tour",function(){clearTimeout(g);return g=setTimeout(f,100)})};e.prototype._setupKeyboardNavigation=function(){var f=this;if(this._options.keyboard){return d(a).on("keyup.bootstrap-tour",function(g){if(!g.which){return}switch(g.which){case 39:g.preventDefault();if(f._current<f._steps.length-1){return f.next()}else{return f.end()}break;case 37:g.preventDefault();if(f._current>0){return f.prev()}break;case 27:g.preventDefault();return f.end()}})}};e.prototype._makePromise=function(f){if(f&&d.isFunction(f.then)){return f}else{return null}};e.prototype._callOnPromiseDone=function(h,g,f){var i=this;if(h){return h.then(function(j){return g.call(i,f)})}else{return g.call(this,f)}};e.prototype._showBackdrop=function(f){if(this.backdrop.overlay!==null){return}this._showOverlay();return this._showOverlayElement(f)};e.prototype._hideBackdrop=function(){if(this.backdrop.overlay===null){return}this._hideOverlayElement();return this._hideOverlay()};e.prototype._showOverlay=function(){this.backdrop=d("<div/>");this.backdrop.addClass("tour-backdrop");this.backdrop.height(d(a).innerHeight());return d("body").append(this.backdrop)};e.prototype._hideOverlay=function(){this.backdrop.remove();return this.backdrop.overlay=null};e.prototype._showOverlayElement=function(g){var f,j,i,h;h=d(g);i=0;j=h.offset();j.top=j.top-i;j.left=j.left-i;f=d("<div/>");f.width(h.innerWidth()+i).height(h.innerHeight()+i).addClass("tour-step-background").offset(j);h.addClass("tour-step-backdrop");d("body").append(f);this.backdrop.step=h;return this.backdrop.background=f};e.prototype._hideOverlayElement=function(){this.backdrop.step.removeClass("tour-step-backdrop");this.backdrop.background.remove();this.backdrop.step=null;return this.backdrop.background=null};return e})();return c.Tour=b})(jQuery,window)}).call(this);